/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2014 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 __fastcall AppleUSBFTDI::MetaClass::MetaClass(AppleUSBFTDI::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBFTDI::MetaClass::~MetaClass(AppleUSBFTDI::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBFTDI::AppleUSBFTDI(IOSerialDriverSync *a1, const OSMetaClass *a2);
__int64 __fastcall AppleUSBFTDI::AppleUSBFTDI(IOSerialDriverSync *a1, const OSMetaClass *a2);
__int64 __fastcall AppleUSBFTDI::~AppleUSBFTDI(AppleUSBFTDI *__hidden this); // idb
__int64 __fastcall AppleUSBFTDI::~AppleUSBFTDI(AppleUSBFTDI *__hidden this); // idb
void __fastcall AppleUSBFTDI::~AppleUSBFTDI(AppleUSBFTDI *this);
__int64 __fastcall AppleUSBFTDI::getMetaClass(AppleUSBFTDI *__hidden this); // idb
__int64 __fastcall AppleUSBFTDI::MetaClass::MetaClass(AppleUSBFTDI::MetaClass *__hidden this); // idb
IOSerialDriverSync *__fastcall AppleUSBFTDI::MetaClass::alloc(AppleUSBFTDI::MetaClass *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBFTDI::AppleUSBFTDI(IOSerialDriverSync *a1);
__int64 __fastcall AppleUSBFTDI::AppleUSBFTDI(IOSerialDriverSync *a1);
signed __int64 __fastcall AppleUSBFTDI::AddBytetoQueue(__int64 a1, __int64 a2, char a3);
signed __int64 __fastcall AppleUSBFTDI::GetBytetoQueue(__int64 a1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBFTDI::InitQueue(__int64 a1, __int64 a2, __int64 a3, __int64 a4);
__int64 __fastcall AppleUSBFTDI::CloseQueue(__int64 a1, __int64 a2);
unsigned __int64 __fastcall AppleUSBFTDI::AddtoRXQueue(__int64 a1, __int64 a2, __int64 a3, __int64 a4);
__int64 __fastcall AppleUSBFTDI::FreeSpaceinQueue(__int64 a1, __int64 a2);
unsigned __int64 __fastcall AppleUSBFTDI::AddtoQueue(__int64 a1, __int64 a2, __int64 a3, unsigned __int64 a4);
// unsigned __int64 __usercall AppleUSBFTDI::RemovefromQueue@<rax>(__int64 a1@<rax>, __int64 a2@<rdx>, unsigned __int64 a3@<rcx>, __int64 a4@<rdi>, __int64 a5@<rsi>);
__int64 __fastcall AppleUSBFTDI::UsedSpaceinQueue(__int64 a1, __int64 a2);
__int64 __fastcall AppleUSBFTDI::GetQueueSize(__int64 a1, __int64 a2);
signed __int64 __fastcall AppleUSBFTDI::GetQueueStatus(__int64 a1, __int64 a2);
int __fastcall AppleUSBFTDI::CheckQueues(AppleUSBFTDI *this);
int __fastcall AppleUSBFTDI::CheckHold(AppleUSBFTDI *this);
__int64 __fastcall AppleUSBFTDI::handleCompletionGated(AppleUSBFTDI *this, void *, void *, void *, void *); // idb
// int __usercall AppleUSBFTDI::dataReadComplete@<eax>(AppleUSBFTDI *this@<rdi>, void *a2@<rsi>, int result@<eax>, int a4@<edx>, int a5@<ecx>);
// char __usercall AppleUSBFTDI::dataWriteComplete@<al>(AppleUSBFTDI *this@<rdi>, void *a2@<rsi>, char *a3@<rax>, int a4@<edx>);
int __fastcall AppleUSBFTDI::merComplete(AppleUSBFTDI *this, void *a2);
int __fastcall AppleUSBFTDI::handleCompletion(AppleUSBFTDI *this, void *a2);
int __fastcall AppleUSBFTDI::usbComplete(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5);
int __fastcall AppleUSBFTDI::dataReadCompleteUSB(AppleUSBFTDI *this, void *a2, void *a3, int a4);
int __fastcall AppleUSBFTDI::dataWriteCompleteUSB(AppleUSBFTDI *this, void *a2, void *a3, unsigned int a4);
int __fastcall AppleUSBFTDI::merCompleteUSB(AppleUSBFTDI *this, void *a2, void *a3, unsigned int a4);
int __fastcall AppleUSBFTDI::checkPipe(__int64 a1, __int64 a2, char a3);
char __fastcall AppleUSBFTDI::setUpTransmit(AppleUSBFTDI *this);
int __fastcall AppleUSBFTDI::probe(AppleUSBFTDI *this, IOService *a2, int *a3);
char __fastcall AppleUSBFTDI::checkDevice(__int64 a1, __int64 a2);
char __fastcall AppleUSBFTDI::start(AppleUSBFTDI *this, IOService *a2);
__int64 __fastcall AppleUSBFTDI::initStructure(AppleUSBFTDI *__hidden this); // idb
char __fastcall AppleUSBFTDI::idChip(AppleUSBFTDI *this);
// char __usercall AppleUSBFTDI::allocateResources@<al>(AppleUSBFTDI *this@<rdi>, __int64 a2@<rax>);
char __fastcall AppleUSBFTDI::createSerialStream(AppleUSBFTDI *this, unsigned __int64 a2);
int __fastcall AppleUSBFTDI::releaseResources(AppleUSBFTDI *this);
char __fastcall AppleUSBFTDI::initForPM(AppleUSBFTDI *this, IOService *a2);
char __fastcall AppleUSBFTDI::WakeonRing(AppleUSBFTDI *this);
int __fastcall AppleUSBFTDI::setWakeFeature(AppleUSBFTDI *this);
char __fastcall AppleUSBFTDI::setupWakeOnRingPMCallback(AppleUSBFTDI *this);
int __fastcall AppleUSBFTDI::stop(AppleUSBFTDI *this, IOService *a2);
__int64 __fastcall AppleUSBFTDI::stopAction(AppleUSBFTDI *__hidden this, OSObject *, void *, void *, void *, void *); // idb
int __fastcall AppleUSBFTDI::stopGated(AppleUSBFTDI *this);
bool __fastcall AppleUSBFTDI::createWorkLoop(AppleUSBFTDI *this);
__int64 __fastcall AppleUSBFTDI::getWorkLoop(AppleUSBFTDI *__hidden this); // idb
char __fastcall AppleUSBFTDI::createSuffix(AppleUSBFTDI *this, unsigned __int8 *a2);
int __fastcall AppleUSBFTDI::acquirePort(AppleUSBFTDI *this, __int64 a2, void *a3);
int __fastcall AppleUSBFTDI::acquirePortAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6);
int __fastcall AppleUSBFTDI::startReads(AppleUSBFTDI *this);
__int64 __fastcall AppleUSBFTDI::acquirePortGated(AppleUSBFTDI *this, char a2);
__int64 __fastcall AppleUSBFTDI::setStructureDefaults(AppleUSBFTDI *__hidden this); // idb
char __fastcall AppleUSBFTDI::sendReset(AppleUSBFTDI *this, __int16 a2);
char __fastcall AppleUSBFTDI::sendFlowCtrl(AppleUSBFTDI *this, int a2, unsigned __int8 a3, unsigned __int8 a4);
int __fastcall AppleUSBFTDI::releasePort(AppleUSBFTDI *this, void *a2);
int __fastcall AppleUSBFTDI::releasePortAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6);
// __int64 __usercall AppleUSBFTDI::releasePortGated@<rax>(AppleUSBFTDI *this@<rdi>, __int64 a2@<rax>);
char __fastcall AppleUSBFTDI::setModemCtrl(AppleUSBFTDI *this, unsigned __int8 a2, unsigned __int8 a3);
__int64 __fastcall AppleUSBFTDI::getState(AppleUSBFTDI *__hidden this, void *); // idb
int __fastcall AppleUSBFTDI::getStateAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6);
__int64 __fastcall AppleUSBFTDI::getStateGated(AppleUSBFTDI *this); // idb
__int64 __fastcall AppleUSBFTDI::setState(AppleUSBFTDI *this, __int64 a2, __int64 a3, void *a4);
int __fastcall AppleUSBFTDI::setStateAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6);
__int64 __fastcall AppleUSBFTDI::setStateGated(AppleUSBFTDI *this, unsigned int *, unsigned int *); // idb
// __int64 __usercall AppleUSBFTDI::watchState@<rax>(AppleUSBFTDI *this@<rdi>, unsigned int *a2@<rsi>, void *a3@<rcx>, __int64 a4@<rax>, __int64 a5@<rdx>);
int __fastcall AppleUSBFTDI::watchStateAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6);
__int64 __fastcall AppleUSBFTDI::watchStateGated(AppleUSBFTDI *__hidden this, unsigned int *, unsigned int *); // idb
__int64 __fastcall AppleUSBFTDI::nextEvent(AppleUSBFTDI *__hidden this, void *); // idb
__int64 __fastcall AppleUSBFTDI::executeEvent(AppleUSBFTDI *this, __int64 a2, __int64 a3, void *a4);
int __fastcall AppleUSBFTDI::executeEventAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6);
__int64 __fastcall AppleUSBFTDI::executeEventGated(AppleUSBFTDI *this, unsigned int *, unsigned int *); // idb
char __fastcall AppleUSBFTDI::sendLatency(AppleUSBFTDI *this, __int16 a2);
char __fastcall AppleUSBFTDI::setBitMode(AppleUSBFTDI *this, __int16 a2, __int16 a3);
__int64 __fastcall AppleUSBFTDI::setData(AppleUSBFTDI *__hidden this); // idb
__int64 __fastcall AppleUSBFTDI::setBaudRate(AppleUSBFTDI *this); // idb
char __fastcall AppleUSBFTDI::setBreak(AppleUSBFTDI *this, char a2);
__int64 __fastcall AppleUSBFTDI::requestEvent(AppleUSBFTDI *this, signed int a2, unsigned int *a3, void *a4);
__int64 __fastcall AppleUSBFTDI::enqueueEvent(AppleUSBFTDI *this, __int64 a2, __int64 a3, __int64 a4, void *a5);
__int64 __fastcall AppleUSBFTDI::dequeueEvent(AppleUSBFTDI *this, unsigned int *a2, unsigned int *a3, __int64 a4, void *a5);
__int64 __fastcall AppleUSBFTDI::enqueueData(AppleUSBFTDI *this, unsigned __int8 *a2, __int64 a3, unsigned int *a4, __int64 a5, void *a6);
int __fastcall AppleUSBFTDI::enqueueDataAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6);
int __fastcall AppleUSBFTDI::enqueueDataGated(AppleUSBFTDI *this, unsigned __int8 *a2, unsigned int *a3, unsigned int *a4, bool *a5);
__int64 __fastcall AppleUSBFTDI::dequeueData(AppleUSBFTDI *this, unsigned __int8 *a2, __int64 a3, unsigned int *a4, __int64 a5, void *a6);
int __fastcall AppleUSBFTDI::dequeueDataAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6);
__int64 __fastcall AppleUSBFTDI::dequeueDataGated(AppleUSBFTDI *this, unsigned __int8 *, unsigned int *, unsigned int *, unsigned int *); // idb
int __fastcall AppleUSBFTDI::startTransmission(AppleUSBFTDI *this);
__int64 __fastcall AppleUSBFTDI::calculateDeviceBaud(AppleUSBFTDI *__hidden this, unsigned __int16 *, unsigned __int16 *); // idb
char __fastcall AppleUSBFTDI::getDeviceBaud(AppleUSBFTDI *this, unsigned __int16 *a2, unsigned __int16 *a3);
char __fastcall AppleUSBFTDI::USBSendRequest(__int64 a1, char a2, char a3, __int16 a4, __int16 a5, __int64 a6, __int16 a7);
bool __fastcall AppleUSBFTDI::allocateRingBuffer(__int64 a1, __int64 a2);
int __fastcall AppleUSBFTDI::freeRingBuffer(__int64 a1, __int64 a2);
int __fastcall AppleUSBFTDI::handleSettingCallback(AppleUSBFTDI *this, const OSSymbol *a2, OSObject *a3);
int __fastcall AppleUSBFTDI::clearSleepingThreads(AppleUSBFTDI *this);
unsigned int __fastcall AppleUSBFTDI::resurrectRead(AppleUSBFTDI *this);
int __fastcall AppleUSBFTDI::didTerminate(AppleUSBFTDI *this, IOService *a2, __int64 a3, bool *a4);
__int64 __fastcall AppleUSBFTDI::message(AppleUSBFTDI *this, __int64 a2, IOService *a3, void *a4);
__int64 __fastcall AppleUSBFTDI::initialPowerStateForDomainState(AppleUSBFTDI *this);
signed __int64 __fastcall AppleUSBFTDI::setPowerState(AppleUSBFTDI *this, __int64 a2, IOService *a3);
__int64 __fastcall AppleUSBFTDI::MetaClass::~MetaClass(AppleUSBFTDI::MetaClass *__hidden this); // idb
__int64 `global constructor keyed to'_a();
__int64 `global destructor keyed to'_a();
void __fastcall ftdi_LogToMessageTracer(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, int a7);
int _start();
__int64 *OSKextGetCurrentIdentifier();
__int64 *OSKextGetCurrentVersionString();
__int64 OSKextGetCurrentLoadTag();
int _stop();
// int __fastcall IODelay(_QWORD, _QWORD); weak
// int __fastcall IOFree(_QWORD, _QWORD); weak
// int IOLockAlloc(void); weak
// int IOLockFree(void); weak
// int __fastcall IOLockLock(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD); weak
// int __fastcall IOLockUnlock(_QWORD); weak
// int __fastcall IOLog(_QWORD, _QWORD, _QWORD); weak
// int __fastcall IOMalloc(_QWORD); weak
// int __fastcall IOSleep(_QWORD); weak
// _QWORD IOWorkLoop::workLoop(IOWorkLoop *__hidden this); idb
// int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD); weak
// _QWORD __cdecl OSMetaClass::~OSMetaClass(OSMetaClass *__hidden this); idb
// _QWORD __cdecl IOCommandGate::commandGate(IOCommandGate *__hidden this, OSObject *, int (__cdecl *)(OSObject *, void *, void *, void *, void *)); idb
// _QWORD __cdecl IOPMrootDomain::copyPMSetting(IOPMrootDomain *__hidden this, OSSymbol *); weak
// _QWORD __cdecl IOPMrootDomain::publishFeature(IOPMrootDomain *__hidden this, const char *); idb
// _QWORD __cdecl IOPMrootDomain::registerPMSettingController(IOPMrootDomain *__hidden this, const OSSymbol **, int (__cdecl *)(OSObject *, const OSSymbol *, OSObject *, unsigned __int64), OSObject *, unsigned __int64, OSObject **); weak
// int __fastcall OSMetaClassBase::safeMetaCast(_QWORD, _QWORD); weak
// _QWORD __cdecl IOSerialDriverSync::IOSerialDriverSync(IOSerialDriverSync *__hidden this, const OSMetaClass *); idb
// _QWORD __cdecl IOSerialDriverSync::~IOSerialDriverSync(IOSerialDriverSync *__hidden this); idb
// _QWORD IORS232SerialStreamSync::IORS232SerialStreamSync(IORS232SerialStreamSync *__hidden this); idb
// _QWORD __cdecl IOBufferMemoryDescriptor::withOptions(IOBufferMemoryDescriptor *__hidden this, unsigned int, unsigned __int64, unsigned __int64); idb
// void __cdecl OSObject::operator delete(void *); idb
// _QWORD __cdecl OSObject::operator new(OSObject *__hidden this, unsigned __int64); idb
// _QWORD __cdecl OSSymbol::withCString(OSSymbol *__hidden this, const char *); idb
// _QWORD IOService::getPMRootDomain(IOService *__hidden this); idb
// _QWORD __cdecl IOService::registerInterestedDriver(IOService *__hidden this, IOService *); idb
// _QWORD __cdecl IOService::deRegisterInterestedDriver(IOService *__hidden this, IOService *); idb
// _QWORD OSMetaClass::instanceConstructed(OSMetaClass *__hidden this); idb
// void __cdecl bzero(void *, size_t);
// int snprintf(char *, size_t, const char *, ...);
// size_t __cdecl strlcat(char *, const char *, size_t);
// size_t __cdecl strlcpy(char *, const char *, size_t);
// size_t __cdecl strlen(const char *);
// char *__cdecl strncpy(char *, const char *, size_t);
// int __fastcall thread_call_allocate(_QWORD, _QWORD); weak
// int thread_call_cancel(void); weak
// int __fastcall thread_call_enter(_QWORD); weak
// int __fastcall thread_call_free(_QWORD); weak

//-------------------------------------------------------------------------
// Data declarations

int dword_10 = 8; // weak
segment_command_64 stru_20 = { 25u, 312u, "__TEXT", 0uLL, 24576uLL, 0uLL, 24576uLL, 7, 5, 3u, 0u }; // weak
section_64 stru_68 =
{
  {
    '_',
    '_',
    't',
    'e',
    'x',
    't',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0'
  },
  "__TEXT",
  4000uLL,
  18085uLL,
  4000u,
  4u,
  0u,
  0u,
  2147484672u,
  0u,
  0u,
  0u
}; // weak
_UNKNOWN loc_1FF7; // weak
_QWORD gBaudTable[] = ; // weak
__int16 word_5F66 = 0; // weak
_QWORD off_6000[5] = { 64256LL, 64760LL, 66112LL, 66616LL, 66632LL }; // weak
_QWORD off_6008[4] = { 64760LL, 66112LL, 66616LL, 66632LL }; // weak
_QWORD off_6010[3] = { 66112LL, 66616LL, 66632LL }; // weak
__int64 off_6018[2] = { 66616LL, 66632LL }; // weak
__int64 off_6020 = 66632LL; // weak
__int64 (__fastcall *off_6060[2])(AppleUSBFTDI *__hidden this) = { &AppleUSBFTDI::~AppleUSBFTDI, &AppleUSBFTDI::~AppleUSBFTDI }; // weak
__int64 (__fastcall *off_6A00[2])(AppleUSBFTDI::MetaClass *__hidden this) = { &AppleUSBFTDI::MetaClass::~MetaClass, &AppleUSBFTDI::MetaClass::~MetaClass }; // weak
_QWORD gOurPowerStates = 1LL; // weak
__int64 kmod_info = 0LL; // weak
_QWORD AppleUSBFTDI::gMetaClass; // weak
int (*_realmain)(void); // weak
int (*_antimain)(void); // weak
_QWORD gPMWakeOnRingSymbol; // weak


//----- (0000000000000FA0) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::MetaClass::MetaClass(AppleUSBFTDI::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBFTDI", off_6008[0], 8184LL);
  result = (__int64)off_6A00;
  *(_QWORD *)this = off_6A00;
  return result;
}
// 6008: using guessed type _QWORD off_6008[4];
// 6A00: using guessed type __int64 (__fastcall *off_6A00[2])(AppleUSBFTDI::MetaClass *__hidden this);
// FAD0: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000000FD2) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::MetaClass::~MetaClass(AppleUSBFTDI::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (0000000000000FDC) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::AppleUSBFTDI(IOSerialDriverSync *a1, const OSMetaClass *a2)
{
  __int64 result; // rax@1

  IOSerialDriverSync::IOSerialDriverSync(a1, a2);
  result = (__int64)off_6060;
  *(_QWORD *)a1 = off_6060;
  return result;
}
// 6060: using guessed type __int64 (__fastcall *off_6060[2])(AppleUSBFTDI *__hidden this);

//----- (0000000000000FFC) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::AppleUSBFTDI(IOSerialDriverSync *a1, const OSMetaClass *a2)
{
  __int64 result; // rax@1

  IOSerialDriverSync::IOSerialDriverSync(a1, a2);
  result = (__int64)off_6060;
  *(_QWORD *)a1 = off_6060;
  return result;
}
// 6060: using guessed type __int64 (__fastcall *off_6060[2])(AppleUSBFTDI *__hidden this);

//----- (000000000000101C) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::~AppleUSBFTDI(AppleUSBFTDI *this)
{
  return IOSerialDriverSync::~IOSerialDriverSync(this);
}

//----- (0000000000001026) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::~AppleUSBFTDI(AppleUSBFTDI *this)
{
  return IOSerialDriverSync::~IOSerialDriverSync(this);
}

//----- (0000000000001030) ----------------------------------------------------
void __fastcall AppleUSBFTDI::~AppleUSBFTDI(AppleUSBFTDI *this)
{
  IOSerialDriverSync::~IOSerialDriverSync(this);
  OSObject::operator delete((void *)this);
}

//----- (0000000000001052) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::getMetaClass(AppleUSBFTDI *this)
{
  return (__int64)&AppleUSBFTDI::gMetaClass;
}
// 6D28: using guessed type _QWORD AppleUSBFTDI::gMetaClass;

//----- (0000000000001060) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::MetaClass::MetaClass(AppleUSBFTDI::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBFTDI", off_6008[0], 8184LL);
  result = (__int64)off_6A00;
  *(_QWORD *)this = off_6A00;
  return result;
}
// 6008: using guessed type _QWORD off_6008[4];
// 6A00: using guessed type __int64 (__fastcall *off_6A00[2])(AppleUSBFTDI::MetaClass *__hidden this);
// FAD0: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000001092) ----------------------------------------------------
IOSerialDriverSync *__fastcall AppleUSBFTDI::MetaClass::alloc(AppleUSBFTDI::MetaClass *this, unsigned __int64 a2)
{
  IOSerialDriverSync *v2; // rbx@1

  v2 = (IOSerialDriverSync *)OSObject::operator new((OSObject *)((char *)&loc_1FF7 + 1), a2);
  IOSerialDriverSync::IOSerialDriverSync(v2, (const OSMetaClass *)&AppleUSBFTDI::gMetaClass);
  *(_QWORD *)v2 = off_6060;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBFTDI::gMetaClass);
  return v2;
}
// 6060: using guessed type __int64 (__fastcall *off_6060[2])(AppleUSBFTDI *__hidden this);
// 6D28: using guessed type _QWORD AppleUSBFTDI::gMetaClass;

//----- (00000000000010D2) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::AppleUSBFTDI(IOSerialDriverSync *a1)
{
  IOSerialDriverSync::IOSerialDriverSync(a1, (const OSMetaClass *)&AppleUSBFTDI::gMetaClass);
  *(_QWORD *)a1 = off_6060;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBFTDI::gMetaClass);
}
// 6060: using guessed type __int64 (__fastcall *off_6060[2])(AppleUSBFTDI *__hidden this);
// 6D28: using guessed type _QWORD AppleUSBFTDI::gMetaClass;

//----- (0000000000001102) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::AppleUSBFTDI(IOSerialDriverSync *a1)
{
  IOSerialDriverSync::IOSerialDriverSync(a1, (const OSMetaClass *)&AppleUSBFTDI::gMetaClass);
  *(_QWORD *)a1 = off_6060;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBFTDI::gMetaClass);
}
// 6060: using guessed type __int64 (__fastcall *off_6060[2])(AppleUSBFTDI *__hidden this);
// 6D28: using guessed type _QWORD AppleUSBFTDI::gMetaClass;

//----- (0000000000001132) ----------------------------------------------------
signed __int64 __fastcall AppleUSBFTDI::AddBytetoQueue(__int64 a1, __int64 a2, char a3)
{
  __int64 v3; // rcx@1
  signed __int64 result; // rax@2

  v3 = *(_QWORD *)(a2 + 16);
  if ( v3 != *(_QWORD *)(a2 + 24) || (result = 1LL, !*(_QWORD *)(a2 + 40)) )
  {
    *(_QWORD *)(a2 + 16) = v3 + 1;
    *(_BYTE *)v3 = a3;
    ++*(_QWORD *)(a2 + 40);
    result = 0LL;
    if ( *(_QWORD *)(a2 + 16) >= *(_QWORD *)(a2 + 8) )
      *(_QWORD *)(a2 + 16) = *(_QWORD *)a2;
  }
  return result;
}

//----- (0000000000001170) ----------------------------------------------------
signed __int64 __fastcall AppleUSBFTDI::GetBytetoQueue(__int64 a1, __int64 a2, __int64 a3)
{
  __int64 v3; // rcx@1
  signed __int64 result; // rax@2

  v3 = *(_QWORD *)(a2 + 24);
  if ( *(_QWORD *)(a2 + 16) != v3 || (result = 2LL, *(_QWORD *)(a2 + 40)) )
  {
    *(_QWORD *)(a2 + 24) = v3 + 1;
    *(_BYTE *)a3 = *(_BYTE *)v3;
    --*(_QWORD *)(a2 + 40);
    result = 0LL;
    if ( *(_QWORD *)(a2 + 24) >= *(_QWORD *)(a2 + 8) )
      *(_QWORD *)(a2 + 24) = *(_QWORD *)a2;
  }
  return result;
}

//----- (00000000000011B0) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::InitQueue(__int64 a1, __int64 a2, __int64 a3, __int64 a4)
{
  *(_QWORD *)a2 = a3;
  *(_QWORD *)(a2 + 8) = a3 + a4;
  *(_QWORD *)(a2 + 32) = a4;
  *(_QWORD *)(a2 + 16) = a3;
  *(_QWORD *)(a2 + 24) = a3;
  *(_QWORD *)(a2 + 40) = 0LL;
  return 0LL;
}

//----- (00000000000011D8) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::CloseQueue(__int64 a1, __int64 a2)
{
  *(_QWORD *)a2 = 0LL;
  *(_QWORD *)(a2 + 8) = 0LL;
  *(_QWORD *)(a2 + 16) = 0LL;
  *(_QWORD *)(a2 + 24) = 0LL;
  *(_QWORD *)(a2 + 32) = 0LL;
  return 0LL;
}

//----- (0000000000001208) ----------------------------------------------------
unsigned __int64 __fastcall AppleUSBFTDI::AddtoRXQueue(__int64 a1, __int64 a2, __int64 a3, __int64 a4)
{
  __int64 v4; // r15@1
  signed __int64 v5; // r14@1
  __int64 v6; // rcx@1
  __int64 v7; // rsi@1
  unsigned __int64 v8; // rbx@1
  bool v9; // al@2
  __int64 v10; // r12@4

  v4 = a2;
  v5 = a4 - 2;
  v6 = *(_QWORD *)(a2 + 32);
  v7 = *(_QWORD *)(a2 + 40);
  v8 = 0LL;
  if ( v6 - v7 >= (unsigned __int64)v5 )
  {
    v9 = v5 != 0;
    v8 = 0LL;
    if ( v6 != v7 && v5 )
    {
      v10 = *(_QWORD *)(a3 + 8);
      v8 = 0LL;
      do
      {
        AppleUSBFTDI::AddBytetoQueue(a1, v4, *(_BYTE *)(v10 + v8++ + 2));
        v9 = v8 < v5;
      }
      while ( *(_QWORD *)(v4 + 32) != *(_QWORD *)(v4 + 40) && v5 > v8 );
    }
    if ( v9 )
      IOLog(
        "%8x %8x AppleUSBFTDI: AddtoRXQueue - Queue full, data has been dropped\n",
        (unsigned int)v8,
        (unsigned int)v5);
  }
  return v8;
}
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);

//----- (0000000000001294) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::FreeSpaceinQueue(__int64 a1, __int64 a2)
{
  return *(_QWORD *)(a2 + 32) - *(_QWORD *)(a2 + 40);
}

//----- (00000000000012A2) ----------------------------------------------------
unsigned __int64 __fastcall AppleUSBFTDI::AddtoQueue(__int64 a1, __int64 a2, __int64 a3, unsigned __int64 a4)
{
  unsigned __int64 v4; // r14@1
  __int64 v5; // r15@1
  unsigned __int64 v6; // rbx@1

  v4 = a4;
  v5 = a3;
  v6 = 0LL;
  if ( *(_QWORD *)(a2 + 32) != *(_QWORD *)(a2 + 40) && a4 )
  {
    do
      AppleUSBFTDI::AddBytetoQueue(a1, a2, *(_BYTE *)(v5 + v6++));
    while ( *(_QWORD *)(a2 + 32) != *(_QWORD *)(a2 + 40) && v6 < v4 );
  }
  return v6;
}

//----- (00000000000012F6) ----------------------------------------------------
unsigned __int64 __usercall AppleUSBFTDI::RemovefromQueue@<rax>(__int64 a1@<rax>, __int64 a2@<rdx>, unsigned __int64 a3@<rcx>, __int64 a4@<rdi>, __int64 a5@<rsi>)
{
  unsigned __int64 v5; // r14@1
  __int64 v6; // r15@1
  unsigned __int64 v7; // rbx@1
  __int64 v9; // [sp-6h] [bp-30h]@1

  v9 = a1;
  v5 = a3;
  v6 = a2;
  v7 = 0LL;
  if ( a3 )
  {
    do
    {
      if ( (unsigned int)AppleUSBFTDI::GetBytetoQueue(a4, a5, (__int64)((char *)&v9 + 7)) )
        break;
      *(_BYTE *)(v6 + v7++) = BYTE7(v9);
    }
    while ( v7 < v5 );
  }
  return v7;
}

//----- (0000000000001348) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::UsedSpaceinQueue(__int64 a1, __int64 a2)
{
  return *(_QWORD *)(a2 + 40);
}

//----- (0000000000001352) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::GetQueueSize(__int64 a1, __int64 a2)
{
  return *(_QWORD *)(a2 + 32);
}

//----- (000000000000135C) ----------------------------------------------------
signed __int64 __fastcall AppleUSBFTDI::GetQueueStatus(__int64 a1, __int64 a2)
{
  signed __int64 result; // rax@2

  if ( *(_QWORD *)(a2 + 16) != *(_QWORD *)(a2 + 24)
    || (result = 1LL, !*(_QWORD *)(a2 + 40)) && (result = 2LL, *(_QWORD *)(a2 + 40)) )
    result = 0LL;
  return result;
}

//----- (0000000000001386) ----------------------------------------------------
int __fastcall AppleUSBFTDI::CheckQueues(AppleUSBFTDI *this)
{
  int v1; // eax@1
  __int64 v2; // rsi@1
  unsigned int v3; // ecx@3
  unsigned __int64 v4; // rsi@6
  unsigned int v5; // edx@6
  int v6; // ecx@6
  unsigned int v7; // edx@8
  int v8; // ecx@8
  __int64 v9; // rsi@10
  unsigned int v10; // edx@11
  unsigned int v11; // ecx@12
  unsigned __int64 v12; // rsi@16
  unsigned int v13; // edx@16
  int v14; // ecx@16
  unsigned int v15; // edx@18
  int v16; // ecx@18
  __int64 v17; // rcx@20
  int v19; // [sp+8h] [bp-8h]@20
  unsigned int v20; // [sp+Ch] [bp-4h]@1

  v1 = *((_DWORD *)this + 72);
  v20 = *((_DWORD *)this + 72);
  v2 = *((_QWORD *)this + 48);
  if ( *((_DWORD *)this + 94) == (_DWORD)v2 )
  {
    v3 = v1 & 0xFB7FFFFF | 0x800000;
  }
  else
  {
    v20 = v1 & 0xFF7FFFFF;
    if ( (_DWORD)v2 )
      v3 = v1 & 0xFB7FFFFF;
    else
      v3 = v1 & 0xFF7FFFFF | 0x4000000;
  }
  v20 = v3;
  v4 = (unsigned int)v2 & 0xFFFFFFFF;
  v5 = v3 & 0xFDFFFFFF;
  v6 = v3 | 0x2000000;
  if ( v4 >= *((_QWORD *)this + 120) )
    v6 = v5;
  v7 = v6 & 0xFEFFFFFF;
  v8 = v6 | 0x1000000;
  if ( v4 <= *((_QWORD *)this + 119) )
    v8 = v7;
  v20 = v8;
  v9 = *((_QWORD *)this + 42);
  if ( *((_DWORD *)this + 82) == (_DWORD)v9 )
  {
    v11 = v8 & 0xFFF6FFFF | 0x10000;
    goto LABEL_14;
  }
  v10 = v8 & 0xFFFEFFFF;
  v20 = v8 & 0xFFFEFFFF;
  if ( (_DWORD)v9 )
  {
    v11 = v8 & 0xFFF6FFFF;
LABEL_14:
    v20 = v11;
    goto LABEL_16;
  }
  v20 = v10 | 0x80000;
  v11 = v10 | 0x80000;
LABEL_16:
  v12 = (unsigned int)v9 & 0xFFFFFFFF;
  v13 = v11 & 0xFFFBFFFF;
  v14 = v11 | 0x40000;
  if ( v12 >= *((_QWORD *)this + 116) )
    v14 = v13;
  v15 = v14 & 0xFFFDFFFF;
  v16 = v14 | 0x20000;
  if ( v12 <= *((_QWORD *)this + 115) )
    v16 = v15;
  v20 = v16;
  v17 = v1 ^ (unsigned int)v16;
  v19 = v17;
  return (*(int (__fastcall **)(AppleUSBFTDI *, int *, int *, __int64, signed __int64))(*(_QWORD *)this + 2392LL))(
           this,
           &v20,
           &v19,
           v17,
           0xFFFFFFFFLL);
}

//----- (00000000000014A6) ----------------------------------------------------
int __fastcall AppleUSBFTDI::CheckHold(AppleUSBFTDI *this)
{
  __int64 i; // rbx@1
  unsigned int v2; // eax@5

  for ( i = *((_QWORD *)this + *((_WORD *)this + 453) + 49); i; i = *((_QWORD *)this + (unsigned __int16)v2 + 49) )
  {
    if ( !(unsigned int)AppleUSBFTDI::AddtoRXQueue((__int64)this, (__int64)((char *)this + 296), i, *(_DWORD *)(i + 16)) )
      break;
    *(_DWORD *)(i + 16) = 0;
    *(_BYTE *)(i + 21) = 0;
    if ( (*(int (__fastcall **)(_QWORD, _QWORD, signed __int64, _QWORD))(**((_QWORD **)this + 134) + 320LL))(
           *((_QWORD *)this + 134),
           *(_QWORD *)i,
           i + 24,
           0LL) )
      *(_BYTE *)(i + 20) = 1;
    *((_QWORD *)this + *((_WORD *)this + 453) + 49) = 0LL;
    v2 = (unsigned __int16)(*((_WORD *)this + 453) + 1);
    if ( v2 > 0x3F )
      LOWORD(v2) = 0;
    *((_WORD *)this + 453) = v2;
  }
  return AppleUSBFTDI::CheckQueues(this);
}

//----- (000000000000156E) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::handleCompletionGated(AppleUSBFTDI *this, void *a2, void *a3, void *a4, void *a5)
{
  AppleUSBFTDI *v5; // r15@1
  __int64 v6; // rdi@1
  signed int v7; // er14@1
  __int64 v8; // r12@2
  __int64 v9; // rdx@2
  __int64 v10; // rcx@2
  __int64 v11; // r8@2
  __int64 v12; // rbx@8
  char *v13; // rax@8
  __int64 v14; // rdi@12

  v5 = this;
  v6 = *((_QWORD *)this + 29);
  v7 = -536870212;
  if ( v6 )
  {
    IOLockLock(v6, a2, a3, a4, a5);
    v8 = *((_QWORD *)v5 + 27);
    *((_QWORD *)v5 + 27) = 0LL;
    *((_QWORD *)v5 + 28) = 0LL;
    IOLockUnlock(*((_QWORD *)v5 + 29));
    v7 = 0;
    while ( v8 )
    {
      while ( v8 )
      {
        v12 = v8;
        v8 = *(_QWORD *)v8;
        v13 = (char *)*(_DWORD *)(v12 + 8);
        if ( (_DWORD)v13 )
        {
          if ( (_DWORD)v13 == 1 )
          {
            a2 = *(void **)(v12 + 16);
            AppleUSBFTDI::dataWriteComplete(v5, a2, v13, *(_DWORD *)(v12 + 32));
          }
          else if ( (_DWORD)v13 == 2 )
          {
            AppleUSBFTDI::merComplete(v5, *(void **)(v12 + 16));
            v14 = *(_QWORD *)(v12 + 24);
            if ( v14 )
              IOFree(v14, 24LL);
            a2 = &stru_20 + 8;
            IOFree(v12, 40LL);
          }
        }
        else
        {
          a2 = *(void **)(v12 + 16);
          AppleUSBFTDI::dataReadComplete(v5, a2, 0, *(_DWORD *)(v12 + 32), *(_DWORD *)(v12 + 36));
        }
      }
      IOLockLock(*((_QWORD *)v5 + 29), a2, v9, v10, v11);
      v8 = *((_QWORD *)v5 + 27);
      *((_QWORD *)v5 + 27) = 0LL;
      *((_QWORD *)v5 + 28) = 0LL;
      IOLockUnlock(*((_QWORD *)v5 + 29));
    }
  }
  return (unsigned int)v7;
}
// 20: using guessed type segment_command_64;
// FA48: using guessed type int __fastcall IOFree(_QWORD, _QWORD);
// FA60: using guessed type int __fastcall IOLockLock(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// FA68: using guessed type int __fastcall IOLockUnlock(_QWORD);

//----- (000000000000167A) ----------------------------------------------------
int __usercall AppleUSBFTDI::dataReadComplete@<eax>(AppleUSBFTDI *this@<rdi>, void *a2@<rsi>, int result@<eax>, int a4@<edx>, int a5@<ecx>)
{
  int v5; // er15@6
  __int64 v6; // rax@7
  int v7; // eax@8
  __int64 v8; // r15@13

  if ( *((_BYTE *)this + 138) || *((_BYTE *)this + 242) || *((_BYTE *)this + 139) || a4 == -536870165 )
    return result;
  if ( !a4 )
  {
    v5 = *((_DWORD *)this + 2034) - a5;
    if ( *((_DWORD *)this + 2034) != a5 )
    {
      v6 = *((_QWORD *)a2 + 1);
      *((_BYTE *)this + 8156) = *(_BYTE *)v6;
      *((_BYTE *)this + 8157) = *(_BYTE *)(v6 + 1);
      if ( (unsigned int)v5 >= 3 )
      {
        v7 = *((_WORD *)this + 452);
        if ( v7 != *((_WORD *)this + 453) )
          goto LABEL_11;
        if ( !(unsigned int)AppleUSBFTDI::AddtoRXQueue(
                              (__int64)this,
                              (__int64)((char *)this + 296),
                              (__int64)a2,
                              (unsigned int)v5) )
        {
          LOWORD(v7) = *((_WORD *)this + 452);
LABEL_11:
          *((_BYTE *)a2 + 21) = 1;
          *((_DWORD *)a2 + 4) = v5;
          *((_WORD *)this + 452) = v7 + 1;
          *((_QWORD *)this + (unsigned __int16)v7 + 49) = a2;
          if ( (unsigned int)*((_WORD *)this + 452) >= 0x40 )
            *((_WORD *)this + 452) = 0;
          goto LABEL_18;
        }
      }
    }
LABEL_18:
    if ( !*((_BYTE *)a2 + 21) )
    {
      if ( (*(int (__fastcall **)(_QWORD, _QWORD, char *, _QWORD))(**((_QWORD **)this + 134) + 320LL))(
             *((_QWORD *)this + 134),
             *(_QWORD *)a2,
             (char *)a2 + 24,
             0LL) )
        *((_BYTE *)a2 + 20) = 1;
    }
    return AppleUSBFTDI::CheckQueues(this);
  }
  v8 = *((_QWORD *)this + 134);
  if ( a4 == -536854449
    || (result = (*(int (__fastcall **)(_QWORD))(*(_QWORD *)v8 + 480LL))(*((_QWORD *)this + 134)), result == -536854449) )
    result = (*(int (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v8 + 488LL))(v8, 1LL);
  if ( result != -536870165 )
    goto LABEL_18;
  return result;
}

//----- (00000000000017E0) ----------------------------------------------------
char __usercall AppleUSBFTDI::dataWriteComplete@<al>(AppleUSBFTDI *this@<rdi>, void *a2@<rsi>, char *a3@<rax>, int a4@<edx>)
{
  unsigned int v4; // edx@5
  char *v5; // rax@6
  int v6; // ecx@6
  __int64 v7; // r15@11
  unsigned int v8; // edx@14
  int v9; // ecx@15
  char *v11; // [sp+0h] [bp-20h]@1

  v11 = a3;
  if ( *((_BYTE *)this + 138) || *((_BYTE *)this + 242) )
    return (char)a3;
  if ( a4 != -536870165 )
  {
    if ( !a4 )
    {
      *((_BYTE *)a2 + 20) = 1;
      AppleUSBFTDI::CheckQueues(this);
      LOWORD(v4) = *((_WORD *)this + 4083);
      if ( (_WORD)v4 )
      {
        v5 = (char *)this + 6740;
        v6 = 0;
        v4 = (unsigned __int16)v4;
        while ( *v5 )
        {
          ++v6;
          v5 += 88;
          if ( (unsigned __int16)v6 >= v4 )
            goto LABEL_9;
        }
      }
      else
      {
LABEL_9:
        v11 = (char *)0x10000000;
        (*(void (__fastcall **)(AppleUSBFTDI *, char *, __int64 *))(*(_QWORD *)this + 2392LL))(
          this,
          (char *)&v11 + 4,
          &v11);
      }
      LOBYTE(a3) = AppleUSBFTDI::setUpTransmit(this);
      return (char)a3;
    }
    v7 = *((_QWORD *)this + 134);
    if ( a4 == -536854449
      || (*(int (__fastcall **)(_QWORD))(*(_QWORD *)v7 + 480LL))(*((_QWORD *)this + 134)) == -536854449 )
      (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v7 + 488LL))(v7, 1LL);
  }
  *((_BYTE *)a2 + 20) = 1;
  LOWORD(v8) = *((_WORD *)this + 4083);
  if ( (_WORD)v8 )
  {
    a3 = (char *)this + 6740;
    v9 = 0;
    v8 = (unsigned __int16)v8;
    while ( *a3 )
    {
      ++v9;
      a3 += 88;
      if ( (unsigned __int16)v9 >= v8 )
        goto LABEL_18;
    }
  }
  else
  {
LABEL_18:
    v11 = (char *)0x10000000;
    LOBYTE(a3) = (*(int (__fastcall **)(AppleUSBFTDI *, char *, __int64 *))(*(_QWORD *)this + 2392LL))(
                   this,
                   (char *)&v11 + 4,
                   &v11);
  }
  return (char)a3;
}

//----- (0000000000001910) ----------------------------------------------------
int __fastcall AppleUSBFTDI::merComplete(AppleUSBFTDI *this, void *a2)
{
  int result; // eax@1
  bool v3; // zf@3

  result = (signed int)a2;
  if ( !*((_BYTE *)this + 138) && !*((_BYTE *)this + 242) )
    v3 = *((_BYTE *)this + 139) == 0;
  if ( a2 )
    result = IOFree(a2, 24LL);
  return result;
}
// FA48: using guessed type int __fastcall IOFree(_QWORD, _QWORD);

//----- (0000000000001946) ----------------------------------------------------
int __fastcall AppleUSBFTDI::handleCompletion(AppleUSBFTDI *this, void *a2)
{
  AppleUSBFTDI *v2; // rax@1
  __int64 v3; // rdi@1

  v2 = this;
  v3 = *((_QWORD *)this + 35);
  if ( v3 && !*((_BYTE *)v2 + 139) && !*((_BYTE *)v2 + 138) )
    LODWORD(v2) = (*(int (__fastcall **)(__int64, __int64 (__fastcall *)(AppleUSBFTDI *, void *, void *, void *, void *), _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v3 + 456LL))(
                    v3,
                    AppleUSBFTDI::handleCompletionGated,
                    0LL,
                    0LL,
                    0LL,
                    0LL);
  return (signed int)v2;
}

//----- (000000000000198C) ----------------------------------------------------
int __fastcall AppleUSBFTDI::usbComplete(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5)
{
  __int64 v5; // r14@1
  __int64 v6; // rbx@1
  __int64 v7; // rdi@2
  int result; // eax@10

  v5 = a3;
  v6 = a1;
  if ( *(_QWORD *)(a1 + 208) )
  {
    v7 = *(_QWORD *)(a1 + 232);
    if ( v7 )
    {
      if ( !*(_BYTE *)(v6 + 139) && *(_QWORD *)(v6 + 280) && *(_BYTE *)(v6 + 240) )
      {
        *(_DWORD *)(a3 + 8) = a2;
        *(_DWORD *)(a3 + 32) = a4;
        *(_DWORD *)(a3 + 36) = a5;
        *(_QWORD *)a3 = 0LL;
        IOLockLock(v7, a2, a3, a4, a5);
        if ( *(_QWORD *)(v6 + 216) )
          **(_QWORD **)(v6 + 224) = v5;
        else
          *(_QWORD *)(v6 + 216) = v5;
        *(_QWORD *)(v6 + 224) = v5;
        IOLockUnlock(*(_QWORD *)(v6 + 232));
        result = thread_call_enter(*(_QWORD *)(v6 + 208));
      }
    }
  }
  return result;
}
// FA60: using guessed type int __fastcall IOLockLock(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// FA68: using guessed type int __fastcall IOLockUnlock(_QWORD);
// 10490: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (0000000000001A28) ----------------------------------------------------
int __fastcall AppleUSBFTDI::dataReadCompleteUSB(AppleUSBFTDI *this, void *a2, void *a3, int a4)
{
  int result; // eax@1
  __int64 v5; // rbx@6
  __int64 v6; // rax@6
  int v7; // ecx@6

  result = a4;
  if ( !*((_BYTE *)this + 138) && !*((_BYTE *)this + 242) && !*((_BYTE *)this + 139) )
  {
    if ( (_DWORD)a3 || *((_DWORD *)this + 2034) - a4 != 2 )
    {
      result = AppleUSBFTDI::usbComplete((__int64)this, 0LL, (__int64)a2, (unsigned int)a3, (unsigned int)a4);
    }
    else
    {
      v5 = *((_QWORD *)a2 + 2);
      v6 = *(_QWORD *)(v5 + 8);
      v7 = *(_BYTE *)v6;
      if ( v7 != *((_BYTE *)this + 8156) && *(_BYTE *)(v6 + 1) != *((_BYTE *)this + 8157) )
      {
        *((_BYTE *)this + 8156) = v7;
        *((_BYTE *)this + 8157) = *(_BYTE *)(v6 + 1);
      }
      result = (*(int (__fastcall **)(_QWORD, _QWORD, signed __int64, _QWORD))(**((_QWORD **)this + 134) + 320LL))(
                 *((_QWORD *)this + 134),
                 *(_QWORD *)v5,
                 v5 + 24,
                 0LL);
      if ( result )
        *(_BYTE *)(v5 + 20) = 1;
    }
  }
  return result;
}

//----- (0000000000001ACE) ----------------------------------------------------
int __fastcall AppleUSBFTDI::dataWriteCompleteUSB(AppleUSBFTDI *this, void *a2, void *a3, unsigned int a4)
{
  return AppleUSBFTDI::usbComplete((__int64)this, 1LL, (__int64)a2, (unsigned int)a3, a4);
}

//----- (0000000000001AE8) ----------------------------------------------------
int __fastcall AppleUSBFTDI::merCompleteUSB(AppleUSBFTDI *this, void *a2, void *a3, unsigned int a4)
{
  return AppleUSBFTDI::usbComplete((__int64)this, 2LL, (__int64)a2, (unsigned int)a3, a4);
}

//----- (0000000000001B02) ----------------------------------------------------
int __fastcall AppleUSBFTDI::checkPipe(__int64 a1, __int64 a2, char a3)
{
  int result; // eax@2

  if ( a3 || (result = (*(int (__fastcall **)(__int64))(*(_QWORD *)a2 + 480LL))(a2), result == -536854449) )
    result = (*(int (__fastcall **)(__int64, signed __int64))(*(_QWORD *)a2 + 488LL))(a2, 1LL);
  return result;
}

//----- (0000000000001B44) ----------------------------------------------------
char __fastcall AppleUSBFTDI::setUpTransmit(AppleUSBFTDI *this)
{
  char v1; // bl@2

  if ( __PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    v1 = 0;
  }
  else
  {
    v1 = 1;
    if ( *((_QWORD *)this + 48) )
      AppleUSBFTDI::startTransmission(this);
  }
  return v1;
}

//----- (0000000000001B7A) ----------------------------------------------------
int __fastcall AppleUSBFTDI::probe(AppleUSBFTDI *this, IOService *a2, int *a3)
{
  int *v3; // r14@1
  __int64 v4; // rax@1
  __int64 v5; // rax@1
  int result; // eax@3

  v3 = a3;
  LODWORD(v4) = (*(int (__fastcall **)(IOService *, _QWORD))(*(_QWORD *)a2 + 696LL))(
                  a2,
                  "kDoNotClassMatchThisInterface");
  LODWORD(v5) = OSMetaClassBase::safeMetaCast(v4, *(_QWORD *)off_6010[0]);
  if ( v5 && (unsigned __int8)(*(int (__fastcall **)(__int64))(*(_QWORD *)v5 + 280LL))(v5) )
  {
    result = 0;
  }
  else
  {
    --*v3;
    result = (*(int (__fastcall **)(AppleUSBFTDI *, IOService *, int *))(off_6018[0] + 1480))(this, a2, v3);
  }
  return result;
}
// 6010: using guessed type _QWORD off_6010[3];
// 6018: using guessed type __int64 off_6018[2];
// FCC8: using guessed type int __fastcall OSMetaClassBase::safeMetaCast(_QWORD, _QWORD);

//----- (0000000000001BF8) ----------------------------------------------------
char __fastcall AppleUSBFTDI::checkDevice(__int64 a1, __int64 a2)
{
  unsigned __int8 v2; // al@1
  char v3; // r13@1
  unsigned int v4; // er12@2
  unsigned __int8 v5; // bl@2
  __int64 v6; // rax@3

  v2 = (*(int (__fastcall **)(__int64))(*(_QWORD *)a2 + 2312LL))(a2);
  v3 = 0;
  if ( v2 )
  {
    v4 = v2;
    v5 = 0;
    do
    {
      LODWORD(v6) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)a2 + 2216LL))(a2, v5);
      if ( !v6 )
        break;
      *(_BYTE *)(a1 + 8168) = *(_BYTE *)(v6 + 7);
      ++v5;
      v3 = 1;
    }
    while ( v5 < v4 );
  }
  return v3 & 1;
}

//----- (0000000000001C66) ----------------------------------------------------
char __fastcall AppleUSBFTDI::start(AppleUSBFTDI *this, IOService *a2)
{
  IOService *v2; // r14@1
  AppleUSBFTDI *v3; // rbx@1
  __int64 v4; // r13@1
  char *v5; // r12@1
  __int64 v6; // rsi@2
  __int64 v7; // rax@2
  __int64 v8; // rax@3
  __int64 v9; // rax@6
  int (__cdecl *v10)(OSObject *, void *, void *, void *, void *); // rdx@6
  __int64 v11; // rax@7
  char v12; // r15@9
  __int64 v13; // rdi@11
  __int64 v14; // rax@17
  __int64 v15; // rax@18
  __int64 v16; // rax@19
  signed __int16 v17; // ax@20
  __int64 v18; // rax@26
  __int64 v19; // rax@31
  unsigned __int16 v20; // ax@32
  __int64 v21; // rax@36
  unsigned __int16 v22; // ax@37
  __int64 v23; // rax@41
  unsigned __int64 v24; // r15@41
  __int64 v25; // rsi@41
  __int64 v26; // rax@41
  __int64 v27; // rax@45
  __int64 v28; // rax@45
  char v29; // cl@46
  char v30; // al@52
  __int64 v31; // rax@54
  __int64 v32; // rax@55
  __int64 v33; // rax@55
  __int64 v34; // rcx@55
  __int64 v36; // rdi@61
  char v37; // [sp+8h] [bp-88h]@52
  char v38; // [sp+9h] [bp-87h]@54
  __int16 v39; // [sp+Ah] [bp-86h]@54
  __int16 v40; // [sp+Ch] [bp-84h]@54
  __int16 v41; // [sp+Eh] [bp-82h]@54
  __int64 v42; // [sp+10h] [bp-80h]@54
  char v43; // [sp+20h] [bp-70h]@55
  char v44; // [sp+40h] [bp-50h]@55
  __int64 v45; // [sp+60h] [bp-30h]@1

  v2 = a2;
  v3 = this;
  v4 = off_6020;
  v45 = *(_QWORD *)off_6020;
  *((_WORD *)this + 68) = 0;
  *((_BYTE *)this + 139) = 0;
  *((_BYTE *)this + 8175) = 0;
  *((_BYTE *)this + 138) = 0;
  *((_QWORD *)this + 34) = 0LL;
  *((_QWORD *)this + 22) = 0LL;
  *((_BYTE *)this + 184) = 0;
  *((_QWORD *)this + 24) = 0LL;
  *((_WORD *)this + 4090) = 0;
  *((_BYTE *)this + 240) = 0;
  *((_BYTE *)this + 8160) = 0;
  *((_BYTE *)this + 8162) = 0;
  *((_BYTE *)this + 8173) = 0;
  *((_WORD *)this + 4085) = 0;
  *(_WORD *)((char *)this + 241) = 1;
  AppleUSBFTDI::initStructure(this);
  v5 = (char *)off_6018[0];
  if ( !(unsigned __int8)(*(int (**)(void))(off_6018[0] + 1488))() )
  {
    v12 = 0;
    IOLog("%8x %8x AppleUSBFTDI: start - super failed\n", 0LL, 0LL);
    goto LABEL_59;
  }
  v6 = *(_QWORD *)off_6000[0];
  LODWORD(v7) = OSMetaClassBase::safeMetaCast(v2, *(_QWORD *)off_6000[0]);
  *((_QWORD *)this + 33) = v7;
  if ( !v7 )
  {
    v13 = (__int64)"%8x %8x AppleUSBFTDI: start - provider invalid\n";
    goto LABEL_57;
  }
  *((_BYTE *)this + 8161) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v7 + 2224LL))(v7, v6);
  LODWORD(v8) = (*(int (**)(void))(**((_QWORD **)this + 33) + 2216LL))();
  *((_QWORD *)this + 32) = v8;
  if ( !v8 )
  {
    v13 = (__int64)"%8x %8x AppleUSBFTDI: start - Failed to get device\n";
    goto LABEL_57;
  }
  *((_WORD *)this + 4085) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v8 + 2304LL))(v8);
  if ( !AppleUSBFTDI::checkDevice((__int64)this, *((_QWORD *)this + 32)) )
  {
    v12 = 0;
    goto LABEL_59;
  }
  AppleUSBFTDI::idChip(this);
  if ( !(unsigned __int8)(*(int (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 2352LL))(this) )
  {
    v13 = (__int64)"%8x %8x AppleUSBFTDI: start - createWorkLoop failed\n";
    goto LABEL_57;
  }
  LODWORD(v9) = (*(int (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 1672LL))(this);
  *((_QWORD *)this + 34) = v9;
  if ( !v9 )
  {
    v13 = (__int64)"%8x %8x AppleUSBFTDI: start - getWorkLoop failed\n";
    goto LABEL_57;
  }
  v11 = IOCommandGate::commandGate(this, 0LL, v10);
  *((_QWORD *)this + 35) = v11;
  if ( !v11 )
  {
    v13 = (__int64)"%8x %8x AppleUSBFTDI: start - commandGate failed\n";
    goto LABEL_57;
  }
  if ( !(*(int (__fastcall **)(_QWORD, __int64))(**((_QWORD **)this + 34) + 320LL))(*((_QWORD *)this + 34), v11) )
  {
    LODWORD(v14) = thread_call_allocate(AppleUSBFTDI::handleCompletion, this);
    *((_QWORD *)this + 26) = v14;
    if ( v14 )
    {
      LODWORD(v15) = IOLockAlloc();
      *((_QWORD *)this + 29) = v15;
      if ( v15 )
      {
        *((_DWORD *)this + 2041) = 0;
        LODWORD(v16) = (*(int (__fastcall **)(IOService *, _QWORD))(*(_QWORD *)v2 + 696LL))(v2, "InputBuffers");
        if ( v16 )
        {
          v17 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v16 + 320LL))(v16);
          if ( (unsigned __int16)v17 >= 0x41u )
            goto LABEL_29;
          *((_WORD *)this + 4082) = v17;
          if ( v17 )
            goto LABEL_31;
        }
        else
        {
          *((_WORD *)this + 4082) = 0;
        }
        LODWORD(v18) = (*(int (__fastcall **)(AppleUSBFTDI *, _QWORD))(*(_QWORD *)this + 696LL))(this, "InputBuffers");
        if ( !v18 )
        {
          *((_WORD *)this + 4082) = 4;
          v17 = 4;
LABEL_31:
          IOLog("AppleUSBFTDI, fInBufPool,kMaxInBufPool %d,%d \n", (unsigned __int16)v17, 64LL);
          LODWORD(v19) = (*(int (__fastcall **)(IOService *, _QWORD))(*(_QWORD *)v2 + 696LL))(v2, "OutputBuffers");
          if ( v19 )
          {
            v20 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v19 + 320LL))(v19);
            if ( v20 >= 0x11u )
              goto LABEL_39;
            *((_WORD *)this + 4083) = v20;
            if ( v20 )
              goto LABEL_41;
          }
          else
          {
            *((_WORD *)this + 4083) = 0;
          }
          LODWORD(v21) = (*(int (__fastcall **)(AppleUSBFTDI *, _QWORD))(*(_QWORD *)this + 696LL))(
                           this,
                           "OutputBuffers");
          if ( !v21 )
          {
            *((_WORD *)this + 4083) = 2;
LABEL_41:
            LODWORD(v23) = (*(int (__fastcall **)(IOService *, _QWORD))(*(_QWORD *)v2 + 696LL))(v2, "ResetOnClose");
            v24 = *(_QWORD *)off_6010[0];
            v25 = *(_QWORD *)off_6010[0];
            LODWORD(v26) = OSMetaClassBase::safeMetaCast(v23, *(_QWORD *)off_6010[0]);
            *((_BYTE *)this + 8174) = v26
                                   && (unsigned __int8)(*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v26 + 280LL))(
                                                         v26,
                                                         v25);
            LODWORD(v27) = (*(int (__fastcall **)(IOService *, _QWORD))(*(_QWORD *)v2 + 696LL))(v2, "SuppressWarning");
            LODWORD(v28) = OSMetaClassBase::safeMetaCast(v27, v24);
            if ( !v28
              || (LODWORD(v28) = (*(int (__fastcall **)(__int64, unsigned __int64))(*(_QWORD *)v28 + 280LL))(v28, v24),
                  v29 = 1,
                  !(_BYTE)v28) )
              v29 = 0;
            *((_BYTE *)this + 8175) = v29;
            if ( AppleUSBFTDI::allocateResources(this, v28) )
            {
              if ( !AppleUSBFTDI::createSerialStream(this, v24) )
                goto LABEL_61;
              if ( !AppleUSBFTDI::initForPM(this, v2) )
              {
                v36 = (__int64)"%8x %8x AppleUSBFTDI: start - initForPM failed\n";
                goto LABEL_63;
              }
              (*(void (__fastcall **)(_QWORD, IOService *))(**((_QWORD **)this + 33) + 32LL))(
                *((_QWORD *)this + 33),
                v2);
              gPMWakeOnRingSymbol = OSSymbol::withCString("Wake On Modem Ring", (const char *)v2);
              if ( *((_BYTE *)this + 8168) & 0x20 )
              {
                AppleUSBFTDI::WakeonRing(this);
                v37 = 0;
                v30 = 1;
                if ( *((_BYTE *)this + 184) )
                  v30 = 3;
                v38 = v30;
                v39 = 1;
                v40 = 0;
                v41 = 0;
                v42 = 0LL;
                LODWORD(v31) = (*(int (**)(void))(**((_QWORD **)this + 33) + 2216LL))();
                (*(void (__fastcall **)(__int64, char *, _QWORD))(*(_QWORD *)v31 + 2360LL))(v31, &v37, 0LL);
                AppleUSBFTDI::setupWakeOnRingPMCallback(this);
              }
              LODWORD(v32) = (*(int (**)(void))(**((_QWORD **)this + 33) + 2216LL))();
              *((_WORD *)this + 4088) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v32 + 2288LL))(v32);
              LODWORD(v33) = (*(int (**)(void))(**((_QWORD **)this + 33) + 2216LL))();
              *((_WORD *)this + 4089) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v33 + 2296LL))(v33);
              v2 = (IOService *)"0x%X";
              snprintf(&v44, 0x14uLL, "0x%X", *((_WORD *)this + 4088));
              v5 = &v43;
              snprintf(&v43, 0x14uLL, "0x%X", *((_WORD *)this + 4089));
              ftdi_LogToMessageTracer(
                (__int64)"com.apple.commssw.ftdi.device",
                (__int64)"AppleUSBFTDI",
                (__int64)&v44,
                (__int64)&v43,
                (__int64)"YES",
                0LL,
                0);
              *((_BYTE *)this + 240) = 1;
              (*(void (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 25) + 1456LL))(*((_QWORD *)this + 25), 0LL);
              v34 = *((_WORD *)this + 4083);
              IOLog(
                "AppleUSBFTDI: Version number - %s, Input buffers %d, Output buffers %d\n",
                "1.0.1b12",
                *((_WORD *)this + 4082));
              v12 = 1;
              goto LABEL_59;
            }
            v13 = (__int64)"%8x %8x AppleUSBFTDI: start - allocateResources failed\n";
            goto LABEL_57;
          }
          v22 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v21 + 320LL))(v21);
          if ( v22 <= 0x10u )
          {
            *((_WORD *)this + 4083) = v22;
            goto LABEL_41;
          }
LABEL_39:
          *((_WORD *)this + 4083) = 16;
          goto LABEL_41;
        }
        v17 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v18 + 320LL))(v18);
        if ( (unsigned __int16)v17 <= 0x40u )
        {
          *((_WORD *)this + 4082) = v17;
          goto LABEL_31;
        }
LABEL_29:
        *((_WORD *)this + 4082) = 64;
        v17 = 64;
        goto LABEL_31;
      }
      v13 = (__int64)"%8x %8x AppleUSBFTDI: start -- allocation of completion lock failed\n";
    }
    else
    {
      v13 = (__int64)"%8x %8x AppleUSBFTDI: start -- thread allocation failed\n";
    }
LABEL_57:
    v12 = 0;
    IOLog(v13, 0LL, 0LL);
    goto LABEL_58;
  }
  v12 = 0;
  IOLog("%8x %8x AppleUSBFTDI: start - addEventSource(commandGate) failed\n", 0LL, 0LL);
  (*(void (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 35) + 40LL))(*((_QWORD *)this + 35), 0LL);
  *((_QWORD *)this + 35) = 0LL;
LABEL_58:
  while ( 1 )
  {
    (*((void (__fastcall **)(AppleUSBFTDI *, IOService *))v5 + 187))(v3, v2);
LABEL_59:
    if ( *(_QWORD *)v4 == v45 )
      break;
LABEL_61:
    v36 = (__int64)"%8x %8x AppleUSBFTDI: start - createSerialStream failed\n";
LABEL_63:
    v12 = 0;
    IOLog(v36, 0LL, 0LL);
    AppleUSBFTDI::releaseResources(v3);
  }
  return v12;
}
// 6000: using guessed type _QWORD off_6000[5];
// 6010: using guessed type _QWORD off_6010[3];
// 6018: using guessed type __int64 off_6018[2];
// 6020: using guessed type __int64 off_6020;
// 6D60: using guessed type _QWORD gPMWakeOnRingSymbol;
// FA50: using guessed type int IOLockAlloc(void);
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);
// FCC8: using guessed type int __fastcall OSMetaClassBase::safeMetaCast(_QWORD, _QWORD);
// 10480: using guessed type int __fastcall thread_call_allocate(_QWORD, _QWORD);

//----- (00000000000022E0) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::initStructure(AppleUSBFTDI *this)
{
  char *v1; // rax@1
  __int64 v2; // rcx@1
  __int64 result; // rax@3

  *((_BYTE *)this + 996) = 0;
  *((_BYTE *)this + 997) = 0;
  *((_DWORD *)this + 72) = 101449728;
  *((_DWORD *)this + 73) = 0;
  *((_QWORD *)this + 134) = 0LL;
  *((_QWORD *)this + 135) = 0LL;
  v1 = (char *)this + 1109;
  v2 = 0LL;
  do
  {
    *(_QWORD *)(v1 - 21) = 0LL;
    *(_QWORD *)(v1 - 13) = 0LL;
    *(v1 - 1) = 0;
    *(_DWORD *)(v1 - 5) = -1;
    *v1 = 0;
    *((_QWORD *)this + v2++ + 49) = 0LL;
    v1 += 88;
  }
  while ( v2 != 64 );
  *((_DWORD *)this + 226) = 0;
  result = 0LL;
  do
  {
    *(_QWORD *)((char *)this + result + 6720) = 0LL;
    *(_QWORD *)((char *)this + result + 6728) = 0LL;
    *(_DWORD *)((char *)this + result + 6736) = -1;
    *((_BYTE *)this + result + 6740) = 0;
    result += 88LL;
  }
  while ( result != 1408 );
  *((_WORD *)this + 4064) = 0;
  return result;
}

//----- (00000000000023AA) ----------------------------------------------------
char __fastcall AppleUSBFTDI::idChip(AppleUSBFTDI *this)
{
  signed int v1; // eax@1
  char result; // al@17

  v1 = *((_WORD *)this + 4085);
  if ( v1 > 1023 )
  {
    if ( v1 <= 1279 )
    {
      if ( v1 == 1024 )
      {
        *((_BYTE *)this + 8172) = 1;
        goto LABEL_21;
      }
LABEL_20:
      *((_BYTE *)this + 8172) = 0;
      goto LABEL_21;
    }
    if ( v1 > 1535 )
    {
      if ( v1 <= 1791 )
      {
        if ( v1 == 1536 )
        {
          *((_BYTE *)this + 8172) = 3;
          goto LABEL_21;
        }
        goto LABEL_20;
      }
      if ( v1 == 1792 )
      {
        *((_BYTE *)this + 8172) = 4;
      }
      else
      {
        if ( v1 != 2048 )
        {
          if ( v1 == 2304 )
          {
            *((_BYTE *)this + 8172) = 6;
            goto LABEL_21;
          }
          goto LABEL_20;
        }
        *((_BYTE *)this + 8172) = 5;
      }
    }
    else
    {
      if ( v1 != 1280 )
        goto LABEL_20;
      *((_BYTE *)this + 8172) = 2;
    }
    result = *((_BYTE *)this + 8161) + 1;
    *((_BYTE *)this + 8160) = result;
    *((_BYTE *)this + 8173) = 1;
    return result;
  }
  if ( v1 != 512 )
    goto LABEL_20;
  *((_BYTE *)this + 8172) = (unsigned __int8)(*(int (__cdecl **)(_QWORD))(**((_QWORD **)this + 32) + 2336LL))(*((_QWORD *)this + 32)) == 0;
LABEL_21:
  result = *((_BYTE *)this + 8161);
  *((_BYTE *)this + 8160) = result;
  return result;
}

//----- (000000000000248E) ----------------------------------------------------
char __usercall AppleUSBFTDI::allocateResources@<al>(AppleUSBFTDI *this@<rdi>, __int64 a2@<rax>)
{
  char v2; // r14@1
  __int64 v3; // rax@2
  unsigned __int64 v4; // rcx@2
  unsigned int v5; // eax@3
  unsigned __int16 v6; // bx@4
  __int64 v7; // rsi@6
  __int64 v8; // rax@6
  signed __int64 v9; // r14@6
  __int64 v10; // rax@7
  __int64 v11; // rax@8
  unsigned __int64 v12; // rcx@8
  unsigned __int16 v13; // bx@10
  __int64 v14; // rax@11
  signed __int64 v15; // r14@11
  __int64 v16; // rax@12
  __int64 v17; // rax@13
  __int64 v18; // rax@14
  unsigned __int16 v19; // dx@15
  unsigned __int16 v20; // ax@16
  signed __int64 v21; // rsi@17
  __int64 v23; // [sp+0h] [bp-20h]@1

  v23 = a2;
  v2 = 0;
  if ( (unsigned __int8)(*(int (__fastcall **)(_QWORD, AppleUSBFTDI *, _QWORD, _QWORD))(**((_QWORD **)this + 33) + 1488LL))(
                          *((_QWORD *)this + 33),
                          this,
                          0LL,
                          0LL) )
  {
    LODWORD(v23) = 258;
    BYTE4(v23) = 0;
    v2 = 0;
    LODWORD(v3) = (*(int (__fastcall **)(_QWORD, _QWORD, __int64 *))(**((_QWORD **)this + 33) + 2176LL))(
                    *((_QWORD *)this + 33),
                    0LL,
                    &v23);
    *((_QWORD *)this + 134) = v3;
    if ( v3 )
    {
      v5 = WORD1(v23);
      *((_DWORD *)this + 2034) = WORD1(v23);
      if ( *((_WORD *)this + 4082) )
      {
        v6 = 0;
        while ( 1 )
        {
          v7 = v5;
          v8 = IOBufferMemoryDescriptor::withOptions(
                 (IOBufferMemoryDescriptor *)((char *)&dword_10 + 1),
                 v5,
                 0x1000uLL,
                 v4);
          v9 = 88LL * v6;
          *(_QWORD *)((char *)this + v9 + 1088) = v8;
          if ( !v8 )
            return 0;
          LODWORD(v10) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v8 + 736LL))(v8, v7);
          *(_QWORD *)((char *)this + v9 + 1096) = v10;
          *((_BYTE *)this + v9 + 1108) = 0;
          ++v6;
          v4 = *((_WORD *)this + 4082);
          if ( v6 >= (unsigned int)v4 )
            break;
          v5 = *((_DWORD *)this + 2034);
        }
      }
      BYTE1(v23) = 0;
      v2 = 0;
      LODWORD(v11) = (*(int (__fastcall **)(_QWORD, _QWORD, __int64 *))(**((_QWORD **)this + 33) + 2176LL))(
                       *((_QWORD *)this + 33),
                       0LL,
                       &v23);
      *((_QWORD *)this + 135) = v11;
      if ( v11 )
      {
        *((_DWORD *)this + 2033) = WORD1(v23);
        if ( *((_WORD *)this + 4083) )
        {
          v13 = 0;
          do
          {
            v14 = IOBufferMemoryDescriptor::withOptions(
                    (IOBufferMemoryDescriptor *)((char *)&dword_10 + 2),
                    0x1000u,
                    0x1000uLL,
                    v12);
            v15 = 88LL * v13;
            *(_QWORD *)((char *)this + v15 + 6720) = v14;
            if ( !v14 )
              return 0;
            LODWORD(v16) = (*(int (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v14 + 736LL))(v14, 4096LL);
            *(_QWORD *)((char *)this + v15 + 6728) = v16;
            *((_BYTE *)this + v15 + 6740) = 1;
            ++v13;
            v12 = *((_WORD *)this + 4083);
          }
          while ( v13 < (unsigned int)v12 );
        }
        LODWORD(v17) = IOMalloc(0x4000LL);
        *((_QWORD *)this + 43) = v17;
        *((_QWORD *)this + 44) = v17 + 0x4000;
        *((_QWORD *)this + 47) = 0x4000LL;
        *((_QWORD *)this + 45) = v17;
        *((_QWORD *)this + 46) = v17;
        *((_QWORD *)this + 48) = 0LL;
        if ( !v17 )
          return 0;
        LODWORD(v18) = IOMalloc(0x4000LL);
        *((_QWORD *)this + 37) = v18;
        *((_QWORD *)this + 38) = v18 + 0x4000;
        *((_QWORD *)this + 41) = 0x4000LL;
        *((_QWORD *)this + 39) = v18;
        *((_QWORD *)this + 40) = v18;
        *((_QWORD *)this + 42) = 0LL;
        if ( !v18 )
          return 0;
        v19 = *((_WORD *)this + 4083);
        v2 = 1;
        if ( v19 )
        {
          v20 = 0;
          do
          {
            v21 = 88LL * v20;
            if ( *(_QWORD *)((char *)this + v21 + 6720) )
            {
              *(_QWORD *)((char *)this + v21 + 6768) = 0LL;
              *(_DWORD *)((char *)this + v21 + 6776) = 1;
              *(_QWORD *)((char *)this + v21 + 6784) = (char *)this + v21 + 6720;
              *(_QWORD *)((char *)this + v21 + 6792) = 0LL;
              *(_DWORD *)((char *)this + v21 + 6800) = 0;
              *(_DWORD *)((char *)this + v21 + 6804) = 0;
              *(_QWORD *)((char *)this + v21 + 6744) = this;
              *(_QWORD *)((char *)this + v21 + 6752) = AppleUSBFTDI::dataWriteCompleteUSB;
              *(_QWORD *)((char *)this + v21 + 6760) = (char *)this + v21 + 6768;
              v19 = *((_WORD *)this + 4083);
            }
            ++v20;
          }
          while ( v20 < (unsigned int)v19 );
        }
      }
    }
  }
  return v2;
}
// 10: using guessed type int;
// FA78: using guessed type int __fastcall IOMalloc(_QWORD);

//----- (000000000000276E) ----------------------------------------------------
char __fastcall AppleUSBFTDI::createSerialStream(AppleUSBFTDI *this, unsigned __int64 a2)
{
  AppleUSBFTDI *v2; // r15@1
  __int64 v3; // r12@1
  IORS232SerialStreamSync *v4; // rbx@1
  char v5; // al@2
  __int64 v6; // rdi@2
  char v7; // bl@3
  unsigned __int8 *v8; // rsi@4
  __int64 v9; // rax@6
  unsigned __int8 v10; // bl@6
  __int64 v11; // rax@7
  char result; // al@11
  __int64 v13; // rcx@14
  unsigned __int8 v14; // [sp+0h] [bp-50h]@4
  __int64 v15; // [sp+28h] [bp-28h]@1

  v2 = this;
  v3 = off_6020;
  v15 = *(_QWORD *)off_6020;
  v4 = (IORS232SerialStreamSync *)OSObject::operator new((OSObject *)&stru_68.offset, a2);
  IORS232SerialStreamSync::IORS232SerialStreamSync(v4);
  *((_QWORD *)this + 25) = v4;
  if ( !v4 )
    goto LABEL_13;
  v5 = (*(int (__fastcall **)(IORS232SerialStreamSync *, _QWORD, _QWORD))(*(_QWORD *)v4 + 2224LL))(v4, 0LL, 0LL);
  v6 = *((_QWORD *)this + 25);
  if ( !v5 )
  {
    (*(void (**)(void))(*(_QWORD *)v6 + 40LL))();
    goto LABEL_13;
  }
  v7 = (*(int (__fastcall **)(__int64, AppleUSBFTDI *))(*(_QWORD *)v6 + 1648LL))(v6, v2);
  (*(void (**)(void))(**((_QWORD **)v2 + 25) + 40LL))();
  if ( !v7 )
  {
LABEL_13:
    result = 0;
    goto LABEL_14;
  }
  (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)v2 + 25) + 624LL))(
    *((_QWORD *)v2 + 25),
    "IOTTYBaseName",
    "usbserial-");
  v8 = &v14;
  if ( AppleUSBFTDI::createSuffix(v2, &v14) )
  {
    v8 = (unsigned __int8 *)"IOTTYSuffix";
    (*(void (__fastcall **)(_QWORD, _QWORD, unsigned __int8 *))(**((_QWORD **)v2 + 25) + 624LL))(
      *((_QWORD *)v2 + 25),
      "IOTTYSuffix",
      &v14);
  }
  LODWORD(v9) = (*(int (__fastcall **)(_QWORD, unsigned __int8 *))(**((_QWORD **)v2 + 33) + 2216LL))(
                  *((_QWORD *)v2 + 33),
                  v8);
  v10 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v9 + 2328LL))(v9);
  if ( v10 )
  {
    LODWORD(v11) = (*(int (**)(void))(**((_QWORD **)v2 + 33) + 2216LL))();
    if ( !(*(int (__fastcall **)(__int64, _QWORD, signed __int64, signed __int64, signed __int64))(*(_QWORD *)v11
                                                                                                 + 2392LL))(
            v11,
            v10,
            (char *)v2 + 141,
            32LL,
            1033LL) )
    {
      if ( !strlen((const char *)v2 + 141) )
        strncpy((char *)v2 + 141, "USB FTDI", 9uLL);
      (*(void (__fastcall **)(_QWORD, _QWORD, signed __int64))(**((_QWORD **)v2 + 25) + 624LL))(
        *((_QWORD *)v2 + 25),
        "Product Name",
        (char *)v2 + 141);
    }
  }
  (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD, signed __int64))(**((_QWORD **)v2 + 25) + 640LL))(
    *((_QWORD *)v2 + 25),
    "Max Packet",
    *((_DWORD *)v2 + 2034),
    16LL);
  result = 1;
LABEL_14:
  v13 = *(_QWORD *)v3;
  return result;
}
// 68: using guessed type section_64;
// 6020: using guessed type __int64 off_6020;

//----- (0000000000002920) ----------------------------------------------------
int __fastcall AppleUSBFTDI::releaseResources(AppleUSBFTDI *this)
{
  AppleUSBFTDI *v1; // r14@1
  __int64 v2; // rdi@1
  unsigned __int16 v3; // ax@3
  unsigned __int16 v4; // bx@4
  signed __int64 v5; // r15@5
  unsigned __int16 v6; // ax@8
  unsigned __int16 v7; // bx@9
  signed __int64 v8; // r15@10

  v1 = this;
  v2 = *((_QWORD *)this + 33);
  if ( v2 )
  {
    (*(void (__fastcall **)(__int64, AppleUSBFTDI *, _QWORD))(*(_QWORD *)v2 + 1496LL))(v2, v1, 0LL);
    v2 = *((_QWORD *)v1 + 33);
    (*(void (**)(void))(*(_QWORD *)v2 + 40LL))();
    *((_QWORD *)v1 + 33) = 0LL;
  }
  v3 = *((_WORD *)v1 + 4082);
  if ( v3 )
  {
    v4 = 0;
    do
    {
      v5 = 88LL * v4;
      v2 = *(_QWORD *)((char *)v1 + v5 + 1088);
      if ( v2 )
      {
        (*(void (**)(void))(*(_QWORD *)v2 + 40LL))();
        *(_QWORD *)((char *)v1 + v5 + 1088) = 0LL;
        *((_BYTE *)v1 + v5 + 1108) = 0;
        v3 = *((_WORD *)v1 + 4082);
      }
      ++v4;
    }
    while ( v4 < (unsigned int)v3 );
  }
  v6 = *((_WORD *)v1 + 4083);
  if ( v6 )
  {
    v7 = 0;
    do
    {
      v8 = 88LL * v7;
      v2 = *(_QWORD *)((char *)v1 + v8 + 6720);
      if ( v2 )
      {
        (*(void (**)(void))(*(_QWORD *)v2 + 40LL))();
        *(_QWORD *)((char *)v1 + v8 + 6720) = 0LL;
        *(_DWORD *)((char *)v1 + v8 + 6736) = -1;
        *((_BYTE *)v1 + v8 + 6740) = 0;
        v6 = *((_WORD *)v1 + 4083);
      }
      ++v7;
    }
    while ( v7 < (unsigned int)v6 );
  }
  *((_WORD *)v1 + 4064) = 0;
  AppleUSBFTDI::freeRingBuffer(v2, (__int64)((char *)v1 + 344));
  return AppleUSBFTDI::freeRingBuffer(v2, (__int64)((char *)v1 + 296));
}

//----- (0000000000002A46) ----------------------------------------------------
char __fastcall AppleUSBFTDI::initForPM(AppleUSBFTDI *this, IOService *a2)
{
  char result; // al@2

  *((_BYTE *)this + 140) = 3;
  (*(void (**)(void))(*(_QWORD *)this + 1936LL))();
  (*(void (__fastcall **)(IOService *, AppleUSBFTDI *))(*(_QWORD *)a2 + 1952LL))(a2, this);
  if ( *((_QWORD *)this + 14) )
  {
    (*(void (__fastcall **)(AppleUSBFTDI *, AppleUSBFTDI *, _QWORD *, signed __int64))(*(_QWORD *)this + 1960LL))(
      this,
      this,
      &gOurPowerStates,
      4LL);
    result = 1;
  }
  else
  {
    result = 0;
  }
  return result;
}
// 6AE0: using guessed type _QWORD gOurPowerStates;

//----- (0000000000002AA0) ----------------------------------------------------
char __fastcall AppleUSBFTDI::WakeonRing(AppleUSBFTDI *this)
{
  IOService *v1; // rax@1
  __int64 v2; // rsi@2
  __int64 v3; // rax@2

  v1 = (IOService *)IOService::getPMRootDomain(this);
  *((_QWORD *)this + 22) = v1;
  if ( v1 )
  {
    IOService::registerInterestedDriver(v1, this);
    v2 = gPMWakeOnRingSymbol;
    v3 = IOPMrootDomain::copyPMSetting(*((IOPMrootDomain **)this + 22), (OSSymbol *)gPMWakeOnRingSymbol);
    if ( v3 )
    {
      if ( (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v3 + 328LL))(v3, v2) )
        *((_BYTE *)this + 184) = 1;
    }
  }
  return 1;
}
// 6D60: using guessed type _QWORD gPMWakeOnRingSymbol;
// FAE8: using guessed type _QWORD __cdecl IOPMrootDomain::copyPMSetting(IOPMrootDomain *__hidden this, OSSymbol *);

//----- (0000000000002AFE) ----------------------------------------------------
int __fastcall AppleUSBFTDI::setWakeFeature(AppleUSBFTDI *this)
{
  char v1; // al@1
  __int64 v2; // rax@3
  char v4; // [sp+8h] [bp-18h]@1
  char v5; // [sp+9h] [bp-17h]@3
  __int16 v6; // [sp+Ah] [bp-16h]@3
  __int16 v7; // [sp+Ch] [bp-14h]@3
  __int16 v8; // [sp+Eh] [bp-12h]@3
  __int64 v9; // [sp+10h] [bp-10h]@3

  v4 = 0;
  v1 = 1;
  if ( *((_BYTE *)this + 184) )
    v1 = 3;
  v5 = v1;
  v6 = 1;
  v7 = 0;
  v8 = 0;
  v9 = 0LL;
  LODWORD(v2) = (*(int (**)(void))(**((_QWORD **)this + 33) + 2216LL))();
  return (*(int (__fastcall **)(__int64, char *, _QWORD))(*(_QWORD *)v2 + 2360LL))(v2, &v4, 0LL);
}

//----- (0000000000002B5C) ----------------------------------------------------
char __fastcall AppleUSBFTDI::setupWakeOnRingPMCallback(AppleUSBFTDI *this)
{
  AppleUSBFTDI *v1; // rbx@1
  IOPMrootDomain *v2; // rdi@1
  __int64 v3; // rax@2
  __int64 v5; // [sp+0h] [bp-30h]@1
  __int64 v6; // [sp+8h] [bp-28h]@1
  __int64 v7; // [sp+18h] [bp-18h]@1

  v1 = this;
  v7 = *(_QWORD *)off_6020;
  v5 = gPMWakeOnRingSymbol;
  v6 = 0LL;
  v2 = (IOPMrootDomain *)*((_QWORD *)this + 22);
  if ( v2 )
  {
    IOPMrootDomain::publishFeature(v2, "WakeOnRing");
    LOBYTE(v3) = (unsigned int)IOPMrootDomain::registerPMSettingController(
                                 *((IOPMrootDomain **)v1 + 22),
                                 (const OSSymbol **)&v5,
                                 (int (__cdecl *)(OSObject *, const OSSymbol *, OSObject *, unsigned __int64))AppleUSBFTDI::handleSettingCallback,
                                 v1,
                                 0LL,
                                 (OSObject **)v1 + 24) == 0;
  }
  else
  {
    v3 = *(_QWORD *)off_6020;
    if ( *(_QWORD *)off_6020 == v7 )
      LOBYTE(v3) = 0;
  }
  return v3;
}
// 6020: using guessed type __int64 off_6020;
// 6D60: using guessed type _QWORD gPMWakeOnRingSymbol;
// FAF8: using guessed type _QWORD __cdecl IOPMrootDomain::registerPMSettingController(IOPMrootDomain *__hidden this, const OSSymbol **, int (__cdecl *)(OSObject *, const OSSymbol *, OSObject *, unsigned __int64), OSObject *, unsigned __int64, OSObject **);

//----- (0000000000002BF0) ----------------------------------------------------
int __fastcall AppleUSBFTDI::stop(AppleUSBFTDI *this, IOService *a2)
{
  AppleUSBFTDI *v2; // rbx@1
  __int64 v3; // rdi@5
  __int64 v4; // rdi@9
  IOService *v5; // rdi@11

  v2 = this;
  *((_BYTE *)this + 138) = 1;
  *((_BYTE *)this + 240) = 0;
  (*(void (**)(void))(*(_QWORD *)this + 32LL))();
  (*(void (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleUSBFTDI *__hidden, OSObject *, void *, void *, void *, void *), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
    *((_QWORD *)this + 35),
    AppleUSBFTDI::stopAction,
    0LL,
    0LL,
    0LL,
    0LL);
  (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)v2 + 40LL))(v2);
  if ( *((_QWORD *)this + 26) )
  {
    thread_call_cancel();
    IOSleep(200LL);
    thread_call_free(*((_QWORD *)this + 26));
    *((_QWORD *)this + 26) = 0LL;
  }
  if ( *((_QWORD *)this + 29) )
  {
    IOLockFree();
    *((_QWORD *)this + 29) = 0LL;
  }
  v3 = *((_QWORD *)this + 34);
  if ( v3 )
  {
    if ( *((_QWORD *)v2 + 35) )
    {
      (*(void (**)(void))(*(_QWORD *)v3 + 328LL))();
      (*(void (**)(void))(**((_QWORD **)v2 + 35) + 40LL))();
      *((_QWORD *)v2 + 35) = 0LL;
      v3 = *((_QWORD *)v2 + 34);
    }
    (*(void (**)(void))(*(_QWORD *)v3 + 40LL))();
    *((_QWORD *)v2 + 34) = 0LL;
  }
  v4 = *((_QWORD *)v2 + 24);
  if ( v4 )
    (*(void (**)(void))(*(_QWORD *)v4 + 40LL))();
  v5 = (IOService *)*((_QWORD *)v2 + 22);
  if ( v5 )
    IOService::deRegisterInterestedDriver(v5, v2);
  (*(void (__fastcall **)(AppleUSBFTDI *, _QWORD))(*(_QWORD *)v2 + 672LL))(v2, "Product Name");
  (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)v2 + 1944LL))(v2);
  return (*(int (__fastcall **)(AppleUSBFTDI *, IOService *))(off_6018[0] + 1496))(v2, a2);
}
// 6018: using guessed type __int64 off_6018[2];
// FA58: using guessed type int IOLockFree(void);
// FA80: using guessed type int __fastcall IOSleep(_QWORD);
// 10488: using guessed type int thread_call_cancel(void);
// 10498: using guessed type int __fastcall thread_call_free(_QWORD);

//----- (0000000000002D36) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::stopAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6)
{
  (*(void (__fastcall **)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *))(*(_QWORD *)this + 2360LL))(
    this,
    a2,
    a3,
    a4,
    a5,
    a6);
  return 0LL;
}

//----- (0000000000002D48) ----------------------------------------------------
int __fastcall AppleUSBFTDI::stopGated(AppleUSBFTDI *this)
{
  return AppleUSBFTDI::releaseResources(this);
}

//----- (0000000000002D52) ----------------------------------------------------
bool __fastcall AppleUSBFTDI::createWorkLoop(AppleUSBFTDI *this)
{
  bool result; // al@1
  __int64 v2; // rax@2

  result = 1;
  if ( !*((_QWORD *)this + 34) )
  {
    v2 = IOWorkLoop::workLoop(this);
    *((_QWORD *)this + 34) = v2;
    result = v2 != 0;
  }
  return result;
}

//----- (0000000000002D80) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::getWorkLoop(AppleUSBFTDI *this)
{
  return *((_QWORD *)this + 34);
}

//----- (0000000000002D8E) ----------------------------------------------------
char __fastcall AppleUSBFTDI::createSuffix(AppleUSBFTDI *this, unsigned __int8 *a2)
{
  __int64 v2; // r12@1
  __int64 v3; // rax@1
  unsigned __int8 v4; // bl@1
  __int64 v5; // rax@2
  __int64 v6; // rax@3
  __int64 v7; // rax@3
  int v8; // eax@4
  int v9; // eax@4
  __int16 v10; // cx@4
  __int16 v11; // ax@4
  unsigned __int8 *v12; // rcx@5
  int v13; // eax@8
  char result; // al@9
  size_t v15; // rax@10
  __int64 v16; // rdx@12
  __int64 v17; // rcx@14
  char v18; // [sp+0h] [bp-50h]@2
  __int64 v19; // [sp+28h] [bp-28h]@1

  v2 = off_6020;
  v19 = *(_QWORD *)off_6020;
  LODWORD(v3) = (*(int (**)(void))(**((_QWORD **)this + 33) + 2216LL))();
  v4 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v3 + 2336LL))(v3);
  if ( v4
    && (LODWORD(v5) = (*(int (**)(void))(**((_QWORD **)this + 33) + 2216LL))(),
        !(*(int (__fastcall **)(__int64, _QWORD, char *, signed __int64, signed __int64))(*(_QWORD *)v5 + 2392LL))(
           v5,
           v4,
           &v18,
           34LL,
           1033LL)) )
  {
    v15 = strlen(&v18);
    strlcpy((char *)a2, &v18, v15 + 1);
    v13 = strlen((const char *)a2);
  }
  else
  {
    LODWORD(v6) = (*(int (**)(void))(**((_QWORD **)this + 33) + 2216LL))();
    LODWORD(v7) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v6 + 696LL))(v6, "locationID");
    if ( !v7 )
    {
      result = 0;
      goto LABEL_14;
    }
    v8 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v7 + 328LL))(v7);
    snprintf((char *)a2, 9uLL, "%x", (unsigned int)v8);
    v9 = strlen((const char *)a2);
    v10 = v9;
    v11 = v9 - 1;
    if ( v11 >= 0 )
    {
      v12 = &a2[(signed __int16)(v10 - 1)];
      do
      {
        if ( *v12 != 48 )
          break;
        --v11;
        --v12;
      }
      while ( v11 >= 0 );
    }
    LOWORD(v13) = v11 + 1;
  }
  if ( *((_BYTE *)this + 8173) )
  {
    v16 = (signed __int16)v13;
    LOWORD(v13) = v13 + 1;
    a2[v16] = *((_BYTE *)this + 8160) | 0x40;
  }
  a2[(signed __int16)v13] = 0;
  result = 1;
LABEL_14:
  v17 = *(_QWORD *)v2;
  return result;
}
// 6020: using guessed type __int64 off_6020;

//----- (0000000000002EFE) ----------------------------------------------------
int __fastcall AppleUSBFTDI::acquirePort(AppleUSBFTDI *this, __int64 a2, void *a3)
{
  int v3; // ebx@1
  int result; // eax@6

  v3 = -536870185;
  if ( __PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138))
    || !*((_QWORD *)this + 34)
    || (v3 = -536870184, !*((_BYTE *)this + 240))
    || ((*(void (__fastcall **)(AppleUSBFTDI *, __int64, void *))(*(_QWORD *)this + 32LL))(this, a2, a3),
        v3 = (*(int (__fastcall **)(_QWORD, int (__fastcall *)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
               *((_QWORD *)this + 35),
               AppleUSBFTDI::acquirePortAction,
               (unsigned __int8)a2,
               0LL,
               0LL,
               0LL),
        (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this),
        v3)
    || (v3 = 0, *((_BYTE *)this + 8162)) )
    result = v3;
  else
    result = AppleUSBFTDI::startReads(this);
  return result;
}

//----- (0000000000002FAA) ----------------------------------------------------
int __fastcall AppleUSBFTDI::acquirePortAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6)
{
  LOBYTE(a4) = a2 != 0LL;
  return (*(int (__fastcall **)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)this + 2368LL))(
           this,
           a2 != 0LL,
           a3,
           a4,
           a5,
           a6);
}

//----- (0000000000002FC4) ----------------------------------------------------
int __fastcall AppleUSBFTDI::startReads(AppleUSBFTDI *this)
{
  int result; // eax@1
  __int16 v2; // r14@3
  unsigned __int16 v3; // r13@3
  signed __int64 v4; // rbx@4
  __int64 v5; // rsi@4

  result = -536870185;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    result = 0;
    if ( *((_WORD *)this + 4082) )
    {
      v2 = 0;
      v3 = 0;
      result = 0;
      do
      {
        v4 = 88LL * v3;
        v5 = *(_QWORD *)((char *)this + v4 + 1088);
        if ( v5 )
        {
          *(_QWORD *)((char *)this + v4 + 1136) = 0LL;
          *(_DWORD *)((char *)this + v4 + 1144) = 0;
          *(_QWORD *)((char *)this + v4 + 1152) = (char *)this + v4 + 1088;
          *(_QWORD *)((char *)this + v4 + 1160) = 0LL;
          *(_DWORD *)((char *)this + v4 + 1168) = 0;
          *(_DWORD *)((char *)this + v4 + 1172) = 0;
          *(_QWORD *)((char *)this + v4 + 1112) = this;
          *(_QWORD *)((char *)this + v4 + 1120) = AppleUSBFTDI::dataReadCompleteUSB;
          *(_QWORD *)((char *)this + v4 + 1128) = (char *)this + v4 + 1136;
          result = (*(int (__fastcall **)(_QWORD, __int64, char *, _QWORD))(**((_QWORD **)this + 134) + 320LL))(
                     *((_QWORD *)this + 134),
                     v5,
                     (char *)this + v4 + 1112,
                     0LL);
          if ( result )
          {
            *((_BYTE *)this + v4 + 1108) = 1;
          }
          else
          {
            ++v2;
            result = 0;
          }
        }
        ++v3;
      }
      while ( v3 < (unsigned int)*((_WORD *)this + 4082) );
      if ( v2 )
        *((_BYTE *)this + 8162) = 1;
    }
  }
  return result;
}

//----- (0000000000003104) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::acquirePortGated(AppleUSBFTDI *this, char a2)
{
  int v2; // er14@3
  int v4; // [sp+Ch] [bp-34h]@3
  int v5; // [sp+10h] [bp-30h]@6
  unsigned int v6; // [sp+14h] [bp-2Ch]@1

  (*(void (**)(void))(*(_QWORD *)this + 32LL))();
  v6 = *((_DWORD *)this + 72) & 0x80000000;
  if ( v6 )
  {
    if ( a2 )
    {
      while ( 1 )
      {
        v6 = 0;
        v4 = 2147483648;
        v2 = (*(int (__fastcall **)(AppleUSBFTDI *, int *, int *))(*(_QWORD *)this + 2400LL))(this, &v6, &v4);
        if ( v2 != -536870198 )
        {
          if ( v2 )
            break;
        }
        v6 = *((_DWORD *)this + 72) & 0x80000000;
        if ( !v6 )
          goto LABEL_6;
      }
      (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
    }
    else
    {
      (*(void (**)(void))(*(_QWORD *)this + 40LL))();
      v2 = -536870203;
    }
  }
  else
  {
LABEL_6:
    v5 = -1606418408;
    v4 = -1;
    (*(void (__fastcall **)(AppleUSBFTDI *, int *, int *))(*(_QWORD *)this + 2392LL))(this, &v5, &v4);
    AppleUSBFTDI::setStructureDefaults(this);
    v2 = 0;
    AppleUSBFTDI::sendReset(this, 0);
    IOSleep(1500LL);
    AppleUSBFTDI::sendFlowCtrl(this, 0, 0, 0);
    ++*((_WORD *)this + 68);
    v5 = 32;
    v4 = 32;
    (*(void (__fastcall **)(AppleUSBFTDI *, int *, int *))(*(_QWORD *)this + 2392LL))(this, &v5, &v4);
  }
  return (unsigned int)v2;
}
// FA80: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000003236) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::setStructureDefaults(AppleUSBFTDI *this)
{
  __int64 result; // rax@1

  *((_DWORD *)this + 248) = 9600;
  *((_DWORD *)this + 2038) = 0;
  *((_DWORD *)this + 244) = 8;
  *((_DWORD *)this + 2035) = 0;
  *((_DWORD *)this + 245) = 2;
  *((_DWORD *)this + 2036) = 0;
  *((_DWORD *)this + 246) = 1;
  *((_DWORD *)this + 2037) = 0;
  *((_DWORD *)this + 247) = 1;
  *((_BYTE *)this + 998) = 0;
  *((_BYTE *)this + 999) = 17;
  *((_BYTE *)this + 1000) = 19;
  *((_WORD *)this + 520) = 0;
  *((_WORD *)this + 521) = 0;
  *((_QWORD *)this + 131) = 0LL;
  *((_BYTE *)this + 8158) = 0;
  *((_BYTE *)this + 8156) = 0;
  *((_BYTE *)this + 8157) = 0;
  *((_QWORD *)this + 114) = 0x4000LL;
  *((_QWORD *)this + 115) = 10922LL;
  *((_QWORD *)this + 116) = 5461LL;
  *((_QWORD *)this + 118) = 0x4000LL;
  *((_QWORD *)this + 119) = 10922LL;
  *((_QWORD *)this + 120) = 5461LL;
  *((_DWORD *)this + 259) = 292;
  result = 0LL;
  do
    *((_DWORD *)this + result++ + 251) = 0;
  while ( result != 8 );
  return result;
}

//----- (0000000000003340) ----------------------------------------------------
char __fastcall AppleUSBFTDI::sendReset(AppleUSBFTDI *this, __int16 a2)
{
  char result; // al@1

  result = AppleUSBFTDI::USBSendRequest((__int64)this, 64, 0, a2, *((_BYTE *)this + 8160), 0LL, 0);
  if ( !result )
    result = IOLog("%8x %8x AppleUSBFTDI: sendReset - USBSendRequest failed\n", 0LL, 0LL);
  return result;
}
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);

//----- (000000000000338C) ----------------------------------------------------
char __fastcall AppleUSBFTDI::sendFlowCtrl(AppleUSBFTDI *this, int a2, unsigned __int8 a3, unsigned __int8 a4)
{
  __int16 v4; // ax@2
  __int16 v5; // cx@2
  char result; // al@4

  if ( a2 == 2 )
  {
    v4 = a4 << 8;
    v5 = a3;
  }
  else
  {
    v4 = 0;
    v5 = 0;
  }
  result = AppleUSBFTDI::USBSendRequest(
             (__int64)this,
             64,
             2,
             v4 | v5,
             ((unsigned __int8)a2 << 8) | *((_BYTE *)this + 8160),
             0LL,
             0);
  if ( !result )
    result = IOLog("%8x %8x AppleUSBFTDI: sendFlowCtrl - USBSendRequest failed\n", 0LL, 0LL);
  return result;
}
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);

//----- (00000000000033FE) ----------------------------------------------------
int __fastcall AppleUSBFTDI::releasePort(AppleUSBFTDI *this, void *a2)
{
  AppleUSBFTDI *v2; // rbx@1
  __int64 v3; // rdi@2
  __int64 v4; // rdi@4
  int v5; // er14@6
  __int64 v6; // rdi@9
  __int64 v7; // rdi@11
  __int64 v8; // rdi@13
  __int64 v9; // rax@14

  v2 = this;
  if ( !*((_BYTE *)this + 139) )
  {
    v3 = *((_QWORD *)this + 134);
    if ( v3 )
      (*(void (__fastcall **)(__int64, void *))(*(_QWORD *)v3 + 296LL))(v3, a2);
    *((_BYTE *)v2 + 8162) = 0;
    v4 = *((_QWORD *)v2 + 135);
    if ( v4 )
      (*(void (__fastcall **)(__int64, void *))(*(_QWORD *)v4 + 296LL))(v4, a2);
  }
  IODelay(100LL, a2);
  (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)v2 + 32LL))(v2);
  v5 = (*(int (__fastcall **)(_QWORD, int (__fastcall *)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)v2 + 35) + 456LL))(
         *((_QWORD *)v2 + 35),
         AppleUSBFTDI::releasePortAction,
         0LL,
         0LL,
         0LL,
         0LL);
  (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)v2 + 40LL))(v2);
  if ( *((_BYTE *)v2 + 139) )
  {
    (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)v2 + 2432LL))(v2);
  }
  else if ( *((_BYTE *)v2 + 8174) )
  {
    v6 = *((_QWORD *)v2 + 134);
    if ( v6 )
      (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v6 + 488LL))(v6, 1LL);
    v7 = *((_QWORD *)v2 + 135);
    if ( v7 )
      (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v7 + 488LL))(v7, 1LL);
    v8 = *((_QWORD *)v2 + 33);
    if ( v8 )
    {
      LODWORD(v9) = (*(int (**)(void))(*(_QWORD *)v8 + 2216LL))();
      return (*(int (__fastcall **)(__int64))(*(_QWORD *)v9 + 2232LL))(v9);
    }
  }
  return v5;
}
// FA40: using guessed type int __fastcall IODelay(_QWORD, _QWORD);

//----- (0000000000003504) ----------------------------------------------------
int __fastcall AppleUSBFTDI::releasePortAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6)
{
  return (*(int (__fastcall **)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *))(*(_QWORD *)this + 2376LL))(
           this,
           a2,
           a3,
           a4,
           a5,
           a6);
}

//----- (0000000000003512) ----------------------------------------------------
__int64 __usercall AppleUSBFTDI::releasePortGated@<rax>(AppleUSBFTDI *this@<rdi>, __int64 a2@<rax>)
{
  char v2; // cl@1
  __int64 result; // rax@2
  __int64 v4; // [sp+0h] [bp-10h]@1

  v4 = a2;
  v2 = *((_BYTE *)this + 139);
  if ( *((_DWORD *)this + 72) < 0 )
  {
    if ( !v2 )
      AppleUSBFTDI::setModemCtrl(this, 0, 0);
    v4 = 0xFFFFFFFFLL;
    (*(void (__fastcall **)(AppleUSBFTDI *, char *, __int64 *))(*(_QWORD *)this + 2392LL))(this, (char *)&v4 + 4, &v4);
    --*((_WORD *)this + 68);
    (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
    result = 0LL;
  }
  else
  {
    result = 3758097111LL;
    if ( !v2 )
    {
      result = 3758097111LL;
      if ( !*((_BYTE *)this + 138) )
        result = 3758097101LL;
    }
  }
  return result;
}

//----- (0000000000003594) ----------------------------------------------------
char __fastcall AppleUSBFTDI::setModemCtrl(AppleUSBFTDI *this, unsigned __int8 a2, unsigned __int8 a3)
{
  char result; // al@1

  result = AppleUSBFTDI::USBSendRequest(
             (__int64)this,
             64,
             1,
             2 * a2 | a3 | (((unsigned __int16)(2 * a2) | a3) << 8),
             *((_BYTE *)this + 8160),
             0LL,
             0);
  if ( !result )
    result = IOLog("%8x %8x AppleUSBFTDI: setModemCtrl - USBSendRequest failed\n", 0LL, 0LL);
  return result;
}
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);

//----- (00000000000035F0) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::getState(AppleUSBFTDI *this, void *a2)
{
  __int64 result; // rax@2
  int v3; // er14@4

  if ( __PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    result = 0LL;
  }
  else
  {
    (*(void (__fastcall **)(AppleUSBFTDI *, void *))(*(_QWORD *)this + 32LL))(this, a2);
    v3 = (*(int (__fastcall **)(_QWORD, int (__fastcall *)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleUSBFTDI::getStateAction,
           0LL,
           0LL,
           0LL,
           0LL);
    (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
    result = (unsigned int)v3;
  }
  return result;
}

//----- (000000000000364E) ----------------------------------------------------
int __fastcall AppleUSBFTDI::getStateAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6)
{
  return (*(int (__fastcall **)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *))(*(_QWORD *)this + 2384LL))(
           this,
           a2,
           a3,
           a4,
           a5,
           a6);
}

//----- (000000000000365C) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::getStateGated(AppleUSBFTDI *this)
{
  __int64 result; // rax@1

  result = 0LL;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    AppleUSBFTDI::CheckQueues(this);
    result = *((_DWORD *)this + 72) & 0xFFFFEFFF;
  }
  return result;
}

//----- (0000000000003694) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::setState(AppleUSBFTDI *this, __int64 a2, __int64 a3, void *a4)
{
  int v4; // ebx@1
  bool v5; // zf@3
  int v7; // [sp+8h] [bp-18h]@1
  int v8; // [sp+Ch] [bp-14h]@1

  v8 = a2;
  v7 = a3;
  v4 = 0;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    v4 = -536870206;
    if ( !(a3 & 0xC0001000) )
    {
      v5 = ((unsigned int)a3 & ((*((_DWORD *)this + 259) | 0xFFFF0000) ^ 0xFFFF)) == 0;
      v7 = a3 & ((*((_DWORD *)this + 259) | 0xFFFF0000) ^ 0xFFFF);
      v4 = 0;
      if ( !v5 )
      {
        (*(void (__fastcall **)(AppleUSBFTDI *, __int64, __int64, void *))(*(_QWORD *)this + 32LL))(this, a2, a3, a4);
        v4 = (*(int (__fastcall **)(_QWORD, int (__fastcall *)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *), int *, int *, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
               *((_QWORD *)this + 35),
               AppleUSBFTDI::setStateAction,
               &v8,
               &v7,
               0LL,
               0LL);
        (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
      }
    }
  }
  return (unsigned int)v4;
}

//----- (000000000000372C) ----------------------------------------------------
int __fastcall AppleUSBFTDI::setStateAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6)
{
  return (*(int (__fastcall **)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)this + 2392LL))(
           this,
           a2,
           a3,
           a4,
           a5,
           a6);
}

//----- (000000000000373E) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::setStateGated(AppleUSBFTDI *this, unsigned int *a2, unsigned int *a3)
{
  signed int v3; // ebx@1
  unsigned int v4; // er12@2
  unsigned int v5; // er13@2
  int v6; // ecx@3
  char *v7; // r14@4
  unsigned int v8; // ebx@6
  char v9; // dl@6
  char v10; // si@8
  int v11; // er12@16

  v3 = -536870185;
  if ( !*((_BYTE *)this + 138) )
  {
    v4 = *a2;
    v5 = *a3;
    if ( (*a2 & 0x80000000) != 0 )
    {
      v7 = (char *)this + 288;
      v6 = *((_DWORD *)this + 72);
    }
    else
    {
      v6 = *((_DWORD *)this + 72);
      v3 = -536870195;
      if ( v6 >= 0 )
        return (unsigned int)v3;
      v7 = (char *)this + 288;
    }
    v8 = (v6 & 2u) >> 1;
    v9 = ((unsigned __int8)v6 >> 2) & 1;
    if ( v5 & 2 && (v4 & 2) != (v6 & 2) )
    {
      v10 = 1;
      LOBYTE(v8) = (unsigned __int8)(v4 & 2) >> 1;
    }
    else
    {
      v10 = 0;
    }
    if ( v5 & 4 && (v4 & 4) != (v6 & 4) )
    {
      v10 = 1;
      v9 = (unsigned __int8)(v4 & 4) >> 2;
    }
    if ( !*((_BYTE *)this + 139) && v10 )
    {
      AppleUSBFTDI::setModemCtrl(this, v9 & 1, v8 & 1);
      v6 = *((_DWORD *)this + 72);
    }
    v11 = v6 & ~v5 | v5 & v4;
    *((_DWORD *)this + 72) = v11;
    v3 = 0;
    if ( (v11 ^ v6) & *((_DWORD *)this + 73) )
    {
      v3 = 0;
      (*(void (__fastcall **)(_QWORD, char *, _QWORD))(**((_QWORD **)this + 35) + 488LL))(
        *((_QWORD *)this + 35),
        v7,
        0LL);
    }
  }
  return (unsigned int)v3;
}

//----- (0000000000003858) ----------------------------------------------------
__int64 __usercall AppleUSBFTDI::watchState@<rax>(AppleUSBFTDI *this@<rdi>, unsigned int *a2@<rsi>, void *a3@<rcx>, __int64 a4@<rax>, __int64 a5@<rdx>)
{
  int v5; // ebx@1
  __int64 v7; // [sp-4h] [bp-20h]@1

  v7 = a4;
  HIDWORD(v7) = a5;
  v5 = -536870185;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    v5 = -536870206;
    if ( a2 )
    {
      v5 = 0;
      if ( (_DWORD)a5 )
      {
        (*(void (__fastcall **)(AppleUSBFTDI *, unsigned int *, __int64, void *))(*(_QWORD *)this + 32LL))(
          this,
          a2,
          a5,
          a3);
        v5 = (*(int (__fastcall **)(_QWORD, int (__fastcall *)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *), unsigned int *, char *, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
               *((_QWORD *)this + 35),
               AppleUSBFTDI::watchStateAction,
               a2,
               (char *)&v7 + 4,
               0LL,
               0LL);
        (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
      }
    }
  }
  return (unsigned int)v5;
}

//----- (00000000000038DA) ----------------------------------------------------
int __fastcall AppleUSBFTDI::watchStateAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6)
{
  return (*(int (__fastcall **)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)this + 2400LL))(
           this,
           a2,
           a3,
           a4,
           a5,
           a6);
}

//----- (00000000000038EC) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::watchStateGated(AppleUSBFTDI *this, unsigned int *a2, unsigned int *a3)
{
  unsigned int *v3; // r14@1
  AppleUSBFTDI *v4; // r12@1
  signed int v5; // ebx@1
  unsigned int v6; // eax@2
  char *v7; // rsi@3
  unsigned int v8; // er13@3
  unsigned int v9; // er15@3
  int v10; // er15@6
  __int64 v11; // rcx@6
  char *v12; // rdi@7
  int v13; // ebx@12
  char v15; // [sp+4h] [bp-3Ch]@11

  v3 = a2;
  v4 = this;
  v5 = -536870185;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    v6 = *((_DWORD *)this + 72);
    v5 = -536870195;
    if ( (v6 & 0x80000000) != 0 )
    {
      v7 = (char *)this + 288;
      v8 = *a3 & 0xFFFFEFFF;
      v9 = *v3;
      if ( *a3 > 0x3FFFFFFF )
      {
        a3 = 0LL;
      }
      else
      {
        v9 &= 0xBFFFFFFF;
        v8 |= 0x40000000u;
        LOBYTE(a3) = 1;
      }
      v10 = ~v9;
      v11 = v8 & (v10 ^ v6);
      if ( v8 & (v10 ^ v6) )
      {
        v12 = (char *)this + 280;
LABEL_8:
        *v3 = v6;
        v5 = -536870198;
        if ( (_BYTE)a3 == 0 || (v11 & 0x40000000) == 0 )
          v5 = 0;
      }
      else
      {
        v15 = (char)a3;
        while ( 1 )
        {
          *((_DWORD *)this + 73) |= v8;
          (*(void (__fastcall **)(AppleUSBFTDI *, char *, unsigned int *, __int64))(*(_QWORD *)this + 32LL))(
            this,
            v7,
            a3,
            v11);
          (*(void (**)(void))(**((_QWORD **)this + 35) + 32LL))();
          ++*((_WORD *)this + 4090);
          v7 = (char *)this + 288;
          v13 = (*(int (__fastcall **)(_QWORD, char *, signed __int64))(**((_QWORD **)this + 35) + 480LL))(
                  *((_QWORD *)this + 35),
                  (char *)this + 288,
                  2LL);
          --*((_WORD *)this + 4090);
          (*(void (**)(void))(**((_QWORD **)this + 35) + 40LL))();
          if ( v13 == 2 )
          {
            (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
            v5 = -536870165;
            goto LABEL_18;
          }
          if ( v13 == 1 )
            break;
          if ( __PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
          {
            (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
            v5 = -536870185;
            goto LABEL_18;
          }
          (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
          v6 = *((_DWORD *)this + 72);
          v11 = v8 & (v10 ^ *((_DWORD *)this + 72));
          if ( v8 & (v10 ^ *((_DWORD *)this + 72)) )
          {
            v7 = (char *)this + 288;
            v12 = (char *)this + 280;
            LOBYTE(a3) = v15;
            goto LABEL_8;
          }
        }
        (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
        v5 = -536870186;
LABEL_18:
        v7 = (char *)this + 288;
        v12 = (char *)this + 280;
      }
      *((_DWORD *)v4 + 73) = 0;
      (*(void (__fastcall **)(_QWORD, char *, _QWORD))(**(_QWORD **)v12 + 488LL))(*(_QWORD *)v12, v7, 0LL);
      *((_BYTE *)v3 + 1) &= 0xEFu;
    }
  }
  return (unsigned int)v5;
}

//----- (0000000000003AD6) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::nextEvent(AppleUSBFTDI *this, void *a2)
{
  __int64 result; // rax@1
  bool v3; // zf@2

  result = 3758097111LL;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    v3 = ((*(int (__fastcall **)(AppleUSBFTDI *, char *))(*(_QWORD *)this + 2152LL))(this, (char *)this + 288) & 0x40000000) == 0;
    result = 3758097101LL;
    if ( !v3 )
      result = 0LL;
  }
  return result;
}

//----- (0000000000003B12) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::executeEvent(AppleUSBFTDI *this, __int64 a2, __int64 a3, void *a4)
{
  int v4; // er14@1
  int v6; // [sp+8h] [bp-18h]@1
  int v7; // [sp+Ch] [bp-14h]@1

  v7 = a2;
  v6 = a3;
  v4 = -536870185;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    (*(void (__fastcall **)(AppleUSBFTDI *, __int64, __int64, void *))(*(_QWORD *)this + 32LL))(this, a2, a3, a4);
    v4 = (*(int (__fastcall **)(_QWORD, int (__fastcall *)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *), int *, int *, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleUSBFTDI::executeEventAction,
           &v7,
           &v6,
           0LL,
           0LL);
    (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
  }
  return (unsigned int)v4;
}

//----- (0000000000003B84) ----------------------------------------------------
int __fastcall AppleUSBFTDI::executeEventAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6)
{
  return (*(int (__fastcall **)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)this + 2408LL))(
           this,
           a2,
           a3,
           a4,
           a5,
           a6);
}

//----- (0000000000003B96) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::executeEventGated(AppleUSBFTDI *this, unsigned int *a2, unsigned int *a3)
{
  signed int v3; // ebx@1
  unsigned int v4; // eax@2
  unsigned int v5; // er15@2
  unsigned int v6; // ecx@2
  __int64 v7; // rcx@9
  bool v8; // zf@16
  __int64 result; // rax@29
  __int16 v10; // si@48
  int v11; // [sp+8h] [bp-28h]@11
  int v12; // [sp+Ch] [bp-24h]@11
  int v13; // [sp+10h] [bp-20h]@2
  unsigned int v14; // [sp+14h] [bp-1Ch]@2

  v3 = -536870185;
  if ( __PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
    return (unsigned int)v3;
  v4 = *a2;
  v5 = *a3;
  v13 = 0;
  v6 = *((_DWORD *)this + 72);
  v14 = v6;
  v3 = -536870195;
  if ( !(v6 & 0x80000000) )
    return (unsigned int)v3;
  if ( (signed int)v4 <= 4 )
  {
    if ( v4 == -2146937856 )
    {
      v3 = 0;
      AppleUSBFTDI::setBitMode(this, (unsigned __int8)v5, 0);
      return (unsigned int)v3;
    }
    goto LABEL_90;
  }
  v3 = 0;
  if ( (signed int)v4 <= 228 )
  {
    if ( (signed int)v4 <= 10 )
    {
      if ( v4 == 5 )
      {
        v7 = v6 & 0x40000000;
        if ( v5 )
        {
          if ( !v7 )
          {
            AppleUSBFTDI::setStructureDefaults(this);
            v12 = 0x40000000;
            v11 = 0x40000000;
            (*(void (__fastcall **)(AppleUSBFTDI *, int *, int *))(*(_QWORD *)this + 2392LL))(this, &v12, &v11);
            v12 = 6;
            v11 = 6;
            (*(void (__fastcall **)(AppleUSBFTDI *, int *, int *))(*(_QWORD *)this + 2392LL))(this, &v12, &v11);
            v3 = 0;
          }
        }
        else
        {
          v3 = 0;
          if ( v7 )
          {
            v12 = 0;
            v11 = 0x40000000;
            (*(void (__fastcall **)(AppleUSBFTDI *, int *, int *))(*(_QWORD *)this + 2392LL))(this, &v12, &v11);
            v3 = 0;
            AppleUSBFTDI::setModemCtrl(this, 0, 0);
          }
        }
        return (unsigned int)v3;
      }
      goto LABEL_90;
    }
    if ( (signed int)v4 <= 14 )
    {
      v8 = v4 == 11;
      goto LABEL_44;
    }
    if ( (signed int)v4 <= 18 )
    {
      v8 = v4 == 15;
      goto LABEL_44;
    }
    if ( (signed int)v4 <= 22 )
    {
      v8 = v4 == 19;
      goto LABEL_44;
    }
    if ( (signed int)v4 <= 26 )
    {
      v8 = v4 == 23;
      goto LABEL_44;
    }
    if ( (signed int)v4 <= 30 )
    {
      v8 = v4 == 27;
      goto LABEL_44;
    }
    if ( (signed int)v4 <= 39 )
    {
      v8 = v4 == 31;
LABEL_44:
      v3 = 0;
      if ( v8 )
        return (unsigned int)v3;
      goto LABEL_90;
    }
    if ( (signed int)v4 <= 46 )
    {
      if ( v4 != 40 )
        goto LABEL_90;
      v10 = 2;
LABEL_52:
      AppleUSBFTDI::sendReset(this, v10);
      return (unsigned int)v3;
    }
    if ( (signed int)v4 <= 50 )
    {
      if ( v4 != 47 )
        goto LABEL_90;
      v10 = 1;
      goto LABEL_52;
    }
    if ( (signed int)v4 <= 54 )
    {
      if ( v4 == 51 )
      {
        v3 = -536870206;
        if ( v5 - 200 <= 0xB71A39 )
        {
          *((_DWORD *)this + 248) = v5 >> 1;
          v3 = AppleUSBFTDI::setBaudRate(this);
        }
        return (unsigned int)v3;
      }
      goto LABEL_90;
    }
    if ( (signed int)v4 <= 58 )
    {
      if ( v4 != 55 )
        goto LABEL_90;
      goto LABEL_66;
    }
    if ( (signed int)v4 > 62 )
    {
      if ( (signed int)v4 <= 66 )
      {
        if ( v4 != 63 )
          goto LABEL_90;
LABEL_66:
        v3 = -536870206;
        if ( !v5 )
          v3 = 0;
        return (unsigned int)v3;
      }
      if ( (signed int)v4 > 70 )
      {
        if ( (signed int)v4 > 74 )
        {
          if ( (signed int)v4 > 78 )
          {
            if ( (signed int)v4 > 82 )
            {
              if ( v4 == 83 )
                return (unsigned int)v3;
              if ( v4 == 85 )
              {
                *((_DWORD *)this + (v5 >> 5) + 251) &= ~(1 << v5);
                v3 = 0;
                return (unsigned int)v3;
              }
              if ( v4 == 89 )
              {
                *((_DWORD *)this + (v5 >> 5) + 251) |= 1 << v5;
                v3 = 0;
                return (unsigned int)v3;
              }
            }
            else if ( v4 == 79 )
            {
              *((_QWORD *)this + 132) = 1000 * v5 / 0x3B9ACA00uLL | ((unsigned __int64)(1000 * v5 % 0x3B9ACA00) << 32);
              AppleUSBFTDI::sendLatency(this, 16);
              v3 = 0;
              return (unsigned int)v3;
            }
          }
          else if ( v4 == 75 )
          {
            *((_QWORD *)this + 133) = 1000 * v5 / 0x3B9ACA00uLL | ((unsigned __int64)(1000 * v5 % 0x3B9ACA00) << 32);
            return (unsigned int)v3;
          }
        }
        else if ( v4 == 71 )
        {
          if ( !v5 || (v3 = -536870206, v5 == 6) )
          {
            *((_DWORD *)this + 247) = v5;
            v3 = 0;
          }
          return (unsigned int)v3;
        }
        goto LABEL_90;
      }
      if ( v4 != 67 )
        goto LABEL_90;
      v3 = -536870206;
      if ( v5 - 1 > 4 )
        return (unsigned int)v3;
      *((_DWORD *)this + 246) = v5;
      *((_DWORD *)this + 247) = 0;
    }
    else
    {
      if ( v4 != 59 )
        goto LABEL_90;
      v3 = -536870206;
      if ( v5 - 10 > 7 )
        return (unsigned int)v3;
      *((_DWORD *)this + 244) = v5 >> 1;
    }
    AppleUSBFTDI::setData(this);
    v3 = 0;
    return (unsigned int)v3;
  }
  if ( (signed int)v4 <= 232 )
  {
    if ( v4 == 229 )
    {
      *((_BYTE *)this + 998) = v5 != 0;
      v3 = 0;
      return (unsigned int)v3;
    }
LABEL_90:
    v3 = -536870206;
    return (unsigned int)v3;
  }
  if ( (signed int)v4 <= 236 )
  {
    if ( v4 == 233 )
    {
      *((_BYTE *)this + 1000) = v5;
      v3 = 0;
      return (unsigned int)v3;
    }
    goto LABEL_90;
  }
  if ( (signed int)v4 <= 242 )
  {
    if ( v4 == 237 )
    {
      *((_BYTE *)this + 999) = v5;
      v3 = 0;
      return (unsigned int)v3;
    }
    goto LABEL_90;
  }
  if ( v4 == 243 )
  {
    *((_DWORD *)this + 245) = v5;
    AppleUSBFTDI::setData(this);
    return (unsigned int)v3;
  }
  if ( v4 != 247 )
  {
    if ( v4 == 249 )
    {
      v14 = v6 & 0xFFFFF7FF;
      v13 = 2048;
      (*(void (__fastcall **)(AppleUSBFTDI *, int *, int *))(*(_QWORD *)this + 2392LL))(this, &v14, &v13);
      if ( !*((_BYTE *)this + 139) )
        AppleUSBFTDI::setBreak(this, v5 != 0);
      return (unsigned int)v3;
    }
    goto LABEL_90;
  }
  result = 3758097090LL;
  if ( !v5 )
    result = 0LL;
  return result;
}

//----- (0000000000004044) ----------------------------------------------------
char __fastcall AppleUSBFTDI::sendLatency(AppleUSBFTDI *this, __int16 a2)
{
  char result; // al@1

  result = AppleUSBFTDI::USBSendRequest((__int64)this, 64, 9, a2, *((_BYTE *)this + 8160), 0LL, 0);
  if ( !result )
    result = IOLog("%8x %8x AppleUSBFTDI: sendLatency - USBSendRequest failed\n", 0LL, 0LL);
  return result;
}
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);

//----- (0000000000004092) ----------------------------------------------------
char __fastcall AppleUSBFTDI::setBitMode(AppleUSBFTDI *this, __int16 a2, __int16 a3)
{
  char result; // al@1

  result = AppleUSBFTDI::USBSendRequest((__int64)this, 64, 11, (a3 << 8) + a2, *((_BYTE *)this + 8160), 0LL, 0);
  if ( !result )
    result = IOLog("%8x %8x AppleUSBFTDI: setBitMode - USBSendRequest failed\n", 0LL, 0LL);
  return result;
}
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);

//----- (00000000000040E2) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::setData(AppleUSBFTDI *this)
{
  unsigned int v1; // ecx@1
  __int64 result; // rax@1

  v1 = *((_DWORD *)this + 245);
  result = *((_DWORD *)this + 246);
  if ( __PAIR__(result, v1) != __PAIR__(*((_DWORD *)this + 2037), *((_DWORD *)this + 2036))
    || *((_DWORD *)this + 244) != *((_DWORD *)this + 2035) )
  {
    if ( !AppleUSBFTDI::USBSendRequest(
            (__int64)this,
            64,
            4,
            *((_BYTE *)this + 976) | (unsigned __int16)(((unsigned __int16)(result + 255) | (unsigned __int8)(16 * ((unsigned __int8)(v1 - 2) == 2))) << 8),
            *((_BYTE *)this + 8160),
            0LL,
            0) )
      IOLog("%8x %8x AppleUSBFTDI: setData - USBSendRequest failed\n", 0LL, 0LL);
    *((_DWORD *)this + 2036) = *((_DWORD *)this + 245);
    *((_DWORD *)this + 2037) = *((_DWORD *)this + 246);
    result = *((_DWORD *)this + 244);
    *((_DWORD *)this + 2035) = result;
  }
  return result;
}
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);

//----- (00000000000041AA) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::setBaudRate(AppleUSBFTDI *this)
{
  int v1; // eax@1
  unsigned int v2; // ebx@1
  unsigned __int16 *v3; // rcx@2
  unsigned __int16 v4; // ax@6
  unsigned __int16 v6; // [sp+Ch] [bp-14h]@1
  unsigned __int16 v7; // [sp+Eh] [bp-12h]@1

  v7 = 0;
  v6 = 0;
  v1 = *((_DWORD *)this + 248);
  v2 = 0;
  if ( v1 != *((_DWORD *)this + 2038) )
  {
    v3 = (unsigned __int16 *)&word_5F66;
    do
    {
      if ( v1 == *(_DWORD *)(v3 - 3) )
      {
        v7 = *(v3 - 1);
        v4 = *v3;
        v6 = *v3;
        goto LABEL_8;
      }
      ++v2;
      v3 += 4;
    }
    while ( (unsigned __int16)v2 <= 0x13u );
    if ( !(unsigned int)AppleUSBFTDI::calculateDeviceBaud(this, &v7, &v6) )
    {
      IOLog("%8x %8x AppleUSBFTDI: setBaudRate - calculateDeviceBaud returned bad baud rate\n", 0LL, 0LL);
      return -536870206;
    }
    v4 = v6;
LABEL_8:
    LOBYTE(v6) = *((_BYTE *)this + 8160) | v4;
    if ( (unsigned __int8)(*((_BYTE *)this + 8172) | 2) == 3 )
      v6 = HIBYTE(v4);
    v2 = 0;
    if ( AppleUSBFTDI::USBSendRequest((__int64)this, 64, 3, v7, v6, 0LL, 0) )
      *((_DWORD *)this + 2038) = *((_DWORD *)this + 248);
    else
      IOLog("%8x %8x AppleUSBFTDI: setBaudRate - USBSendRequest failed\n", 0LL, 0LL);
  }
  return v2;
}
// 5F66: using guessed type __int16 word_5F66;
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);

//----- (00000000000042BA) ----------------------------------------------------
char __fastcall AppleUSBFTDI::setBreak(AppleUSBFTDI *this, char a2)
{
  int v2; // edx@1
  int v3; // ecx@1
  char result; // al@5

  v2 = *((_DWORD *)this + 246) + 255;
  v3 = v2 | 0x10;
  if ( *((_BYTE *)this + 980) != 2 )
    LOBYTE(v3) = v2;
  if ( a2 )
    LOBYTE(v3) = v3 | 0x40;
  result = AppleUSBFTDI::USBSendRequest(
             (__int64)this,
             64,
             4,
             *((_BYTE *)this + 976) | (unsigned __int16)((unsigned __int8)v3 << 8),
             *((_BYTE *)this + 8160),
             0LL,
             0);
  if ( !result )
    result = IOLog("%8x %8x AppleUSBFTDI: setBreak - USBSendRequest failed\n", 0LL, 0LL);
  return result;
}
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);

//----- (000000000000433E) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::requestEvent(AppleUSBFTDI *this, signed int a2, unsigned int *a3, void *a4)
{
  unsigned int *v4; // r14@1
  signed int v5; // ebx@1
  unsigned int v6; // eax@6
  int v7; // eax@7
  int v8; // eax@33
  signed __int64 v10; // rcx@69

  v4 = a3;
  v5 = -536870185;
  if ( __PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
    return (unsigned int)v5;
  v5 = 0;
  if ( !a3 )
    return (unsigned int)v5;
  if ( a2 <= 228 )
  {
    if ( a2 <= 10 )
    {
      if ( a2 == 5 )
      {
        v6 = (unsigned int)(*(int (__fastcall **)(AppleUSBFTDI *, char *, unsigned int *, void *))(*(_QWORD *)this
                                                                                                 + 2152LL))(
                             this,
                             (char *)this + 288,
                             a3,
                             a4) >> 30;
LABEL_7:
        v7 = v6 & 1;
LABEL_35:
        *v4 = v7;
        return (unsigned int)v5;
      }
      return (unsigned int)v5;
    }
    if ( a2 <= 14 )
    {
      if ( a2 == 11 )
      {
        v7 = *((_DWORD *)this + 94);
        goto LABEL_35;
      }
      return (unsigned int)v5;
    }
    if ( a2 <= 18 )
    {
      if ( a2 == 15 )
      {
        v7 = *((_DWORD *)this + 82);
        goto LABEL_35;
      }
      return (unsigned int)v5;
    }
    if ( a2 <= 22 )
    {
      if ( a2 != 19 )
        return (unsigned int)v5;
LABEL_60:
      *a3 = 0;
      return (unsigned int)v5;
    }
    if ( a2 <= 26 )
    {
      if ( a2 != 23 )
        return (unsigned int)v5;
      goto LABEL_60;
    }
    if ( a2 <= 30 )
    {
      if ( a2 != 27 )
        return (unsigned int)v5;
      goto LABEL_60;
    }
    if ( a2 <= 34 )
    {
      if ( a2 != 31 )
        return (unsigned int)v5;
      goto LABEL_60;
    }
    if ( a2 <= 38 )
    {
      if ( a2 != 35 )
        return (unsigned int)v5;
      v7 = *((_DWORD *)this + 94) - *((_DWORD *)this + 96);
      goto LABEL_35;
    }
    if ( a2 <= 50 )
    {
      if ( a2 != 39 )
        return (unsigned int)v5;
      v7 = *((_DWORD *)this + 84);
      goto LABEL_35;
    }
    if ( a2 > 54 )
    {
      if ( a2 <= 58 )
      {
        if ( a2 != 55 )
          return (unsigned int)v5;
        goto LABEL_60;
      }
      if ( a2 > 62 )
      {
        if ( a2 > 66 )
        {
          if ( a2 <= 70 )
          {
            if ( a2 != 67 )
              return (unsigned int)v5;
            v7 = *((_DWORD *)this + 246);
            goto LABEL_35;
          }
          if ( a2 <= 74 )
          {
            if ( a2 != 71 )
              return (unsigned int)v5;
            v7 = *((_DWORD *)this + 247);
            goto LABEL_35;
          }
          if ( a2 == 75 )
          {
            v10 = *((_QWORD *)this + 133);
          }
          else
          {
            if ( a2 != 79 )
            {
              if ( a2 != 83 )
                return (unsigned int)v5;
              v7 = *((_DWORD *)this + 259);
              goto LABEL_35;
            }
            v10 = *((_QWORD *)this + 132);
          }
          *a3 = 2361183241434822607LL
              * ((1000000000 * (unsigned __int64)((unsigned int)v10 & 0xFFFFFFFF) + (v10 >> 32)) >> 3) >> 64 >> 4;
          return (unsigned int)v5;
        }
        if ( a2 != 63 )
          return (unsigned int)v5;
        goto LABEL_60;
      }
      if ( a2 != 59 )
        return (unsigned int)v5;
      v8 = *((_DWORD *)this + 244);
    }
    else
    {
      if ( a2 != 51 )
        return (unsigned int)v5;
      v8 = *((_DWORD *)this + 248);
    }
LABEL_34:
    v7 = 2 * v8;
    goto LABEL_35;
  }
  if ( a2 <= 232 )
  {
    if ( a2 == 229 )
    {
      v7 = *((_BYTE *)this + 998);
      goto LABEL_35;
    }
    return (unsigned int)v5;
  }
  if ( a2 <= 236 )
  {
    if ( a2 == 233 )
    {
      v7 = *((_BYTE *)this + 1000);
      goto LABEL_35;
    }
    return (unsigned int)v5;
  }
  if ( a2 <= 242 )
  {
    if ( a2 == 237 )
    {
      v7 = *((_BYTE *)this + 999);
      goto LABEL_35;
    }
    return (unsigned int)v5;
  }
  if ( a2 == 243 )
  {
    v8 = *((_DWORD *)this + 245);
    goto LABEL_34;
  }
  if ( a2 == 247 )
    goto LABEL_60;
  if ( a2 == 249 )
  {
    v6 = (unsigned int)(*(int (__fastcall **)(AppleUSBFTDI *, char *, unsigned int *, void *))(*(_QWORD *)this + 2152LL))(
                         this,
                         (char *)this + 288,
                         a3,
                         a4) >> 11;
    goto LABEL_7;
  }
  return (unsigned int)v5;
}

//----- (00000000000045B2) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::enqueueEvent(AppleUSBFTDI *this, __int64 a2, __int64 a3, __int64 a4, void *a5)
{
  int v5; // er14@1
  int v7; // [sp+8h] [bp-18h]@1
  int v8; // [sp+Ch] [bp-14h]@1

  v8 = a2;
  v7 = a3;
  v5 = -536870185;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    (*(void (__fastcall **)(AppleUSBFTDI *, __int64, __int64, __int64, void *))(*(_QWORD *)this + 32LL))(
      this,
      a2,
      a3,
      a4,
      a5);
    v5 = (*(int (__fastcall **)(_QWORD, int (__fastcall *)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *), int *, int *, _QWORD, _QWORD))(**((_QWORD **)this + 35) + 456LL))(
           *((_QWORD *)this + 35),
           AppleUSBFTDI::executeEventAction,
           &v8,
           &v7,
           0LL,
           0LL);
    (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
  }
  return (unsigned int)v5;
}

//----- (0000000000004624) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::dequeueEvent(AppleUSBFTDI *this, unsigned int *a2, unsigned int *a3, __int64 a4, void *a5)
{
  __int64 result; // rax@1
  bool v6; // zf@4

  result = 3758097111LL;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    result = 3758097090LL;
    if ( a2 )
    {
      if ( a3 )
      {
        v6 = ((*(int (__fastcall **)(AppleUSBFTDI *, char *, unsigned int *, __int64, void *))(*(_QWORD *)this + 2152LL))(
                this,
                (char *)this + 288,
                a3,
                a4,
                a5) & 0x40000000) == 0;
        result = 3758097101LL;
        if ( !v6 )
          result = 0LL;
      }
    }
  }
  return result;
}

//----- (0000000000004670) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::enqueueData(AppleUSBFTDI *this, unsigned __int8 *a2, __int64 a3, unsigned int *a4, __int64 a5, void *a6)
{
  unsigned int *v6; // r14@1
  int v7; // ebx@1
  char v9; // [sp+Bh] [bp-25h]@1
  int v10; // [sp+Ch] [bp-24h]@1

  v6 = a4;
  v10 = a3;
  v9 = a5;
  v7 = -536870185;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    v7 = -536870206;
    if ( a4 )
    {
      if ( a2 )
      {
        (*(void (__fastcall **)(AppleUSBFTDI *, unsigned __int8 *, __int64, unsigned int *, __int64, void *))(*(_QWORD *)this + 32LL))(
          this,
          a2,
          a3,
          a4,
          a5,
          a6);
        v7 = (*(int (__fastcall **)(_QWORD, int (__fastcall *)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *), unsigned __int8 *, int *, unsigned int *, char *))(**((_QWORD **)this + 35) + 456LL))(
               *((_QWORD *)this + 35),
               AppleUSBFTDI::enqueueDataAction,
               a2,
               &v10,
               v6,
               &v9);
        (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
      }
    }
  }
  return (unsigned int)v7;
}

//----- (0000000000004704) ----------------------------------------------------
int __fastcall AppleUSBFTDI::enqueueDataAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6)
{
  return (*(int (__fastcall **)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)this + 2416LL))(
           this,
           a2,
           a3,
           a4,
           a5,
           a6);
}

//----- (0000000000004716) ----------------------------------------------------
int __fastcall AppleUSBFTDI::enqueueDataGated(AppleUSBFTDI *this, unsigned __int8 *a2, unsigned int *a3, unsigned int *a4, bool *a5)
{
  unsigned int *v5; // r15@1
  unsigned __int64 v6; // r12@1
  bool v7; // r13@1
  int result; // eax@1
  int v9; // [sp+10h] [bp-30h]@5
  int v10; // [sp+14h] [bp-2Ch]@1

  v5 = a4;
  v6 = *a3;
  v7 = *a5;
  v10 = 0x2000000;
  result = -536870185;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    *a4 = 0;
    result = -536870195;
    if ( *((_BYTE *)this + 291) & 0x40 )
    {
      *a4 = AppleUSBFTDI::AddtoQueue((__int64)this, (__int64)((char *)this + 344), (__int64)a2, v6);
      AppleUSBFTDI::CheckQueues(this);
      AppleUSBFTDI::setUpTransmit(this);
      if ( *v5 < (unsigned int)v6 && v7 )
      {
        while ( 1 )
        {
          v10 = 0x2000000;
          v9 = 0x2000000;
          result = (*(int (__fastcall **)(AppleUSBFTDI *, int *, int *))(*(_QWORD *)this + 2400LL))(this, &v10, &v9);
          if ( result )
            break;
          *v5 += AppleUSBFTDI::AddtoQueue(
                   (__int64)this,
                   (__int64)((char *)this + 344),
                   (__int64)&a2[*v5],
                   (unsigned int)v6 - *v5);
          AppleUSBFTDI::CheckQueues(this);
          AppleUSBFTDI::setUpTransmit(this);
          if ( *v5 >= (unsigned int)v6 )
            goto LABEL_7;
        }
      }
      else
      {
LABEL_7:
        result = 0;
      }
    }
  }
  return result;
}

//----- (000000000000480E) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::dequeueData(AppleUSBFTDI *this, unsigned __int8 *a2, __int64 a3, unsigned int *a4, __int64 a5, void *a6)
{
  unsigned int *v6; // r14@1
  int v7; // er12@1
  int v9; // [sp+8h] [bp-28h]@1
  int v10; // [sp+Ch] [bp-24h]@1

  v6 = a4;
  v10 = a3;
  v9 = a5;
  v7 = -536870185;
  if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
  {
    v7 = -536870206;
    if ( a4 )
    {
      if ( a2 && (unsigned int)a3 >= (unsigned int)a5 )
      {
        (*(void (__fastcall **)(AppleUSBFTDI *, unsigned __int8 *, __int64, unsigned int *, __int64, void *))(*(_QWORD *)this + 32LL))(
          this,
          a2,
          a3,
          a4,
          a5,
          a6);
        v7 = (*(int (__fastcall **)(_QWORD, int (__fastcall *)(AppleUSBFTDI *, OSObject *, void *, void *, void *, void *), unsigned __int8 *, int *, unsigned int *, int *))(**((_QWORD **)this + 35) + 456LL))(
               *((_QWORD *)this + 35),
               AppleUSBFTDI::dequeueDataAction,
               a2,
               &v10,
               v6,
               &v9);
        (*(void (__fastcall **)(AppleUSBFTDI *))(*(_QWORD *)this + 40LL))(this);
      }
    }
  }
  return (unsigned int)v7;
}

//----- (00000000000048A4) ----------------------------------------------------
int __fastcall AppleUSBFTDI::dequeueDataAction(AppleUSBFTDI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6)
{
  return (*(int (__fastcall **)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)this + 2424LL))(
           this,
           a2,
           a3,
           a4,
           a5,
           a6);
}

//----- (00000000000048B6) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::dequeueDataGated(AppleUSBFTDI *this, unsigned __int8 *a2, unsigned int *a3, unsigned int *a4, unsigned int *a5)
{
  __int64 v5; // rax@1
  unsigned __int64 v6; // rcx@1
  unsigned int v7; // er14@1
  signed int v8; // er13@1
  __int64 v9; // rbx@2
  AppleUSBFTDI *v10; // r13@4
  int v11; // er15@4
  int v12; // eax@4
  unsigned int v13; // eax@6
  __int64 v14; // rdi@10
  AppleUSBFTDI *v15; // r14@10
  __int64 v16; // rax@10
  int v17; // eax@11
  bool v18; // zf@11
  unsigned __int64 v19; // rax@13
  AppleUSBFTDI *v20; // rbx@13
  unsigned int v22; // [sp+4h] [bp-3Ch]@6
  __int64 v23; // [sp+8h] [bp-38h]@4
  int v24; // [sp+10h] [bp-30h]@10
  int v25; // [sp+14h] [bp-2Ch]@1

  v5 = (__int64)a4;
  v6 = *a3;
  v7 = *a5;
  v25 = 0;
  v8 = -536870185;
  if ( !*((_BYTE *)this + 139) )
  {
    v9 = v5;
    if ( !*((_BYTE *)this + 138) )
    {
      *(_DWORD *)v5 = 0;
      v8 = -536870195;
      if ( *((_BYTE *)this + 291) & 0x40 )
      {
        v10 = this;
        v23 = (__int64)((char *)this + 296);
        v11 = v6;
        v12 = AppleUSBFTDI::RemovefromQueue(v5, (__int64)a2, v6, (__int64)this, (__int64)((char *)this + 296));
        *(_DWORD *)v9 = v12;
        if ( v12 )
          AppleUSBFTDI::CheckHold(this);
        AppleUSBFTDI::CheckQueues(this);
        v13 = v7;
        v22 = v7;
        if ( v7 )
        {
          while ( *(_DWORD *)v9 < v13 )
          {
            v25 = 0;
            v24 = 0x80000;
            v14 = (__int64)v10;
            v15 = v10;
            LODWORD(v16) = (*(int (__fastcall **)(AppleUSBFTDI *, int *, int *))(*(_QWORD *)v10 + 2400LL))(
                             v10,
                             &v25,
                             &v24);
            v8 = v16;
            if ( (_DWORD)v16 )
              return (unsigned int)v8;
            v17 = AppleUSBFTDI::RemovefromQueue(
                    v16,
                    (__int64)&a2[*(_DWORD *)v9],
                    (unsigned int)(v11 - *(_DWORD *)v9),
                    v14,
                    v23);
            v18 = *(_DWORD *)v9 + v17 == 0;
            *(_DWORD *)v9 += v17;
            v10 = v15;
            if ( !v18 )
              AppleUSBFTDI::CheckHold(v15);
            this = v15;
            AppleUSBFTDI::CheckQueues(v15);
            v13 = v22;
          }
        }
        v19 = *((_QWORD *)v10 + 42);
        v20 = v10;
        v8 = 0;
        if ( v19 < *((_QWORD *)v20 + 116) && *((_WORD *)v20 + 520) == 0xFFFF )
        {
          *((_WORD *)v20 + 520) = 0;
          AppleUSBFTDI::AddBytetoQueue((__int64)this, (__int64)((char *)v20 + 344), *((_BYTE *)v20 + 1000));
          AppleUSBFTDI::setUpTransmit(v20);
        }
      }
    }
  }
  return (unsigned int)v8;
}

//----- (0000000000004A10) ----------------------------------------------------
int __fastcall AppleUSBFTDI::startTransmission(AppleUSBFTDI *this)
{
  __int64 v1; // rax@1
  char *v2; // rcx@3
  unsigned int v3; // edx@3
  signed __int64 v4; // rdx@8
  unsigned int v5; // eax@8
  unsigned __int64 v6; // rbx@8
  __int64 v7; // r13@10
  char *v9; // [sp+8h] [bp-48h]@8
  signed __int64 v10; // [sp+10h] [bp-40h]@8
  int v11; // [sp+1Ch] [bp-34h]@15
  int v12; // [sp+20h] [bp-30h]@15
  char v13; // [sp+27h] [bp-29h]@11

  v1 = *((_WORD *)this + 4064);
  if ( !*((_BYTE *)this + 88 * v1 + 6740) )
  {
    if ( !(_WORD)v1 )
      return v1;
    v2 = (char *)this + 6740;
    v3 = (unsigned __int16)v1;
    LODWORD(v1) = 0;
    while ( !*v2 )
    {
      LODWORD(v1) = v1 + 1;
      v2 += 88;
      if ( (unsigned __int16)v1 >= v3 )
        return v1;
    }
    *((_WORD *)this + 4064) = v1;
  }
  v4 = 88LL * (unsigned __int16)v1;
  v10 = v4;
  v9 = (char *)this + v4 + 6740;
  *v9 = 0;
  v5 = (unsigned __int16)(v1 + 1);
  v6 = 0LL;
  if ( v5 >= *((_WORD *)this + 4083) )
    LOWORD(v5) = 0;
  *((_WORD *)this + 4064) = v5;
  v7 = *(_QWORD *)((char *)this + v4 + 6728);
  while ( !(unsigned int)AppleUSBFTDI::GetBytetoQueue((__int64)this, (__int64)((char *)this + 344), (__int64)&v13) )
  {
    *(_BYTE *)(v7 + v6++) = v13;
    if ( v6 >= 0x1000 )
      goto LABEL_15;
  }
  if ( v6 )
  {
LABEL_15:
    v12 = 0x10000000;
    v11 = 0x10000000;
    (*(void (__fastcall **)(AppleUSBFTDI *, int *, int *))(*(_QWORD *)this + 2392LL))(this, &v12, &v11);
    *(_DWORD *)((char *)this + v10 + 6736) = v6;
    (*(void (__fastcall **)(_QWORD, unsigned __int64))(**(_QWORD **)((char *)this + v10 + 6720) + 712LL))(
      *(_QWORD *)((char *)this + v10 + 6720),
      v6);
    (*(void (__fastcall **)(_QWORD, _QWORD, char *))(**((_QWORD **)this + 135) + 328LL))(
      *((_QWORD *)this + 135),
      *(_QWORD *)((char *)this + v10 + 6720),
      (char *)this + v10 + 6744);
    LODWORD(v1) = AppleUSBFTDI::CheckQueues(this);
    return v1;
  }
  AppleUSBFTDI::CheckQueues(this);
  LODWORD(v1) = (_DWORD)v9;
  *v9 = 1;
  return v1;
}

//----- (0000000000004B76) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::calculateDeviceBaud(AppleUSBFTDI *this, unsigned __int16 *a2, unsigned __int16 *a3)
{
  unsigned int v3; // ecx@1
  unsigned int v4; // ebx@1
  unsigned __int16 *v5; // rax@3
  unsigned int v6; // er8@9
  int v7; // er9@9
  int v8; // er8@9
  __int64 v9; // r10@9
  __int64 v10; // rdi@9
  __int64 v11; // rbx@9
  __int64 v12; // rax@11
  unsigned int v13; // er14@14
  unsigned int v14; // edi@14
  bool v15; // cf@14
  int v16; // edi@14

  v3 = *((_DWORD *)this + 248);
  v4 = 0;
  if ( v3 - 1 < 0x5B8D80 )
  {
    v5 = (unsigned __int16 *)&word_5F66;
    while ( v3 != *(_DWORD *)(v5 - 3) )
    {
      LOWORD(v4) = v4 + 1;
      v5 += 4;
      if ( (unsigned __int16)v4 > 0x13u )
        goto LABEL_9;
    }
    *a2 = *(v5 - 1);
    *a3 = *v5;
    if ( (_WORD)v4 )
      return v3;
LABEL_9:
    v6 = 5 * v3 / 0x64;
    v7 = v3 - v6;
    v8 = v3 + v6;
    v9 = 0LL;
    v10 = 0LL;
    v11 = 0LL;
    while ( v3 >= LODWORD(gBaudTable[v11]) )
    {
      ++v10;
      v11 = (unsigned __int16)v10;
      v12 = 0LL;
      if ( (unsigned __int16)v10 > 0x13u )
        goto LABEL_14;
    }
    v12 = (unsigned __int16)(v11 - 1);
    v9 = v10;
LABEL_14:
    v13 = LODWORD(gBaudTable[v9]);
    v4 = LODWORD(gBaudTable[v12]);
    v14 = LODWORD(gBaudTable[v9]);
    v15 = v14 < v8;
    v16 = v14 - v8;
    if ( v15 || v16 == 0 || v4 >= v7 )
    {
      if ( v4 - v7 >= v16 )
      {
        *a2 = WORD2(gBaudTable[v9]);
        *a3 = WORD3(gBaudTable[v9]);
        v4 = v13;
      }
      else
      {
        *a2 = WORD2(gBaudTable[v12]);
        *a3 = WORD3(gBaudTable[v12]);
      }
    }
    else
    {
      v4 = 0;
      IOLog("%8x %8x AppleUSBFTDI: calculateDeviceBaud - Baud rate error\n", (unsigned int)v8, (unsigned int)v7);
    }
  }
  else
  {
    IOLog("%8x %8x AppleUSBFTDI: calculateDeviceBaud - Unsupported Baud rate\n", 0LL, v3);
  }
  return v4;
}
// 5F60: using guessed type _QWORD gBaudTable[];
// 5F66: using guessed type __int16 word_5F66;
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);

//----- (0000000000004C8E) ----------------------------------------------------
char __fastcall AppleUSBFTDI::getDeviceBaud(AppleUSBFTDI *this, unsigned __int16 *a2, unsigned __int16 *a3)
{
  int v3; // er8@1
  unsigned __int16 *v4; // rax@1
  int v5; // edi@1

  v3 = *((_DWORD *)this + 248);
  v4 = (unsigned __int16 *)&word_5F66;
  v5 = 0;
  while ( v3 != *(_DWORD *)(v4 - 3) )
  {
    ++v5;
    v4 += 4;
    if ( (unsigned __int16)v5 > 0x13u )
      return 0;
  }
  *a2 = *(v4 - 1);
  *a3 = *v4;
  return 1;
}
// 5F66: using guessed type __int16 word_5F66;

//----- (0000000000004CCC) ----------------------------------------------------
char __fastcall AppleUSBFTDI::USBSendRequest(__int64 a1, char a2, char a3, __int16 a4, __int16 a5, __int64 a6, __int16 a7)
{
  __int64 v7; // r15@1
  __int16 v8; // r13@1
  char v9; // r14@1
  __int64 v10; // rax@7
  void *v11; // rax@8
  __int64 v12; // rax@9
  __int64 v13; // r14@12
  int v14; // ecx@12
  char result; // al@12
  __int64 v16; // rdi@13
  void *v17; // [sp+0h] [bp-40h]@9
  __int16 v18; // [sp+Ch] [bp-34h]@7
  __int64 v19; // [sp+10h] [bp-30h]@8

  v7 = a6;
  v8 = a4;
  v9 = a3;
  if ( *(_BYTE *)(a1 + 139) || *(_BYTE *)(a1 + 138) || a7 && !a6 )
    goto LABEL_17;
  if ( a6 && !a7 )
    goto LABEL_17;
  v18 = a5;
  LODWORD(v10) = IOMalloc(24LL);
  if ( !v10 )
    goto LABEL_17;
  *(_QWORD *)v10 = a1;
  *(_QWORD *)(v10 + 8) = AppleUSBFTDI::merCompleteUSB;
  *(_QWORD *)(v10 + 16) = 0LL;
  v19 = v10;
  LODWORD(v11) = IOMalloc(24LL);
  if ( !v11 )
    goto LABEL_15;
  v17 = v11;
  bzero(v11, 0x18uLL);
  LODWORD(v12) = IOMalloc(40LL);
  if ( !v12 )
  {
    IOFree(v17, 24LL);
LABEL_15:
    v16 = v19;
    goto LABEL_16;
  }
  *(_QWORD *)v12 = 0LL;
  *(_DWORD *)(v12 + 8) = 2;
  *(_QWORD *)(v12 + 16) = v17;
  *(_QWORD *)(v12 + 24) = v19;
  *(_DWORD *)(v12 + 32) = 0;
  *(_DWORD *)(v12 + 36) = 0;
  *(_BYTE *)v17 = a2;
  *((_BYTE *)v17 + 1) = v9;
  *((_WORD *)v17 + 1) = v8;
  *((_WORD *)v17 + 2) = v18;
  *((_WORD *)v17 + 3) = a7;
  if ( !a7 )
    v7 = 0LL;
  *((_QWORD *)v17 + 1) = v7;
  *(_QWORD *)(v19 + 16) = v12;
  v13 = v12;
  v14 = (*(int (__fastcall **)(_QWORD, void *, signed __int64, signed __int64, __int64))(**(_QWORD **)(a1 + 256) + 2424LL))(
          *(_QWORD *)(a1 + 256),
          v17,
          500LL,
          1000LL,
          v19);
  result = 1;
  if ( v14 )
  {
    IOFree(v17, 24LL);
    IOFree(v13, 40LL);
    v16 = v19;
LABEL_16:
    IOFree(v16, 24LL);
LABEL_17:
    result = 0;
  }
  return result;
}
// FA48: using guessed type int __fastcall IOFree(_QWORD, _QWORD);
// FA78: using guessed type int __fastcall IOMalloc(_QWORD);

//----- (0000000000004E68) ----------------------------------------------------
bool __fastcall AppleUSBFTDI::allocateRingBuffer(__int64 a1, __int64 a2)
{
  __int64 v2; // rax@1

  LODWORD(v2) = IOMalloc(0x4000LL);
  *(_QWORD *)a2 = v2;
  *(_QWORD *)(a2 + 8) = v2 + 0x4000;
  *(_QWORD *)(a2 + 32) = 0x4000LL;
  *(_QWORD *)(a2 + 16) = v2;
  *(_QWORD *)(a2 + 24) = v2;
  *(_QWORD *)(a2 + 40) = 0LL;
  return v2 != 0;
}
// FA78: using guessed type int __fastcall IOMalloc(_QWORD);

//----- (0000000000004EAE) ----------------------------------------------------
int __fastcall AppleUSBFTDI::freeRingBuffer(__int64 a1, __int64 a2)
{
  int result; // eax@3

  if ( a2 )
  {
    if ( *(_QWORD *)a2 )
      result = IOFree(*(_QWORD *)a2, *(_QWORD *)(a2 + 32));
    *(_QWORD *)a2 = 0LL;
    *(_QWORD *)(a2 + 8) = 0LL;
    *(_QWORD *)(a2 + 16) = 0LL;
    *(_QWORD *)(a2 + 24) = 0LL;
    *(_QWORD *)(a2 + 32) = 0LL;
  }
  return result;
}
// FA48: using guessed type int __fastcall IOFree(_QWORD, _QWORD);

//----- (0000000000004EFC) ----------------------------------------------------
int __fastcall AppleUSBFTDI::handleSettingCallback(AppleUSBFTDI *this, const OSSymbol *a2, OSObject *a3)
{
  int result; // eax@1
  bool v4; // zf@4
  char v5; // al@4
  __int64 v6; // rax@6
  char v7; // [sp+8h] [bp-28h]@4
  char v8; // [sp+9h] [bp-27h]@6
  __int16 v9; // [sp+Ah] [bp-26h]@6
  __int16 v10; // [sp+Ch] [bp-24h]@6
  __int16 v11; // [sp+Eh] [bp-22h]@6
  __int64 v12; // [sp+10h] [bp-20h]@6

  result = (*(int (__fastcall **)(OSObject *))(*(_QWORD *)a3 + 328LL))(a3);
  if ( (const OSSymbol *)gPMWakeOnRingSymbol == a2 && result != *((_BYTE *)this + 184) )
  {
    *((_BYTE *)this + 184) = result != 0;
    if ( !__PAIR__(*((_BYTE *)this + 139), *((_BYTE *)this + 138)) )
    {
      v4 = result == 0;
      v7 = 0;
      v5 = 3;
      if ( v4 )
        v5 = 1;
      v8 = v5;
      v9 = 1;
      v10 = 0;
      v11 = 0;
      v12 = 0LL;
      LODWORD(v6) = (*(int (**)(void))(**((_QWORD **)this + 33) + 2216LL))();
      result = (*(int (__fastcall **)(__int64, char *, _QWORD))(*(_QWORD *)v6 + 2360LL))(v6, &v7, 0LL);
    }
  }
  return result;
}
// 6D60: using guessed type _QWORD gPMWakeOnRingSymbol;

//----- (0000000000004FA0) ----------------------------------------------------
int __fastcall AppleUSBFTDI::clearSleepingThreads(AppleUSBFTDI *this)
{
  AppleUSBFTDI *v1; // rax@1
  __int64 v2; // rdi@1

  v1 = this;
  v2 = *((_QWORD *)this + 35);
  if ( v2 && *((_WORD *)v1 + 4090) > 0 )
  {
    *((_DWORD *)v1 + 73) = 0;
    LODWORD(v1) = (*(int (__fastcall **)(__int64, char *, _QWORD))(*(_QWORD *)v2 + 488LL))(v2, (char *)v1 + 288, 0LL);
  }
  return (signed int)v1;
}

//----- (0000000000004FE2) ----------------------------------------------------
unsigned int __fastcall AppleUSBFTDI::resurrectRead(AppleUSBFTDI *this)
{
  __int64 v1; // r14@1
  unsigned int result; // eax@2
  __int64 v3; // r14@4
  unsigned __int16 v4; // bx@8
  signed __int64 v5; // r14@9
  __int64 v6; // rsi@9

  v1 = *((_QWORD *)this + 134);
  if ( v1 )
  {
    result = (*(int (__fastcall **)(_QWORD))(*(_QWORD *)v1 + 480LL))(*((_QWORD *)this + 134));
    if ( result == -536854449 )
      result = (*(int (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v1 + 488LL))(v1, 1LL);
  }
  v3 = *((_QWORD *)this + 135);
  if ( v3 )
  {
    result = (*(int (__fastcall **)(_QWORD))(*(_QWORD *)v3 + 480LL))(*((_QWORD *)this + 135));
    if ( result == -536854449 )
      result = (*(int (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v3 + 488LL))(v3, 1LL);
  }
  if ( *((_WORD *)this + 4082) )
  {
    v4 = 0;
    do
    {
      v5 = 88LL * v4;
      v6 = *(_QWORD *)((char *)this + v5 + 1088);
      if ( v6
        && *((_BYTE *)this + v5 + 1108)
        && !(*(int (__fastcall **)(_QWORD, __int64, char *, _QWORD))(**((_QWORD **)this + 134) + 320LL))(
              *((_QWORD *)this + 134),
              v6,
              (char *)this + v5 + 1112,
              0LL) )
        *((_BYTE *)this + v5 + 1108) = 0;
      ++v4;
      result = *((_WORD *)this + 4082);
    }
    while ( v4 < result );
  }
  return result;
}

//----- (00000000000050C0) ----------------------------------------------------
int __fastcall AppleUSBFTDI::didTerminate(AppleUSBFTDI *this, IOService *a2, __int64 a3, bool *a4)
{
  *((_BYTE *)this + 139) = 1;
  return (*(int (__fastcall **)(AppleUSBFTDI *, IOService *, __int64, bool *))(off_6018[0] + 1048))(this, a2, a3, a4);
}
// 6018: using guessed type __int64 off_6018[2];

//----- (00000000000050DA) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::message(AppleUSBFTDI *this, __int64 a2, IOService *a3, void *a4)
{
  AppleUSBFTDI *v4; // rbx@1
  char v5; // al@4
  unsigned int v6; // er14@5
  char v7; // al@9
  __int64 v8; // rax@11
  __int64 v9; // rdi@14
  __int64 v10; // rdi@16
  char v12; // [sp+8h] [bp-28h]@9
  char v13; // [sp+9h] [bp-27h]@11
  __int16 v14; // [sp+Ah] [bp-26h]@11
  __int16 v15; // [sp+Ch] [bp-24h]@11
  __int16 v16; // [sp+Eh] [bp-22h]@11
  __int64 v17; // [sp+10h] [bp-20h]@11

  v4 = this;
  if ( (signed int)a2 > -536854519 )
  {
    if ( (_DWORD)a2 != -536854518 )
    {
      if ( (_DWORD)a2 == -536854517 )
      {
        AppleUSBFTDI::resurrectRead(this);
        return 0;
      }
      goto LABEL_22;
    }
    AppleUSBFTDI::resurrectRead(this);
    v6 = 0;
    if ( *((_BYTE *)this + 8168) & 0x20 )
    {
      v12 = 0;
      v7 = 1;
      if ( *((_BYTE *)this + 184) )
        v7 = 3;
      v13 = v7;
      v14 = 1;
      v15 = 0;
      v16 = 0;
      v17 = 0LL;
      LODWORD(v8) = (*(int (**)(void))(**((_QWORD **)this + 33) + 2216LL))();
      v6 = 0;
      (*(void (__fastcall **)(__int64, char *, _QWORD))(*(_QWORD *)v8 + 2360LL))(v8, &v12, 0LL);
    }
  }
  else
  {
    if ( (_DWORD)a2 != -536870896 )
    {
      if ( (_DWORD)a2 == -536870656 )
      {
        v5 = *((_BYTE *)this + 242);
        if ( *((_BYTE *)this + 241) )
        {
          v6 = 0;
          if ( !v5 )
          {
            v6 = 0;
            IOLog("%8x %8x AppleUSBFTDI: message - The driver has been asked to close the device\n", 0LL, 3758096640LL);
            *((_BYTE *)this + 242) = 1;
            (*(void (__fastcall **)(_QWORD, AppleUSBFTDI *, _QWORD))(**((_QWORD **)this + 32) + 1496LL))(
              *((_QWORD *)this + 32),
              this,
              0LL);
            *((_BYTE *)this + 139) = 1;
          }
        }
        else
        {
          v6 = 0;
          if ( !v5 )
          {
            v6 = 0;
            IOLog(
              "%8x %8x AppleUSBFTDI: message - Request to close the device is being ignored...\n",
              0LL,
              3758096640LL);
          }
        }
        return v6;
      }
      if ( (_DWORD)a2 == -536870640 )
      {
        v6 = 0;
        if ( *((_BYTE *)this + 242) )
          *((_BYTE *)this + 242) = 0;
        return v6;
      }
LABEL_22:
      return (*(int (__fastcall **)(AppleUSBFTDI *, __int64, IOService *, void *))(off_6018[0] + 1856))(
               this,
               a2,
               a3,
               a4);
    }
    v9 = *((_QWORD *)this + 134);
    if ( v9 )
      (*(void (__fastcall **)(__int64, __int64, IOService *, void *))(*(_QWORD *)v9 + 296LL))(v9, a2, a3, a4);
    *((_BYTE *)v4 + 8162) = 0;
    v10 = *((_QWORD *)v4 + 135);
    if ( v10 )
      (*(void (__fastcall **)(__int64, __int64, IOService *, void *))(*(_QWORD *)v10 + 296LL))(v10, a2, a3, a4);
    *((_BYTE *)v4 + 139) = 1;
    v6 = 0;
  }
  return v6;
}
// 6018: using guessed type __int64 off_6018[2];
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);

//----- (000000000000528E) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::initialPowerStateForDomainState(AppleUSBFTDI *this)
{
  return *((_BYTE *)this + 140);
}

//----- (000000000000529C) ----------------------------------------------------
signed __int64 __fastcall AppleUSBFTDI::setPowerState(AppleUSBFTDI *this, __int64 a2, IOService *a3)
{
  signed __int64 result; // rax@5

  if ( *((_BYTE *)this + 140) != a2 )
  {
    *((_BYTE *)this + 140) = a2;
    if ( (unsigned int)(unsigned __int8)a2 - 1 >= 2 )
    {
      if ( (unsigned __int8)a2 == 3 )
      {
        *((_BYTE *)this + 139) = 0;
      }
      else
      {
        result = 5LL;
        if ( (_BYTE)a2 )
          return result;
        *((_BYTE *)this + 139) = 1;
        (*(void (__fastcall **)(AppleUSBFTDI *, __int64, IOService *))(*(_QWORD *)this + 2432LL))(this, a2, a3);
      }
    }
  }
  return 0LL;
}

//----- (00000000000052EA) ----------------------------------------------------
__int64 __fastcall AppleUSBFTDI::MetaClass::~MetaClass(AppleUSBFTDI::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (0000000000005300) ----------------------------------------------------
__int64 `global constructor keyed to'_a()
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(&AppleUSBFTDI::gMetaClass, "AppleUSBFTDI", off_6008[0], 8184LL);
  result = (__int64)off_6A00;
  AppleUSBFTDI::gMetaClass = off_6A00;
  return result;
}
// 6008: using guessed type _QWORD off_6008[4];
// 6A00: using guessed type __int64 (__fastcall *off_6A00[2])(AppleUSBFTDI::MetaClass *__hidden this);
// 6D28: using guessed type _QWORD AppleUSBFTDI::gMetaClass;
// FAD0: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000005340) ----------------------------------------------------
__int64 `global destructor keyed to'_a()
{
  return OSMetaClass::~OSMetaClass((OSMetaClass *)&AppleUSBFTDI::gMetaClass);
}
// 6D28: using guessed type _QWORD AppleUSBFTDI::gMetaClass;

//----- (0000000000005351) ----------------------------------------------------
void __fastcall ftdi_LogToMessageTracer(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5, __int64 a6, int a7)
{
  __int64 v7; // r12@1
  __int64 v8; // r14@1
  __int64 v9; // r15@1
  char *v10; // rax@3
  char *v11; // rax@4
  const char *v12; // rdx@8
  char *v13; // rdi@10
  __int64 v14; // rdx@18
  __int64 v15; // [sp+0h] [bp-90h]@8
  __int64 v16; // [sp+8h] [bp-88h]@8
  __int64 v17; // [sp+10h] [bp-80h]@8
  __int64 v18; // [sp+18h] [bp-78h]@8
  __int64 v19; // [sp+20h] [bp-70h]@0
  __int64 v20; // [sp+28h] [bp-68h]@0
  __int64 v21; // [sp+30h] [bp-60h]@0
  __int64 v22; // [sp+38h] [bp-58h]@0
  __int64 v23; // [sp+40h] [bp-50h]@0
  __int64 v24; // [sp+48h] [bp-48h]@0
  char *v25; // [sp+50h] [bp-40h]@4
  char *v26; // [sp+58h] [bp-38h]@3
  __int64 v27; // [sp+60h] [bp-30h]@1

  v27 = a6;
  v7 = a5;
  v8 = a4;
  v9 = a3;
  if ( a1 )
  {
    if ( a2 )
    {
      LODWORD(v10) = IOMalloc(1024LL);
      v26 = v10;
      if ( v10 )
      {
        LODWORD(v11) = IOMalloc(1024LL);
        v25 = v11;
        if ( v11 )
        {
          if ( v7 && v8 && v9 )
          {
            v24 = v7;
            v23 = (__int64)"com.apple.message.summarize";
            v22 = v8;
            v21 = (__int64)"com.apple.message.signature3";
            v20 = v9;
            v19 = (__int64)"com.apple.message.signature2";
            v18 = a2;
            v17 = (__int64)"com.apple.message.signature";
            v16 = a1;
            v15 = (__int64)"com.apple.message.domain";
            v12 = "%s [%s %d] [%s %s] [%s %s] [%s %s] [%s %s] [%s %s]";
          }
          else if ( v8 && v9 )
          {
            v22 = v8;
            v21 = (__int64)"com.apple.message.signature3";
            v20 = v9;
            v19 = (__int64)"com.apple.message.signature2";
            v18 = a2;
            v17 = (__int64)"com.apple.message.signature";
            v16 = a1;
            v15 = (__int64)"com.apple.message.domain";
            v12 = "%s [%s %d] [%s %s] [%s %s] [%s %s] [%s %s]";
          }
          else if ( v8 || !v9 )
          {
            v18 = a2;
            v17 = (__int64)"com.apple.message.signature";
            v16 = a1;
            v15 = (__int64)"com.apple.message.domain";
            v12 = "%s [%s %d] [%s %s] [%s %s]";
          }
          else
          {
            v20 = v9;
            v19 = (__int64)"com.apple.message.signature2";
            v18 = a2;
            v17 = (__int64)"com.apple.message.signature";
            v16 = a1;
            v15 = (__int64)"com.apple.message.domain";
            v12 = "%s [%s %d] [%s %s] [%s %s] [%s %s]";
          }
          snprintf(v26, 0x400uLL, v12, "         0", "Level", 5LL, v15, v16, v17, v18, v19, v20, v21, v22, v23, v24);
          if ( a7 == 1 )
          {
            snprintf(v25, 0x400uLL, " [%s %d]", "com.apple.message.success", 1LL);
            strlcat(v26, v25, 0x400uLL);
          }
          if ( v27 )
          {
            snprintf(v25, 0x400uLL, " [%s %lld]", "com.apple.message.value");
            strlcat(v26, v25, 0x400uLL);
          }
          IOLog("%s\n", v26, v14);
          IOFree(v26, 1024LL);
          v13 = v25;
        }
        else
        {
          v13 = v26;
        }
        IOFree(v13, 1024LL);
      }
    }
  }
}
// FA48: using guessed type int __fastcall IOFree(_QWORD, _QWORD);
// FA70: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);
// FA78: using guessed type int __fastcall IOMalloc(_QWORD);

//----- (00000000000055DF) ----------------------------------------------------
int _start()
{
  int result; // eax@2

  if ( _realmain )
    result = _realmain();
  else
    result = 0;
  return result;
}
// 6D50: using guessed type int (*_realmain)(void);

//----- (00000000000055F9) ----------------------------------------------------
__int64 *OSKextGetCurrentIdentifier()
{
  return &kmod_info + 2;
}
// 6C60: using guessed type __int64 kmod_info;

//----- (000000000000560A) ----------------------------------------------------
__int64 *OSKextGetCurrentVersionString()
{
  return &kmod_info + 10;
}
// 6C60: using guessed type __int64 kmod_info;

//----- (000000000000561B) ----------------------------------------------------
__int64 OSKextGetCurrentLoadTag()
{
  return *((_DWORD *)&kmod_info + 3);
}
// 6C60: using guessed type __int64 kmod_info;

//----- (000000000000562B) ----------------------------------------------------
int _stop()
{
  int result; // eax@2

  if ( _antimain )
    result = _antimain();
  else
    result = 0;
  return result;
}
// 6D58: using guessed type int (*_antimain)(void);

// ALL OK, 114 function(s) have been successfully decompiled
