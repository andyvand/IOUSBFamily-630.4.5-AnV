/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2014 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 __fastcall AppleUSBHub::MetaClass::MetaClass(AppleUSBHub::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBHub::MetaClass::~MetaClass(AppleUSBHub::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBHub::AppleUSBHub(IOUSBHubPolicyMaker *a1, const OSMetaClass *a2);
__int64 __fastcall AppleUSBHub::AppleUSBHub(IOUSBHubPolicyMaker *a1, const OSMetaClass *a2);
__int64 __fastcall AppleUSBHub::~AppleUSBHub(AppleUSBHub *__hidden this); // idb
__int64 __fastcall AppleUSBHub::~AppleUSBHub(AppleUSBHub *__hidden this); // idb
void __fastcall AppleUSBHub::~AppleUSBHub(AppleUSBHub *this);
__int64 __fastcall AppleUSBHub::getMetaClass(AppleUSBHub *__hidden this); // idb
__int64 __fastcall AppleUSBHub::MetaClass::MetaClass(AppleUSBHub::MetaClass *__hidden this); // idb
IOUSBHubPolicyMaker *__fastcall AppleUSBHub::MetaClass::alloc(AppleUSBHub::MetaClass *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBHub::AppleUSBHub(IOUSBHubPolicyMaker *a1);
__int64 __fastcall AppleUSBHub::AppleUSBHub(IOUSBHubPolicyMaker *a1);
char __fastcall AppleUSBHub::init(__int64 a1);
unsigned __int8 __fastcall AppleUSBHub::start(AppleUSBHub *this, uintptr_t arg2);
void __fastcall AppleUSBHub::IncrementOutstandingIO(AppleUSBHub *this, unsigned __int8 a2);
// __int64 __usercall AppleUSBHub::LowerPowerState@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
// char __usercall AppleUSBHub::DecrementOutstandingIO@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>, unsigned __int8 a3@<sil>);
char __fastcall AppleUSBHub::ConfigureHubDriver(AppleUSBHub *this);
void __fastcall AppleUSBHub::TimeoutOccurred(OSMetaClassBase *a1, __int64 a2, const OSMetaClass *a3);
__int64 __fastcall AppleUSBHub::ConfigureHub(AppleUSBHub *this); // idb
int __fastcall AppleUSBHub::ProcessStatusChangedEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3);
int __fastcall AppleUSBHub::ResetPortZeroEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3);
int __fastcall AppleUSBHub::CheckForDeadHubEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3);
int __fastcall AppleUSBHub::ClearFeatureEndpointHaltEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3);
int __fastcall AppleUSBHub::CheckForActivePortsEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3);
int __fastcall AppleUSBHub::WaitForPortResumesEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3);
int __fastcall AppleUSBHub::EnsureUsabilityEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3);
int __fastcall AppleUSBHub::InitialDelayEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3);
int __fastcall AppleUSBHub::HubResetPortAfterPowerChangeDoneEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3);
// __int64 __usercall AppleUSBHub::GetHubErrataBits@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
// bool __usercall AppleUSBHub::IsHubDeviceInternal@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
// __int64 __usercall AppleUSBHub::ControllerCanMuxPortsOverToEHCI@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
__int64 __fastcall AppleUSBHub::StopPorts(AppleUSBHub *this); // idb
void __fastcall AppleUSBHub::stop(AppleUSBHub *this, IOService *a2);
__int64 __fastcall AppleUSBHub::message(AppleUSBHub *this, uintptr_t a2, IOService *a3, void *a4);
__int64 __fastcall AppleUSBHub::GetPortStatus(AppleUSBHub *this, __int64 a2, int a3);
__int64 __fastcall AppleUSBHub::DoPortAction(AppleUSBHub *this, uintptr_t a2, unsigned int a3, unsigned int a4);
unsigned __int64 __fastcall computeDeltaTimeMS(const unsigned __int64 *a1);
int __fastcall AppleUSBHub::finalize(AppleUSBHub *this);
int __fastcall AppleUSBHub::requestTerminate(AppleUSBHub *this, IOService *a2, unsigned int a3);
int __fastcall AppleUSBHub::AbandonPortCheck(AppleUSBHub *this);
int __fastcall AppleUSBHub::willTerminate(AppleUSBHub *this, IOService *a2, unsigned int a3);
int __fastcall AppleUSBHub::didTerminate(AppleUSBHub *this, IOService *a2, unsigned int a3, bool *a4);
int __fastcall AppleUSBHub::terminate(AppleUSBHub *this);
int __fastcall AppleUSBHub::free(AppleUSBHub *this);
int __fastcall AppleUSBHub::terminateClient(AppleUSBHub *this, IOService *a2);
__int64 __fastcall AppleUSBHub::powerStateWillChangeTo(AppleUSBHub *this, uintptr_t arg2, uintptr_t arg3, IOService *this); // idb
char __fastcall AppleUSBHub::IsPortInitThreadActiveForAnyPort(AppleUSBHub *this);
char __fastcall AppleUSBHub::IsStatusChangedThreadActiveForAnyPort(AppleUSBHub *this);
int __fastcall AppleUSBHub::setPowerState(AppleUSBHub *this, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHub::powerStateDidChangeTo(AppleUSBHub *this, uintptr_t arg2, uintptr_t arg3, IOService *); // idb
void __fastcall AppleUSBHub::powerChangeDone(AppleUSBHub *this, uintptr_t arg2);
int __fastcall AppleUSBHub::WakeOnPowerOn(AppleUSBHub *this);
void __fastcall AppleUSBHub::ResetMyPort(AppleUSBHub *this);
__int64 __fastcall AppleUSBHub::calculateDepth(AppleUSBHub *this, int a2);
__int64 __fastcall AppleUSBHub::SetHubDepth(AppleUSBHub *this, __int16 a2);
// bool __usercall AppleUSBHub::HasExpressCardPort@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
__int64 __fastcall AppleUSBHub::GetHubDescriptor(IOService *this, __int64 a2);
char __fastcall AppleUSBHub::UnpackPortFlags(AppleUSBHub *this);
void __fastcall AppleUSBHub::CountCaptivePorts(AppleUSBHub *this);
__int64 __fastcall AppleUSBHub::CheckPortPowerRequirements(AppleUSBHub *__hidden this); // idb
__int64 __fastcall AppleUSBHub::AllocatePortMemory(AppleUSBHub *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBHub::SetPortRemoteWakeMask(AppleUSBHub *this, __int16 a2, unsigned int a3);
char __fastcall AppleUSBHub::UnpackUSB2PortFlags(AppleUSBHub *this);
__int64 __fastcall AppleUSBHub::UnpackUSB3PortFlags(AppleUSBHub *__hidden this); // idb
int __fastcall AppleUSBHub::GetDeviceStatus(AppleUSBHub *this, unsigned __int16 *a2);
// __int64 __usercall AppleUSBHub::ControllerHasMuxedPorts@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
// __int64 __usercall AppleUSBHub::GetACPIPortMuxProperties@<rax>(AppleUSBHub *this@<rdi>, bool *a2@<rdx>, char *a3@<rcx>, __int64 a4@<rax>, unsigned int a5@<esi>);
// char __usercall AppleUSBHub::GetACPIPortCaptiveProperties@<al>(AppleUSBHub *this@<rdi>, bool *a2@<rdx>, bool *a3@<rcx>, __int64 a4@<rax>, unsigned int a5@<esi>);
__int64 __fastcall AppleUSBHub::HubPowerChange(AppleUSBHub *this, uintptr_t arg2, __int64 a3, __int64 a4, __int64 a5);
__int64 __fastcall AppleUSBHub::StartPorts(AppleUSBHub *this, __int64 a2, __int64 a3, __int64 a4, __int64 a5);
// char __usercall AppleUSBHub::HubAreAllPortsDisconnectedOrSuspended@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
__int64 __fastcall AppleUSBHub::SuspendPorts(AppleUSBHub *this, unsigned int a2);
__int64 __fastcall AppleUSBHub::ProcessAllNotificationsForEvent(AppleUSBHub *this, OSArray *a2, uintptr_t a3);
// __int64 __usercall AppleUSBHub::RaisePowerState@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
__int64 __fastcall AppleUSBHub::ClearPortFeature(AppleUSBHub *this, __int16 a2, __int16 a3);
__int64 __fastcall AppleUSBHub::SetPortPower(AppleUSBHub *this, unsigned int a2, int a3);
int __fastcall AppleUSBHub::IncrementOutstandingResumes(AppleUSBHub *this);
bool __fastcall AppleUSBHub::HubStatusChanged(AppleUSBHub *this);
__int64 __fastcall AppleUSBHub::GetHubStatus(AppleUSBHub *a1, __int64 a2);
int __fastcall AppleUSBHub::FatalError(AppleUSBHub *this, unsigned int a2, const char *a3);
__int64 __fastcall AppleUSBHub::ClearHubFeature(AppleUSBHub *this, __int16 a2);
// char __usercall AppleUSBHub::GetInternalHubErrataBits@<al>(AppleUSBHub *this@<rdi>, unsigned int *a2@<rsi>, __int64 a3@<rax>);
__int64 __fastcall AppleUSBHub::GetHubPortErrataBits(AppleUSBHub *this, int a2);
__int64 __fastcall AppleUSBHub::DoDeviceRequestWithRetries(AppleUSBHub *this, __int64 a2, char a3);
__int64 __fastcall AppleUSBHub::GetPortState(AppleUSBHub *this, unsigned __int8 *a2, __int16 a3);
__int64 __fastcall AppleUSBHub::SetPortFeature(AppleUSBHub *this, __int16 a2, __int16 a3);
__int64 __fastcall AppleUSBHub::SetPortLinkState(AppleUSBHub *this, __int16 a2, unsigned int a3);
__int64 __fastcall AppleUSBHub::GetPortErrorCount(AppleUSBHub *this, __int16 a2, unsigned __int16 *a3);
__int64 __fastcall AppleUSBHub::SetPortU1Timeout(AppleUSBHub *this, __int16 a2, unsigned int a3);
__int64 __fastcall AppleUSBHub::SetPortU2Timeout(AppleUSBHub *this, __int16 a2, unsigned int a3);
int __fastcall AppleUSBHub::DoDeviceRequest(__int64 a1, __int64 a2);
// __int64 __usercall AppleUSBHub::WaitForPowerOn@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>, __int64 a3@<rsi>);
int __fastcall AppleUSBHub::TakeDoPortActionLock(AppleUSBHub *this);
int __fastcall AppleUSBHub::ReleaseDoPortActionLock(AppleUSBHub *this);
char __fastcall AppleUSBHub::InterruptReadHandlerEntry(AppleUSBHub *this, OSObject *a2, void *a3, unsigned int a4);
void __fastcall AppleUSBHub::InterruptReadHandler(AppleUSBHub *this, signed int a2, unsigned int a3);
int __fastcall AppleUSBHub::CallCheckForDeadHub(AppleUSBHub *this);
unsigned __int8 __fastcall AppleUSBHub::ResetPortZero(AppleUSBHub *this);
void __fastcall AppleUSBHub::ProcessStatusChanged(AppleUSBHub *this);
__int64 __fastcall AppleUSBHub::RearmInterruptRead(AppleUSBHub *this); // idb
__int64 __fastcall AppleUSBHub::PrintHubDescriptor(__int64 a1, __int64 a2);
void __fastcall AppleUSBHub::CheckForDeadHub(AppleUSBHub *this);
void __fastcall AppleUSBHub::ClearFeatureEndpointHalt(AppleUSBHub *this);
// char __usercall AppleUSBHub::CheckForActivePorts@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
__int64 __fastcall AppleUSBHub::WaitForAbandonPortCheck(AppleUSBHub *__hidden this); // idb
__int64 __fastcall AppleUSBHub::WaitForPortResumes(AppleUSBHub *this); // idb
// __int64 __usercall AppleUSBHub::DecrementOutstandingResumes@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
char __fastcall AppleUSBHub::IsHSRootHub(AppleUSBHub *this);
__int64 __fastcall AppleUSBHub::GetPortInformation(AppleUSBHub *this, int a2, unsigned int *a3);
__int64 __fastcall AppleUSBHub::ResetPort(AppleUSBHub *this, unsigned int); // idb
__int64 __fastcall AppleUSBHub::SuspendPort(AppleUSBHub *this, unsigned int a2, char a3);
__int64 __fastcall AppleUSBHub::ReEnumeratePort(AppleUSBHub *this, unsigned int, unsigned int); // idb
__int64 __fastcall AppleUSBHub::ChangeOutstandingIO(uintptr_t arg2, uintptr_t arg2, void *, void *, void *, void *); // idb
__int64 __fastcall AppleUSBHub::ChangeRaisedPowerState(uintptr_t arg2, uintptr_t arg2, void *, void *, void *, void *); // idb
__int64 __fastcall AppleUSBHub::ChangeOutstandingResumes(uintptr_t arg2, uintptr_t arg2, void *, void *, void *, void *); // idb
// __int64 __usercall AppleUSBHub::ChangeDoPortActionLock@<rax>(AppleUSBHub *this@<rdi>, OSObject *a2@<rsi>, void *a3@<rdx>, void *a4@<rcx>, void *a5@<r8>, void *a6@<r9>, __int64 a7@<rax>);
int __fastcall AppleUSBHub::EnterTestMode(AppleUSBHub *this);
// int __usercall AppleUSBHub::LeaveTestMode@<eax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>, const OSMetaClass *a3@<rdx>);
int __fastcall AppleUSBHub::PutPortIntoTestMode(AppleUSBHub *this, unsigned int a2, unsigned int a3);
__int64 __fastcall AppleUSBHub::SetIndicatorForPort(AppleUSBHub *this, unsigned int a2, __int16 a3);
__int64 __fastcall AppleUSBHub::GetPortIndicatorControl(AppleUSBHub *this, unsigned int a2, unsigned int *a3);
__int64 __fastcall AppleUSBHub::SetIndicatorsToAutomatic(AppleUSBHub *this); // idb
__int64 __fastcall AppleUSBHub::GetPortPower(AppleUSBHub *this, unsigned int a2, unsigned int *a3);
void __fastcall AppleUSBHub::DisablePowerManagement(AppleUSBHub *this, int a2);
__int64 __fastcall AppleUSBHub::GetPortPowerMgmtState(AppleUSBHub *this, unsigned int a2, unsigned __int64 *a3);
int __fastcall AppleUSBHub::EnsureUsability(AppleUSBHub *this);
// int __usercall AppleUSBHub::WaitForAbandonPortCheckGated@<eax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
__int64 __fastcall AppleUSBHub::InitialDelay(AppleUSBHub *this); // idb
void __fastcall AppleUSBHub::HubResetPortAfterPowerChangeDone(AppleUSBHub *this);
// bool __usercall AppleUSBHub::IsHubDeviceInternalAndOnThunderbolt@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>);
__int64 __fastcall AppleUSBHub::DeviceDisconnected(AppleUSBHub *this, unsigned __int16, char *); // idb
int __fastcall AppleUSBHub::SwitchMux(AppleUSBHub *this, unsigned int a2, const OSMetaClass *a3);
__int64 __fastcall AppleUSBHub::ProcessUSBNotification(AppleUSBHub *this, unsigned __int8 a2, IOUSBNotification *a3, uintptr_t a4);
__int64 __fastcall AppleUSBHub::SendUSBNotifications(AppleUSBHub *this, OSSet *a2, uintptr_t a3, OSSet *a4);
__int64 __fastcall AppleUSBHub::HubMessageToString(AppleUSBHub *this, signed int a2);
char *__fastcall AppleUSBHub::FeatureName(AppleUSBHub *this, unsigned int a2);
char *__fastcall AppleUSBHub::LinkStateName(AppleUSBHub *this, unsigned int a2);
__int64 __fastcall AppleUSBHub::MetaClass::~MetaClass(AppleUSBHub::MetaClass *__hidden this); // idb
__int64 `global constructor keyed to'_a();
__int64 `global destructor keyed to'_a();
__int64 __fastcall AppleUSBHubPort::MetaClass::MetaClass(AppleUSBHubPort::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBHubPort::MetaClass::~MetaClass(AppleUSBHubPort::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBHubPort::AppleUSBHubPort(__int64 a1);
__int64 __fastcall AppleUSBHubPort::AppleUSBHubPort(__int64 a1);
__int64 __fastcall AppleUSBHubPort::~AppleUSBHubPort(AppleUSBHubPort *__hidden this); // idb
__int64 __fastcall AppleUSBHubPort::~AppleUSBHubPort(AppleUSBHubPort *__hidden this); // idb
void __fastcall AppleUSBHubPort::~AppleUSBHubPort(AppleUSBHubPort *this);
__int64 __fastcall AppleUSBHubPort::getMetaClass(AppleUSBHubPort *__hidden this); // idb
__int64 __fastcall AppleUSBHubPort::MetaClass::MetaClass(AppleUSBHubPort::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBHubPort::MetaClass::alloc(AppleUSBHubPort::MetaClass *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBHubPort::AppleUSBHubPort(__int64 a1);
__int64 __fastcall AppleUSBHubPort::AppleUSBHubPort(__int64 a1);
__int64 __fastcall AppleUSBHubPort::init(AppleUSBHubPort *this, AppleUSBHub *a2, unsigned __int64 a3, char *a4, unsigned __int8 a5, unsigned __int8 a6, bool a7, char *a8);
int __fastcall AppleUSBHubPort::PortInitEntry(AppleUSBHubPort *this, OSObject *a2, const OSMetaClass *a3);
// int __usercall AppleUSBHubPort::PortStatusChangedHandlerEntry@<eax>(AppleUSBHubPort *this@<rdi>, OSObject *a2@<rsi>, __int64 a3@<rax>, const OSMetaClass *a4@<rdx>);
// int __usercall AppleUSBHubPort::AddDeviceEntry@<eax>(AppleUSBHubPort *this@<rdi>, OSObject *a2@<rsi>, void *a3@<rdx>, uintptr_t a4@<rax>);
// int __usercall AppleUSBHubPort::EnablePowerAfterOvercurrentEntry@<eax>(AppleUSBHubPort *this@<rdi>, OSObject *a2@<rsi>, uintptr_t a3@<rax>, const OSMetaClass *a4@<rdx>);
unsigned __int64 __fastcall AppleUSBHubPort::InitPortVectors(AppleUSBHubPort *this);
__int64 __fastcall AppleUSBHubPort::start(AppleUSBHubPort *__hidden this); // idb
int __fastcall AppleUSBHubPort::free(AppleUSBHubPort *this);
int __fastcall AppleUSBHubPort::stop(AppleUSBHubPort *this, __int64 a2, const OSMetaClass *a3);
void __fastcall AppleUSBHubPort::ReleaseDeviceZero(uintptr_t arg1);
void __fastcall AppleUSBHubPort::RemoveDevice(AppleUSBHubPort *this, __int64 a2, const OSMetaClass *a3);
char __fastcall AppleUSBHubPort::PortInit(uintptr_t arg1, __int64 a2);
void __fastcall AppleUSBHubPort::FatalError(AppleUSBHubPort *this, __int64 a2, const char *a3);
__int64 __fastcall AppleUSBHubPort::PowerCycleDeviceAttachedToThisPort(uintptr_t arg1); // idb
__int64 __fastcall AppleUSBHubPort::LaunchAddDeviceThread(AppleUSBHubPort *__hidden this, unsigned int); // idb
__int64 __fastcall AppleUSBHubPort::AddDevice(uintptr_t arg1, uintptr_t arg3, const OSMetaClass *a3);
char __fastcall AppleUSBHubPort::AcquireDeviceZero(uintptr_t arg1);
__int64 __fastcall AppleUSBHubPort::SetPortVector(__int64 a1, __int64 a2, __int64 a3, int a4);
__int64 __fastcall AppleUSBHubPort::AddDeviceResetChangeHandler(AppleUSBHubPort *this, unsigned int a2, const OSMetaClass *a3);
__int64 __fastcall AppleUSBHubPort::DefaultResetChangeHandler(uintptr_t arg1);
__int64 __fastcall AppleUSBHubPort::LaunchAddDeviceThreadGated(uintptr_t arg1, uintptr_t a2);
__int64 __fastcall AppleUSBHubPort::CallAddDeviceResetChangeHandlerDirectly(AppleUSBHubPort *this, AppleUSBHubPort *a2, unsigned __int16 a3);
__int64 __fastcall AppleUSBHubPort::Suspend(uintptr_t arg1, unsigned __int8 a2, char a3, __int64 a4, __int64 a5);
__int64 __fastcall AppleUSBHubPort::WaitForSuspendCommandGated(uintptr_t arg1, void *, unsigned __int64); // idb
// __int64 __usercall AppleUSBHubPort::Resume@<rax>(uintptr_t arg1@<rdi>, __int64 a2@<rax>);
__int64 __fastcall AppleUSBHubPort::DefaultSuspendChangeHandler(AppleUSBHubPort *this);
int __fastcall AppleUSBHubPort::MessageDeviceClients(AppleUSBHubPort *this, unsigned int a2, void *a3, __int64 a4);
// __int64 __usercall AppleUSBHubPort::SuspendPort@<rax>(uintptr_t arg1@<rdi>, __int64 a2@<rax>, unsigned __int8 a3@<dl>, char a4@<sil>);
__int64 __fastcall AppleUSBHubPort::HandleSuspendPortHandler(uintptr_t arg1, __int64 a2, char a3);
bool __fastcall AppleUSBHubPort::HasExpressCardCantWake(AppleUSBHubPort *this);
__int64 __fastcall AppleUSBHubPort::ReEnumeratePort(AppleUSBHubPort *this, __int64 a2);
__int64 __fastcall AppleUSBHubPort::ClearTT(AppleUSBHubPort *this, char a2, unsigned int a3);
__int64 __fastcall AppleUSBHubPort::ResetPort(AppleUSBHubPort *this, AppleUSBHubPort *a2);
bool __fastcall AppleUSBHubPort::ShouldApplyDisconnectWorkaround(AppleUSBHubPort *this);
__int64 __fastcall AppleUSBHubPort::HandleResetPortHandler(AppleUSBHubPort *this, signed __int64 a2, __int64 a3, __int64 (__fastcall *a4)(uintptr_t arg1), __int64 a5);
__int64 __fastcall AppleUSBHubPort::SDControllerReset(AppleUSBHubPort *__hidden this); // idb
int __fastcall DoConfigureDeviceZero(IOUSBController *this, unsigned __int8 a2, const OSMetaClass *a3, unsigned __int16 a4, unsigned int a5);
__int64 __fastcall AppleUSBHubPort::GetDevZeroDescriptorWithRetries(uintptr_t arg1); // idb
__int64 __fastcall AppleUSBHubPort::DetachDevice(AppleUSBHubPort *this); // idb
char __fastcall AppleUSBHubPort::IsCaptiveOverride(AppleUSBHubPort *this, int a2, unsigned __int16 a3);
void __fastcall AppleUSBHubPort::WakeSuspendCommand(uintptr_t arg1, void *a2);
// __int64 __usercall AppleUSBHubPort::HandleLinkState@<rax>(AppleUSBHubPort *this@<rdi>, __int64 a2@<rax>, unsigned int a3@<edx>);
__int64 __fastcall AppleUSBHubPort::DefaultOverCrntChangeHandler(uintptr_t arg1);
void __fastcall AppleUSBHubPort::DisplayOverCurrentNotice(uintptr_t arg1, unsigned __int8 a2, unsigned __int8 a3);
__int64 __fastcall AppleUSBHubPort::DefaultEnableChangeHandler(AppleUSBHubPort *this);
__int64 __fastcall AppleUSBHubPort::DefaultConnectionChangeHandler(AppleUSBHubPort *this, __int16 a2, __int16 a3);
// bool __usercall AppleUSBHubPort::ShouldIgnoreDisconnect@<al>(AppleUSBHubPort *this@<rdi>, __int64 a2@<rax>);
__int64 __fastcall AppleUSBHubPort::DefaultBHResetChangeHandler(uintptr_t arg1, unsigned __int16, unsigned __int16); // idb
__int64 __fastcall AppleUSBHubPort::DefaultPortLinkStateChangeHandler(AppleUSBHubPort *this, unsigned __int16 a2, unsigned int a3);
__int64 __fastcall AppleUSBHubPort::DefaultPortConfigErrChangeHandler(uintptr_t arg1, __int64 a2, unsigned int a3);
void __fastcall AppleUSBHubPort::PortStatusChangedHandler(AppleUSBHubPort *this, AppleUSBHubPort *a2);
char __fastcall AppleUSBHubPort::StatusChanged(AppleUSBHubPort *this);
__int64 __fastcall AppleUSBHubPort::ReleaseDevZeroLock(uintptr_t arg1); // idb
// void __usercall AppleUSBHubPort::EnablePowerAfterOvercurrent(AppleUSBHubPort *this@<rdi>, uintptr_t a2@<rax>);
char __fastcall AppleUSBHubPort::DetectExpressCardCantWake(AppleUSBHubPort *this);
uintptr_t __fastcall AppleUSBHubPort::FindSDCardReaderACPIPlatformDevice(uintptr_t arg1, char a2);
__int64 __fastcall AppleUSBHubPort::SDControllerPower(uintptr_t arg1, unsigned __int8 a2);
bool __fastcall AppleUSBHubPort::CheckForPowerOffSupport(uintptr_t arg1, __int64 a2);
__int64 __fastcall AppleUSBHubPort::MetaClass::~MetaClass(AppleUSBHubPort::MetaClass *__hidden this); // idb
__int64 `global constructor keyed to'_a_0();
__int64 `global destructor keyed to'_a_0();
__int64 __fastcall AppleUSBHSHubUserClient::MetaClass::MetaClass(AppleUSBHSHubUserClient::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBHSHubUserClient::MetaClass::~MetaClass(AppleUSBHSHubUserClient::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBHSHubUserClient::AppleUSBHSHubUserClient(__int64 a1);
__int64 __fastcall AppleUSBHSHubUserClient::AppleUSBHSHubUserClient(__int64 a1);
__int64 __fastcall AppleUSBHSHubUserClient::~AppleUSBHSHubUserClient(AppleUSBHSHubUserClient *__hidden this); // idb
__int64 __fastcall AppleUSBHSHubUserClient::~AppleUSBHSHubUserClient(AppleUSBHSHubUserClient *__hidden this); // idb
void __fastcall AppleUSBHSHubUserClient::~AppleUSBHSHubUserClient(AppleUSBHSHubUserClient *this);
__int64 __fastcall AppleUSBHSHubUserClient::getMetaClass(AppleUSBHSHubUserClient *__hidden this); // idb
__int64 __fastcall AppleUSBHSHubUserClient::MetaClass::MetaClass(AppleUSBHSHubUserClient::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBHSHubUserClient::MetaClass::alloc(AppleUSBHSHubUserClient::MetaClass *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBHSHubUserClient::AppleUSBHSHubUserClient(__int64 a1);
__int64 __fastcall AppleUSBHSHubUserClient::AppleUSBHSHubUserClient(__int64 a1);
__int64 __fastcall AppleUSBHSHubUserClient::_open(__int64 a1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_close(uintptr_t arg1); // idb
__int64 __fastcall AppleUSBHSHubUserClient::_IsEHCIRootHub(__int64 a1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_EnterTestMode(AppleUSBHSHubUserClient *this); // idb
__int64 __fastcall AppleUSBHSHubUserClient::_LeaveTestMode(__int64 a1);
__int64 __fastcall AppleUSBHSHubUserClient::_GetNumberOfPorts(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_PutPortIntoTestMode(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_GetLocationID(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_SupportsIndicators(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_SetIndicatorForPort(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_GetPortIndicatorControl(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_SetIndicatorsToAutomatic(uintptr_t arg1); // idb
__int64 __fastcall AppleUSBHSHubUserClient::_GetPowerSwitchingMode(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_SetPortPower(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_GetPortPower(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_DisablePowerManagement(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_PortReset(AppleUSBHSHubUserClient *this, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_PortWarmReset(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_PortLinkState(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_PortU1Timeout(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_PortU2Timeout(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_PortRemoteWakeMask(uintptr_t arg1, __int64 a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::_GetPortPwrMgmtState(__int64 a1, __int64 a2, __int64 a3);
int AppleUSBHSHubUserClient::externalMethod();
char __fastcall AppleUSBHSHubUserClient::initWithTask(uintptr_t arg1, uintptr_t arg2, IOUserClient *this, uintptr_t arg4, __int64 a5);
int __fastcall AppleUSBHSHubUserClient::start(uintptr_t arg1, IOService *a2, const OSMetaClass *a3);
__int64 __fastcall AppleUSBHSHubUserClient::Open(AppleUSBHSHubUserClient *this, unsigned __int8 a2);
__int64 __fastcall AppleUSBHSHubUserClient::Close(uintptr_t arg1); // idb
__int64 __fastcall AppleUSBHSHubUserClient::IsEHCIRootHub(AppleUSBHSHubUserClient *__hidden this, unsigned __int64 *); // idb
__int64 __fastcall AppleUSBHSHubUserClient::GetNumberOfPorts(uintptr_t arg1, unsigned __int64 *); // idb
__int64 __fastcall AppleUSBHSHubUserClient::GetLocationID(uintptr_t arg1, unsigned __int64 *); // idb
int __fastcall AppleUSBHSHubUserClient::EnterTestMode(AppleUSBHSHubUserClient *this);
// int __usercall AppleUSBHSHubUserClient::LeaveTestMode@<eax>(AppleUSBHSHubUserClient *this@<rdi>, __int64 a2@<rax>, const OSMetaClass *a3@<rdx>);
int __fastcall AppleUSBHSHubUserClient::PutPortIntoTestMode(uintptr_t arg1, uintptr_t a2, uintptr_t a3);
__int64 __fastcall AppleUSBHSHubUserClient::SupportsIndicators(uintptr_t arg1, unsigned __int64 *); // idb
__int64 __fastcall AppleUSBHSHubUserClient::SetIndicatorForPort(uintptr_t arg1, uintptr_t arg3, uintptr_t arg4); // idb
__int64 __fastcall AppleUSBHSHubUserClient::GetPortIndicatorControl(uintptr_t arg1, unsigned int a2, unsigned __int64 *a3);
__int64 __fastcall AppleUSBHSHubUserClient::SetIndicatorsToAutomatic(uintptr_t arg1); // idb
__int64 __fastcall AppleUSBHSHubUserClient::GetPowerSwitchingMode(uintptr_t arg1, unsigned __int64 *); // idb
__int64 __fastcall AppleUSBHSHubUserClient::GetPortPower(uintptr_t arg1, unsigned __int64, unsigned __int64 *); // idb
__int64 __fastcall AppleUSBHSHubUserClient::SetPortPower(uintptr_t arg1, uintptr_t arg2, uintptr_t a3);
__int64 __fastcall AppleUSBHSHubUserClient::DisablePowerManagement(uintptr_t arg1, uintptr_t a2);
__int64 __fastcall AppleUSBHSHubUserClient::PortReset(AppleUSBHSHubUserClient *this, __int64 a2);
__int64 __fastcall AppleUSBHSHubUserClient::PortWarmReset(uintptr_t arg1, unsigned __int64); // idb
__int64 __fastcall AppleUSBHSHubUserClient::PortLinkState(uintptr_t arg1, int a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::PortU1Timeout(uintptr_t arg1, int a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::PortU2Timeout(uintptr_t arg1, int a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::PortRemoteWakeMask(uintptr_t arg1, int a2, __int64 a3);
__int64 __fastcall AppleUSBHSHubUserClient::GetPortPwrMgmtState(AppleUSBHSHubUserClient *this, unsigned __int16 a2, unsigned __int64 *a3);
__int64 __fastcall AppleUSBHSHubUserClient::MetaClass::~MetaClass(AppleUSBHSHubUserClient::MetaClass *__hidden this); // idb
__int64 `global constructor keyed to'_a_1();
__int64 `global destructor keyed to'_a_1();
int _start();
__int64 *OSKextGetCurrentIdentifier();
__int64 *OSKextGetCurrentVersionString();
__int64 OSKextGetCurrentLoadTag();
int _stop();
// int __fastcall IOFree(_QWORD, _QWORD); weak
// int __fastcall IOLockAlloc(_QWORD, _QWORD); weak
// int __cdecl IOLockFree(_QWORD); weak
// int __fastcall IOLockLock(_QWORD, _QWORD); weak
// int __fastcall IOLockTryLock(_QWORD); weak
// int __fastcall IOLockUnlock(_QWORD, _QWORD); weak
// int __fastcall IOLog(_QWORD); weak
// int __fastcall IOMalloc(_QWORD); weak
// int __fastcall IOSleep(_QWORD); weak
// int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD); weak
// int __fastcall OSCompareAndSwap(_QWORD, _QWORD, _QWORD); weak
// int __fastcall PEGetModelName(_QWORD, _QWORD); weak
// _QWORD IOUSBDevice::GetProtocol(IOUSBDevice *__hidden this); idb
// _QWORD IOUSBDevice::GetIsochDelay(IOUSBDevice *__hidden this); idb
// _QWORD __cdecl IOUSBDevice::SetBusPowerAvailable(IOUSBDevice *__hidden this, unsigned int); idb
// _QWORD IOUSBDevice::GetbcdUSB(IOUSBDevice *__hidden this); idb
// int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD); weak
// _QWORD __cdecl OSMetaClass::~OSMetaClass(OSMetaClass *__hidden this); idb
// _QWORD __cdecl IOUserClient::clientHasPrivilege(IOUserClient *__hidden this, void *, const char *); idb
// int __cdecl IOUserClient::IOUserClient(_QWORD); weak
// _QWORD __cdecl IOUserClient::~IOUserClient(IOUserClient *__hidden this); idb
// _QWORD __cdecl IOCommandGate::commandGate(IOCommandGate *__hidden this, OSObject *, int (__cdecl *)(OSObject *, void *, void *, void *, void *)); idb
// _QWORD IOPMrootDomain::wakeFromDoze(IOPMrootDomain *__hidden this); idb
// _QWORD __cdecl IOUSBHubDevice::UpdateUnconnectedExternalPorts(IOUSBHubDevice *__hidden this, int); idb
// _QWORD IORegistryEntry::getRegistryEntryID(IORegistryEntry *__hidden this); idb
// int __fastcall IORegistryEntry::fromPath(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD); weak
// _QWORD __cdecl IORegistryEntry::getPlane(IORegistryEntry *__hidden this, const char *); idb
// _QWORD __cdecl IOUSBController::MakeDevice(IOUSBController *__hidden this, unsigned __int16 *); idb
// _QWORD __cdecl IOUSBController::IsPortMuxed(IOUSBController *__hidden this, IORegistryEntry *, unsigned int, unsigned int, char *); idb
// _QWORD __cdecl IOUSBController::CreateDevice(IOUSBController *__hidden this, IOUSBDevice *, unsigned __int16, unsigned __int8, unsigned __int8, unsigned int); idb
// _QWORD __cdecl IOUSBController::MakeHubDevice(IOUSBController *__hidden this, unsigned __int16 *); idb
// _QWORD IOUSBController::GetCommandGate(IOUSBController *__hidden this); idb
// _QWORD __cdecl IOUSBController::ExpressCardPort(IOUSBController *__hidden this, IORegistryEntry *); idb
// _QWORD __cdecl IOUSBController::IsControllerMuxed(IOUSBController *__hidden this, IORegistryEntry *, unsigned int); idb
// _QWORD __cdecl IOUSBController::ConfigureDeviceZero(IOUSBController *__hidden this, unsigned __int8, unsigned __int8); idb
// _QWORD __cdecl IOUSBController::SetDeviceZeroAddress(IOUSBController *__hidden this, unsigned __int16); idb
// int __fastcall IOUSBController::GetDeviceZeroDescriptor(_QWORD, _QWORD, _QWORD); weak
// _QWORD IOUSBController::WaitForReleaseDeviceZero(IOUSBController *__hidden this); idb
// _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *); weak
// _QWORD __cdecl IOUSBControllerV3::GetConnectorType(IOUSBControllerV3 *__hidden this, IORegistryEntry *, unsigned int, unsigned int, unsigned __int8 *); idb
// _QWORD __cdecl IOUSBControllerV3::GetInternalHubErrataBits(IOUSBControllerV3 *__hidden this, IORegistryEntry *, unsigned int, unsigned int, unsigned int *); idb
// _QWORD __cdecl IOUSBControllerV3::CanControllerMuxOverToEHCI(IOUSBControllerV3 *__hidden this, IORegistryEntry *, unsigned int); idb
// _QWORD __cdecl IOUSBNotification::SendNotification(IOUSBNotification *__hidden this, unsigned __int64, void *); idb
// int __fastcall IORegistryIterator::iterateOver(_QWORD, _QWORD, _QWORD); weak
// int __fastcall IOTimerEventSource::timerEventSource(_QWORD, _QWORD); weak
// _QWORD __cdecl IOUSBHubPolicyMaker::IOUSBHubPolicyMaker(IOUSBHubPolicyMaker *__hidden this, const OSMetaClass *); idb
// _QWORD __cdecl IOUSBHubPolicyMaker::~IOUSBHubPolicyMaker(IOUSBHubPolicyMaker *__hidden this); idb
// int __fastcall OSCollectionIterator::withCollection(_QWORD); weak
// _QWORD __cdecl IOBufferMemoryDescriptor::withCapacity(IOBufferMemoryDescriptor *__hidden this, unsigned __int64, unsigned int, bool); idb
// _QWORD __cdecl OSSet::withCapacity(OSSet *__hidden this, unsigned int); idb
// _QWORD __cdecl OSArray::withCapacity(OSArray *__hidden this, unsigned int); idb
// _QWORD __cdecl OSNumber::withNumber(OSNumber *__hidden this, unsigned __int64, unsigned int); idb
// int __cdecl OSObject::OSObject(_QWORD); weak
// _QWORD __cdecl OSObject::~OSObject(OSObject *__hidden this); idb
// void __cdecl OSObject::operator delete(void *); idb
// _QWORD __cdecl OSObject::operator new(OSObject *__hidden this, unsigned __int64); idb
// _QWORD IOService::getPMRootDomain(IOService *__hidden this); idb
// _QWORD __cdecl IOService::changePowerStateTo(IOService *__hidden this, unsigned __int64); idb
// _QWORD IOService::powerOverrideOnPriv(IOService *__hidden this); idb
// _QWORD IOService::powerOverrideOffPriv(IOService *__hidden this); idb
// _QWORD __cdecl IOService::changePowerStateToPriv(IOService *__hidden this, unsigned __int64); idb
// _QWORD IOService::acknowledgeSetPowerState(IOService *__hidden this); idb
// _QWORD OSMetaClass::instanceConstructed(OSMetaClass *__hidden this); idb
// _QWORD __cdecl OSMetaClassBase::metaCast(OSMetaClassBase *__hidden this, const char *); idb
// _QWORD IOService::isInactive(IOService *__hidden this); idb
// int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD); weak
// void __cdecl bzero(void *, size_t);
// int __fastcall clock_get_uptime(_QWORD); weak
// int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD); weak
// void __cdecl kernel_debug(uint32_t debugid, uintptr_t arg1, uintptr_t arg2, uintptr_t arg3, uintptr_t arg4, uintptr_t arg5);
// int __cdecl memcmp(const void *, const void *, size_t);
// size_t __cdecl strlcpy(char *, const char *, size_t);
// int __cdecl strncmp(const char *, const char *, size_t);
// unsigned __int64 __cdecl strtoul(const char *, char **, int);
// int __fastcall thread_call_allocate(_QWORD, _QWORD); weak
// int __cdecl thread_call_cancel(_QWORD); weak
// int __fastcall thread_call_enter(_QWORD); weak
// int __fastcall thread_call_enter1(_QWORD, _QWORD); weak
// int __fastcall thread_call_free(_QWORD); weak

//-------------------------------------------------------------------------
// Data declarations

int dword_0 = 4277009103; // weak
int dword_C = 11; // weak
int dword_10 = 8; // weak
int dword_18 = 133; // weak
section_64 stru_B8 =
{
  {
    '_',
    '_',
    'c',
    's',
    't',
    'r',
    'i',
    'n',
    'g',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0'
  },
  "__TEXT",
  97863uLL,
  8290uLL,
  97863u,
  0u,
  0u,
  0u,
  2u,
  0u,
  0u,
  0u
}; // weak
section_64 stru_1A0 =
{
  {
    '_',
    '_',
    'g',
    'o',
    't',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0',
    '\0'
  },
  "__DATA",
  106496uLL,
  160uLL,
  106496u,
  3u,
  0u,
  0u,
  0u,
  0u,
  0u,
  0u
}; // weak
dysymtab_command stru_430 =
{
  11u,
  80u,
  0u,
  28u,
  28u,
  281u,
  309u,
  429u,
  0u,
  0u,
  0u,
  0u,
  0u,
  0u,
  0u,
  0u,
  127576u,
  1647u,
  114688u,
  135u
}; // weak
void *__ptr32 off_6D28[5] =
{
  (void *__ptr32 )0xFFFFF7BELL,
  (void *__ptr32 )0xFFFFF7BELL,
  (void *__ptr32 )0xFFFFF7F5LL,
  (void *__ptr32 )0xFFFFF83ELL,
  (void *__ptr32 )0xFFFFF894LL
}; // weak
void *__ptr32 off_93C8[4] =
{
  (void *__ptr32 )0xFFFFFEE9LL,
  (void *__ptr32 )0xFFFFFF2ELL,
  (void *__ptr32 )0xFFFFFF73LL,
  (void *__ptr32 )0xFFFFFFB8LL
}; // weak
void *__ptr32 off_11E98[4] =
{
  (void *__ptr32 )0xFFFFFEE6LL,
  (void *__ptr32 )0xFFFFFF2BLL,
  (void *__ptr32 )0xFFFFFF6DLL,
  (void *__ptr32 )0xFFFFFFA7LL
}; // weak
_QWORD errataList = 217583459827385450LL; // weak
__int64 qword_19EC8[3] = { -2305839891067437056LL, -2305839943143914773LL, 0LL }; // weak
_QWORD defaultPortVectors[] = { 0LL, 0LL }; // weak
int dword_19FC4 = 95195135; // weak
_QWORD off_1A000[20] =
{
  179032LL,
  179360LL,
  179928LL,
  179984LL,
  180016LL,
  180048LL,
  180248LL,
  180256LL,
  180432LL,
  181520LL,
  182048LL,
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
_QWORD off_1A008[19] =
{
  179360LL,
  179928LL,
  179984LL,
  180016LL,
  180048LL,
  180248LL,
  180256LL,
  180432LL,
  181520LL,
  182048LL,
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
_QWORD off_1A010[18] =
{
  179928LL,
  179984LL,
  180016LL,
  180048LL,
  180248LL,
  180256LL,
  180432LL,
  181520LL,
  182048LL,
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
_QWORD off_1A018[17] =
{
  179984LL,
  180016LL,
  180048LL,
  180248LL,
  180256LL,
  180432LL,
  181520LL,
  182048LL,
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
_QWORD off_1A020[16] =
{
  180016LL,
  180048LL,
  180248LL,
  180256LL,
  180432LL,
  181520LL,
  182048LL,
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
_QWORD off_1A028[15] =
{
  180048LL,
  180248LL,
  180256LL,
  180432LL,
  181520LL,
  182048LL,
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
_QWORD off_1A030[14] =
{
  180248LL,
  180256LL,
  180432LL,
  181520LL,
  182048LL,
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
_QWORD off_1A038[13] =
{
  180256LL,
  180432LL,
  181520LL,
  182048LL,
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
_QWORD off_1A040[12] =
{
  180432LL,
  181520LL,
  182048LL,
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
_QWORD off_1A048[11] =
{
  181520LL,
  182048LL,
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
__int64 off_1A050[10] =
{
  182048LL,
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
__int64 off_1A058[9] =
{
  182056LL,
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
__int64 off_1A060[8] =
{
  182064LL,
  182072LL,
  182088LL,
  182128LL,
  182136LL,
  182144LL,
  182152LL,
  182160LL
}; // weak
__int64 off_1A068[7] = { 182072LL, 182088LL, 182128LL, 182136LL, 182144LL, 182152LL, 182160LL }; // weak
__int64 off_1A070[6] = { 182088LL, 182128LL, 182136LL, 182144LL, 182152LL, 182160LL }; // weak
__int64 off_1A078[5] = { 182128LL, 182136LL, 182144LL, 182152LL, 182160LL }; // weak
__int64 off_1A080[4] = { 182136LL, 182144LL, 182152LL, 182160LL }; // weak
__int64 off_1A088[3] = { 182144LL, 182152LL, 182160LL }; // weak
__int64 off_1A090[2] = { 182152LL, 182160LL }; // weak
__int64 off_1A098 = 182160LL; // weak
_QWORD AppleUSBHub::metaClass = 113760LL; // weak
__int64 (__fastcall *off_1A0F0[2])(AppleUSBHub *__hidden this) = { &AppleUSBHub::~AppleUSBHub, &AppleUSBHub::~AppleUSBHub }; // weak
__int64 (__fastcall *off_1AA30[2])(AppleUSBHub::MetaClass *__hidden this) = { &AppleUSBHub::MetaClass::~MetaClass, &AppleUSBHub::MetaClass::~MetaClass }; // weak
char *off_1AB10[31] =
{
  "kUSBHubPortConnectionFeature",
  "kUSBHubPortEnableFeature",
  "kUSBHubPortSuspendFeature",
  "kUSBHubPortOverCurrentFeature",
  "kUSBHubPortResetFeature",
  "kUSBHubPortLinkStateFeature",
  "Unknown Feature",
  "Unknown Feature",
  "kUSBHubPortPowerFeature",
  "kUSBHubPortLowSpeedFeature",
  "Unknown Feature",
  "Unknown Feature",
  "Unknown Feature",
  "Unknown Feature",
  "Unknown Feature",
  "Unknown Feature",
  "kUSBHubPortConnectionChangeFeature",
  "kUSBHubPortEnableChangeFeature",
  "kUSBHubPortSuspendChangeFeature",
  "kUSBHubPortOverCurrentChangeFeature",
  "kUSBHubPortResetChangeFeature",
  "kUSBHubPortTestFeature",
  "kUSBHubPortIndicatorFeature",
  "kUSBHubPortU1TimeoutFeature",
  "kUSBHubPortU2TimeoutFeature",
  "kUSBHubPortLinkStateChangeFeature",
  "kUSBHubPortConfigErrorChangeFeature",
  "kUSBHubPortRemoteWakeMaskFeature",
  "kUSBHubPortBHPortResetFeature",
  "kUSBHubPortBHResetChangeFeature",
  "kUSBHubPortForceLinkPMAcceptFeature"
}; // weak
char *off_1AC10[18] =
{
  "U0",
  "U1",
  "U2",
  "U3",
  "SS.Disabled)",
  "Rx.Detect)",
  "SS.Inactive",
  "Polling)",
  "Recovery",
  "Hot Reset",
  "Compliance Mode",
  "Loopback",
  "Reserved State",
  "Reserved State",
  "Reserved State",
  "Reserved State",
  &AppleUSBHubPort::gMetaClass,
  &OSObject::gMetaClass
}; // weak
__int64 (__fastcall *off_1ACB0[2])(AppleUSBHubPort *__hidden this) = { &AppleUSBHubPort::~AppleUSBHubPort, &AppleUSBHubPort::~AppleUSBHubPort }; // weak
__int64 (__fastcall *off_1AE10[2])(AppleUSBHubPort::MetaClass *__hidden this) =
{
  &AppleUSBHubPort::MetaClass::~MetaClass,
  &AppleUSBHubPort::MetaClass::~MetaClass
}; // weak
__int64 (__fastcall *off_1AF10[2])(AppleUSBHSHubUserClient *__hidden this) =
{
  &AppleUSBHSHubUserClient::~AppleUSBHSHubUserClient,
  &AppleUSBHSHubUserClient::~AppleUSBHSHubUserClient
}; // weak
__int64 (__fastcall *off_1B890[2])(AppleUSBHSHubUserClient::MetaClass *__hidden this) =
{
  &AppleUSBHSHubUserClient::MetaClass::~MetaClass,
  &AppleUSBHSHubUserClient::MetaClass::~MetaClass
}; // weak
__int64 kmod_info = 0LL; // weak
_QWORD AppleUSBHub::gMetaClass; // weak
_QWORD AppleUSBHubPort::gMetaClass; // weak
_QWORD AppleUSBHSHubUserClient::gMetaClass; // weak
int (*_realmain)(void); // weak
int (*_antimain)(void); // weak
int AppleUSBHub::DecrementOutstandingIO(bool)::gSerial; // weak
int AppleUSBHub::LowerPowerState(void)::gSerial; // weak
int AppleUSBHub::DecrementOutstandingResumes(void)::gSerial; // weak


//----- (00000000000013C0) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::MetaClass::MetaClass(AppleUSBHub::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBHub", off_1A028[0], 1088LL);
  result = (__int64)off_1AA30;
  *(_QWORD *)this = off_1AA30;
  return result;
}
// 1A028: using guessed type _QWORD off_1A028[15];
// 1AA30: using guessed type __int64 (__fastcall *off_1AA30[2])(AppleUSBHub::MetaClass *__hidden this);
// 2BB40: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (00000000000013F2) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::MetaClass::~MetaClass(AppleUSBHub::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (00000000000013FC) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::AppleUSBHub(IOUSBHubPolicyMaker *a1, const OSMetaClass *a2)
{
  __int64 result; // rax@1

  IOUSBHubPolicyMaker::IOUSBHubPolicyMaker(a1, a2);
  result = (__int64)off_1A0F0;
  *(_QWORD *)a1 = off_1A0F0;
  return result;
}
// 1A0F0: using guessed type __int64 (__fastcall *off_1A0F0[2])(AppleUSBHub *__hidden this);

//----- (000000000000141C) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::AppleUSBHub(IOUSBHubPolicyMaker *a1, const OSMetaClass *a2)
{
  __int64 result; // rax@1

  IOUSBHubPolicyMaker::IOUSBHubPolicyMaker(a1, a2);
  result = (__int64)off_1A0F0;
  *(_QWORD *)a1 = off_1A0F0;
  return result;
}
// 1A0F0: using guessed type __int64 (__fastcall *off_1A0F0[2])(AppleUSBHub *__hidden this);

//----- (000000000000143C) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::~AppleUSBHub(AppleUSBHub *this)
{
  return IOUSBHubPolicyMaker::~IOUSBHubPolicyMaker(this);
}

//----- (0000000000001446) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::~AppleUSBHub(AppleUSBHub *this)
{
  return IOUSBHubPolicyMaker::~IOUSBHubPolicyMaker(this);
}

//----- (0000000000001450) ----------------------------------------------------
void __fastcall AppleUSBHub::~AppleUSBHub(AppleUSBHub *this)
{
  IOUSBHubPolicyMaker::~IOUSBHubPolicyMaker(this);
  OSObject::operator delete((void *)this);
}

//----- (0000000000001472) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::getMetaClass(AppleUSBHub *this)
{
  return (__int64)&AppleUSBHub::gMetaClass;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;

//----- (0000000000001480) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::MetaClass::MetaClass(AppleUSBHub::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBHub", off_1A028[0], 1088LL);
  result = (__int64)off_1AA30;
  *(_QWORD *)this = off_1AA30;
  return result;
}
// 1A028: using guessed type _QWORD off_1A028[15];
// 1AA30: using guessed type __int64 (__fastcall *off_1AA30[2])(AppleUSBHub::MetaClass *__hidden this);
// 2BB40: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (00000000000014B2) ----------------------------------------------------
IOUSBHubPolicyMaker *__fastcall AppleUSBHub::MetaClass::alloc(AppleUSBHub::MetaClass *this, unsigned __int64 a2)
{
  IOUSBHubPolicyMaker *v2; // rbx@1

  v2 = (IOUSBHubPolicyMaker *)OSObject::operator new((OSObject *)&stru_430.iextdefsym, a2);
  IOUSBHubPolicyMaker::IOUSBHubPolicyMaker(v2, (const OSMetaClass *)&AppleUSBHub::gMetaClass);
  *(_QWORD *)v2 = off_1A0F0;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBHub::gMetaClass);
  return v2;
}
// 430: using guessed type dysymtab_command;
// 1A0F0: using guessed type __int64 (__fastcall *off_1A0F0[2])(AppleUSBHub *__hidden this);
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;

//----- (00000000000014F2) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::AppleUSBHub(IOUSBHubPolicyMaker *a1)
{
  IOUSBHubPolicyMaker::IOUSBHubPolicyMaker(a1, (const OSMetaClass *)&AppleUSBHub::gMetaClass);
  *(_QWORD *)a1 = off_1A0F0;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBHub::gMetaClass);
}
// 1A0F0: using guessed type __int64 (__fastcall *off_1A0F0[2])(AppleUSBHub *__hidden this);
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;

//----- (0000000000001522) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::AppleUSBHub(IOUSBHubPolicyMaker *a1)
{
  IOUSBHubPolicyMaker::IOUSBHubPolicyMaker(a1, (const OSMetaClass *)&AppleUSBHub::gMetaClass);
  *(_QWORD *)a1 = off_1A0F0;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBHub::gMetaClass);
}
// 1A0F0: using guessed type __int64 (__fastcall *off_1A0F0[2])(AppleUSBHub *__hidden this);
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;

//----- (0000000000001552) ----------------------------------------------------
char __fastcall AppleUSBHub::init(__int64 a1)
{
  char result; // al@2

  if ( (unsigned __int8)(*(int (__cdecl **)(__int64))(off_1A060[0] + 600))(a1) )
  {
    *(_BYTE *)(a1 + 409) = 0;
    *(_DWORD *)(a1 + 1016) = 0;
    *(_QWORD *)(a1 + 448) = 0LL;
    *(_QWORD *)(a1 + 272) = 0LL;
    *(_BYTE *)(a1 + 304) = 0;
    *(_BYTE *)(a1 + 305) = 0;
    *(_BYTE *)(a1 + 306) = 0;
    *(_QWORD *)(a1 + 336) = 0LL;
    *(_QWORD *)(a1 + 344) = 0LL;
    *(_QWORD *)(a1 + 352) = 0LL;
    *(_BYTE *)(a1 + 314) = 0;
    *(_DWORD *)(a1 + 328) = 0;
    *(_DWORD *)(a1 + 720) = 0;
    *(_DWORD *)(a1 + 728) = 0;
    *(_DWORD *)(a1 + 724) = 0;
    *(_BYTE *)(a1 + 316) = 0;
    *(_BYTE *)(a1 + 307) = 0;
    *(_BYTE *)(a1 + 318) = 0;
    *(_DWORD *)(a1 + 308) = 3;
    *(_BYTE *)(a1 + 429) = 0;
    *(_BYTE *)(a1 + 1042) = 0;
    *(_QWORD *)(a1 + 1024) = 0LL;
    clock_get_uptime(a1 + 1048);
    result = 1;
  }
  else
  {
    result = 0;
  }
  return result;
}
// 1A060: using guessed type __int64 off_1A060[8];
// 2C760: using guessed type int __fastcall clock_get_uptime(_QWORD);

//----- (0000000000001650) ----------------------------------------------------
unsigned __int8 __fastcall AppleUSBHub::start(AppleUSBHub *this, uintptr_t arg2)
{
  __int64 v2; // r15@1
  __int64 v3; // rax@4
  unsigned __int8 v4; // r14@4
  __int64 v5; // rax@5
  uintptr_t v6; // rdx@8
  uintptr_t v7; // rsi@8
  uintptr_t v8; // r8@8

  v2 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1005u, (uintptr_t)this, arg2, 0LL, 0LL, 0LL);
  *((_DWORD *)this + 75) = 1;
  *((_DWORD *)this + 181) = 1;
  AppleUSBHub::IncrementOutstandingIO(this, 0);
  LODWORD(v3) = (*(int (__fastcall **)(AppleUSBHub *, uintptr_t))(off_1A060[0] + 1488))(this, arg2);
  v4 = v3;
  if ( (_BYTE)v3 )
  {
    v5 = *(_DWORD *)v2 & 2;
    if ( *((_BYTE *)this + 426) )
    {
      if ( !(_DWORD)v5 )
        goto LABEL_13;
      v5 = off_1A098;
      if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_13;
      v6 = *((_WORD *)this + 122);
      v7 = *((_DWORD *)this + 74);
      v8 = 0LL;
    }
    else
    {
      if ( !(_DWORD)v5 )
        goto LABEL_13;
      v5 = off_1A098;
      if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_13;
      v6 = *((_WORD *)this + 122);
      v7 = *((_DWORD *)this + 74);
      v8 = 1LL;
    }
    kernel_debug(0x52D1004u, v7, v6, 0LL, v8, 0LL);
LABEL_13:
    v3 = AppleUSBHub::LowerPowerState(this, v5);
  }
  AppleUSBHub::DecrementOutstandingIO(this, v3, 0);
  *((_DWORD *)this + 75) = 0;
  if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1006u, (uintptr_t)this, *((_DWORD *)this + 74), *((_BYTE *)this + 218), v4, 0LL);
  return v4;
}
// 1A060: using guessed type __int64 off_1A060[8];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000000179E) ----------------------------------------------------
void __fastcall AppleUSBHub::IncrementOutstandingIO(AppleUSBHub *this, unsigned __int8 a2)
{
  AppleUSBHub *v2; // rbx@1
  __int64 v3; // rdi@1
  uintptr_t v4; // rsi@4
  uintptr_t v5; // rdx@4
  int v6; // eax@5

  v2 = this;
  v3 = *((_QWORD *)this + 34);
  if ( v3 )
  {
    (*(void (__fastcall **)(__int64, __int64 (__fastcall *)(uintptr_t, uintptr_t, void *, void *, void *, void *), signed __int64, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v3 + 456LL))(
      v3,
      AppleUSBHub::ChangeOutstandingIO,
      1LL,
      0LL,
      a2,
      0LL);
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v4 = *((_DWORD *)v2 + 74);
      v5 = *((_DWORD *)v2 + 180);
LABEL_10:
      kernel_debug(0x52DA818u, v4, v5, 0LL, 0LL, 0LL);
      return;
    }
  }
  else
  {
    v6 = *((_DWORD *)v2 + 180) + 1;
    *((_DWORD *)v2 + 180) = v6;
    if ( a2 )
      *((_BYTE *)v2 + 320) = 1;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v5 = (unsigned int)v6;
      v4 = *((_DWORD *)v2 + 74);
      goto LABEL_10;
    }
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000001856) ----------------------------------------------------
__int64 __usercall AppleUSBHub::LowerPowerState@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  AppleUSBHub *v2; // rbx@1
  __int64 v3; // rdi@1
  __int64 result; // rax@2
  int v5; // eax@6
  __int64 v6; // [sp-4h] [bp-10h]@1

  v6 = a2;
  v2 = this;
  ++AppleUSBHub::LowerPowerState(void)::gSerial;
  v3 = *((_QWORD *)this + 34);
  if ( v3 )
  {
    (*(void (__fastcall **)(__int64, __int64 (__fastcall *)(uintptr_t, uintptr_t, void *, void *, void *, void *), signed __int64, char *, _QWORD, _QWORD))(*(_QWORD *)v3 + 456LL))(
      v3,
      AppleUSBHub::ChangeRaisedPowerState,
      -1LL,
      (char *)&v6 + 4,
      0LL,
      0LL);
    result = HIDWORD(v6);
  }
  else
  {
    result = (unsigned int)(*((_DWORD *)v2 + 181) - 1);
    *((_DWORD *)v2 + 181) = result;
    HIDWORD(v6) = result;
  }
  if ( !(_DWORD)result )
  {
    result = IOService::isInactive(v2);
    if ( !(_BYTE)result )
    {
      v5 = (*(int (__fastcall **)(AppleUSBHub *))(*(_QWORD *)v2 + 2208LL))(v2);
      result = IOService::changePowerStateTo(v2, (unsigned int)v5);
    }
  }
  return result;
}
// 1BCEC: using guessed type int AppleUSBHub::LowerPowerState(void)::gSerial;

//----- (00000000000018D6) ----------------------------------------------------
char __usercall AppleUSBHub::DecrementOutstandingIO@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>, unsigned __int8 a3@<sil>)
{
  AppleUSBHub *v3; // rbx@1
  uintptr_t v4; // r14@1
  __int64 v5; // rdi@1
  int v6; // eax@3
  __int64 v7; // r15@5
  __int64 v8; // rax@8
  __int64 v9; // r14@18
  __int64 v11; // [sp-4h] [bp-20h]@1

  v11 = a2;
  v3 = this;
  v4 = AppleUSBHub::DecrementOutstandingIO(bool)::gSerial++;
  v5 = *((_QWORD *)this + 34);
  if ( v5 )
  {
    (*(void (__fastcall **)(__int64, __int64 (__fastcall *)(uintptr_t, uintptr_t, void *, void *, void *, void *), signed __int64, char *, _QWORD, _QWORD))(*(_QWORD *)v5 + 456LL))(
      v5,
      AppleUSBHub::ChangeOutstandingIO,
      -1LL,
      (char *)&v11 + 4,
      a3,
      0LL);
  }
  else
  {
    v6 = *((_DWORD *)v3 + 180) - 1;
    *((_DWORD *)v3 + 180) = v6;
    HIDWORD(v11) = v6;
    if ( a3 )
      *((_BYTE *)v3 + 320) = 0;
  }
  v7 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52DA814u, *((_DWORD *)v3 + 74), v4, HIDWORD(v11), *((_BYTE *)v3 + 318), 0LL);
  LOBYTE(v8) = AppleUSBHub::IsPortInitThreadActiveForAnyPort(v3);
  if ( (_BYTE)v8 )
  {
    if ( *((_QWORD *)v3 + 21) == 4LL && *((_BYTE *)v3 + 318) )
    {
      *((_BYTE *)v3 + 318) = 0;
      LOBYTE(v8) = AppleUSBHub::RearmInterruptRead(v3);
    }
  }
  else
  {
    LOBYTE(v8) = BYTE4(v11);
    if ( *((_BYTE *)v3 + 316) )
    {
      if ( !HIDWORD(v11) && !*((_BYTE *)v3 + 432) )
      {
        v8 = *((_QWORD *)v3 + 21);
        if ( v8 == 4 || !v8 && *((_BYTE *)v3 + 317) )
        {
          v9 = *((_QWORD *)v3 + 18);
          *((_BYTE *)v3 + 316) = 0;
          AppleUSBHub::StopPorts(v3);
          *((_QWORD *)v3 + 18) = 0LL;
          LOBYTE(v8) = (*(int (__fastcall **)(__int64, AppleUSBHub *, _QWORD))(*(_QWORD *)v9 + 1496LL))(v9, v3, 0LL);
        }
      }
    }
    else if ( (!HIDWORD(v11) || HIDWORD(v11) == 1 && *((_DWORD *)v3 + 81))
           && *((_QWORD *)v3 + 21) == 4LL
           && !*((_BYTE *)v3 + 306) )
    {
      LOBYTE(v8) = IOService::isInactive(v3);
      if ( !(_BYTE)v8 )
      {
        if ( *((_BYTE *)v3 + 318) )
        {
          *((_BYTE *)v3 + 318) = 0;
          LOBYTE(v8) = AppleUSBHub::RearmInterruptRead(v3);
        }
        if ( !*((_BYTE *)v3 + 429) && *((_DWORD *)v3 + 41) == -1 )
        {
          *((_BYTE *)v3 + 429) = 1;
          (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)v3 + 32LL))(v3);
          LODWORD(v8) = thread_call_enter(*((_QWORD *)v3 + 46));
          if ( (_DWORD)v8 == 1 )
          {
            if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(0x52D1054u, *((_DWORD *)v3 + 74), 0LL, 0LL, 0LL, 0LL);
            LOBYTE(v8) = (*(int (__fastcall **)(AppleUSBHub *))(*(_QWORD *)v3 + 40LL))(v3);
          }
        }
      }
    }
  }
  return v8;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 1BCE8: using guessed type int AppleUSBHub::DecrementOutstandingIO(bool)::gSerial;
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (0000000000001B08) ----------------------------------------------------
char __fastcall AppleUSBHub::ConfigureHubDriver(AppleUSBHub *this)
{
  AppleUSBHub *v1; // r15@1
  __int64 v2; // rax@1
  int (__cdecl *v3)(OSObject *, void *, void *, void *, void *); // rdx@1
  __int64 v4; // rcx@1
  __int64 v5; // r8@1
  unsigned int v6; // er14@2
  __int64 v7; // rax@2
  __int64 v8; // rax@3
  __int64 v9; // rdx@5
  unsigned int v10; // er12@13
  __int64 v11; // rax@16
  __int64 v12; // rdi@17
  __int64 v13; // rax@20
  __int64 v14; // rdi@21
  __int64 v15; // rdi@24
  __int64 v16; // rdi@26
  __int64 v17; // rdi@28
  char v18; // r14@28
  __int64 v20; // rax@32
  int v21; // eax@33
  __int64 v22; // rax@34
  __int64 v23; // rbx@34
  __int64 v24; // rax@34
  __int64 v25; // rax@34
  bool v26; // zf@34
  __int64 v27; // rax@37
  __int64 v28; // rax@39
  __int64 v29; // rax@42
  __int64 v30; // rax@42
  __int64 v31; // rax@42
  __int64 v32; // rax@42
  __int64 v33; // rax@42
  __int64 v34; // rax@42
  __int64 v35; // rax@42
  __int64 v36; // rax@42
  __int64 v37; // rax@42
  unsigned int v38; // eax@51
  __int64 v39; // rax@51
  OSMetaClassBase *v40; // rax@54
  const OSMetaClass *v41; // rdx@54
  __int64 v42; // rax@54

  v1 = this;
  LODWORD(v2) = IOTimerEventSource::timerEventSource(this, AppleUSBHub::TimeoutOccurred);
  *((_QWORD *)this + 56) = v2;
  if ( !v2 )
  {
    v9 = (__int64)"AppleUSBHub::ConfigureHubDriver Couldn't allocate timer event source";
    goto LABEL_11;
  }
  v6 = 0;
  v7 = IOCommandGate::commandGate(this, 0LL, v3);
  *((_QWORD *)this + 34) = v7;
  if ( !v7 )
  {
    v9 = (__int64)"AppleUSBHub::ConfigureHubDriver - unable to create command gate";
LABEL_12:
    KernelDebugLogInternal(1LL, 1431519814LL, v9, v4, v5);
LABEL_13:
    v10 = *((_DWORD *)this + 74);
    (*(void (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)off_1A010[0] + 1920LL))(*(_QWORD *)off_1A010[0], v6);
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "AppleUSBHub::ConfigureHubDriver  Aborting startup for hub @ 0x%x,  error 0x%x (%s)",
      v10,
      v6);
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10BCu, *((_DWORD *)this + 74), (signed int)v6, 0LL, 0LL, 0LL);
    AppleUSBHub::StopPorts(this);
    (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)this + 1480LL))(this, *((_QWORD *)this + 18));
    v11 = *((_QWORD *)this + 56);
    if ( v11 )
    {
      v12 = *((_QWORD *)this + 35);
      if ( v12 )
      {
        (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v12 + 328LL))(v12, *((_QWORD *)v1 + 56));
        v11 = *((_QWORD *)v1 + 56);
      }
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v11 + 40LL))(v11);
      *((_QWORD *)v1 + 56) = 0LL;
    }
    v13 = *((_QWORD *)v1 + 34);
    if ( v13 )
    {
      v14 = *((_QWORD *)v1 + 35);
      if ( v14 )
      {
        (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v14 + 328LL))(v14, *((_QWORD *)v1 + 34));
        v13 = *((_QWORD *)v1 + 34);
      }
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v13 + 40LL))(v13);
      *((_QWORD *)v1 + 34) = 0LL;
    }
    v15 = *((_QWORD *)v1 + 35);
    if ( v15 )
    {
      (*(void (**)(void))(*(_QWORD *)v15 + 40LL))();
      *((_QWORD *)v1 + 35) = 0LL;
    }
    v16 = *((_QWORD *)v1 + 18);
    if ( v16 && (unsigned __int8)(*(int (__fastcall **)(__int64, AppleUSBHub *))(*(_QWORD *)v16 + 1504LL))(v16, v1) )
    {
      v17 = *((_QWORD *)v1 + 18);
      *((_QWORD *)v1 + 18) = 0LL;
      v18 = 0;
      (*(void (__fastcall **)(__int64, AppleUSBHub *, _QWORD))(*(_QWORD *)v17 + 1496LL))(v17, v1, 0LL);
    }
    else
    {
      v18 = 0;
    }
    return v18;
  }
  LODWORD(v8) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)this + 1672LL))(this, 0LL);
  *((_QWORD *)this + 35) = v8;
  if ( !v8 )
  {
    v9 = (__int64)"AppleUSBHub::ConfigureHubDriver Couldn't get provider's workloop";
    goto LABEL_11;
  }
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v8 + 32LL))(v8);
  if ( (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 35) + 320LL))(
         *((_QWORD *)this + 35),
         *((_QWORD *)this + 56)) )
  {
    v9 = (__int64)"AppleUSBHub::ConfigureHubDriver Couldn't add timer event source";
LABEL_11:
    v6 = 0;
    goto LABEL_12;
  }
  if ( (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 35) + 320LL))(
         *((_QWORD *)this + 35),
         *((_QWORD *)this + 34)) )
  {
    v9 = (__int64)"AppleUSBHub::ConfigureHubDriver Couldn't add gate event source";
    goto LABEL_11;
  }
  *((_WORD *)this + 122) = (*(int (**)(void))(**((_QWORD **)this + 18) + 2248LL))();
  v6 = 0;
  if ( !(unsigned __int8)(*(int (__fastcall **)(_QWORD, AppleUSBHub *, _QWORD, _QWORD))(**((_QWORD **)this + 18) + 1488LL))(
                           *((_QWORD *)this + 18),
                           this,
                           0LL,
                           0LL) )
  {
    v9 = (__int64)"AppleUSBHub::ConfigureHubDriver unable to open provider";
    goto LABEL_12;
  }
  LODWORD(v20) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                   *((_QWORD *)this + 18),
                   "kStartupDelay");
  if ( v20 )
  {
    v21 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v20 + 328LL))(v20);
    *((_DWORD *)this + 254) = v21;
    IOSleep((unsigned int)v21);
  }
  LODWORD(v22) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                   *((_QWORD *)this + 18),
                   "kIgnoreDisconnectOnWakeup");
  v23 = *(_QWORD *)off_1A090[0];
  *((_BYTE *)this + 1040) = v22 == **(_QWORD **)off_1A090[0];
  LODWORD(v24) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                   *((_QWORD *)this + 18),
                   "kRetryBogusPortStatus");
  *((_BYTE *)this + 1041) = v24 == *(_QWORD *)v23;
  LODWORD(v25) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                   *((_QWORD *)this + 18),
                   "kAssumePortsAreCaptive");
  v26 = v25 == *(_QWORD *)v23;
  *((_BYTE *)this + 1056) = v25 == *(_QWORD *)v23;
  if ( !v26 && (unsigned __int8)IOUSBDevice::GetProtocol(*((IOUSBDevice **)this + 18)) == 3 )
    *((_BYTE *)this + 1056) = 1;
  LODWORD(v27) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                   *((_QWORD *)this + 18),
                   "ExtraPowerRequest");
  if ( v27 )
    *((_BYTE *)this + 1064) = 1;
  LODWORD(v28) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                   *((_QWORD *)this + 18),
                   "locationID");
  if ( v28 )
    *((_DWORD *)this + 74) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v28 + 328LL))(v28);
  v6 = AppleUSBHub::ConfigureHub(this);
  if ( v6 )
    goto LABEL_13;
  v6 = 0;
  (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)this + 1456LL))(this, 0LL);
  LODWORD(v29) = thread_call_allocate(AppleUSBHub::ProcessStatusChangedEntry, this);
  *((_QWORD *)this + 42) = v29;
  LODWORD(v30) = thread_call_allocate(AppleUSBHub::ResetPortZeroEntry, this);
  *((_QWORD *)this + 43) = v30;
  LODWORD(v31) = thread_call_allocate(AppleUSBHub::CheckForDeadHubEntry, this);
  *((_QWORD *)this + 44) = v31;
  LODWORD(v32) = thread_call_allocate(AppleUSBHub::ClearFeatureEndpointHaltEntry, this);
  *((_QWORD *)this + 45) = v32;
  LODWORD(v33) = thread_call_allocate(AppleUSBHub::CheckForActivePortsEntry, this);
  *((_QWORD *)this + 46) = v33;
  LODWORD(v34) = thread_call_allocate(AppleUSBHub::WaitForPortResumesEntry, this);
  *((_QWORD *)this + 47) = v34;
  LODWORD(v35) = thread_call_allocate(AppleUSBHub::EnsureUsabilityEntry, this);
  *((_QWORD *)this + 48) = v35;
  LODWORD(v36) = thread_call_allocate(AppleUSBHub::InitialDelayEntry, this);
  *((_QWORD *)this + 49) = v36;
  LODWORD(v37) = thread_call_allocate(AppleUSBHub::HubResetPortAfterPowerChangeDoneEntry, this);
  *((_QWORD *)this + 50) = v37;
  if ( !*((_QWORD *)this + 42)
    || !*((_QWORD *)this + 43)
    || !*((_QWORD *)this + 44)
    || !*((_QWORD *)this + 45)
    || !*((_QWORD *)this + 46)
    || !*((_QWORD *)this + 47)
    || !*((_QWORD *)this + 48)
    || !*((_QWORD *)this + 49)
    || !v37 )
  {
    v9 = (__int64)"AppleUSBHub::ConfigureHubDriver  could not allocate all thread functions.  Aborting ConfigureHubDriver";
    goto LABEL_12;
  }
  v38 = AppleUSBHub::GetHubErrataBits(this, v37);
  *((_DWORD *)this + 189) = v38;
  LODWORD(v39) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD, _QWORD, signed __int64))(*(_QWORD *)this + 640LL))(
                   this,
                   "Errata",
                   v38,
                   32LL);
  v18 = 1;
  if ( AppleUSBHub::IsHubDeviceInternal(this, v39) )
  {
    if ( *((_BYTE *)this + 756) & 2 )
      *((_BYTE *)this + 1079) = 1;
    LODWORD(v40) = (*(int (__fastcall **)(_QWORD))(**((_QWORD **)this + 18) + 2480LL))(*((_QWORD *)this + 18));
    v42 = OSMetaClassBase::safeMetaCast(v40, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, v41);
    if ( v42 )
    {
      v42 = AppleUSBHub::GetHubErrataBits((AppleUSBHub *)v42, v42);
      if ( v42 & 2 )
      {
        *((_BYTE *)this + 1078) = 1;
        *((_BYTE *)this + 1065) = 1;
      }
    }
    *((_BYTE *)this + 1080) = AppleUSBHub::ControllerCanMuxPortsOverToEHCI(this, v42);
  }
  return v18;
}
// 1A010: using guessed type _QWORD off_1A010[18];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A090: using guessed type __int64 off_1A090[2];
// 1A098: using guessed type __int64 off_1A098;
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);
// 2BF48: using guessed type int __fastcall IOTimerEventSource::timerEventSource(_QWORD, _QWORD);
// 2C7C0: using guessed type int __fastcall thread_call_allocate(_QWORD, _QWORD);

//----- (00000000000020D4) ----------------------------------------------------
void __fastcall AppleUSBHub::TimeoutOccurred(OSMetaClassBase *a1, __int64 a2, const OSMetaClass *a3)
{
  uintptr_t v3; // rsi@1
  __int64 v4; // r14@1
  __int64 v5; // r12@2
  __int64 v6; // rcx@6
  unsigned __int8 v7; // al@7
  unsigned int i; // er13@8
  __int64 v9; // rbx@11
  __int64 v10; // r15@11
  int v11; // eax@13
  int v12; // ecx@14
  __int64 v13; // rax@15

  v3 = (uintptr_t)&AppleUSBHub::gMetaClass;
  v4 = OSMetaClassBase::safeMetaCast(a1, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, a3);
  if ( v4 )
  {
    v5 = off_1A080[0];
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v3 = *(_DWORD *)(v4 + 296);
      kernel_debug(0x52D109Du, v3, 0LL, 0LL, 0LL, 0LL);
    }
    if ( !(unsigned __int8)IOService::isInactive((IOService *)v4) )
    {
      (*(void (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v4 + 32LL))(v4, v3);
      v6 = *(_QWORD *)(v4 + 416);
      if ( v6 )
      {
        v7 = *(_BYTE *)(v4 + 218);
        if ( v7 )
        {
          for ( i = 2; ; ++i )
          {
            if ( v6 )
            {
              v9 = i - 2;
              v10 = *(_QWORD *)(v6 + 8 * v9);
              if ( v10 )
                break;
            }
LABEL_21:
            if ( i > v7 )
              goto LABEL_22;
            v6 = *(_QWORD *)(v4 + 416);
          }
          (*(void (__fastcall **)(_QWORD))(*(_QWORD *)v10 + 32LL))(*(_QWORD *)(v6 + 8 * v9));
          if ( *(_BYTE *)(v10 + 100) )
          {
            v11 = *(_DWORD *)(v4 + 456);
            if ( _bittest((const unsigned int *)&v11, v9) )
            {
              v12 = *(_DWORD *)(v10 + 396);
              if ( *(_DWORD *)(v4 + 4 * v9 + 460) == v12 )
              {
                AppleUSBHub::IncrementOutstandingIO((AppleUSBHub *)v4, 0);
                (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v4 + 32LL))(v4, 0LL);
                LODWORD(v13) = thread_call_enter(*(_QWORD *)(v4 + 344));
                if ( (_DWORD)v13 == 1 )
                {
                  AppleUSBHub::DecrementOutstandingIO((AppleUSBHub *)v4, v13, 0);
                  (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v4 + 40LL))(v4, 0LL);
                }
                goto LABEL_20;
              }
            }
            else
            {
              v12 = *(_DWORD *)(v10 + 396);
            }
            *(_DWORD *)(v4 + 456) = (1 << (i - 2)) | v11;
            *(_DWORD *)(v4 + 4 * v9 + 460) = v12;
          }
          else
          {
            *(_DWORD *)(v4 + 456) &= ~(1 << (i - 2));
            *(_DWORD *)(v4 + 4 * v9 + 460) = 0;
          }
LABEL_20:
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v10 + 40LL))(v10);
          v7 = *(_BYTE *)(v4 + 218);
          goto LABEL_21;
        }
      }
LABEL_22:
      if ( *(_QWORD *)(v4 + 448) && !(unsigned __int8)IOService::isInactive((IOService *)v4) )
        (*(void (__fastcall **)(_QWORD, signed __int64))(**(_QWORD **)(v4 + 448) + 464LL))(
          *(_QWORD *)(v4 + 448),
          30000LL);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v4 + 40LL))(v4);
      if ( *(_BYTE *)v5 & 2 )
      {
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D109Eu, *(_DWORD *)(v4 + 296), 0LL, 0LL, 0LL, 0LL);
      }
    }
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (00000000000022DE) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::ConfigureHub(AppleUSBHub *this)
{
  AppleUSBHub *v1; // r14@1
  __int64 v2; // r8@4
  signed int v3; // er13@5
  uintptr_t v4; // rax@8
  __int64 v5; // r8@8
  uintptr_t v6; // r15@8
  uintptr_t v7; // rax@12
  int v8; // ebx@16
  uintptr_t v9; // rsi@21
  uintptr_t v10; // rdx@21
  uintptr_t v11; // r8@21
  __int64 v12; // rax@28
  __int64 v13; // rax@28
  OSMetaClassBase *v14; // rax@37
  const OSMetaClass *v15; // rdx@37
  __int64 v16; // rax@37
  unsigned int v17; // eax@39
  __int64 v18; // r8@39
  __int64 v19; // rcx@39
  uintptr_t v20; // rsi@40
  __int64 v22; // rax@55
  signed int v23; // ecx@57
  char v24; // al@57
  __int64 v25; // rax@70
  __int64 v26; // rax@71
  __int64 v27; // rax@71
  __int64 v28; // rax@71
  __int64 v29; // rax@72
  __int64 v30; // r8@72
  __int64 v31; // r8@76
  __int64 v32; // r8@77
  unsigned __int8 v33; // al@77
  unsigned __int8 v34; // cl@77
  unsigned __int8 v35; // al@77
  bool v36; // cl@78
  int v37; // ebx@85
  unsigned int v38; // er13@98
  __int64 v39; // r8@98
  int v40; // eax@101
  unsigned int v41; // ebx@102
  unsigned __int8 v42; // al@102
  uintptr_t v43; // rbx@103
  unsigned __int8 v44; // al@103
  uintptr_t v45; // rdx@104
  uintptr_t v46; // r8@104
  uintptr_t v47; // rsi@104
  int v48; // er13@108
  int v49; // er15@108
  int v50; // er12@119
  __int64 v51; // rdi@123
  __int64 v52; // rax@123
  __int64 v53; // rsi@123
  __int64 v54; // rdx@123
  __int64 v55; // rax@128
  __int64 v56; // r8@128
  signed __int64 v57; // rdx@142
  __int64 v58; // rsi@142
  unsigned int v59; // ecx@146
  int v60; // eax@147
  unsigned __int8 v61; // dl@147
  int v62; // ebx@148
  char v63; // [sp+0h] [bp-50h]@128
  char v64; // [sp+1h] [bp-4Fh]@128
  __int64 v65; // [sp+8h] [bp-48h]@72
  char v66; // [sp+10h] [bp-40h]@60
  char v67; // [sp+11h] [bp-3Fh]@60
  __int16 v68; // [sp+12h] [bp-3Eh]@60
  __int16 v69; // [sp+14h] [bp-3Ch]@60
  __int16 v70; // [sp+16h] [bp-3Ah]@60
  __int64 v71; // [sp+18h] [bp-38h]@60

  v1 = this;
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1019u, *((_DWORD *)this + 74), 0LL, 0LL, 0LL, 0LL);
  *((_BYTE *)this + 314) = 0;
  *((_DWORD *)this + 82) = 0;
  *((_BYTE *)this + 409) = 0;
  *((_DWORD *)this + 77) = 3;
  if ( !(unsigned __int8)(*(int (**)(void))(**((_QWORD **)this + 18) + 2312LL))() )
  {
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "AppleUSBHub::ConfigureHub(hub @ 0x%x) No hub configurations",
      *((_DWORD *)this + 74),
      v2);
    v8 = -536870210;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v9 = *((_DWORD *)this + 74);
      v10 = 0LL;
      v11 = 0LL;
LABEL_22:
      kernel_debug(0x52D1018u, v9, v10, 0LL, v11, 0LL);
    }
    goto LABEL_50;
  }
  v3 = 4;
  while ( 1 )
  {
    if ( v3 <= 3 )
      IOSleep(100LL);
    LODWORD(v4) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 2216LL))(
                    *((_QWORD *)this + 18),
                    0LL);
    v6 = v4;
    if ( !v4 )
    {
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "AppleUSBHub::ConfigureHub(hub @ 0x%x) No config descriptor, retrying",
        *((_DWORD *)this + 74),
        v5);
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1018u, *((_DWORD *)this + 74), 0LL, 0LL, 1uLL, 0LL);
      IOSleep(300LL);
      LODWORD(v7) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 2216LL))(
                      *((_QWORD *)this + 18),
                      0LL);
      v6 = v7;
      if ( !v7 )
      {
        v17 = *((_DWORD *)this + 186);
        v18 = v17 + 1;
        *((_DWORD *)this + 186) = v18;
        v19 = *((_DWORD *)this + 74);
        if ( v17 > 5 )
        {
          v6 = 0LL;
          KernelDebugLogInternal(
            1LL,
            1431519814LL,
            "AppleUSBHub::ConfigureHub(hub @ 0x%x) No config descriptor, after retry, and resetting 5 times",
            v19,
            v18);
          v8 = -536854442;
          if ( *(_BYTE *)off_1A080[0] & 2 )
          {
            v6 = 0LL;
            if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            {
              v6 = 0LL;
              kernel_debug(0x52D1018u, *((_DWORD *)this + 74), *((_DWORD *)this + 186), 0LL, 0x3E7uLL, 0LL);
            }
          }
        }
        else
        {
          v8 = 0;
          v20 = 1431519814LL;
          KernelDebugLogInternal(
            1LL,
            1431519814LL,
            "AppleUSBHub::ConfigureHub(hub @ 0x%x) No config descriptor, after retry, resetting the port (%d)",
            v19,
            v18);
          if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v20 = *((_DWORD *)this + 74);
            kernel_debug(0x52D1018u, v20, *((_DWORD *)this + 186), 0LL, 2uLL, 0LL);
          }
          (*(void (__fastcall **)(AppleUSBHub *, uintptr_t))(*(_QWORD *)this + 32LL))(this, v20);
          AppleUSBHub::ResetMyPort(this);
          (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 40LL))(this);
          v6 = 0LL;
        }
        goto LABEL_47;
      }
    }
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1018u, *((_DWORD *)this + 74), *(_BYTE *)(v6 + 5), 0LL, 3uLL, 0LL);
    v8 = (*(int (__fastcall **)(_QWORD, AppleUSBHub *, _QWORD, _QWORD))(**((_QWORD **)this + 18) + 2240LL))(
           *((_QWORD *)this + 18),
           this,
           *(_BYTE *)(v6 + 5),
           0LL);
    if ( v8 != -536854449 )
      break;
    --v3;
    v8 = -536854449;
    if ( v3 <= 0 )
      goto LABEL_47;
  }
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1018u, *((_DWORD *)this + 74), v8, 0LL, 4uLL, 0LL);
  if ( !v6 || v8 )
  {
LABEL_47:
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1018u, *((_DWORD *)this + 74), v6, v8, 5uLL, 0LL);
    goto LABEL_50;
  }
  LODWORD(v12) = (*(int (**)(void))(**((_QWORD **)this + 18) + 2264LL))();
  v13 = *(_QWORD *)(v12 + 168);
  if ( v13 )
  {
    v13 = *(_BYTE *)(v13 + 40);
    if ( (_DWORD)v13 == 3 )
      *((_BYTE *)this + 427) = 1;
  }
  if ( !*((_BYTE *)this + 160) && !AppleUSBHub::IsHubDeviceInternal(this, v13) && *((_BYTE *)this + 427) )
  {
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1018u, *((_DWORD *)this + 74), 0LL, 0LL, 6uLL, 0LL);
    LODWORD(v14) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                     *((_QWORD *)this + 18),
                     "kOverrideAllowLowPower");
    OSMetaClassBase::safeMetaCast(v14, *(const OSMetaClassBase **)off_1A048[0], v15);
    LODWORD(v16) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                     *((_QWORD *)this + 18),
                     "kOverrideAllowLowPower");
    *((_BYTE *)this + 162) = v16 != **(_QWORD **)off_1A090[0];
  }
  v22 = (unsigned __int8)IOUSBDevice::GetProtocol(*((IOUSBDevice **)this + 18));
  if ( (unsigned __int8)v22 == 3 )
  {
    *((_BYTE *)this + 426) = 1;
    if ( !*((_BYTE *)this + 160) )
    {
      v23 = 20;
      v24 = 0;
      do
      {
        if ( !(*((_DWORD *)this + 74) & 0xFEFFFFFF & (15 << v23)) )
          break;
        ++v24;
        v23 -= 4;
      }
      while ( v23 >= 0 );
      v66 = 32;
      v67 = 12;
      v68 = (unsigned __int8)(v24 - 1);
      v69 = 0;
      v70 = 0;
      v71 = 0LL;
      v22 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v66, 0);
      v8 = v22;
      if ( (_DWORD)v22 )
      {
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v10 = (signed int)v22;
          v9 = *((_DWORD *)this + 74);
          v11 = 7LL;
          goto LABEL_22;
        }
        goto LABEL_50;
      }
    }
  }
  if ( *(_BYTE *)(v6 + 7) & 0x20 )
  {
    if ( !*((_BYTE *)this + 426) )
    {
      LODWORD(v22) = (*(int (__fastcall **)(_QWORD, signed __int64))(**((_QWORD **)this + 18) + 2144LL))(
                       *((_QWORD *)this + 18),
                       1LL);
      if ( (_DWORD)v22 )
      {
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D1018u, *((_DWORD *)this + 74), (signed int)v22, 0LL, 8uLL, 0LL);
      }
    }
  }
  *((_BYTE *)this + 1057) = AppleUSBHub::HasExpressCardPort(this, v22);
  LODWORD(v25) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                   *((_QWORD *)this + 18),
                   "ExpressCardCantWake");
  if ( v25 == **(_QWORD **)off_1A090[0] )
  {
    LODWORD(v26) = (*(int (**)(void))(**((_QWORD **)this + 18) + 2264LL))();
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v26 + 32LL))(v26);
    LODWORD(v27) = (*(int (**)(void))(**((_QWORD **)this + 18) + 2264LL))();
    (*(void (__fastcall **)(__int64, signed __int64, AppleUSBHub *, _QWORD))(*(_QWORD *)v27 + 1840LL))(
      v27,
      3758112784LL,
      this,
      *((_QWORD *)this + 18));
    LODWORD(v28) = (*(int (**)(void))(**((_QWORD **)this + 18) + 2264LL))();
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v28 + 40LL))(v28);
  }
  v65 = -65527LL;
  LODWORD(v29) = (*(int (__fastcall **)(_QWORD, _QWORD, __int64 *))(**((_QWORD **)this + 18) + 2200LL))(
                   *((_QWORD *)this + 18),
                   0LL,
                   &v65);
  *((_QWORD *)this + 25) = v29;
  if ( v29 )
    goto LABEL_156;
  KernelDebugLogInternal(
    1LL,
    1431519814LL,
    "AppleUSBHub::ConfigureHub(hub @ 0x%x)  no interface found, trying again",
    *((_DWORD *)this + 74),
    v30);
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1018u, *((_DWORD *)this + 74), 0LL, 0LL, 9uLL, 0LL);
  IOSleep(100LL);
  v65 = -65527LL;
  LODWORD(v29) = (*(int (__fastcall **)(_QWORD, _QWORD, __int64 *))(**((_QWORD **)this + 18) + 2200LL))(
                   *((_QWORD *)this + 18),
                   0LL,
                   &v65);
  *((_QWORD *)this + 25) = v29;
  if ( v29 )
  {
LABEL_156:
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v29 + 32LL))(v29);
    v33 = *(_BYTE *)(v6 + 7);
    v34 = *(_BYTE *)(v6 + 7) >> 7;
    *((_BYTE *)this + 312) = v34;
    v35 = (v33 >> 6) & 1;
    *((_BYTE *)this + 313) = v35;
    if ( v34 | v35 )
    {
      v8 = AppleUSBHub::GetHubDescriptor(this, (__int64)((char *)this + 216));
      if ( v8 )
      {
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBHub::ConfigureHub(hub @ 0x%x)  could not get hub descriptor (0x%x)",
          *((_DWORD *)this + 74),
          (unsigned int)v8);
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v10 = v8;
          v9 = *((_DWORD *)this + 74);
          v11 = 12LL;
          goto LABEL_22;
        }
        goto LABEL_50;
      }
      v37 = *((_BYTE *)this + 218);
      if ( (_BYTE)v37 )
      {
LABEL_89:
        if ( (unsigned __int8)v37 >= 0x41u )
        {
          if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(0x52D1018u, *((_DWORD *)this + 74), (unsigned __int8)v37, 0LL, 0xEuLL, 0LL);
          *((_BYTE *)this + 218) = 64;
          LOBYTE(v37) = 64;
        }
      }
      else
      {
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          kernel_debug(0x52D1018u, *((_DWORD *)this + 74), 0LL, 0LL, 0xDuLL, 0LL);
          LOBYTE(v37) = *((_BYTE *)this + 218);
          goto LABEL_89;
        }
        LOBYTE(v37) = 0;
      }
      *((_BYTE *)this + 408) = ((unsigned __int8)v37 >> 3) + 1;
      v38 = *(_WORD *)((char *)this + 219);
      *((_QWORD *)this + 33) = IOBufferMemoryDescriptor::withCapacity(
                                 (IOBufferMemoryDescriptor *)(unsigned __int8)(((unsigned __int8)v37 >> 3) + 1),
                                 1uLL,
                                 0,
                                 v36);
      if ( (unsigned __int8)(*(int (__fastcall **)(_QWORD, AppleUSBHub *, _QWORD, _QWORD))(**((_QWORD **)this + 25)
                                                                                         + 1488LL))(
                              *((_QWORD *)this + 25),
                              this,
                              0LL,
                              0LL) )
      {
        *((_WORD *)this + 212) = 0;
        if ( (unsigned __int16)IOUSBDevice::GetbcdUSB(*((IOUSBDevice **)this + 18)) >= 0x200u && *((_QWORD *)this + 17) )
        {
          v40 = (unsigned __int8)IOUSBDevice::GetProtocol(*((IOUSBDevice **)this + 18));
          if ( (unsigned __int8)v40 <= 3u )
          {
            v48 = 16 * (unsigned __int8)v37 | (v38 >> 3) & 0xC;
            v49 = v48 + 2;
            switch ( v40 )
            {
              case 0:
                if ( !(*(_BYTE *)off_1A080[0] & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
                  goto LABEL_128;
                v47 = *((_DWORD *)this + 74);
                v45 = 0LL;
                v46 = 16LL;
                break;
              case 1:
                if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                  kernel_debug(0x52D1018u, *((_DWORD *)this + 74), 0LL, 0LL, 0x11uLL, 0LL);
                (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 17) + 2688LL))(
                  *((_QWORD *)this + 17),
                  *((_WORD *)this + 122),
                  (unsigned int)v49);
                *((_BYTE *)this + 425) = 1;
                goto LABEL_128;
              case 2:
                if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                  kernel_debug(0x52D1018u, *((_DWORD *)this + 74), 0LL, 0LL, 0x12uLL, 0LL);
                *((_BYTE *)this + 425) = 1;
                v50 = (*(int (__fastcall **)(_QWORD, AppleUSBHub *, signed __int64))(**((_QWORD **)this + 25) + 2192LL))(
                        *((_QWORD *)this + 25),
                        this,
                        1LL);
                if ( v50 )
                {
                  KernelDebugLogInternal(
                    1LL,
                    1431519814LL,
                    "AppleUSBHub::ConfigureHub(hub @ 0x%x) - err (%x) setting alt interface",
                    *((_DWORD *)this + 74),
                    (unsigned int)v50);
                  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                    kernel_debug(0x52D1018u, *((_DWORD *)this + 74), v50, 0LL, 0x13uLL, 0LL);
                  v51 = *((_QWORD *)this + 17);
                  v52 = *(_QWORD *)v51;
                  v53 = *((_WORD *)v1 + 122);
                  v54 = (unsigned int)v49;
                }
                else
                {
                  v51 = *((_QWORD *)this + 17);
                  v52 = *(_QWORD *)v51;
                  v53 = *((_WORD *)v1 + 122);
                  v54 = v48 | 3u;
                }
                (*(void (__fastcall **)(__int64, __int64, __int64))(v52 + 2688))(v51, v53, v54);
                *((_BYTE *)v1 + 424) = 1;
                goto LABEL_128;
              case 3:
                if ( !(*(_BYTE *)off_1A080[0] & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
                  goto LABEL_128;
                v47 = *((_DWORD *)this + 74);
                v45 = 0LL;
                v46 = 20LL;
                break;
              default:
                goto LABEL_102;
            }
LABEL_127:
            kernel_debug(0x52D1018u, v47, v45, 0LL, v46, 0LL);
          }
          else
          {
LABEL_102:
            v41 = *((_DWORD *)this + 74);
            v42 = IOUSBDevice::GetProtocol(*((IOUSBDevice **)this + 18));
            KernelDebugLogInternal(
              1LL,
              1431519814LL,
              "AppleUSBHub::ConfigureHub(hub @ 0x%x) - unknown protocol (%d)",
              v41,
              v42);
            if ( *(_BYTE *)off_1A080[0] & 2 )
            {
              v43 = *((_DWORD *)this + 74);
              v44 = IOUSBDevice::GetProtocol(*((IOUSBDevice **)this + 18));
              if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              {
                v45 = v44;
                v46 = 21LL;
                v47 = v43;
                goto LABEL_127;
              }
            }
          }
        }
LABEL_128:
        v63 = 3;
        v64 = 1;
        LODWORD(v55) = (*(int (__fastcall **)(_QWORD, _QWORD, char *))(**((_QWORD **)v1 + 25) + 2176LL))(
                         *((_QWORD *)v1 + 25),
                         0LL,
                         &v63);
        *((_QWORD *)v1 + 32) = v55;
        if ( v55 )
        {
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v55 + 32LL))(v55);
          AppleUSBHub::UnpackPortFlags(v1);
          AppleUSBHub::CountCaptivePorts(v1);
          v8 = AppleUSBHub::CheckPortPowerRequirements(v1);
          if ( v8 )
          {
            KernelDebugLogInternal(
              1LL,
              1431519814LL,
              "AppleUSBHub::ConfigureHub(hub @ 0x%x)  CheckPortPowerRequirements failed with 0x%x",
              *((_DWORD *)v1 + 74),
              (unsigned int)v8);
            if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            {
              v10 = v8;
              v9 = *((_DWORD *)v1 + 74);
              v11 = 24LL;
              goto LABEL_22;
            }
          }
          else
          {
            v8 = AppleUSBHub::AllocatePortMemory(v1, 0LL);
            if ( v8 )
            {
              KernelDebugLogInternal(
                1LL,
                1431519814LL,
                "AppleUSBHub::ConfigureHub(hub @ 0x%x)  AllocatePortMemory failed with 0x%x",
                (unsigned int)v8,
                *((_DWORD *)v1 + 74));
              if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              {
                v10 = v8;
                v9 = *((_DWORD *)v1 + 74);
                v11 = 25LL;
                goto LABEL_22;
              }
            }
            else
            {
              if ( *((_BYTE *)v1 + 425) )
              {
                if ( *((_BYTE *)v1 + 424) )
                {
                  v57 = *((_BYTE *)v1 + 218);
                  v58 = (__int64)"High Speed";
                }
                else
                {
                  v58 = (__int64)"High Speed";
                  v57 = 1LL;
                }
                (*(void (__fastcall **)(AppleUSBHub *, __int64, signed __int64, signed __int64))(*(_QWORD *)v1 + 640LL))(
                  v1,
                  v58,
                  v57,
                  8LL);
              }
              if ( *((_BYTE *)v1 + 426) )
              {
                v59 = *((_BYTE *)v1 + 218);
                if ( *((_BYTE *)v1 + 218) )
                {
                  v60 = 0;
                  v61 = *((_BYTE *)v1 + 218);
                  do
                  {
                    v62 = v60 + 1;
                    if ( (unsigned __int16)(v60 + 1) <= v59 )
                    {
                      AppleUSBHub::SetPortFeature(v1, 27, v60 + 769);
                      v61 = *((_BYTE *)v1 + 218);
                    }
                    v59 = v61;
                    v60 = v62;
                  }
                  while ( v62 < v61 );
                }
              }
              (*(void (__fastcall **)(AppleUSBHub *, _QWORD, _QWORD))(*(_QWORD *)v1 + 624LL))(
                v1,
                "IOUserClientClass",
                "AppleUSBHSHubUserClient");
              *((_BYTE *)v1 + 306) = 0;
              v8 = 0;
            }
          }
        }
        else
        {
          KernelDebugLogInternal(
            1LL,
            1431519814LL,
            "AppleUSBHub::ConfigureHub(hub @ 0x%x)  could not find interrupt pipe",
            *((_DWORD *)v1 + 74),
            v56);
          v8 = -536854434;
          if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v9 = *((_DWORD *)v1 + 74);
            v10 = 0LL;
            v11 = 22LL;
            goto LABEL_22;
          }
        }
      }
      else
      {
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          " AppleUSBHub::ConfigureHub(hub @ 0x%x)  could not open hub interface",
          *((_DWORD *)this + 74),
          v39);
        v8 = -536870195;
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v9 = *((_DWORD *)this + 74);
          v10 = 0LL;
          v11 = 15LL;
          goto LABEL_22;
        }
      }
    }
    else
    {
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "AppleUSBHub::ConfigureHub(hub @ 0x%x)  illegal device config - no power",
        *((_DWORD *)this + 74),
        v32);
      v8 = -536870173;
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v10 = *(_BYTE *)(v6 + 7);
        v9 = *((_DWORD *)this + 74);
        v11 = 11LL;
        goto LABEL_22;
      }
    }
  }
  else
  {
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "AppleUSBHub::ConfigureHub(hub @ 0x%x)  no interface found",
      *((_DWORD *)this + 74),
      v31);
    v8 = -536854450;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v9 = *((_DWORD *)this + 74);
      v10 = 0LL;
      v11 = 10LL;
      goto LABEL_22;
    }
  }
LABEL_50:
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D101Au, *((_DWORD *)v1 + 74), v8, 0LL, 0LL, 0LL);
  return (unsigned int)v8;
}
// 1A048: using guessed type _QWORD off_1A048[11];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A090: using guessed type __int64 off_1A090[2];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000321C) ----------------------------------------------------
int __fastcall AppleUSBHub::ProcessStatusChangedEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3)
{
  AppleUSBHub *v3; // rax@1
  AppleUSBHub *v4; // rbx@1
  __int64 v5; // rax@2

  v3 = (AppleUSBHub *)OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, a3);
  v4 = v3;
  if ( v3 )
  {
    AppleUSBHub::ProcessStatusChanged(v3);
    AppleUSBHub::DecrementOutstandingIO(v4, v5, 0);
    LODWORD(v3) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v4 + 40LL))(v4, 0LL);
  }
  return (signed int)v3;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000325E) ----------------------------------------------------
int __fastcall AppleUSBHub::ResetPortZeroEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3)
{
  AppleUSBHub *v3; // rax@1
  AppleUSBHub *v4; // rbx@1
  __int64 v5; // rax@2

  v3 = (AppleUSBHub *)OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, a3);
  v4 = v3;
  if ( v3 )
  {
    LOBYTE(v5) = AppleUSBHub::ResetPortZero(v3);
    AppleUSBHub::DecrementOutstandingIO(v4, v5, 0);
    LODWORD(v3) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v4 + 40LL))(v4, 0LL);
  }
  return (signed int)v3;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (00000000000032A0) ----------------------------------------------------
int __fastcall AppleUSBHub::CheckForDeadHubEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3)
{
  AppleUSBHub *v3; // rax@1
  AppleUSBHub *v4; // rbx@1
  __int64 v5; // rax@2

  v3 = (AppleUSBHub *)OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, a3);
  v4 = v3;
  if ( v3 )
  {
    AppleUSBHub::CheckForDeadHub(v3);
    AppleUSBHub::DecrementOutstandingIO(v4, v5, 0);
    LODWORD(v3) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v4 + 40LL))(v4, 0LL);
  }
  return (signed int)v3;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (00000000000032E2) ----------------------------------------------------
int __fastcall AppleUSBHub::ClearFeatureEndpointHaltEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3)
{
  AppleUSBHub *v3; // rax@1
  AppleUSBHub *v4; // rbx@1
  __int64 v5; // rax@2

  v3 = (AppleUSBHub *)OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, a3);
  v4 = v3;
  if ( v3 )
  {
    AppleUSBHub::ClearFeatureEndpointHalt(v3);
    AppleUSBHub::DecrementOutstandingIO(v4, v5, 0);
    LODWORD(v3) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v4 + 40LL))(v4, 0LL);
  }
  return (signed int)v3;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (0000000000003324) ----------------------------------------------------
int __fastcall AppleUSBHub::CheckForActivePortsEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3)
{
  __int64 v3; // rax@1
  __int64 v4; // rbx@1

  v3 = OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, a3);
  v4 = v3;
  if ( v3 )
  {
    AppleUSBHub::CheckForActivePorts((AppleUSBHub *)v3, v3);
    *(_BYTE *)(v4 + 429) = 0;
    LODWORD(v3) = (*(int (__fastcall **)(__int64, _QWORD *))(*(_QWORD *)v4 + 40LL))(v4, &AppleUSBHub::gMetaClass);
  }
  return v3;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (0000000000003364) ----------------------------------------------------
int __fastcall AppleUSBHub::WaitForPortResumesEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3)
{
  AppleUSBHub *v3; // rax@1
  AppleUSBHub *v4; // rbx@1
  __int64 v5; // rax@2

  v3 = (AppleUSBHub *)OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, a3);
  v4 = v3;
  if ( v3 )
  {
    v5 = AppleUSBHub::WaitForPortResumes(v3);
    AppleUSBHub::DecrementOutstandingIO(v4, v5, 0);
    LODWORD(v3) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v4 + 40LL))(v4, 0LL);
  }
  return (signed int)v3;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (00000000000033A6) ----------------------------------------------------
int __fastcall AppleUSBHub::EnsureUsabilityEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3)
{
  AppleUSBHub *v3; // rax@1
  AppleUSBHub *v4; // rbx@1
  __int64 v5; // rax@2

  v3 = (AppleUSBHub *)OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, a3);
  v4 = v3;
  if ( v3 )
  {
    LODWORD(v5) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD *))(*(_QWORD *)v3 + 2128LL))(
                    v3,
                    &AppleUSBHub::gMetaClass);
    AppleUSBHub::DecrementOutstandingIO(v4, v5, 0);
    LODWORD(v3) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v4 + 40LL))(v4, 0LL);
  }
  return (signed int)v3;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (00000000000033EC) ----------------------------------------------------
int __fastcall AppleUSBHub::InitialDelayEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3)
{
  AppleUSBHub *v3; // rax@1
  AppleUSBHub *v4; // rbx@1

  v3 = (AppleUSBHub *)OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, a3);
  v4 = v3;
  if ( v3 )
  {
    AppleUSBHub::InitialDelay(v3);
    LODWORD(v3) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD *))(*(_QWORD *)v4 + 40LL))(v4, &AppleUSBHub::gMetaClass);
  }
  return (signed int)v3;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (0000000000003424) ----------------------------------------------------
int __fastcall AppleUSBHub::HubResetPortAfterPowerChangeDoneEntry(AppleUSBHub *this, OSObject *a2, const OSMetaClass *a3)
{
  AppleUSBHub *v3; // rax@1
  AppleUSBHub *v4; // rbx@1

  v3 = (AppleUSBHub *)OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, a3);
  v4 = v3;
  if ( v3 )
  {
    AppleUSBHub::HubResetPortAfterPowerChangeDone(v3);
    LODWORD(v3) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD *))(*(_QWORD *)v4 + 40LL))(v4, &AppleUSBHub::gMetaClass);
  }
  return (signed int)v3;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000345C) ----------------------------------------------------
__int64 __usercall AppleUSBHub::GetHubErrataBits@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  AppleUSBHub *v2; // r14@1
  unsigned __int16 v3; // r15@1
  unsigned __int16 v4; // r12@1
  __int64 v5; // rax@1
  unsigned int v6; // er13@1
  signed __int64 v7; // rcx@1
  __int64 v9; // [sp-4h] [bp-30h]@1

  v9 = a2;
  v2 = this;
  v3 = (*(int (__cdecl **)(_QWORD))(**((_QWORD **)this + 18) + 2288LL))(*((_QWORD *)this + 18));
  v4 = (*(int (__cdecl **)(_QWORD))(**((_QWORD **)v2 + 18) + 2296LL))(*((_QWORD *)v2 + 18));
  LODWORD(v5) = (*(int (__cdecl **)(_QWORD))(**((_QWORD **)v2 + 18) + 2304LL))(*((_QWORD *)v2 + 18));
  v6 = 0;
  v7 = 8LL;
  do
  {
    if ( v3 == *(_WORD *)((char *)&errataList + v7 - 8)
      && v4 == *(_WORD *)((char *)&errataList + v7 - 6)
      && (unsigned __int16)v5 >= (unsigned int)*(_WORD *)((char *)&errataList + v7 - 4)
      && (unsigned __int16)v5 <= (unsigned int)*(_WORD *)((char *)&errataList + v7 - 2) )
      v6 |= *(_DWORD *)((char *)&errataList + v7);
    v7 += 12LL;
  }
  while ( (_DWORD)v7 != 32 );
  HIDWORD(v9) = 0;
  if ( AppleUSBHub::GetInternalHubErrataBits(this, (unsigned int *)&v9 + 1, v5) )
    v6 |= HIDWORD(v9);
  return v6;
}
// 19EB0: using guessed type _QWORD errataList;

//----- (000000000000351E) ----------------------------------------------------
bool __usercall AppleUSBHub::IsHubDeviceInternal@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  bool result; // al@2
  __int64 v3; // [sp-4h] [bp-10h]@1

  v3 = a2;
  HIDWORD(v3) = 0;
  if ( *((_BYTE *)this + 1067) )
  {
    result = *((_BYTE *)this + 1066) != 0;
  }
  else if ( (*(int (__fastcall **)(_QWORD, char *))(**((_QWORD **)this + 18) + 2488LL))(
              *((_QWORD *)this + 18),
              (char *)&v3 + 4) )
  {
    result = 0;
  }
  else
  {
    if ( (WORD2(v3) & 0x2004) == 4 )
    {
      *((_BYTE *)this + 1066) = 1;
      result = 1;
    }
    else
    {
      result = *((_BYTE *)this + 1066) != 0;
    }
    *((_BYTE *)this + 1067) = 1;
  }
  return result;
}

//----- (0000000000003590) ----------------------------------------------------
__int64 __usercall AppleUSBHub::ControllerCanMuxPortsOverToEHCI@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  __int64 v2; // r14@2
  __int64 v3; // rax@2
  IORegistryEntry *v4; // rax@3
  const OSMetaClass *v5; // rdx@3
  IORegistryEntry *v6; // r14@3
  IOUSBControllerV3 *v7; // rax@5
  __int64 result; // rax@6

  if ( AppleUSBHub::IsHubDeviceInternal(this, a2)
    && (v2 = off_1A078[0],
        LODWORD(v3) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 792LL))(
                        *((_QWORD *)this + 18),
                        *(_QWORD *)off_1A078[0]),
        v3)
    && (LODWORD(v4) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v3 + 792LL))(v3, *(_QWORD *)v2),
        (v6 = v4) != 0LL)
    && *((_QWORD *)this + 18)
    && (v7 = (IOUSBControllerV3 *)OSMetaClassBase::safeMetaCast(
                                    *((OSMetaClassBase **)this + 17),
                                    *(const OSMetaClassBase **)off_1A020[0],
                                    v5)) != 0LL )
    result = IOUSBControllerV3::CanControllerMuxOverToEHCI(v7, v6, *((_DWORD *)this + 74));
  else
    result = 0LL;
  return result;
}
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A078: using guessed type __int64 off_1A078[5];
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (0000000000003618) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::StopPorts(AppleUSBHub *this)
{
  AppleUSBHub *v1; // r14@1
  uintptr_t v2; // r15@2
  uintptr_t v3; // rbx@2
  unsigned __int8 v4; // al@2
  __int64 v5; // rdi@4
  __int64 v6; // r15@6
  unsigned __int8 v7; // al@7
  __int64 v8; // r13@8
  __int64 v9; // rbx@9
  __int64 v10; // r12@10
  int v11; // eax@13
  int v12; // esi@22
  uintptr_t v13; // rbx@25
  unsigned __int8 v14; // al@25
  uintptr_t arg1; // [sp+0h] [bp-30h]@13

  v1 = this;
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    v2 = *((_DWORD *)this + 74);
    v3 = *((_BYTE *)this + 218);
    v4 = IOService::isInactive(this);
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10B9u, v2, v3, v4, 0LL, 0LL);
  }
  v5 = *((_QWORD *)this + 32);
  if ( v5 )
  {
    *((_BYTE *)v1 + 307) = 1;
    *((_BYTE *)v1 + 318) = 0;
    (*(void (__cdecl **)(__int64))(*(_QWORD *)v5 + 296LL))(v5);
  }
  v6 = *((_QWORD *)v1 + 52);
  if ( v6 )
  {
    *((_QWORD *)v1 + 52) = 0LL;
    v7 = *((_BYTE *)v1 + 218);
    if ( v7 )
    {
      v8 = 0LL;
      do
      {
        v9 = *(_QWORD *)(v6 + 8 * v8);
        if ( v9 )
        {
          v10 = *(_QWORD *)(v9 + 88);
          *(_QWORD *)(v6 + 8 * v8) = 0LL;
          if ( v10 )
          {
            if ( (*(int (__fastcall **)(__int64))(*(_QWORD *)v10 + 304LL))(v10) )
            {
              if ( *(_BYTE *)off_1A080[0] & 2 )
              {
                arg1 = *((_DWORD *)v1 + 74);
                v11 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v10 + 304LL))(v10);
                if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                  kernel_debug(0x52D10B8u, arg1, v8 + 1, (unsigned int)v11, 0LL, 0LL);
              }
              (*(void (__fastcall **)(__int64))(*(_QWORD *)v10 + 344LL))(v10);
            }
            (*(void (__fastcall **)(__int64))(*(_QWORD *)v10 + 40LL))(v10);
          }
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v9 + 320LL))(v9);
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v9 + 40LL))(v9);
          v7 = *((_BYTE *)v1 + 218);
        }
        ++v8;
      }
      while ( (signed int)v8 < v7 );
    }
    else
    {
      v7 = 0;
    }
    IOFree(v6, 8LL * v7);
  }
  v12 = *((_DWORD *)v1 + 187);
  if ( v12 )
  {
    IOUSBHubDevice::UpdateUnconnectedExternalPorts(*((IOUSBHubDevice **)v1 + 18), v12 + 2000);
    *((_DWORD *)v1 + 187) = 0;
  }
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    v13 = *((_DWORD *)v1 + 74);
    v14 = IOService::isInactive(v1);
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10BAu, v13, v14, 0LL, 0LL, 0LL);
  }
  return 0LL;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BA80: using guessed type int __fastcall IOFree(_QWORD, _QWORD);

//----- (0000000000003812) ----------------------------------------------------
void __fastcall AppleUSBHub::stop(AppleUSBHub *this, IOService *a2)
{
  AppleUSBHub *v2; // r15@1
  __int64 v3; // r12@1
  __int64 v4; // rdi@4
  __int64 v5; // rdi@7
  uintptr_t v6; // rbx@11
  __int64 v7; // r13@11
  __int64 v8; // rdi@17
  __int64 v9; // rdi@20
  __int64 v10; // rdi@22
  __int64 v11; // rdi@24
  __int64 v12; // rdi@26
  __int64 v13; // rdi@28
  __int64 v14; // rdi@30
  __int64 v15; // rdi@32
  __int64 v16; // rdi@34
  __int64 v17; // rdi@36
  __int64 v18; // rdi@38
  __int64 v19; // rdi@39

  v2 = this;
  v3 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D10A5u, *((_DWORD *)this + 74), (uintptr_t)a2, 0LL, 0LL, 0LL);
  v4 = *((_QWORD *)this + 33);
  if ( v4 )
  {
    (*(void (__cdecl **)(__int64))(*(_QWORD *)v4 + 40LL))(v4);
    *((_QWORD *)v2 + 33) = 0LL;
  }
  if ( *((_BYTE *)v2 + 425) )
  {
    v5 = *((_QWORD *)v2 + 17);
    if ( v5 )
      (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v5 + 2704LL))(v5, *((_WORD *)v2 + 122));
  }
  if ( *((_QWORD *)v2 + 25) )
  {
    if ( *((_BYTE *)v2 + 429) )
    {
      v6 = 499LL;
      v7 = off_1A098;
      do
      {
        if ( *(_BYTE *)v3 & 2 && *(_DWORD *)v7 & 0xFFFFFFF7 )
          kernel_debug(0x52D10A4u, *((_DWORD *)v2 + 74), v6, 0LL, 0LL, 0LL);
        IOSleep(10LL);
        if ( !*((_BYTE *)v2 + 429) )
          break;
        --v6;
      }
      while ( (signed int)v6 > 0 );
    }
    v8 = *((_QWORD *)v2 + 32);
    if ( v8 )
    {
      (*(void (__cdecl **)(__int64))(*(_QWORD *)v8 + 40LL))(v8);
      *((_QWORD *)v2 + 32) = 0LL;
    }
    (*(void (__fastcall **)(_QWORD, AppleUSBHub *, _QWORD))(**((_QWORD **)v2 + 25) + 1496LL))(
      *((_QWORD *)v2 + 25),
      v2,
      0LL);
    (*(void (__cdecl **)(_QWORD))(**((_QWORD **)v2 + 25) + 40LL))(*((_QWORD *)v2 + 25));
    *((_QWORD *)v2 + 25) = 0LL;
  }
  v9 = *((_QWORD *)v2 + 42);
  if ( v9 )
  {
    thread_call_cancel(v9);
    thread_call_free(*((_QWORD *)v2 + 42));
    *((_QWORD *)v2 + 42) = 0LL;
  }
  v10 = *((_QWORD *)v2 + 43);
  if ( v10 )
  {
    thread_call_cancel(v10);
    thread_call_free(*((_QWORD *)v2 + 43));
    *((_QWORD *)v2 + 43) = 0LL;
  }
  v11 = *((_QWORD *)v2 + 44);
  if ( v11 )
  {
    thread_call_cancel(v11);
    thread_call_free(*((_QWORD *)v2 + 44));
    *((_QWORD *)v2 + 44) = 0LL;
  }
  v12 = *((_QWORD *)v2 + 45);
  if ( v12 )
  {
    thread_call_cancel(v12);
    thread_call_free(*((_QWORD *)v2 + 45));
    *((_QWORD *)v2 + 45) = 0LL;
  }
  v13 = *((_QWORD *)v2 + 46);
  if ( v13 )
  {
    thread_call_cancel(v13);
    thread_call_free(*((_QWORD *)v2 + 46));
    *((_QWORD *)v2 + 46) = 0LL;
  }
  v14 = *((_QWORD *)v2 + 47);
  if ( v14 )
  {
    thread_call_cancel(v14);
    thread_call_free(*((_QWORD *)v2 + 47));
    *((_QWORD *)v2 + 47) = 0LL;
  }
  v15 = *((_QWORD *)v2 + 48);
  if ( v15 )
  {
    thread_call_cancel(v15);
    thread_call_free(*((_QWORD *)v2 + 48));
    *((_QWORD *)v2 + 48) = 0LL;
  }
  v16 = *((_QWORD *)v2 + 49);
  if ( v16 )
  {
    thread_call_cancel(v16);
    thread_call_free(*((_QWORD *)v2 + 49));
    *((_QWORD *)v2 + 49) = 0LL;
  }
  v17 = *((_QWORD *)v2 + 50);
  if ( v17 )
  {
    thread_call_cancel(v17);
    thread_call_free(*((_QWORD *)v2 + 50));
    *((_QWORD *)v2 + 50) = 0LL;
  }
  v18 = *((_QWORD *)v2 + 35);
  if ( v18 )
  {
    (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v18 + 328LL))(v18, *((_QWORD *)v2 + 34));
    v19 = *((_QWORD *)v2 + 35);
    if ( v19 )
      (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v19 + 328LL))(v19, *((_QWORD *)v2 + 56));
  }
  (*(void (__fastcall **)(AppleUSBHub *, IOService *))(off_1A060[0] + 1496))(v2, a2);
  if ( *(_BYTE *)v3 & 2 )
  {
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10A6u, *((_DWORD *)v2 + 74), (uintptr_t)a2, 0LL, 0LL, 0LL);
  }
}
// 1A060: using guessed type __int64 off_1A060[8];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2C7C8: using guessed type int __cdecl thread_call_cancel(_QWORD);
// 2C7E0: using guessed type int __fastcall thread_call_free(_QWORD);

//----- (0000000000003B5C) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::message(AppleUSBHub *this, uintptr_t a2, IOService *a3, void *a4)
{
  signed int v4; // ebx@1
  AppleUSBHub *v5; // r13@1
  uintptr_t v6; // r14@2
  __int64 v7; // r12@2
  __int64 v8; // r15@2
  unsigned __int8 v9; // al@2
  uintptr_t v10; // r12@3
  signed int v11; // er14@4
  unsigned int v12; // edx@8
  uintptr_t v13; // rsi@8
  unsigned int v14; // ecx@8
  __int64 v15; // rax@11
  __int64 v16; // rax@11
  __int64 v17; // rax@11
  unsigned __int64 v18; // rax@13
  __int64 v19; // rcx@14
  __int64 v20; // r12@15
  __int64 v21; // rdi@17
  __int64 v22; // rcx@19
  __int64 v23; // rax@25
  __int64 v24; // rax@34
  __int64 v25; // rax@35
  __int64 v26; // rdx@38
  void *v28; // [sp+8h] [bp-38h]@1
  char v29; // [sp+10h] [bp-30h]@25
  char v30; // [sp+12h] [bp-2Eh]@28

  v28 = a4;
  v4 = a2;
  v5 = this;
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    v6 = *((_DWORD *)this + 74);
    v7 = *((_QWORD *)this + 21);
    v8 = *((_DWORD *)this + 41);
    v9 = IOService::isInactive(this);
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v10 = (unsigned int)a2 | (unsigned __int64)(v7 << 32);
      a2 = v6;
      kernel_debug(0x52D1008u, v6, v10, v9 | (unsigned __int64)(v8 << 32), 0LL, 0LL);
    }
  }
  v11 = 0;
  if ( v4 > -536854502 )
  {
    if ( v4 == -536854501 )
    {
      LODWORD(v15) = (*(int (__fastcall **)(_QWORD, uintptr_t, IOService *))(**((_QWORD **)this + 18) + 2264LL))(
                       *((_QWORD *)this + 18),
                       a2,
                       a3);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v15 + 32LL))(v15);
      LODWORD(v16) = (*(int (**)(void))(**((_QWORD **)this + 18) + 2264LL))();
      (*(void (__fastcall **)(__int64, signed __int64, AppleUSBHub *, void *))(*(_QWORD *)v16 + 1840LL))(
        v16,
        3758112795LL,
        this,
        v28);
      LODWORD(v17) = (*(int (**)(void))(**((_QWORD **)this + 18) + 2264LL))();
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v17 + 40LL))(v17);
    }
  }
  else if ( v4 > -536854507 )
  {
    if ( v4 == -536854506 )
    {
      v18 = computeDeltaTimeMS((const unsigned __int64 *)this + 129);
      if ( (unsigned int)v28 < *((_BYTE *)this + 218) )
      {
        v19 = *((_QWORD *)this + 52);
        if ( v19 )
        {
          v20 = *(_QWORD *)(v19 + 8LL * (unsigned int)v28);
          if ( v20 )
          {
            if ( !*(_BYTE *)(v20 + 407) )
            {
              *(_BYTE *)(v20 + 407) = 1;
              v21 = *(_QWORD *)(v20 + 80);
              if ( v21 )
              {
                if ( v18 <= 0x3E7 )
                {
                  (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v21 + 904LL))(v21, 0LL);
                  v22 = *((_DWORD *)v5 + 74);
                  IOLog("The USB device %s (Port %d of Hub at 0x%x) may have caused a wake by issuing a remote wakeup (2)\n");
                }
                (*(void (__fastcall **)(__int64))(*(_QWORD *)v20 + 32LL))(v20);
                (*(void (**)(void))(**(_QWORD **)(v20 + 80) + 32LL))();
                v11 = 0;
                (*(void (__fastcall **)(_QWORD, signed __int64, _QWORD, _QWORD))(**(_QWORD **)(v20 + 80) + 1856LL))(
                  *(_QWORD *)(v20 + 80),
                  3758097232LL,
                  0LL,
                  0LL);
                (*(void (**)(void))(**(_QWORD **)(v20 + 80) + 40LL))();
                (*(void (__fastcall **)(__int64))(*(_QWORD *)v20 + 40LL))(v20);
              }
              else if ( v18 <= 0x3E7 )
              {
                v26 = *((_DWORD *)v5 + 74);
                v11 = 0;
                IOLog("An unknown USB device (Port %d of Hub at 0x%x) may have caused a wake by issuing a remote wakeup\n");
              }
            }
          }
        }
      }
    }
  }
  else if ( v4 > -536854525 )
  {
    switch ( v4 + 536854524 )
    {
      case 7:
      case 11:
        *((_BYTE *)this + 304) = 0;
        *((_BYTE *)this + 307) = 0;
        *((_BYTE *)this + 318) = 1;
        (*(void (__fastcall **)(AppleUSBHub *, uintptr_t, IOService *))(*(_QWORD *)this + 2128LL))(this, a2, a3);
        return (unsigned int)v11;
      case 0:
        v11 = -536870208;
        if ( !(unsigned __int8)IOService::isInactive(this) && !*((_BYTE *)this + 306) )
        {
          AppleUSBHub::IncrementOutstandingIO(this, 0);
          v23 = AppleUSBHub::GetPortStatus(this, (__int64)&v29, *(_WORD *)v28);
          v11 = -536870208;
          if ( !(_DWORD)v23 )
          {
            if ( !(v29 & 1) || (v11 = 0, !*((_BYTE *)this + 1040)) && v30 & 1 )
              v11 = -536870208;
          }
          AppleUSBHub::DecrementOutstandingIO(this, v23, 0);
        }
        return (unsigned int)v11;
      case 2:
        (*(void (__fastcall **)(AppleUSBHub *, uintptr_t, IOService *))(*(_QWORD *)this + 2128LL))(this, a2, a3);
        v12 = *(_DWORD *)v28;
        v14 = *((_DWORD *)v28 + 1);
        v13 = 3758112774LL;
        goto LABEL_9;
      case 8:
        v11 = -536870201;
        if ( !*((_BYTE *)this + 425) )
          return (unsigned int)v11;
        v12 = *(_DWORD *)v28;
        v14 = *((_DWORD *)v28 + 1);
        v13 = 3758112780LL;
        goto LABEL_9;
      case 14:
        v24 = *((_QWORD *)this + 52);
        if ( v24 )
        {
          v25 = *(_QWORD *)(v24 + 8LL * (unsigned int)(*(_DWORD *)v28 - 1));
          if ( v25 )
            *(_DWORD *)(v25 + 128) = *((_DWORD *)v28 + 1);
        }
        break;
      default:
        return (unsigned int)v11;
    }
  }
  else if ( v4 == -536854527 )
  {
    (*(void (__fastcall **)(AppleUSBHub *, uintptr_t, IOService *))(*(_QWORD *)this + 2128LL))(this, a2, a3);
    v12 = *(_DWORD *)v28;
    v13 = 3758112769LL;
    v14 = 0;
LABEL_9:
    v11 = AppleUSBHub::DoPortAction(this, v13, v12, v14);
  }
  return (unsigned int)v11;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAB0: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000003F28) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::GetPortStatus(AppleUSBHub *this, __int64 a2, int a3)
{
  int v3; // er15@1
  const OSMetaClass *v4; // rdx@1
  signed int v5; // ebx@1
  signed int v6; // er12@2
  signed int v7; // eax@7
  AppleUSBHub *v8; // r12@11
  __int64 v9; // r13@12
  uintptr_t v10; // rcx@12
  uintptr_t v11; // rcx@22
  uintptr_t v12; // rdx@22
  uintptr_t v13; // rsi@22
  uint32_t v14; // edi@22
  uintptr_t v15; // r8@22
  __int64 v16; // r14@25
  unsigned int v17; // edi@29
  int v18; // esi@29
  unsigned int v19; // esi@31
  __int16 v20; // cx@33
  int v21; // esi@37
  __int64 v22; // rax@42
  __int64 v23; // rcx@42
  const OSMetaClassBase *v24; // r13@45
  uintptr_t v25; // r14@45
  __int64 v26; // rax@47
  __int64 v27; // rax@49
  OSMetaClassBase *v28; // rax@50
  const OSMetaClass *v29; // rdx@50
  AppleUSBHub *v30; // r15@50
  __int64 v31; // rax@51
  __int64 v32; // rax@54
  int v34; // [sp+14h] [bp-4Ch]@1
  char arg2; // [sp+18h] [bp-48h]@22
  char v36; // [sp+20h] [bp-40h]@1
  char v37; // [sp+21h] [bp-3Fh]@1
  __int16 v38; // [sp+22h] [bp-3Eh]@1
  __int16 v39; // [sp+24h] [bp-3Ch]@1
  __int16 v40; // [sp+26h] [bp-3Ah]@1
  __int64 v41; // [sp+28h] [bp-38h]@1
  uintptr_t arg3; // [sp+30h] [bp-30h]@1

  v34 = a3;
  v36 = -93;
  v37 = 0;
  v38 = 0;
  v39 = a3;
  v40 = 4;
  v41 = a2;
  LODWORD(arg3) = 0;
  v3 = 1;
  v5 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v36, 1);
  if ( !v5 )
  {
    v6 = 1;
    while ( (unsigned int)arg3 != 4LL )
    {
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1098u, *((_DWORD *)this + 74), (unsigned __int16)v34, (unsigned int)arg3, 0LL, 0LL);
      v7 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v36, 1);
      v5 = v7;
      v3 = v6 + 1;
      if ( v6 <= 29 )
      {
        ++v6;
        if ( !v7 )
          continue;
      }
      goto LABEL_11;
    }
    v3 = v6;
    v5 = 0;
  }
LABEL_11:
  v8 = this;
  if ( *((_BYTE *)this + 1041) )
  {
    v9 = a2;
    v10 = *(_WORD *)(a2 + 2);
    if ( v10 >= 0x20 )
    {
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1098u, *((_DWORD *)this + 74), (unsigned __int16)v34, v10, 1uLL, 0LL);
      IOSleep(50LL);
      v5 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v36, 0);
    }
  }
  else
  {
    v9 = a2;
  }
  if ( v5 || (_DWORD)arg3 == 4 )
  {
    if ( !v5 )
    {
      v16 = off_1A080[0];
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1095u, *((_DWORD *)this + 74), (unsigned __int16)v34, *(_QWORD *)v9, 0LL, 0LL);
      v5 = 0;
      if ( !*((_BYTE *)this + 426) )
        goto LABEL_63;
      v17 = (unsigned __int8)*(_WORD *)v9 | ((unsigned int)*(_WORD *)v9 >> 1) & 0x100;
      v18 = v17 | 0x2000;
      if ( (*(_WORD *)v9 >> 8) & 0x1C )
        LOWORD(v18) = v17;
      v19 = ((((unsigned int)*(_WORD *)v9 >> 5) & 8) << 11) | v18;
      v4 = (const OSMetaClass *)(v19 | 4);
      if ( (((unsigned int)*(_WORD *)v9 >> 5) & 0xF) != 3 )
        LOWORD(v4) = v19;
      v20 = (unsigned __int16)v4 | 0x8000;
      if ( *(_WORD *)v9 >= 0 )
        v20 = (signed __int16)v4;
      *(_WORD *)v9 = v20;
      if ( !(*(_BYTE *)v16 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      {
LABEL_63:
        arg2 = 1;
        goto LABEL_40;
      }
      arg2 = 1;
      v21 = (unsigned __int16)v20 | (v34 << 16);
      v11 = *(_WORD *)(v9 + 2) | ((unsigned __int16)v20 << 16);
      v12 = v21;
      v13 = *((_DWORD *)v8 + 74);
      v5 = 0;
      v14 = 86839444;
      v15 = 0LL;
      goto LABEL_38;
    }
  }
  else
  {
    v5 = -536870169;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v11 = v3;
      v12 = (unsigned __int16)v34;
      v13 = *((_DWORD *)this + 74);
      arg2 = 0;
      v14 = 86839448;
      v15 = 2LL;
LABEL_38:
      kernel_debug(v14, v13, v12, v11, v15, 0LL);
      goto LABEL_40;
    }
  }
  arg2 = 0;
LABEL_40:
  if ( *((_BYTE *)v8 + 1079) )
  {
    if ( *(_BYTE *)(v9 + 2) & 1 )
    {
      v22 = *((_QWORD *)v8 + 52);
      v23 = *(_QWORD *)(v22 + 8LL * (unsigned __int16)v34 - 8);
      if ( v23 )
      {
        if ( *(_BYTE *)(v23 + 102) && *((_BYTE *)v8 + 218) )
        {
          v24 = *(const OSMetaClassBase **)off_1A008[0];
          v25 = 1LL;
          while ( 1 )
          {
            v26 = *(_QWORD *)(v22 + 8 * v25 - 8);
            if ( v26 )
            {
              if ( *(_BYTE *)(v26 + 101) )
              {
                v27 = OSMetaClassBase::safeMetaCast(*(OSMetaClassBase **)(v26 + 80), v24, v4);
                if ( v27 )
                {
                  LODWORD(v28) = (*(int (__fastcall **)(__int64, const OSMetaClassBase *))(*(_QWORD *)v27 + 2608LL))(
                                   v27,
                                   v24);
                  v30 = (AppleUSBHub *)OSMetaClassBase::safeMetaCast(
                                         v28,
                                         (const OSMetaClassBase *)&AppleUSBHub::gMetaClass,
                                         v29);
                  if ( v30 )
                  {
                    v31 = off_1A080[0];
                    if ( *(_BYTE *)off_1A080[0] & 2 )
                    {
                      v31 = off_1A098;
                      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                        kernel_debug(0x52D1096u, *((_DWORD *)v8 + 74), (unsigned __int16)v34, v25, 0LL, 0LL);
                    }
                    v32 = AppleUSBHub::RaisePowerState(v30, v31);
                    AppleUSBHub::LowerPowerState(v30, v32);
                  }
                }
              }
            }
            if ( (signed int)v25 >= *((_BYTE *)v8 + 218) )
              break;
            ++v25;
            v22 = *((_QWORD *)v8 + 52);
          }
        }
      }
    }
  }
  if ( !arg2 && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1098u, *((_DWORD *)v8 + 74), (unsigned __int16)v34, v5, 3uLL, 0LL);
  return (unsigned int)v5;
}
// 1A008: using guessed type _QWORD off_1A008[19];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (0000000000004342) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::DoPortAction(AppleUSBHub *this, uintptr_t a2, unsigned int a3, unsigned int a4)
{
  unsigned int v4; // er15@1
  unsigned int v5; // er12@1
  AppleUSBHub *v6; // r14@1
  int v7; // ebx@1
  __int64 v8; // rax@3
  int v9; // ecx@4
  int v10; // er13@7
  __int64 v11; // rax@8
  __int64 v12; // rax@8
  signed __int64 v13; // r15@11
  __int64 v14; // rax@13
  __int64 v15; // rax@21
  AppleUSBHub *v16; // rbx@22
  __int64 v17; // rax@23
  AppleUSBHub *v18; // rdi@23
  uintptr_t v20; // r13@30
  __int64 v21; // rax@31
  __int64 v22; // rdi@34
  __int64 v23; // rax@41
  int v24; // er15@44
  signed int v25; // er12@45
  __int64 v26; // r15@54
  __int64 v27; // rax@58
  __int64 v28; // rdi@59
  __int64 v29; // rax@61
  unsigned int v30; // [sp+Ch] [bp-44h]@11
  int v31; // [sp+10h] [bp-40h]@1
  char v32; // [sp+18h] [bp-38h]@44
  char v33; // [sp+1Ah] [bp-36h]@47
  __int16 v34; // [sp+20h] [bp-30h]@38
  int v35; // [sp+24h] [bp-2Ch]@1

  v4 = a4;
  v5 = a3;
  v31 = a2;
  v6 = this;
  v35 = 0;
  v7 = a3 - 1;
  if ( (unsigned __int8)IOService::isInactive(this)
    || *((_BYTE *)this + 306)
    || (v8 = *((_QWORD *)this + 21), (unsigned __int64)v8 <= 3)
    && (v9 = *((_DWORD *)this + 41), v9 != 4)
    && (v9 != -1 || (unsigned __int64)v8 <= 1) )
  {
    v35 = -536870163;
    v10 = -536870163;
    goto LABEL_18;
  }
  v10 = v35;
  if ( v35 )
  {
LABEL_18:
    v13 = (signed __int64)((char *)this + 416);
    goto LABEL_19;
  }
  v11 = AppleUSBHub::RaisePowerState(this, v8);
  a2 = 2000LL;
  v12 = AppleUSBHub::WaitForPowerOn(this, v11, 2000LL);
  v35 = v12;
  if ( (_DWORD)v12 )
  {
    v35 = -536870163;
LABEL_10:
    AppleUSBHub::LowerPowerState(v6, v12);
    v10 = v35;
    goto LABEL_11;
  }
  v10 = 0;
  if ( *((_BYTE *)this + 304) )
  {
    v22 = *((_QWORD *)this + 18);
    if ( v22 )
    {
      v10 = 0;
      a2 = 0LL;
      LODWORD(v12) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v22 + 2440LL))(v22, 0LL);
      v35 = v12;
      if ( (_DWORD)v12 )
        goto LABEL_10;
      LODWORD(v12) = IOSleep(*((_DWORD *)v6 + 46));
      if ( v35 )
        goto LABEL_10;
    }
  }
LABEL_11:
  v30 = v4;
  v13 = (signed __int64)((char *)v6 + 416);
  if ( *((_QWORD *)v6 + 52) || v10 )
  {
    if ( !v10 )
    {
      v10 = AppleUSBHub::TakeDoPortActionLock(v6);
      v35 = v10;
      if ( v10 )
        return (unsigned int)v10;
      if ( *(_QWORD *)v13 )
      {
        v20 = *(_QWORD *)(*(_QWORD *)v13 + 8LL * (unsigned int)v7);
        if ( v20 )
        {
          (*(void (__fastcall **)(uintptr_t, uintptr_t))(*(_QWORD *)v20 + 32LL))(v20, a2);
          v21 = (unsigned int)(v31 + 536854527);
          switch ( (_DWORD)v21 )
          {
            case 0:
              v35 = AppleUSBHubPort::ResetPort((AppleUSBHubPort *)v20, (AppleUSBHubPort *)a2);
              break;
            case 1:
              v35 = AppleUSBHubPort::SuspendPort(v20, v21, 1u, 1);
              if ( !(unsigned int)AppleUSBHub::GetPortStatus(v6, (__int64)&v34, (unsigned __int16)v5) && (v34 & 5) == 1 )
              {
                *(_DWORD *)(v20 + 96) = 3;
                AppleUSBHubPort::MessageDeviceClients((AppleUSBHubPort *)v20, 0xE000400B, &v35, 4LL);
              }
              break;
            case 2:
              LODWORD(v23) = (*(int (__fastcall **)(AppleUSBHub *))(*(_QWORD *)v6 + 2128LL))(v6);
              v35 = AppleUSBHubPort::SuspendPort(v20, v23, 1u, 0);
              if ( !v35 && *((_QWORD *)v6 + 21) == 3LL )
              {
                if ( *((_BYTE *)v6 + 160) )
                {
                  IOSleep(20LL);
                  v24 = (unsigned __int16)v5;
                  v35 = AppleUSBHub::GetPortStatus(v6, (__int64)&v32, (unsigned __int16)v5);
                  if ( !v35 )
                  {
                    v25 = 5001;
                    while ( 1 )
                    {
                      --v25;
                      if ( v25 <= 0 )
                        break;
                      if ( v33 & 4 )
                      {
                        AppleUSBHub::ClearPortFeature(v6, 18, v24);
                        *(_DWORD *)(v20 + 96) = 3;
                        *(_BYTE *)(v20 + 401) = 0;
                        v26 = *(_QWORD *)(v20 + 80);
                        if ( v26 )
                        {
                          (*(void (__fastcall **)(_QWORD, signed __int64))(*(_QWORD *)v26 + 32LL))(
                            *(_QWORD *)(v20 + 80),
                            18LL);
                          (*(void (__fastcall **)(__int64, signed __int64, __int64, _QWORD))(*(_QWORD *)v26 + 1840LL))(
                            v26,
                            3758112779LL,
                            v26,
                            0LL);
                          (*(void (__fastcall **)(__int64))(*(_QWORD *)v26 + 40LL))(v26);
                        }
                        goto LABEL_57;
                      }
                      IOSleep(1LL);
                      v35 = AppleUSBHub::GetPortStatus(v6, (__int64)&v32, v24);
                      if ( v35 )
                        goto LABEL_57;
                    }
                  }
                }
                else
                {
                  KernelDebugLogInternal(
                    1LL,
                    1431519814LL,
                    "AppleUSBHub::DoPortAction - resuming port %d of hub at 0x%x, but we are not a root hub - shouldn't be here",
                    v5,
                    *((_DWORD *)v6 + 74));
                }
              }
              break;
            case 5:
              v35 = AppleUSBHubPort::ReEnumeratePort((AppleUSBHubPort *)v20, v30);
              break;
            case 0xB:
              if ( *((_BYTE *)v6 + 425) )
                v35 = AppleUSBHubPort::ClearTT((AppleUSBHubPort *)v20, *((_BYTE *)v6 + 424), v30);
              else
                v35 = -536870201;
              break;
            default:
              break;
          }
LABEL_57:
          (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)v20 + 40LL))(v20);
        }
      }
      AppleUSBHub::IncrementOutstandingIO(v6, 0);
      if ( *((_QWORD *)v6 + 35) )
      {
        v28 = *((_QWORD *)v6 + 34);
        if ( v28 )
          LODWORD(v27) = (*(int (__fastcall **)(__int64, __int64 (__usercall *)@<rax>(AppleUSBHub *@<rdi>, OSObject *@<rsi>, void *@<rdx>, void *@<rcx>, void *@<r8>, void *@<r9>, __int64@<rax>), _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v28 + 456LL))(
                           v28,
                           AppleUSBHub::ChangeDoPortActionLock,
                           0LL,
                           0LL,
                           0LL,
                           0LL);
      }
      LOBYTE(v29) = AppleUSBHub::DecrementOutstandingIO(v6, v27, 0);
      AppleUSBHub::LowerPowerState(v6, v29);
      if ( (unsigned __int8)IOService::isInactive(v6) )
        goto LABEL_25;
      if ( *((_BYTE *)v6 + 306) )
        goto LABEL_25;
      if ( *((_BYTE *)v6 + 429) )
        goto LABEL_25;
      if ( v31 != -536854526 )
        goto LABEL_25;
      *((_BYTE *)v6 + 429) = 1;
      (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v6 + 32LL))(v6, 0LL);
      if ( thread_call_enter(*((_QWORD *)v6 + 46)) != 1 )
        goto LABEL_25;
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1034u, *((_DWORD *)v6 + 74), 0xE0004002uLL, 0LL, 0LL, 0LL);
      v17 = *(_QWORD *)v6;
      v18 = v6;
LABEL_24:
      (*(void (__fastcall **)(AppleUSBHub *))(v17 + 40))(v18);
LABEL_25:
      v10 = v35;
      return (unsigned int)v10;
    }
  }
  else
  {
    v14 = off_1A080[0];
    if ( *(_BYTE *)off_1A080[0] & 2 )
    {
      v14 = off_1A098;
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        a2 = *((_DWORD *)v6 + 74);
        kernel_debug(0x52D1034u, a2, 0xFFFFFFFFE00002C0LL, 0LL, 0LL, 0LL);
      }
    }
    AppleUSBHub::LowerPowerState(v6, v14);
    v35 = -536870208;
    v10 = -536870208;
  }
LABEL_19:
  if ( (v31 & 0xFFFFFFFE) == -536854526 )
  {
    if ( *(_QWORD *)v13 )
    {
      v15 = *(_QWORD *)(*(_QWORD *)v13 + 8LL * (unsigned int)v7);
      if ( v15 )
      {
        v16 = *(AppleUSBHub **)(v15 + 80);
        if ( v16 )
        {
          (*(void (__fastcall **)(AppleUSBHub *, uintptr_t))(*(_QWORD *)v16 + 32LL))(v16, a2);
          (*(void (__fastcall **)(AppleUSBHub *, signed __int64, AppleUSBHub *, _QWORD))(*(_QWORD *)v16 + 1840LL))(
            v16,
            3758112783LL,
            v16,
            0LL);
          v17 = *(_QWORD *)v16;
          v18 = v16;
          goto LABEL_24;
        }
      }
    }
  }
  return (unsigned int)v10;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (00000000000048AC) ----------------------------------------------------
unsigned __int64 __fastcall computeDeltaTimeMS(const unsigned __int64 *a1)
{
  const unsigned __int64 *v1; // rbx@1
  unsigned __int64 result; // rax@1
  const unsigned __int64 v3; // rdi@1
  __int64 v4; // [sp+8h] [bp-18h]@1
  unsigned __int64 v5; // [sp+10h] [bp-10h]@1

  v1 = a1;
  v4 = 0LL;
  clock_get_uptime(&v5);
  result = 0LL;
  v3 = v5 - *a1;
  if ( v5 > *v1 )
  {
    v5 -= *v1;
    absolutetime_to_nanoseconds(v3, &v4);
    result = (unsigned __int64)((unsigned __int128)(4835703278458516699LL * v4) >> 64) >> 18;
  }
  return result;
}
// 2C750: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);
// 2C760: using guessed type int __fastcall clock_get_uptime(_QWORD);

//----- (00000000000048FE) ----------------------------------------------------
int __fastcall AppleUSBHub::finalize(AppleUSBHub *this)
{
  return (*(int (__fastcall **)(AppleUSBHub *))(off_1A060[0] + 1560))(this);
}
// 1A060: using guessed type __int64 off_1A060[8];

//----- (0000000000004910) ----------------------------------------------------
int __fastcall AppleUSBHub::requestTerminate(AppleUSBHub *this, IOService *a2, unsigned int a3)
{
  unsigned int v3; // er14@1
  __int64 v4; // r13@1
  uintptr_t v5; // rdx@6
  uintptr_t v6; // rbx@8

  v3 = a3;
  v4 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D10A8u, *((_DWORD *)this + 74), *((_QWORD *)this + 21), *((_DWORD *)this + 41), 0LL, 0LL);
  if ( *((_QWORD *)this + 21) != 4LL || *((_DWORD *)this + 41) != -1 )
  {
    IOService::changePowerStateTo(this, 4uLL);
    v5 = *((_QWORD *)this + 21);
    if ( v5 )
    {
      if ( v5 != 4 )
      {
        v6 = 9LL;
        do
        {
          if ( *((_DWORD *)this + 41) == -1 || (signed int)v6 + 1 <= 0 )
            break;
          if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(0x52D10A8u, *((_DWORD *)this + 74), v5, v6, 1uLL, 0LL);
          IOSleep(100LL);
          v5 = *((_QWORD *)this + 21);
          --v6;
        }
        while ( v5 != 4 );
      }
    }
  }
  AppleUSBHub::AbandonPortCheck(this);
  return (*(int (__fastcall **)(AppleUSBHub *, IOService *, _QWORD))(off_1A060[0] + 1032))(this, a2, v3);
}
// 1A060: using guessed type __int64 off_1A060[8];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000004A38) ----------------------------------------------------
int __fastcall AppleUSBHub::AbandonPortCheck(AppleUSBHub *this)
{
  AppleUSBHub *v1; // rbx@1
  __int64 v2; // rdi@2
  int result; // eax@4

  v1 = this;
  if ( *((_QWORD *)this + 35) )
  {
    v2 = *((_QWORD *)this + 34);
    if ( v2 )
    {
      if ( *((_BYTE *)v1 + 430) )
        result = (*(int (__fastcall **)(__int64, signed __int64, signed __int64))(*(_QWORD *)v2 + 488LL))(
                   v2,
                   (char *)v1 + 430,
                   1LL);
    }
  }
  *((_BYTE *)v1 + 431) = 1;
  return result;
}

//----- (0000000000004A84) ----------------------------------------------------
int __fastcall AppleUSBHub::willTerminate(AppleUSBHub *this, IOService *a2, unsigned int a3)
{
  unsigned int v3; // er12@1
  AppleUSBHub *v4; // r13@1
  uintptr_t v5; // r14@2
  uintptr_t v6; // r15@2
  uintptr_t v7; // rbx@2
  unsigned __int8 v8; // al@2
  __int64 v9; // rdi@4
  int v10; // eax@5
  __int64 v11; // rax@9
  uintptr_t i; // rbx@11
  uintptr_t v13; // r14@14
  const OSMetaClass *v14; // rdx@19
  __int64 v15; // rax@21
  __int64 v16; // r15@21
  __int64 v17; // rdi@22
  unsigned int v18; // ST04_4@23
  void (__fastcall *v19)(_QWORD, _QWORD, _QWORD); // r12@23
  __int64 v20; // rdi@26
  IOService *v22; // [sp+8h] [bp-38h]@11
  IOService *v23; // [sp+10h] [bp-30h]@1

  v3 = a3;
  v23 = a2;
  v4 = this;
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    v5 = *((_DWORD *)this + 74);
    v6 = *((_QWORD *)this + 21);
    v7 = *((_DWORD *)this + 41);
    v8 = IOService::isInactive(this);
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      a2 = (IOService *)v5;
      kernel_debug(0x52D100Du, v5, v6, v7, v8, 0LL);
    }
  }
  v9 = *((_QWORD *)this + 32);
  if ( v9 )
  {
    v10 = (*(int (__fastcall **)(__int64, IOService *))(*(_QWORD *)v9 + 296LL))(v9, a2);
    if ( v10 )
    {
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        a2 = (IOService *)*((_DWORD *)v4 + 74);
        kernel_debug(0x52D100Cu, (uintptr_t)a2, v10, 0LL, 0LL, 0LL);
      }
    }
  }
  v11 = *((_QWORD *)v4 + 52);
  if ( v11 && *((_BYTE *)v4 + 218) )
  {
    v22 = *(IOService **)off_1A020[0];
    for ( i = 1LL; ; ++i )
    {
      if ( v11 )
      {
        v13 = *(_QWORD *)(v11 + 8 * i - 8);
        if ( v13 )
        {
          if ( *(_BYTE *)(v13 + 100) && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            a2 = (IOService *)*((_DWORD *)v4 + 74);
            kernel_debug(0x52D100Cu, (uintptr_t)a2, i, 0LL, 1uLL, 0LL);
          }
          AppleUSBHubPort::ReleaseDevZeroLock(v13);
          if ( *(_DWORD *)(v13 + 96) == 1 )
          {
            if ( *((_QWORD *)v4 + 18) )
            {
              a2 = v22;
              v15 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)v4 + 17), v22, v14);
              v16 = v15;
              if ( v15 )
              {
                v17 = *(_QWORD *)(v13 + 80);
                if ( v17 )
                {
                  v18 = v3;
                  v19 = *(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(*(_QWORD *)v15 + 3136LL);
                  a2 = (IOService *)(unsigned __int16)(*(int (__fastcall **)(__int64, IOService *))(*(_QWORD *)v17
                                                                                                  + 2248LL))(
                                                        v17,
                                                        v22);
                  v19(v16, a2, 1LL);
                  v3 = v18;
                }
              }
            }
            *(_DWORD *)(v13 + 96) = 3;
          }
        }
      }
      if ( (signed int)i >= *((_BYTE *)v4 + 218) )
        break;
      v11 = *((_QWORD *)v4 + 52);
    }
  }
  v20 = *((_QWORD *)v4 + 56);
  if ( v20 )
    (*(void (__fastcall **)(__int64, IOService *))(*(_QWORD *)v20 + 536LL))(v20, a2);
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D100Eu, *((_DWORD *)v4 + 74), 0LL, 0LL, 0LL, 0LL);
  return (*(int (__fastcall **)(AppleUSBHub *, IOService *, _QWORD))(off_1A060[0] + 1040))(v4, v23, v3);
}
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A060: using guessed type __int64 off_1A060[8];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (0000000000004CC2) ----------------------------------------------------
int __fastcall AppleUSBHub::didTerminate(AppleUSBHub *this, IOService *a2, unsigned int a3, bool *a4)
{
  unsigned int v4; // er15@1
  __int64 v5; // r14@1
  uintptr_t v6; // r13@2
  unsigned __int8 v7; // al@2
  uintptr_t v8; // r13@9
  unsigned __int8 v9; // al@9
  __int64 v11; // r13@12
  bool *v12; // [sp+0h] [bp-30h]@1

  v12 = a4;
  v4 = a3;
  v5 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    v6 = *((_DWORD *)this + 74);
    v7 = IOService::isInactive(this);
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10ADu, v6, v7, *((_DWORD *)this + 180), *((_DWORD *)this + 41), 0LL);
  }
  if ( *((_DWORD *)this + 180) || *((_DWORD *)this + 41) != -1 || *((_BYTE *)this + 432) )
  {
    *((_BYTE *)this + 316) = 1;
  }
  else
  {
    v11 = *((_QWORD *)this + 18);
    AppleUSBHub::StopPorts(this);
    *((_QWORD *)this + 18) = 0LL;
    (*(void (__fastcall **)(__int64, AppleUSBHub *, _QWORD))(*(_QWORD *)v11 + 1496LL))(v11, this, 0LL);
  }
  if ( *(_BYTE *)v5 & 2 )
  {
    v8 = *((_DWORD *)this + 74);
    v9 = IOService::isInactive(this);
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10AEu, v8, v9, *((_DWORD *)this + 180), *((_DWORD *)this + 41), 0LL);
  }
  return (*(int (__fastcall **)(AppleUSBHub *, IOService *, _QWORD, bool *))(off_1A060[0] + 1048))(this, a2, v4, v12);
}
// 1A060: using guessed type __int64 off_1A060[8];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000004DE8) ----------------------------------------------------
int __fastcall AppleUSBHub::terminate(AppleUSBHub *this)
{
  return (*(int (__fastcall **)(AppleUSBHub *))(off_1A060[0] + 1552))(this);
}
// 1A060: using guessed type __int64 off_1A060[8];

//----- (0000000000004DFA) ----------------------------------------------------
int __fastcall AppleUSBHub::free(AppleUSBHub *this)
{
  AppleUSBHub *v1; // rbx@1
  __int64 v2; // r12@1
  __int64 v3; // rdi@4
  uintptr_t v4; // r14@7
  uintptr_t v5; // r15@7
  int v6; // eax@7
  __int64 v7; // rdi@11
  __int64 v8; // rdi@13
  __int64 v9; // rdi@15

  v1 = this;
  v2 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D10B1u, *((_DWORD *)this + 74), 0LL, 0LL, 0LL, 0LL);
  v3 = *((_QWORD *)this + 92);
  if ( v3 )
  {
    if ( (*(int (**)(void))(*(_QWORD *)v3 + 304LL))() )
    {
      if ( *(_BYTE *)v2 & 2 )
      {
        v4 = *((_DWORD *)v1 + 74);
        v5 = *((_QWORD *)v1 + 92);
        v6 = (*(int (__fastcall **)(_QWORD))(*(_QWORD *)v5 + 304LL))(*((_QWORD *)v1 + 92));
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D10B0u, v4, v5, (unsigned int)v6, 0LL, 0LL);
      }
      (*(void (**)(void))(**((_QWORD **)v1 + 92) + 344LL))();
    }
    (*(void (**)(void))(**((_QWORD **)v1 + 92) + 40LL))();
  }
  v7 = *((_QWORD *)v1 + 56);
  if ( v7 )
  {
    (*(void (**)(void))(*(_QWORD *)v7 + 40LL))();
    *((_QWORD *)v1 + 56) = 0LL;
  }
  v8 = *((_QWORD *)v1 + 34);
  if ( v8 )
  {
    (*(void (**)(void))(*(_QWORD *)v8 + 40LL))();
    *((_QWORD *)v1 + 34) = 0LL;
  }
  v9 = *((_QWORD *)v1 + 35);
  if ( v9 )
  {
    (*(void (**)(void))(*(_QWORD *)v9 + 40LL))();
    *((_QWORD *)v1 + 35) = 0LL;
  }
  if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D10B2u, *((_DWORD *)v1 + 74), 0LL, 0LL, 0LL, 0LL);
  return (*(int (__fastcall **)(AppleUSBHub *))(off_1A060[0] + 160))(v1);
}
// 1A060: using guessed type __int64 off_1A060[8];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000004F5C) ----------------------------------------------------
int __fastcall AppleUSBHub::terminateClient(AppleUSBHub *this, IOService *a2)
{
  return (*(int (__fastcall **)(AppleUSBHub *, IOService *))(off_1A060[0] + 1584))(this, a2);
}
// 1A060: using guessed type __int64 off_1A060[8];

//----- (0000000000004F6E) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::powerStateWillChangeTo(AppleUSBHub *this, uintptr_t arg2, uintptr_t arg3, IOService *a4)
{
  AppleUSBHub *v4; // r12@1
  uintptr_t v5; // r15@1
  uintptr_t v6; // r13@1
  AppleUSBHub *v7; // r14@1
  int v8; // ebx@1
  AppleUSBHub *v9; // rax@1
  int v10; // ecx@2
  uintptr_t v11; // rsi@5
  uintptr_t v12; // r8@5
  __int64 v13; // rbx@7
  __int64 v14; // r13@7
  unsigned __int8 v15; // al@7
  uintptr_t v16; // rdx@8
  uintptr_t v17; // rcx@8
  __int64 v18; // rdi@16
  uintptr_t v19; // rbx@18
  __int64 v20; // r12@18
  __int64 v21; // r13@18
  uintptr_t v23; // [sp+8h] [bp-38h]@7
  int v24; // [sp+14h] [bp-2Ch]@3

  v4 = a4;
  v5 = arg3;
  v6 = arg2;
  v7 = this;
  v8 = (*(int (**)(void))(off_1A060[0] + 2072))();
  v9 = (AppleUSBHub *)IOService::getPMRootDomain(this);
  if ( this != v4 )
  {
    v10 = *(_DWORD *)off_1A080[0] & 2;
    if ( v9 == v4 )
    {
      v24 = v8;
      if ( !v10 )
        goto LABEL_26;
      if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_14;
      v11 = *((_DWORD *)this + 74);
      v12 = 1LL;
    }
    else
    {
      v24 = v8;
      if ( !v10 || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      {
LABEL_14:
        if ( this != v4 )
          goto LABEL_26;
        goto LABEL_15;
      }
      v11 = *((_DWORD *)this + 74);
      v12 = 2LL;
    }
    v16 = v6;
    v17 = v5;
LABEL_13:
    kernel_debug(0x52D1011u, v11, v16, v17, v12, 0LL);
    goto LABEL_14;
  }
  v24 = v8;
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    v23 = *((_DWORD *)this + 74);
    v13 = *((_QWORD *)this + 21);
    v14 = *((_DWORD *)this + 180);
    v15 = IOService::isInactive(v4);
    if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      goto LABEL_14;
    v12 = 0LL;
    v11 = v23;
    v16 = v5 | (v13 << 32);
    v17 = v15 | (unsigned __int64)(v14 << 32);
    goto LABEL_13;
  }
LABEL_15:
  if ( *((_DWORD *)this + 41) <= 3 )
  {
    AppleUSBHub::AbandonPortCheck(this);
    v18 = *((_QWORD *)this + 32);
    if ( v18 )
    {
      *((_BYTE *)v7 + 307) = 1;
      *((_BYTE *)v7 + 318) = 0;
      (*(void (**)(void))(*(_QWORD *)v18 + 296LL))();
    }
    v19 = 299LL;
    v20 = off_1A080[0];
    v21 = off_1A098;
    do
    {
      if ( !AppleUSBHub::IsPortInitThreadActiveForAnyPort(v7)
        && !AppleUSBHub::IsStatusChangedThreadActiveForAnyPort(v7)
        && !*((_BYTE *)v7 + 429) )
        break;
      if ( *(_BYTE *)v20 & 2 && *(_DWORD *)v21 & 0xFFFFFFF7 )
        kernel_debug(0x52D1010u, *((_DWORD *)v7 + 74), v19, 0LL, 0LL, 0LL);
      IOSleep(100LL);
      --v19;
    }
    while ( (_DWORD)v19 != -1 );
  }
LABEL_26:
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1012u, *((_DWORD *)v7 + 74), v5 | (*((_QWORD *)v7 + 21) << 32), *((_DWORD *)v7 + 180), v24, 0LL);
  return (unsigned int)v24;
}
// 1A060: using guessed type __int64 off_1A060[8];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (00000000000051A6) ----------------------------------------------------
char __fastcall AppleUSBHub::IsPortInitThreadActiveForAnyPort(AppleUSBHub *this)
{
  __int64 v1; // rcx@1
  unsigned int v2; // edx@2
  __int64 v3; // rsi@2
  char result; // al@2
  __int64 v5; // rdi@3

  v1 = *((_QWORD *)this + 52);
  if ( v1 )
  {
    v2 = *((_BYTE *)this + 218);
    v3 = 0LL;
    result = 0;
    if ( *((_BYTE *)this + 218) )
    {
      while ( 1 )
      {
        v5 = *(_QWORD *)(v1 + 8 * v3);
        if ( v5 )
        {
          result = 1;
          if ( *(_BYTE *)(v5 + 107) )
            break;
        }
        ++v3;
        if ( (signed int)v3 + 1 > v2 )
          goto LABEL_6;
      }
    }
  }
  else
  {
LABEL_6:
    result = 0;
  }
  return result;
}

//----- (00000000000051E8) ----------------------------------------------------
char __fastcall AppleUSBHub::IsStatusChangedThreadActiveForAnyPort(AppleUSBHub *this)
{
  __int64 v1; // rcx@1
  unsigned int v2; // edx@2
  __int64 v3; // rsi@2
  char result; // al@2
  __int64 v5; // rdi@3

  v1 = *((_QWORD *)this + 52);
  if ( v1 )
  {
    v2 = *((_BYTE *)this + 218);
    v3 = 0LL;
    result = 0;
    if ( *((_BYTE *)this + 218) )
    {
      while ( 1 )
      {
        v5 = *(_QWORD *)(v1 + 8 * v3);
        if ( v5 )
        {
          result = 1;
          if ( *(_BYTE *)(v5 + 104) )
            break;
        }
        ++v3;
        if ( (signed int)v3 + 1 > v2 )
          goto LABEL_6;
      }
    }
  }
  else
  {
LABEL_6:
    result = 0;
  }
  return result;
}

//----- (000000000000522A) ----------------------------------------------------
int __fastcall AppleUSBHub::setPowerState(AppleUSBHub *this, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1

  v3 = a3;
  if ( *((_QWORD *)this + 21) != a2 )
    AppleUSBHub::IncrementOutstandingIO(this, 1u);
  return (*(int (__fastcall **)(AppleUSBHub *, __int64, __int64))(off_1A060[0] + 2040))(this, a2, v3);
}
// 1A060: using guessed type __int64 off_1A060[8];

//----- (0000000000005274) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::powerStateDidChangeTo(AppleUSBHub *this, uintptr_t arg2, uintptr_t arg3, IOService *a4)
{
  AppleUSBHub *v4; // rbx@1
  uintptr_t v5; // r12@1
  __int64 v6; // r14@1
  __int64 v7; // rax@1
  unsigned int v9; // [sp+0h] [bp-2Ch]@1

  v4 = a4;
  v5 = arg3;
  v6 = *((_QWORD *)this + 21);
  LODWORD(v7) = (*(int (__cdecl **)(AppleUSBHub *))(off_1A060[0] + 2080))(this);
  v9 = v7;
  if ( this == v4 )
  {
    if ( v6 != v5 )
      AppleUSBHub::DecrementOutstandingIO(this, v7, 1u);
  }
  else if ( (AppleUSBHub *)IOService::getPMRootDomain(this) == v4 )
  {
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10CCu, *((_DWORD *)this + 74), arg2, v5, 0LL, 0LL);
    if ( arg2 & 2 )
      clock_get_uptime((char *)this + 1032);
  }
  return v9;
}
// 1A060: using guessed type __int64 off_1A060[8];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2C760: using guessed type int __fastcall clock_get_uptime(_QWORD);

//----- (0000000000005328) ----------------------------------------------------
void __fastcall AppleUSBHub::powerChangeDone(AppleUSBHub *this, uintptr_t arg2)
{
  uintptr_t v2; // r14@1
  AppleUSBHub *v3; // rbx@1
  __int64 v4; // r13@1
  __int64 v5; // rax@4
  __int64 v6; // rdi@13
  unsigned __int64 v7; // r15@26
  uintptr_t v8; // r12@27
  uintptr_t v9; // rax@27

  v2 = arg2;
  v3 = this;
  v4 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1015u, *((_DWORD *)this + 74), arg2, *((_QWORD *)this + 21), *((_BYTE *)this + 318), 0LL);
  (*(void (__fastcall **)(AppleUSBHub *, uintptr_t))(off_1A060[0] + 2136))(this, arg2);
  v5 = IOService::isInactive(this);
  if ( (_BYTE)v5 )
  {
    if ( *((_BYTE *)this + 320) )
    {
      arg2 = 1LL;
LABEL_9:
      AppleUSBHub::DecrementOutstandingIO(this, v5, arg2);
      goto LABEL_10;
    }
    if ( *((_BYTE *)this + 316) )
    {
      AppleUSBHub::IncrementOutstandingIO(this, 0);
      arg2 = 0LL;
      goto LABEL_9;
    }
  }
LABEL_10:
  if ( *((_QWORD *)this + 21) == 4LL )
  {
    if ( *((_BYTE *)this + 433) )
    {
      if ( *((_QWORD *)this + 35) )
      {
        v6 = *((_QWORD *)this + 34);
        if ( v6 )
        {
          arg2 = (uintptr_t)((char *)v3 + 433);
          (*(void (__fastcall **)(__int64, signed __int64, signed __int64))(*(_QWORD *)v6 + 488LL))(
            v6,
            (char *)v3 + 433,
            1LL);
        }
      }
    }
  }
  if ( !(unsigned __int8)IOService::isInactive(v3)
    && !*((_BYTE *)v3 + 306)
    && !*((_BYTE *)v3 + 429)
    && *((_QWORD *)v3 + 21) == 4LL )
  {
    *((_BYTE *)v3 + 429) = 1;
    (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)v3 + 32LL))(v3);
    if ( thread_call_enter(*((_QWORD *)v3 + 46)) == 1 )
    {
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        arg2 = *((_DWORD *)v3 + 74);
        kernel_debug(0x52D1014u, arg2, 0LL, 0LL, 0LL, 0LL);
      }
      (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)v3 + 40LL))(v3);
    }
  }
  if ( *((_BYTE *)v3 + 434) )
  {
    if ( *((_QWORD *)v3 + 21) == 4LL )
    {
      *((_BYTE *)v3 + 434) = 0;
      v7 = computeDeltaTimeMS((const unsigned __int64 *)v3 + 55);
      if ( *(_BYTE *)v4 & 2 )
      {
        v8 = *((_DWORD *)v3 + 74);
        v9 = IORegistryEntry::getRegistryEntryID(v3);
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          arg2 = v8;
          kernel_debug(0x52D10A0u, v8, v7, 0LL, v9, 0LL);
        }
      }
    }
  }
  if ( *((_BYTE *)v3 + 319) && !*((_QWORD *)v3 + 21) && !(unsigned __int8)IOService::isInactive(v3) )
  {
    *((_BYTE *)v3 + 319) = 0;
    if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      arg2 = *((_DWORD *)v3 + 74);
      kernel_debug(0x52D1014u, arg2, v2, *((_QWORD *)v3 + 21), 1uLL, 0LL);
    }
    (*(void (__fastcall **)(AppleUSBHub *, uintptr_t))(*(_QWORD *)v3 + 32LL))(v3, arg2);
    if ( thread_call_enter(*((_QWORD *)v3 + 50)) == 1 )
    {
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1014u, *((_DWORD *)v3 + 74), 0LL, 0LL, 2uLL, 0LL);
      (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)v3 + 40LL))(v3);
    }
  }
  if ( *(_BYTE *)v4 & 2 )
  {
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1016u, *((_DWORD *)v3 + 74), v2, *((_QWORD *)v3 + 21), *((_BYTE *)v3 + 318), 0LL);
  }
}
// 1A060: using guessed type __int64 off_1A060[8];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (000000000000560A) ----------------------------------------------------
int __fastcall AppleUSBHub::WakeOnPowerOn(AppleUSBHub *this)
{
  AppleUSBHub *v1; // rax@1
  __int64 v2; // rdi@2

  v1 = this;
  if ( *((_QWORD *)this + 35) )
  {
    v2 = *((_QWORD *)this + 34);
    if ( v2 )
    {
      if ( *((_BYTE *)v1 + 433) )
        LODWORD(v1) = (*(int (__fastcall **)(__int64, char *, signed __int64))(*(_QWORD *)v2 + 488LL))(
                        v2,
                        (char *)v1 + 433,
                        1LL);
    }
  }
  return (signed int)v1;
}

//----- (000000000000564E) ----------------------------------------------------
void __fastcall AppleUSBHub::ResetMyPort(AppleUSBHub *this)
{
  AppleUSBHub *v1; // r14@1
  __int64 v2; // r12@1
  __int64 v3; // rdi@4
  int v4; // eax@5
  __int64 v5; // rcx@9
  unsigned __int8 v6; // al@10
  uintptr_t v7; // rbx@11
  __int64 v8; // r13@11
  uintptr_t v9; // r15@14
  __int64 v10; // rdi@21

  v1 = this;
  v2 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1051u, *((_DWORD *)this + 74), *((_BYTE *)this + 218), 0LL, 0LL, 0LL);
  *((_BYTE *)this + 306) = 1;
  v3 = *((_QWORD *)this + 32);
  if ( v3 )
  {
    v4 = (*(int (__cdecl **)(__int64))(*(_QWORD *)v3 + 296LL))(v3);
    if ( v4 )
    {
      if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1050u, *((_DWORD *)v1 + 74), v4, 0LL, 1uLL, 0LL);
    }
  }
  v5 = *((_QWORD *)v1 + 52);
  if ( v5 )
  {
    v6 = *((_BYTE *)v1 + 218);
    if ( v6 )
    {
      v7 = 1LL;
      v8 = off_1A098;
      while ( 1 )
      {
        if ( v5 )
        {
          v9 = *(_QWORD *)(v5 + 8 * v7 - 8);
          if ( v9 )
          {
            if ( *(_BYTE *)(v9 + 100) && *(_BYTE *)v2 & 2 && *(_DWORD *)v8 & 0xFFFFFFF7 )
              kernel_debug(0x52D1050u, *((_DWORD *)v1 + 74), v7, v6, 2uLL, 0LL);
            AppleUSBHubPort::ReleaseDevZeroLock(v9);
            v6 = *((_BYTE *)v1 + 218);
          }
        }
        if ( (signed int)v7 >= v6 )
          break;
        ++v7;
        v5 = *((_QWORD *)v1 + 52);
      }
    }
  }
  v10 = *((_QWORD *)v1 + 56);
  if ( v10 )
    (*(void (__cdecl **)(__int64))(*(_QWORD *)v10 + 536LL))(v10);
  if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1050u, *((_DWORD *)v1 + 74), 0LL, 0LL, 3uLL, 0LL);
  *((_BYTE *)v1 + 319) = 1;
  IOService::changePowerStateToPriv(v1, 4uLL);
  IOService::powerOverrideOnPriv(v1);
  IOService::changePowerStateToPriv(v1, 0LL);
  if ( *(_BYTE *)v2 & 2 )
  {
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1052u, *((_DWORD *)v1 + 74), 0LL, 0LL, 0LL, 0LL);
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000005842) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::calculateDepth(AppleUSBHub *this, int a2)
{
  signed int v2; // ecx@1
  __int64 result; // rax@1

  v2 = 20;
  LOWORD(result) = 0;
  do
  {
    if ( !((15 << v2) & a2) )
      break;
    LOWORD(result) = result + 1;
    v2 -= 4;
  }
  while ( v2 >= 0 );
  return (unsigned __int16)result;
}

//----- (0000000000005864) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SetHubDepth(AppleUSBHub *this, __int16 a2)
{
  char v3; // [sp+8h] [bp-18h]@1
  char v4; // [sp+9h] [bp-17h]@1
  __int16 v5; // [sp+Ah] [bp-16h]@1
  __int16 v6; // [sp+Ch] [bp-14h]@1
  __int16 v7; // [sp+Eh] [bp-12h]@1
  __int64 v8; // [sp+10h] [bp-10h]@1

  v3 = 32;
  v4 = 12;
  v5 = a2;
  v6 = 0;
  v7 = 0;
  v8 = 0LL;
  return AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v3, 0);
}

//----- (000000000000589E) ----------------------------------------------------
bool __usercall AppleUSBHub::HasExpressCardPort@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  __int64 v2; // r14@2
  __int64 v3; // rax@2
  IORegistryEntry *v4; // rax@3
  IORegistryEntry *v5; // r14@3
  IOUSBController *v6; // rax@4

  if ( AppleUSBHub::IsHubDeviceInternal(this, a2) )
  {
    v2 = off_1A078[0];
    LODWORD(v3) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 792LL))(
                    *((_QWORD *)this + 18),
                    *(_QWORD *)off_1A078[0]);
    if ( v3 )
    {
      LODWORD(v4) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v3 + 792LL))(v3, *(_QWORD *)v2);
      v5 = v4;
      if ( v4 )
      {
        LODWORD(v6) = (*(int (**)(void))(**((_QWORD **)this + 18) + 2264LL))();
        *((_DWORD *)this + 265) = IOUSBController::ExpressCardPort(v6, v5);
      }
    }
  }
  return *((_DWORD *)this + 265) > 0;
}
// 1A078: using guessed type __int64 off_1A078[5];

//----- (0000000000005918) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::GetHubDescriptor(IOService *this, __int64 a2)
{
  __int64 v2; // r12@1
  signed int v3; // ebx@1
  signed __int16 v4; // cx@2
  int v5; // eax@7
  int v6; // eax@14
  __int64 result; // rax@21
  char v8; // [sp+0h] [bp-50h]@2
  char v9; // [sp+1h] [bp-4Fh]@2
  __int16 v10; // [sp+2h] [bp-4Eh]@4
  __int16 v11; // [sp+4h] [bp-4Ch]@4
  __int16 v12; // [sp+6h] [bp-4Ah]@4
  __int64 v13; // [sp+8h] [bp-48h]@4
  char v14; // [sp+1Ah] [bp-36h]@10
  __int64 v15; // [sp+28h] [bp-28h]@1

  v2 = off_1A070[0];
  v15 = *(_QWORD *)off_1A070[0];
  v3 = -536870206;
  if ( a2 )
  {
    v8 = -96;
    v9 = 6;
    v4 = 10752;
    if ( !*((_BYTE *)this + 426) )
      v4 = 10496;
    v10 = v4;
    v11 = 0;
    v12 = 25;
    v13 = a2;
    v3 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v8, 0);
    if ( !v3
      || !(unsigned __int8)IOService::isInactive(this)
      && (v10 = 0, v12 = 25, (v3 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v8, 0)) == 0) )
    {
      v5 = *((_DWORD *)this + 74);
      if ( (v5 == -99614720 || v5 == -49283072 || v5 == 1560281088) && PEGetModelName(&v14, 14LL) )
      {
        if ( !strncmp(&v14, "MacBookPro8,1", 0xDuLL) )
        {
          if ( *(_BYTE *)(a2 + 7) == 14 )
            *(_BYTE *)(a2 + 7) = 6;
        }
        else if ( !strncmp(&v14, "MacPro3,1", 9uLL) )
        {
          *(_BYTE *)(a2 + 7) = 4;
        }
        else if ( !strncmp(&v14, "iMac11,1", 8uLL) )
        {
          v6 = *((_DWORD *)this + 74);
          if ( v6 == -99614720 || v6 == -49283072 )
            *((_DWORD *)this + 188) = 24;
        }
      }
      v3 = 0;
    }
  }
  result = *(_QWORD *)v2;
  if ( *(_QWORD *)v2 == v15 )
    result = (unsigned int)v3;
  return result;
}
// 1A070: using guessed type __int64 off_1A070[6];
// 2BAD8: using guessed type int __fastcall PEGetModelName(_QWORD, _QWORD);

//----- (0000000000005A9C) ----------------------------------------------------
char __fastcall AppleUSBHub::UnpackPortFlags(AppleUSBHub *this)
{
  int v1; // eax@2
  char *v2; // rdi@2

  if ( *((_BYTE *)this + 217) == 42 )
  {
    v1 = (unsigned __int8)(*((_BYTE *)this + 218) >> 3) + 1;
    v2 = (char *)this + 235;
    do
    {
      *v2++ = -1;
      --v1;
    }
    while ( v1 );
  }
  else
  {
    LOBYTE(v1) = AppleUSBHub::UnpackUSB2PortFlags(this);
  }
  return v1;
}

//----- (0000000000005AD4) ----------------------------------------------------
void __fastcall AppleUSBHub::CountCaptivePorts(AppleUSBHub *this)
{
  int v1; // er9@1
  signed int v2; // ecx@2
  int v3; // edx@2
  int v4; // esi@2
  bool v5; // al@5

  v1 = *((_BYTE *)this + 218);
  if ( *((_BYTE *)this + 218) )
  {
    v2 = 2;
    v3 = 0;
    v4 = 0;
    do
    {
      if ( *((_BYTE *)this + v4 + 226) & (unsigned __int8)v2 )
        ++*((_BYTE *)this + 409);
      v2 *= 2;
      v5 = v2 > 128;
      if ( v2 > 128 )
        v2 = 1;
      v4 += v5;
      ++v3;
    }
    while ( v3 < v1 );
  }
}

//----- (0000000000005B26) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::CheckPortPowerRequirements(AppleUSBHub *this)
{
  unsigned int v1; // er15@1
  int v2; // er14@1
  signed int v3; // ecx@1
  signed int v4; // ebx@3
  bool v5; // cf@5
  int v6; // er14@5
  unsigned int v7; // ecx@7
  int v8; // er12@7
  unsigned int v9; // eax@8
  int v10; // er15@14
  char v11; // al@15
  char v12; // t0@20
  __int64 v13; // rax@23
  __int64 v14; // rax@28
  __int64 v15; // rdx@32
  __int64 v16; // rcx@32
  __int64 v17; // r8@32
  OSMetaClassBase *v18; // rax@36
  __int64 v19; // rsi@36
  const OSMetaClass *v20; // rdx@36
  __int64 v21; // rax@36
  int v22; // eax@38
  signed int v24; // [sp+8h] [bp-48h]@3
  __int16 v25; // [sp+Eh] [bp-42h]@14
  char v26; // [sp+10h] [bp-40h]@14
  char v27; // [sp+11h] [bp-3Fh]@14
  __int16 v28; // [sp+12h] [bp-3Eh]@14
  __int16 v29; // [sp+14h] [bp-3Ch]@14
  __int16 v30; // [sp+16h] [bp-3Ah]@14
  __int16 *v31; // [sp+18h] [bp-38h]@14

  v1 = (unsigned __int8)(*((_BYTE *)this + 222) >> 1);
  v2 = (*(int (**)(void))(**((_QWORD **)this + 18) + 2272LL))();
  v3 = 500;
  if ( *((_BYTE *)this + 426) )
    v3 = 900;
  v24 = v3;
  v4 = 50;
  if ( *((_BYTE *)this + 426) )
    v4 = 75;
  (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD, signed __int64))(**((_QWORD **)this + 18) + 640LL))(
    *((_QWORD *)this + 18),
    "Ports",
    *((_BYTE *)this + 218),
    32LL);
  v5 = v2 < v1;
  v6 = v2 - v1;
  if ( v5 )
  {
    *((_BYTE *)this + 314) = 0;
    *((_DWORD *)this + 82) = 0;
  }
  else
  {
    v7 = *((_BYTE *)this + 409);
    v8 = v4 * (*((_BYTE *)this + 218) - v7);
    *((_BYTE *)this + 314) = v6 >= (unsigned int)v8;
    if ( v7 )
    {
      v9 = v6 - v8;
      if ( v6 < (unsigned int)v8 )
        v9 = v6;
      *((_DWORD *)this + 82) = v9 / v7;
    }
    if ( *((_BYTE *)this + 756) & 1 )
      *((_DWORD *)this + 82) = v4;
  }
  *((_BYTE *)this + 315) = 0;
  if ( *((_BYTE *)this + 313) )
  {
    v25 = 0;
    *((_DWORD *)this + 82) = v4;
    v26 = -128;
    v27 = 0;
    v28 = 0;
    v29 = 0;
    v30 = 2;
    v31 = &v25;
    v10 = AppleUSBHub::DoDeviceRequest((__int64)this, (__int64)&v26);
    if ( v10 )
      return (unsigned int)v10;
    v11 = v25;
    *((_BYTE *)this + 315) = v25 & 1;
    if ( !(v11 & 1) && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D101Cu, *((_DWORD *)this + 74), 0LL, 0LL, 0LL, 0LL);
    if ( *((_BYTE *)this + 313) )
    {
      v12 = *((_BYTE *)this + 312);
      if ( *((_BYTE *)this + 315) )
      {
        if ( !*((_BYTE *)this + 160) && !*((_BYTE *)this + 163) )
        {
          LODWORD(v13) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 744LL))(
                           *((_QWORD *)this + 18),
                           "AAPL,standard-port-current-in-sleep");
          if ( v13 )
            (*(void (__fastcall **)(__int64))(*(_QWORD *)v13 + 40LL))(v13);
          else
            (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD, signed __int64))(**((_QWORD **)this + 18) + 640LL))(
              *((_QWORD *)this + 18),
              "AAPL,standard-port-current-in-sleep",
              (unsigned int)v24,
              32LL);
        }
      }
    }
  }
  if ( *((_BYTE *)this + 160) && (*(int (**)(void))(**((_QWORD **)this + 18) + 2616LL))() & 4 )
  {
    LODWORD(v14) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 744LL))(
                     *((_QWORD *)this + 18),
                     "AAPL,standard-port-current-in-sleep");
    if ( v14 )
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v14 + 40LL))(v14);
    else
      (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD, signed __int64))(**((_QWORD **)this + 18) + 640LL))(
        *((_QWORD *)this + 18),
        "AAPL,standard-port-current-in-sleep",
        (unsigned int)v24,
        32LL);
  }
  v10 = 0;
  if ( __PAIR__(*((_BYTE *)this + 315), *((_BYTE *)this + 314)) )
    goto LABEL_42;
  (*(void (__fastcall **)(_QWORD, signed __int64))(**((_QWORD **)this + 18) + 2456LL))(*((_QWORD *)this + 18), 1LL);
  (*(void (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 904LL))(*((_QWORD *)this + 18), 0LL);
  v15 = *((_DWORD *)this + 74);
  v16 = *((_BYTE *)this + 314);
  v17 = *((_BYTE *)this + 315);
  IOLog("USB Low Power Notice:  The hub \"%s\" at 0x%x cannot be used because there is not enough power for all its ports (%d, %d  %d, %d)\n");
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D101Cu, *((_DWORD *)this + 74), 0LL, 0LL, 1uLL, 0LL);
  v10 = -536870173;
  if ( *((_BYTE *)this + 312) )
  {
LABEL_42:
    LODWORD(v18) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                     *((_QWORD *)this + 18),
                     "HubWakePowerReserved");
    v19 = *(_QWORD *)off_1A030[0];
    v21 = OSMetaClassBase::safeMetaCast(v18, *(const OSMetaClassBase **)off_1A030[0], v20);
    if ( v21 && *((_BYTE *)this + 315) )
    {
      v22 = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v21 + 328LL))(v21, v19);
      (*(void (__fastcall **)(_QWORD, signed __int64, _QWORD))(off_1A050[0] + 2520))(
        *((_QWORD *)this + 18),
        1LL,
        (unsigned int)v22);
      (*(void (__fastcall **)(_QWORD, _QWORD, _QWORD, signed __int64))(**((_QWORD **)this + 18) + 640LL))(
        *((_QWORD *)this + 18),
        "HubWakePowerReserved",
        0LL,
        32LL);
    }
  }
  return (unsigned int)v10;
}
// 1A030: using guessed type _QWORD off_1A030[14];
// 1A050: using guessed type __int64 off_1A050[10];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAB0: using guessed type int __fastcall IOLog(_QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (0000000000005EE0) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::AllocatePortMemory(AppleUSBHub *this, unsigned __int64 a2)
{
  AppleUSBHub *v2; // r14@1
  signed int v3; // ecx@1
  signed int v4; // ecx@3
  __int64 v5; // rax@5
  __int64 result; // rax@5
  __int64 v7; // rax@7
  int v8; // ebx@7
  signed int v9; // er12@7
  unsigned int v10; // er15@7
  bool v11; // zf@10
  __int64 v12; // rax@10
  signed int v13; // ebx@11
  unsigned __int64 v14; // r13@17
  __int64 v15; // r14@17
  int v16; // ebx@18
  int v17; // eax@23
  char *v18; // rax@26
  signed int v19; // [sp+1Ch] [bp-54h]@3
  char v20; // [sp+23h] [bp-4Dh]@6
  signed int v21; // [sp+24h] [bp-4Ch]@5
  __int64 v22; // [sp+28h] [bp-48h]@5
  bool v23; // [sp+37h] [bp-39h]@13
  int v24; // [sp+38h] [bp-38h]@10
  bool v25; // [sp+3Ch] [bp-34h]@13
  char v26; // [sp+40h] [bp-30h]@9
  bool v27; // [sp+45h] [bp-2Bh]@1
  bool v28; // [sp+46h] [bp-2Ah]@1
  bool v29; // [sp+47h] [bp-29h]@13

  v2 = this;
  v28 = 0;
  v27 = 0;
  v3 = 50;
  if ( *((_BYTE *)this + 426) )
    v3 = 75;
  v19 = v3;
  v4 = 250;
  if ( *((_BYTE *)this + 426) )
    v4 = 450;
  v21 = v4;
  LODWORD(v5) = IOMalloc(8LL * *((_BYTE *)this + 218));
  v22 = v5;
  result = 3758097085LL;
  if ( v22 )
  {
    v20 = AppleUSBHub::ControllerHasMuxedPorts(this, 3758097085LL);
    if ( *((_BYTE *)this + 218) )
    {
      v7 = (__int64)((char *)this + 748);
      v8 = 0;
      v9 = 2;
      v10 = 1;
      do
      {
        if ( v20 )
        {
          a2 = v10;
          AppleUSBHub::GetACPIPortMuxProperties(v2, &v27, &v26, v7, v10);
        }
        v24 = v8;
        v12 = *((_BYTE *)v2 + (unsigned int)v8 + 226);
        v11 = ((unsigned int)v12 & v9) == 0;
        LOBYTE(v12) = *((_BYTE *)v2 + 315);
        if ( v11 )
        {
          v13 = v19;
          if ( (_BYTE)v12 )
            v13 = v21;
          a2 = v10;
          AppleUSBHub::GetACPIPortCaptiveProperties(v2, &v29, &v28, v12, v10);
          v25 = v28;
          v23 = v29 != 0;
        }
        else
        {
          v13 = v21;
          if ( !(_BYTE)v12 )
            v13 = *((_DWORD *)v2 + 82);
          v29 = 1;
          v28 = 0;
          v23 = 1;
          v25 = 0;
        }
        v14 = (unsigned __int64)v2;
        v15 = OSObject::operator new((OSObject *)stru_1A0.segname, a2);
        AppleUSBHubPort::AppleUSBHubPort(v15);
        a2 = v14;
        if ( (*(int (__fastcall **)(__int64, unsigned __int64, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v15 + 280LL))(
               v15,
               v14,
               v10,
               (unsigned int)v13,
               v23,
               v25 != 0) )
        {
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v15 + 40LL))(v15);
          *(_QWORD *)(v22 + 8LL * (v10 - 1)) = 0LL;
          v2 = (AppleUSBHub *)v14;
          v16 = v24;
        }
        else
        {
          *(_QWORD *)(v22 + 8LL * (v10 - 1)) = v15;
          v2 = (AppleUSBHub *)v14;
          v16 = v24;
          if ( v25 && *(_BYTE *)(v14 + 426) && *(_BYTE *)(v14 + 160) )
            ++*((_DWORD *)this + 187);
        }
        v9 *= 2;
        v17 = (unsigned int)v9 > 0x80;
        if ( (unsigned int)v9 > 0x80 )
          v9 = 1;
        v8 = v17 + v16;
        ++v10;
        v7 = *((_BYTE *)v2 + 218);
      }
      while ( v10 <= (unsigned int)v7 );
      v18 = (char *)this + 748;
    }
    else
    {
      v18 = (char *)this + 748;
    }
    if ( *(_DWORD *)v18 )
      IOUSBHubDevice::UpdateUnconnectedExternalPorts(*((IOUSBHubDevice **)v2 + 18), *(_DWORD *)v18 + 1000);
    *((_QWORD *)v2 + 52) = v22;
    result = 0LL;
  }
  return result;
}
// 1A0: using guessed type section_64 stru_1A0;
// 2BAB8: using guessed type int __fastcall IOMalloc(_QWORD);

//----- (0000000000006112) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SetPortRemoteWakeMask(AppleUSBHub *this, __int16 a2, unsigned int a3)
{
  __int64 result; // rax@2

  if ( a3 <= *((_BYTE *)this + 218) )
    result = AppleUSBHub::SetPortFeature(this, 27, (a2 << 8) + (unsigned __int16)a3);
  else
    result = 3758097090LL;
  return result;
}

//----- (000000000000613C) ----------------------------------------------------
char __fastcall AppleUSBHub::UnpackUSB2PortFlags(AppleUSBHub *this)
{
  unsigned __int8 v1; // al@1
  signed __int64 v2; // rcx@1
  signed __int64 v3; // rcx@3
  __int64 v4; // rsi@5
  char *v5; // rcx@5
  __int64 v6; // rdx@5
  char result; // al@6

  v1 = *((_BYTE *)this + 218);
  v2 = 240LL;
  do
  {
    *((_BYTE *)this + v2 + 3) = *((_BYTE *)this + v2);
    --v2;
  }
  while ( (signed int)v2 - 231 > 0 );
  v3 = 231LL;
  do
  {
    *((_BYTE *)this + v3 + 3) = *((_BYTE *)this + v3);
    --v3;
  }
  while ( (signed int)v3 - 222 > 0 );
  *((_BYTE *)this + 223) = 0;
  *((_WORD *)this + 112) = 0;
  v4 = (unsigned int)(v1 >> 3) + 1;
  v5 = (char *)this + v4;
  v6 = 0LL;
  do
  {
    result = v5[v6 + 226];
    *((_BYTE *)this + v6 + 235) = result;
    v5[v6++ + 226] = 0;
  }
  while ( (_DWORD)v4 != (_DWORD)v6 );
  return result;
}

//----- (00000000000061B6) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::UnpackUSB3PortFlags(AppleUSBHub *this)
{
  char *v1; // rdi@1
  __int64 result; // rax@1

  LOBYTE(result) = *((_BYTE *)this + 218) >> 3;
  v1 = (char *)this + 235;
  LODWORD(result) = (unsigned __int8)result + 1;
  do
  {
    *v1++ = -1;
    result = (unsigned int)(result - 1);
  }
  while ( (_DWORD)result );
  return result;
}

//----- (00000000000061DC) ----------------------------------------------------
int __fastcall AppleUSBHub::GetDeviceStatus(AppleUSBHub *this, unsigned __int16 *a2)
{
  char v3; // [sp+8h] [bp-18h]@1
  char v4; // [sp+9h] [bp-17h]@1
  __int16 v5; // [sp+Ah] [bp-16h]@1
  __int16 v6; // [sp+Ch] [bp-14h]@1
  __int16 v7; // [sp+Eh] [bp-12h]@1
  unsigned __int16 *v8; // [sp+10h] [bp-10h]@1

  v3 = -128;
  v4 = 0;
  v5 = 0;
  v6 = 0;
  v7 = 2;
  v8 = a2;
  return AppleUSBHub::DoDeviceRequest((__int64)this, (__int64)&v3);
}

//----- (0000000000006212) ----------------------------------------------------
__int64 __usercall AppleUSBHub::ControllerHasMuxedPorts@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  __int64 v2; // r14@2
  __int64 v3; // rax@2
  IORegistryEntry *v4; // rax@3
  IORegistryEntry *v5; // r14@3
  IOUSBController *v6; // rax@4
  __int64 result; // rax@4

  if ( AppleUSBHub::IsHubDeviceInternal(this, a2)
    && (v2 = off_1A078[0],
        LODWORD(v3) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 792LL))(
                        *((_QWORD *)this + 18),
                        *(_QWORD *)off_1A078[0]),
        v3)
    && (LODWORD(v4) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v3 + 792LL))(v3, *(_QWORD *)v2),
        (v5 = v4) != 0LL) )
  {
    LODWORD(v6) = (*(int (**)(void))(**((_QWORD **)this + 18) + 2264LL))();
    result = IOUSBController::IsControllerMuxed(v6, v5, *((_DWORD *)this + 74));
  }
  else
  {
    result = 0LL;
  }
  return result;
}
// 1A078: using guessed type __int64 off_1A078[5];

//----- (0000000000006286) ----------------------------------------------------
__int64 __usercall AppleUSBHub::GetACPIPortMuxProperties@<rax>(AppleUSBHub *this@<rdi>, bool *a2@<rdx>, char *a3@<rcx>, __int64 a4@<rax>, unsigned int a5@<esi>)
{
  char *v5; // r14@1
  bool *v6; // r12@1
  __int64 v7; // r13@2
  __int64 v8; // rax@2
  IORegistryEntry *v9; // rax@3
  IORegistryEntry *v10; // r13@3
  IOUSBController *v11; // rax@4
  __int64 result; // rax@4

  v5 = a3;
  v6 = a2;
  if ( AppleUSBHub::IsHubDeviceInternal(this, a4)
    && (v7 = off_1A078[0],
        LODWORD(v8) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 792LL))(
                        *((_QWORD *)this + 18),
                        *(_QWORD *)off_1A078[0]),
        v8)
    && (LODWORD(v9) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v8 + 792LL))(v8, *(_QWORD *)v7),
        (v10 = v9) != 0LL) )
  {
    LODWORD(v11) = (*(int (__cdecl **)(_QWORD))(**((_QWORD **)this + 18) + 2264LL))(*((_QWORD *)this + 18));
    result = IOUSBController::IsPortMuxed(v11, v10, a5, *((_DWORD *)this + 74), v5);
  }
  else
  {
    result = 0LL;
  }
  *v6 = result;
  return result;
}
// 1A078: using guessed type __int64 off_1A078[5];

//----- (0000000000006320) ----------------------------------------------------
char __usercall AppleUSBHub::GetACPIPortCaptiveProperties@<al>(AppleUSBHub *this@<rdi>, bool *a2@<rdx>, bool *a3@<rcx>, __int64 a4@<rax>, unsigned int a5@<esi>)
{
  bool *v5; // r15@1
  bool *v6; // r12@1
  __int64 v7; // rax@1
  IOUSBControllerV3 *v8; // rax@2
  __int64 v9; // r13@3
  const OSMetaClass *v10; // rdx@4
  IORegistryEntry *v11; // r13@4
  __int64 v13; // [sp-6h] [bp-30h]@1

  v13 = a4;
  v5 = a3;
  v6 = a2;
  *a2 = 0;
  *a3 = 0;
  LOBYTE(v7) = AppleUSBHub::IsHubDeviceInternal(this, a4);
  if ( (_BYTE)v7 || (LOBYTE(v8) = AppleUSBHub::IsHubDeviceInternalAndOnThunderbolt(this, v7), (_BYTE)v8) )
  {
    v9 = off_1A078[0];
    LODWORD(v8) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 792LL))(
                    *((_QWORD *)this + 18),
                    *(_QWORD *)off_1A078[0]);
    if ( v8 )
    {
      LODWORD(v8) = (*(int (__fastcall **)(IOUSBControllerV3 *, _QWORD))(*(_QWORD *)v8 + 792LL))(v8, *(_QWORD *)v9);
      v11 = v8;
      if ( v8 )
      {
        if ( *((_QWORD *)this + 18) )
        {
          v8 = (IOUSBControllerV3 *)OSMetaClassBase::safeMetaCast(
                                      *((OSMetaClassBase **)this + 17),
                                      *(const OSMetaClassBase **)off_1A020[0],
                                      v10);
          if ( v8 )
          {
            BYTE7(v13) = -2;
            if ( !(unsigned int)IOUSBControllerV3::GetConnectorType(
                                  v8,
                                  v11,
                                  a5,
                                  *((_DWORD *)this + 74),
                                  (unsigned __int8 *)&v13 + 7) )
            {
              if ( BYTE7(v13) == 255 )
              {
                *v6 = 1;
              }
              else if ( BYTE7(v13) <= 7u )
              {
                *v5 = 1;
              }
            }
            LODWORD(v8) = *((_DWORD *)this + 188);
            if ( _bittest((const unsigned int *)&v8, a5) )
              *v5 = 1;
          }
        }
      }
    }
  }
  return (char)v8;
}
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A078: using guessed type __int64 off_1A078[5];
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000641A) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::HubPowerChange(AppleUSBHub *this, uintptr_t arg2, __int64 a3, __int64 a4, __int64 a5)
{
  unsigned __int64 v5; // r14@1
  AppleUSBHub *v6; // r12@1
  __int64 v7; // r13@1
  uintptr_t v8; // r15@2
  uintptr_t v9; // rbx@2
  unsigned __int8 v10; // al@2
  __int64 v11; // rdx@8
  __int64 v12; // rcx@8
  __int64 v13; // rax@10
  uintptr_t v14; // rsi@18
  uintptr_t v15; // rdx@18
  uintptr_t v16; // rcx@18
  uintptr_t v17; // r8@18
  __int64 v18; // rdi@24
  signed int v19; // ebx@25
  unsigned int v20; // ebx@29
  char v21; // al@29
  __int64 v22; // r8@29
  unsigned int v23; // ebx@35
  __int64 v24; // rax@39
  int v25; // ebx@44
  __int64 v26; // r8@44
  uintptr_t v27; // rdx@47
  uintptr_t v28; // r8@47
  __int64 v29; // rdi@49
  __int64 v30; // rdi@52
  unsigned int v31; // eax@55
  __int64 v32; // rdi@58
  uintptr_t v33; // rbx@65
  int v34; // eax@65
  __int64 v35; // rdi@68
  int v36; // eax@70
  uintptr_t v37; // rdx@73
  uintptr_t v38; // rsi@73
  uintptr_t v39; // r8@73
  signed int v40; // er15@75
  bool v41; // cf@79
  int v42; // eax@83
  int v43; // ebx@88
  __int64 v44; // r8@88
  __int64 v45; // rdi@95
  unsigned int v46; // ebx@97
  __int64 v47; // r8@97
  __int64 v48; // rdi@102
  uintptr_t v49; // rbx@105
  __int64 v50; // rax@106
  unsigned __int16 v52; // [sp+8h] [bp-38h]@76
  __int16 v53; // [sp+Ah] [bp-36h]@77
  char v54; // [sp+10h] [bp-30h]@6

  v5 = arg2;
  v6 = this;
  v7 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    v8 = *((_DWORD *)this + 74);
    v9 = *((_BYTE *)this + 318);
    v10 = IOService::isInactive(this);
    a4 = off_1A098;
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      arg2 = v8;
      kernel_debug(0x52D1021u, v8, v5, v9, v10, 0LL);
    }
  }
  if ( *((_QWORD *)this + 21) == 2LL && v5 >= 3 )
  {
    clock_get_uptime((char *)this + 1024);
    arg2 = (uintptr_t)&v54;
    absolutetime_to_nanoseconds(*((_QWORD *)this + 128), &v54);
  }
  if ( v5 > 4 )
  {
LABEL_8:
    v11 = (__int64)"AppleUSBHub::HubPowerChange - unknown ordinal (%d)";
    v12 = (unsigned int)v5;
LABEL_9:
    KernelDebugLogInternal(1LL, 1431519814LL, v11, v12, a5);
    goto LABEL_105;
  }
  v13 = (__int64)off_6D28;
  switch ( v5 )
  {
    case 0uLL:
    case 1uLL:
      if ( *((_BYTE *)this + 160) )
      {
        *((_BYTE *)this + 434) = 1;
        clock_get_uptime((char *)this + 440);
      }
      AppleUSBHub::StopPorts(this);
      goto LABEL_14;
    case 2uLL:
      if ( *((_BYTE *)this + 306) )
      {
        if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v14 = *((_DWORD *)this + 74);
          v15 = 0LL;
          v16 = 0LL;
          v17 = 9LL;
          goto LABEL_101;
        }
        goto LABEL_105;
      }
      if ( !((*(int (__fastcall **)(_QWORD, uintptr_t))(**((_QWORD **)this + 18) + 2616LL))(
               *((_QWORD *)this + 18),
               arg2) & 4) )
      {
        if ( *(_BYTE *)v7 & 2 )
        {
          v33 = *((_DWORD *)this + 74);
          v34 = (*(int (**)(void))(**((_QWORD **)this + 18) + 2616LL))();
          if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(0x52D1020u, v33, (unsigned int)v34, 0LL, 0xAuLL, 0LL);
        }
        goto LABEL_105;
      }
      v30 = *((_QWORD *)this + 56);
      if ( v30 )
        (*(void (**)(void))(*(_QWORD *)v30 + 536LL))();
      if ( !*((_BYTE *)v6 + 304) )
      {
        v31 = AppleUSBHub::SuspendPorts(v6, arg2);
        v12 = v31;
        if ( v31 )
        {
          v11 = (__int64)"AppleUSBHub::HubPowerChange - SuspendPorts failed with 0x%x";
          goto LABEL_9;
        }
        if ( *((_QWORD *)v6 + 18) && !*((_BYTE *)v6 + 160) )
        {
          IOSleep(25LL);
          v42 = (*(int (__fastcall **)(_QWORD, signed __int64))(**((_QWORD **)v6 + 18) + 2440LL))(
                  *((_QWORD *)v6 + 18),
                  1LL);
          if ( !v42 )
            goto LABEL_121;
          if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v37 = v42;
            v38 = *((_DWORD *)v6 + 74);
            v39 = 12LL;
            goto LABEL_87;
          }
        }
      }
      goto LABEL_14;
    case 3uLL:
      if ( *((_BYTE *)this + 162) )
      {
        if ( !(*(_BYTE *)v7 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
          goto LABEL_105;
        v16 = *((_QWORD *)this + 21);
        v15 = *((_BYTE *)this + 304);
        v14 = *((_DWORD *)this + 74);
        v17 = 5LL;
        goto LABEL_101;
      }
      if ( *((_QWORD *)this + 21) < 4uLL )
        goto LABEL_14;
      v32 = *((_QWORD *)this + 56);
      if ( v32 )
        LODWORD(v13) = (*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v32 + 536LL))(v32, arg2);
      if ( *((_BYTE *)v6 + 304) )
      {
        if ( !(*(_BYTE *)v7 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
          goto LABEL_105;
        v14 = *((_DWORD *)v6 + 74);
        v15 = 0LL;
        v16 = 0LL;
        v17 = 6LL;
LABEL_101:
        kernel_debug(0x52D1020u, v14, v15, v16, v17, 0LL);
        goto LABEL_105;
      }
      if ( AppleUSBHub::HubAreAllPortsDisconnectedOrSuspended(v6, v13) )
      {
        v35 = *((_QWORD *)v6 + 18);
        if ( v35 && !*((_BYTE *)v6 + 160) )
        {
          v36 = (*(int (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v35 + 2440LL))(v35, 1LL);
          if ( v36 )
          {
            if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            {
              v37 = v36;
              v38 = *((_DWORD *)v6 + 74);
              v39 = 8LL;
LABEL_87:
              kernel_debug(0x52D1020u, v38, v37, 0LL, v39, 0LL);
            }
          }
          else
          {
LABEL_121:
            *((_BYTE *)v6 + 304) = 1;
          }
        }
        goto LABEL_14;
      }
      if ( !*((_BYTE *)v6 + 218) )
        goto LABEL_120;
      v40 = 1;
      while ( 1 )
      {
        arg2 = (uintptr_t)&v52;
        if ( !(unsigned int)AppleUSBHub::GetPortStatus(v6, (__int64)&v52, (unsigned __int16)v40)
          && !v53
          && (v52 & 7) == 3 )
          break;
        v41 = v40++ < (unsigned int)*((_BYTE *)v6 + 218);
        if ( !v41 )
          goto LABEL_120;
      }
      if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1020u, *((_DWORD *)v6 + 74), (unsigned int)v40, (unsigned __int64)v52 << 32, 7uLL, 0LL);
      if ( *((_BYTE *)v6 + 160) )
      {
        arg2 = 1431519814LL;
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBHub(0x%x)::HubPowerChange - RootHub port %d (status: 0x%x change: 0x%x) connected, enabled and not suspended - UNEXPECTED",
          *((_DWORD *)v6 + 74),
          (unsigned int)v40);
LABEL_120:
        (*(void (__fastcall **)(AppleUSBHub *, uintptr_t))(*(_QWORD *)v6 + 2128LL))(v6, arg2);
      }
LABEL_14:
      *((_BYTE *)v6 + 318) = 0;
      goto LABEL_105;
    case 4uLL:
      if ( *((_BYTE *)this + 304) )
      {
        v18 = *((_QWORD *)this + 18);
        if ( v18 )
        {
          arg2 = 0LL;
          (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v18 + 2440LL))(v18, 0LL);
          v19 = 20;
          do
          {
            IOSleep(20LL);
            if ( !*((_BYTE *)v6 + 304) )
              break;
            --v19;
          }
          while ( v19 != -1 );
          IOSleep(*((_DWORD *)v6 + 46));
          if ( !v19 )
          {
            v20 = *((_DWORD *)v6 + 74);
            v21 = (*(int (**)(void))(**((_QWORD **)v6 + 35) + 304LL))();
            v22 = (__int64)"false";
            if ( v21 )
              v22 = (__int64)"true";
            arg2 = 1431519814LL;
            KernelDebugLogInternal(
              1LL,
              1431519814LL,
              "AppleUSBHub::HubPowerChange - hub (0x%x) going to ON - my port is suspended, could not wake it up!  onThread(%s)",
              v20,
              v22);
            if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            {
              arg2 = *((_DWORD *)v6 + 74);
              kernel_debug(0x52D1020u, arg2, *((_QWORD *)v6 + 18), 0LL, 0LL, 0LL);
            }
          }
        }
      }
      if ( !*((_QWORD *)v6 + 52) )
      {
        v23 = AppleUSBHub::AllocatePortMemory(v6, arg2);
        if ( v23 )
        {
          arg2 = 1431519814LL;
          KernelDebugLogInternal(
            1LL,
            1431519814LL,
            "AppleUSBHub::HubPowerChange - AllocatePortMemory failed with 0x%x",
            v23,
            a5);
          if ( *(_BYTE *)v7 & 2 )
          {
            if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            {
              arg2 = *((_DWORD *)v6 + 74);
              kernel_debug(0x52D1020u, arg2, (signed int)v23, 0LL, 1uLL, 0LL);
            }
          }
        }
      }
      v24 = *((_QWORD *)v6 + 21);
      if ( (unsigned __int64)v24 > 2 )
      {
        if ( !*((_BYTE *)v6 + 160) )
        {
          v29 = *((_QWORD *)v6 + 32);
          if ( v29 )
            (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v29 + 488LL))(v29, 1LL);
        }
        goto LABEL_102;
      }
      if ( !*((_QWORD *)v6 + 18)
        || (unsigned __int64)v24 > 1
        || !AppleUSBHub::IsHubDeviceInternal(v6, v24)
        || !*((_BYTE *)v6 + 1065) )
        goto LABEL_94;
      v25 = (*(int (__fastcall **)(_QWORD, signed __int64))(**((_QWORD **)v6 + 18) + 2440LL))(*((_QWORD *)v6 + 18), 1LL);
      if ( v25 )
      {
        arg2 = 1431519814LL;
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBHub::HubPowerChange - Inoculation SUSPEND failed with 0x%x",
          (unsigned int)v25,
          v26);
        if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v27 = v25;
          arg2 = *((_DWORD *)v6 + 74);
          v28 = 3LL;
LABEL_92:
          kernel_debug(0x52D1020u, arg2, v27, 0LL, v28, 0LL);
          goto LABEL_94;
        }
      }
      else
      {
        IOSleep(30LL);
        arg2 = 0LL;
        v43 = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)v6 + 18) + 2440LL))(*((_QWORD *)v6 + 18), 0LL);
        if ( v43 )
        {
          arg2 = 1431519814LL;
          KernelDebugLogInternal(
            1LL,
            1431519814LL,
            "AppleUSBHub::HubPowerChange - Inoculation RESUME failed with 0x%x",
            (unsigned int)v43,
            v44);
          if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v27 = v43;
            arg2 = *((_DWORD *)v6 + 74);
            v28 = 2LL;
            goto LABEL_92;
          }
        }
        else
        {
          IOSleep(*((_DWORD *)v6 + 46));
        }
      }
LABEL_94:
      if ( !*((_BYTE *)v6 + 160) )
      {
        v45 = *((_QWORD *)v6 + 32);
        if ( v45 )
        {
          arg2 = 1LL;
          (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v45 + 488LL))(v45, 1LL);
        }
      }
      v46 = AppleUSBHub::StartPorts(v6, arg2, a3, a4, a5);
      if ( !v46 )
      {
LABEL_102:
        v48 = *((_QWORD *)v6 + 56);
        if ( v48 )
          (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v48 + 464LL))(v48, 30000LL);
        *((_BYTE *)v6 + 307) = 0;
        *((_BYTE *)v6 + 318) = 1;
        goto LABEL_105;
      }
      KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBHub::HubPowerChange - StartPorts failed with 0x%x", v46, v47);
      if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v15 = (signed int)v46;
        v14 = *((_DWORD *)v6 + 74);
        v16 = 0LL;
        v17 = 4LL;
        goto LABEL_101;
      }
LABEL_105:
      v49 = 0LL;
      if ( *((_DWORD *)v6 + 182) )
      {
        *((_BYTE *)v6 + 428) = 1;
        AppleUSBHub::IncrementOutstandingIO(v6, 0);
        (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v6 + 32LL))(v6, 0LL);
        LODWORD(v50) = thread_call_enter(*((_QWORD *)v6 + 47));
        v49 = 1LL;
        if ( (_DWORD)v50 == 1 )
        {
          if ( *(_BYTE *)v7 & 2 )
          {
            v50 = off_1A098;
            if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(0x52D1020u, *((_DWORD *)v6 + 74), 0LL, 0LL, 0xDuLL, 0LL);
          }
          AppleUSBHub::DecrementOutstandingIO(v6, v50, 0);
          (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v6 + 40LL))(v6, 0LL);
        }
      }
      if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1022u, *((_DWORD *)v6 + 74), v5, *((_BYTE *)v6 + 318), v49, 0LL);
      return (unsigned int)v49;
    default:
      goto LABEL_8;
  }
}
// 6D28: using guessed type void *__ptr32 off_6D28[5];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2C750: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);
// 2C760: using guessed type int __fastcall clock_get_uptime(_QWORD);
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (0000000000006D3C) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::StartPorts(AppleUSBHub *this, __int64 a2, __int64 a3, __int64 a4, __int64 a5)
{
  AppleUSBHub *v5; // r14@1
  uintptr_t v6; // r15@2
  uintptr_t v7; // rbx@2
  unsigned __int8 v8; // al@2
  signed int v9; // er13@5
  signed __int64 v10; // rsi@6
  __int64 v11; // rax@6
  __int64 v12; // r8@6
  __int64 v13; // rdi@6
  uintptr_t v14; // rbx@9
  int v15; // eax@9
  unsigned __int8 v16; // al@12
  uintptr_t v17; // r15@13
  __int64 v18; // r12@13
  uintptr_t v19; // rcx@14
  __int64 v20; // rdx@14
  uintptr_t v21; // rbx@15
  __int64 v22; // rdi@18
  __int64 v23; // rdi@25
  uintptr_t v24; // rbx@28
  int v25; // eax@28
  int v26; // eax@32
  signed __int64 v27; // r12@32
  __int64 v28; // rax@34
  uintptr_t v29; // r15@35
  __int64 v30; // rdx@39
  int v31; // er13@39
  __int64 v32; // rcx@39
  __int64 v33; // rax@44
  __int64 v34; // rax@44
  __int64 v35; // rax@44
  __int64 v36; // rax@46
  unsigned __int64 v37; // rax@55
  __int64 v38; // rdi@55
  signed __int64 v39; // rax@57
  __int64 v40; // rcx@57
  __int64 v41; // rdi@60
  __int64 v42; // rax@64
  __int64 v43; // rax@64
  __int64 v44; // rax@64
  signed __int64 v45; // rax@66
  __int64 v46; // rcx@67
  __int64 v47; // rdx@68
  __int64 v48; // rdi@68
  __int64 v49; // rdx@70
  int v50; // er13@76
  __int16 v51; // dx@82
  int v52; // eax@89
  __int64 v53; // rcx@89
  __int64 v54; // r13@91
  __int64 v55; // rdi@91
  int v56; // er13@96
  __int64 v57; // rdi@110
  OSMetaClassBase *v58; // rax@111
  const OSMetaClass *v59; // rdx@111
  __int64 v60; // rax@111
  __int64 v61; // r13@111
  __int64 v62; // rdi@112
  void (__fastcall *v63)(_QWORD, _QWORD, _QWORD); // ST08_8@113
  uintptr_t v64; // rbx@119
  unsigned __int8 v65; // al@119
  __int64 v67; // [sp+8h] [bp-68h]@89
  __int64 v68; // [sp+18h] [bp-58h]@32
  const OSMetaClassBase *v69; // [sp+20h] [bp-50h]@32
  int v70; // [sp+2Ch] [bp-44h]@32
  __int64 v71; // [sp+30h] [bp-40h]@6
  __int64 v72; // [sp+38h] [bp-38h]@6
  int v73; // [sp+40h] [bp-30h]@39

  v5 = this;
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    v6 = *((_DWORD *)this + 74);
    v7 = *((_BYTE *)this + 218);
    v8 = IOService::isInactive(this);
    a4 = off_1A098;
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10B5u, v6, v7, v8, 0LL, 0LL);
  }
  if ( *((_QWORD *)this + 52) )
  {
    v9 = 0;
    if ( !(unsigned __int8)IOService::isInactive(this) )
    {
      v10 = (signed __int64)"kHubPowerSequencingDelay";
      LODWORD(v11) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                       *((_QWORD *)this + 18),
                       "kHubPowerSequencingDelay");
      v72 = v11;
      v71 = **(_QWORD **)off_1A090[0];
      v13 = *((_QWORD *)this + 92);
      if ( v13 && (*(int (**)(void))(*(_QWORD *)v13 + 304LL))() )
      {
        if ( *(_BYTE *)off_1A080[0] & 2 )
        {
          v14 = *((_DWORD *)v5 + 74);
          v15 = (*(int (**)(void))(**((_QWORD **)v5 + 92) + 304LL))();
          if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v10 = v14;
            kernel_debug(0x52D10B4u, v14, (unsigned int)v15, 0LL, 0LL, 0LL);
          }
        }
        (*(void (__fastcall **)(_QWORD, signed __int64))(**((_QWORD **)v5 + 92) + 344LL))(*((_QWORD *)v5 + 92), v10);
      }
      v16 = *((_BYTE *)v5 + 218);
      if ( v16 )
      {
        v17 = 0LL;
        v18 = off_1A098;
        do
        {
          v19 = v17++;
          v20 = *((_QWORD *)v5 + 52);
          if ( v20 )
          {
            v21 = *(_QWORD *)(v20 + 8 * v19);
            if ( v21 )
            {
              (*(void (__fastcall **)(_QWORD))(*(_QWORD *)v21 + 32LL))(*(_QWORD *)(v20 + 8 * v19));
              if ( *(_DWORD *)(v21 + 96) == 1 )
              {
                if ( *(_QWORD *)(v21 + 80) )
                {
                  v22 = *((_QWORD *)v5 + 92);
                  if ( v22
                    || (v22 = OSArray::withCapacity((OSArray *)*((_BYTE *)v5 + 218), v10),
                        (*((_QWORD *)v5 + 92) = v22) != 0LL) )
                  {
                    v10 = v21;
                    (*(void (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v22 + 440LL))(v22, v21);
                    if ( *(_BYTE *)off_1A080[0] & 2 )
                    {
                      if ( *(_DWORD *)v18 & 0xFFFFFFF7 )
                      {
                        v10 = *((_DWORD *)v5 + 74);
                        kernel_debug(0x52D10B4u, v10, v17, v21, 1uLL, 0LL);
                      }
                    }
                  }
                }
              }
              (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)v21 + 40LL))(v21);
              v16 = *((_BYTE *)v5 + 218);
            }
          }
        }
        while ( (signed int)v17 < v16 );
      }
      v23 = *((_QWORD *)v5 + 92);
      if ( v23 && (*(int (**)(void))(*(_QWORD *)v23 + 304LL))() )
      {
        if ( *(_BYTE *)off_1A080[0] & 2 )
        {
          v24 = *((_DWORD *)v5 + 74);
          v25 = (*(int (**)(void))(**((_QWORD **)v5 + 92) + 304LL))();
          if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(0x52D10B4u, v24, (unsigned int)v25, 0LL, 2uLL, 0LL);
        }
        v10 = (signed __int64)AppleUSBHub::ProcessAllNotificationsForEvent;
        (*(void (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleUSBHub *, OSArray *, uintptr_t), _QWORD, signed __int64, _QWORD, _QWORD))(**((_QWORD **)v5 + 34) + 456LL))(
          *((_QWORD *)v5 + 34),
          AppleUSBHub::ProcessAllNotificationsForEvent,
          *((_QWORD *)v5 + 92),
          4LL,
          0LL,
          0LL);
      }
      if ( *((_BYTE *)v5 + 218) )
      {
        v69 = *(const OSMetaClassBase **)off_1A020[0];
        v26 = (_DWORD)v5 + 1032;
        LOBYTE(v26) = 1;
        v70 = v26;
        LODWORD(v27) = 0;
        v68 = 0LL;
        while ( 1 )
        {
          v27 = (signed int)v27 + 1LL;
          while ( 1 )
          {
            v28 = *((_QWORD *)v5 + 52);
            if ( v28 )
            {
              v29 = *(_QWORD *)(v28 + 8 * v27 - 8);
              if ( v29 )
                break;
            }
            v9 = 0;
            v10 = 1431519814LL;
            KernelDebugLogInternal(
              1LL,
              1431519814LL,
              "AppleUSBHub::StartPorts - port (%d) unexpectedly missing",
              (unsigned int)v27++,
              v12);
            if ( (signed int)v27 - 1 >= *((_BYTE *)v5 + 218) )
              goto LABEL_118;
          }
          (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)v29 + 32LL))(v29);
          if ( !*(_DWORD *)(v29 + 96) )
          {
            if ( v70 & 1 )
            {
              AppleUSBHub::RaisePowerState(v5, (unsigned int)v70);
              (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)v5 + 32LL))(v5);
              LODWORD(v36) = thread_call_enter(*((_QWORD *)v5 + 49));
              if ( (_DWORD)v36 == 1 )
              {
                AppleUSBHub::LowerPowerState(v5, v36);
                (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)v5 + 40LL))(v5);
              }
              v70 = 0;
            }
            if ( v72 == v71 )
              IOSleep(2 * (unsigned int)*((_BYTE *)v5 + 221));
            (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)v29 + 312LL))(v29);
            goto LABEL_114;
          }
          v73 = 0;
          v10 = (signed __int64)&v73;
          v31 = AppleUSBHub::GetPortStatus(v5, (__int64)&v73, (unsigned __int16)v27);
          LOBYTE(v32) = 1;
          if ( !v31 )
            break;
LABEL_73:
          if ( *(_DWORD *)(v29 + 96) != 1 )
          {
            if ( *((_BYTE *)v5 + 426) )
            {
              v32 = ((unsigned int)(unsigned __int16)v73 >> 5) & 7;
              if ( ((unsigned int)v32 | ((unsigned int)(unsigned __int16)v73 >> 11) & 8) == 3 )
              {
                v10 = 2LL;
                AppleUSBHub::ClearPortFeature(v5, 2, v27);
              }
            }
            goto LABEL_115;
          }
          if ( !v31 )
          {
            if ( BYTE2(v73) & 5 )
            {
              v10 = v29;
              v50 = (*(int (__fastcall **)(_QWORD, uintptr_t, _QWORD, __int64))(**((_QWORD **)v5 + 92) + 504LL))(
                      *((_QWORD *)v5 + 92),
                      v29,
                      0LL,
                      v32);
              if ( v50 != -1 )
              {
                if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                  kernel_debug(0x52D10B4u, *((_DWORD *)v5 + 74), v29, v50, 3uLL, 0LL);
                v10 = (unsigned int)v50;
                (*(void (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)v5 + 92) + 472LL))(
                  *((_QWORD *)v5 + 92),
                  (unsigned int)v50);
              }
              if ( BYTE2(v73) & 4 )
              {
                v51 = v27;
                v10 = 18LL;
              }
              else
              {
                if ( !*((_BYTE *)v5 + 426)
                  || (((unsigned int)(unsigned __int16)v73 >> 5) & 7 | ((unsigned int)(unsigned __int16)v73 >> 11) & 8) != 3 )
                  goto LABEL_110;
                v51 = v27;
                v10 = 2LL;
              }
              AppleUSBHub::ClearPortFeature(v5, v10, v51);
LABEL_110:
              IOSleep(*(_DWORD *)(v29 + 128));
              v57 = *((_QWORD *)v5 + 18);
              if ( v57 )
              {
                LODWORD(v58) = (*(int (**)(void))(*(_QWORD *)v57 + 2264LL))();
                v10 = (signed __int64)v69;
                v60 = OSMetaClassBase::safeMetaCast(v58, v69, v59);
                v61 = v60;
                if ( v60 )
                {
                  v62 = *(_QWORD *)(v29 + 80);
                  if ( v62 )
                  {
                    v63 = *(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(*(_QWORD *)v60 + 3136LL);
                    v10 = (unsigned __int16)(*(int (__fastcall **)(__int64, const OSMetaClassBase *))(*(_QWORD *)v62 + 2248LL))(
                                              v62,
                                              v69);
                    v63(v61, v10, 1LL);
                  }
                }
              }
LABEL_114:
              *(_DWORD *)(v29 + 96) = 3;
              goto LABEL_115;
            }
            if ( !(v73 & 4) )
            {
              v10 = v29;
              v56 = (*(int (__fastcall **)(_QWORD, uintptr_t, _QWORD, __int64))(**((_QWORD **)v5 + 92) + 504LL))(
                      *((_QWORD *)v5 + 92),
                      v29,
                      0LL,
                      v32);
              if ( v56 != -1 )
              {
                if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                  kernel_debug(0x52D10B4u, *((_DWORD *)v5 + 74), v29, v56, 3uLL, 0LL);
                v10 = (unsigned int)v56;
                (*(void (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)v5 + 92) + 472LL))(
                  *((_QWORD *)v5 + 92),
                  (unsigned int)v56);
              }
              if ( (v73 & 3) == 1 && AppleUSBHubPort::HasExpressCardCantWake((AppleUSBHubPort *)v29) )
              {
                if ( (unsigned __int16)v27 <= (unsigned int)*((_BYTE *)v5 + 218) )
                {
                  v10 = 8LL;
                  AppleUSBHub::ClearPortFeature(v5, 8, v27);
                }
                IOSleep(100LL);
                if ( (unsigned __int16)v27 <= (unsigned int)*((_BYTE *)v5 + 218) )
                {
                  v10 = 8LL;
                  AppleUSBHub::SetPortFeature(v5, 8, v27);
                }
              }
              goto LABEL_110;
            }
            if ( v68 & 1 )
              goto LABEL_124;
            v67 = v32;
            v9 = 0;
            v10 = 0LL;
            v52 = AppleUSBHubPort::SuspendPort(v29, v68, 0, 0);
            if ( v52 == -536870163 )
              goto LABEL_118;
            LOBYTE(v53) = 1;
            v68 = v53;
            v32 = v67;
            if ( !v52 )
            {
LABEL_124:
              v54 = v32;
              v10 = 0LL;
              AppleUSBHub::IncrementOutstandingIO(v5, 0);
              v55 = *((_QWORD *)v5 + 34);
              if ( v55 )
              {
                v10 = (signed __int64)AppleUSBHub::ChangeOutstandingResumes;
                (*(void (__fastcall **)(__int64, __int64 (__fastcall *)(uintptr_t, uintptr_t, void *, void *, void *, void *), signed __int64, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v55 + 456LL))(
                  v55,
                  AppleUSBHub::ChangeOutstandingResumes,
                  1LL,
                  0LL,
                  0LL,
                  0LL);
              }
              else
              {
                ++*((_DWORD *)v5 + 182);
              }
              v32 = v54;
            }
          }
          if ( (_BYTE)v32 )
            goto LABEL_110;
LABEL_115:
          (*(void (__fastcall **)(uintptr_t, signed __int64, __int64, __int64))(*(_QWORD *)v29 + 40LL))(
            v29,
            v10,
            v30,
            v32);
          v9 = 0;
          if ( (signed int)v27 >= *((_BYTE *)v5 + 218) )
            goto LABEL_118;
        }
        if ( BYTE2(v73) & 1 && v73 & 1 )
        {
          if ( *((_DWORD *)v5 + 265) == (_DWORD)v27 && *((_BYTE *)v5 + 1057) )
          {
            AppleUSBHubPort::DetectExpressCardCantWake((AppleUSBHubPort *)v29);
            LODWORD(v33) = (*(int (__fastcall **)(_QWORD, int *))(**((_QWORD **)v5 + 18) + 2264LL))(
                             *((_QWORD *)v5 + 18),
                             &v73);
            (*(void (__fastcall **)(__int64))(*(_QWORD *)v33 + 32LL))(v33);
            LODWORD(v34) = (*(int (**)(void))(**((_QWORD **)v5 + 18) + 2264LL))();
            v10 = 3758112784LL;
            (*(void (__fastcall **)(__int64, signed __int64, AppleUSBHub *, _QWORD))(*(_QWORD *)v34 + 1840LL))(
              v34,
              3758112784LL,
              v5,
              *((_QWORD *)v5 + 18));
            LODWORD(v35) = (*(int (**)(void))(**((_QWORD **)v5 + 18) + 2264LL))();
            (*(void (__fastcall **)(__int64))(*(_QWORD *)v35 + 40LL))(v35);
          }
          goto LABEL_72;
        }
        if ( BYTE2(v73) & 5 )
        {
          if ( (BYTE2(v73) & 5) == 4 )
          {
            if ( !*(_BYTE *)(v29 + 407) )
            {
              v37 = computeDeltaTimeMS((const unsigned __int64 *)v5 + 129);
              *(_BYTE *)(v29 + 407) = 1;
              v38 = *(_QWORD *)(v29 + 80);
              if ( v38 )
              {
                if ( v37 <= 0x3E7 )
                {
                  LODWORD(v39) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v38 + 904LL))(v38, 0LL);
                  v40 = *((_DWORD *)v5 + 74);
                  v10 = v39;
                  IOLog("The USB device %s (Port %d of Hub at 0x%x) may have caused a wake by issuing a remote wakeup (3)\n");
                }
                (*(void (__fastcall **)(uintptr_t, signed __int64))(*(_QWORD *)v29 + 32LL))(v29, v10);
                (*(void (**)(void))(**(_QWORD **)(v29 + 80) + 32LL))();
                v10 = 3758097232LL;
                (*(void (__fastcall **)(_QWORD, signed __int64, _QWORD, _QWORD))(**(_QWORD **)(v29 + 80) + 1856LL))(
                  *(_QWORD *)(v29 + 80),
                  3758097232LL,
                  0LL,
                  0LL);
                (*(void (**)(void))(**(_QWORD **)(v29 + 80) + 40LL))();
                (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)v29 + 40LL))(v29);
                goto LABEL_72;
              }
              if ( v37 <= 0x3E7 )
              {
                v49 = *((_DWORD *)v5 + 74);
                v48 = (__int64)"An unknown USB device (Port %d of Hub at 0x%x) may have caused a wake by issuing a remote wakeup\n";
LABEL_71:
                v10 = (unsigned int)v27;
                IOLog(v48);
                goto LABEL_72;
              }
            }
          }
          else if ( BYTE2(v73) & 1 )
          {
            v41 = *(_QWORD *)(v29 + 80);
            if ( v41 )
            {
              if ( !(BYTE1(v73) & 1) )
                goto LABEL_125;
              if ( *((_DWORD *)v5 + 265) == (_DWORD)v27 && *((_BYTE *)v5 + 1057) )
              {
                AppleUSBHubPort::DetectExpressCardCantWake((AppleUSBHubPort *)v29);
                LODWORD(v42) = (*(int (__fastcall **)(_QWORD, int *))(**((_QWORD **)v5 + 18) + 2264LL))(
                                 *((_QWORD *)v5 + 18),
                                 &v73);
                (*(void (__fastcall **)(__int64))(*(_QWORD *)v42 + 32LL))(v42);
                LODWORD(v43) = (*(int (**)(void))(**((_QWORD **)v5 + 18) + 2264LL))();
                (*(void (__fastcall **)(__int64, signed __int64, AppleUSBHub *, _QWORD))(*(_QWORD *)v43 + 1840LL))(
                  v43,
                  3758112784LL,
                  v5,
                  *((_QWORD *)v5 + 18));
                LODWORD(v44) = (*(int (**)(void))(**((_QWORD **)v5 + 18) + 2264LL))();
                (*(void (__fastcall **)(__int64))(*(_QWORD *)v44 + 40LL))(v44);
                v41 = *(_QWORD *)(v29 + 80);
              }
              v10 = (signed __int64)"no device";
              if ( v41 )
              {
LABEL_125:
                LODWORD(v45) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v41 + 904LL))(v41, 0LL);
                v10 = v45;
              }
              v46 = *((_DWORD *)v5 + 74);
              IOLog("The USB device %s (Port %d of Hub at 0x%x) may have caused a wake by being disconnected\n");
              goto LABEL_72;
            }
            v47 = *((_DWORD *)v5 + 74);
            v48 = (__int64)"An Unknown USB Device (Port %d of Hub at 0x%x), may have caused a wake by being connected\n";
            goto LABEL_71;
          }
        }
LABEL_72:
        v32 = 0LL;
        goto LABEL_73;
      }
    }
  }
  else
  {
    KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBHub::StartPorts - no memory for ports!!", a4, a5);
    v9 = -536870211;
  }
LABEL_118:
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    v64 = *((_DWORD *)v5 + 74);
    v65 = IOService::isInactive(v5);
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10B6u, v64, v65, v9, 0LL, 0LL);
  }
  return (unsigned int)v9;
}
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A090: using guessed type __int64 off_1A090[2];
// 1A098: using guessed type __int64 off_1A098;
// 2BAB0: using guessed type int __fastcall IOLog(_QWORD);
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (00000000000076CC) ----------------------------------------------------
char __usercall AppleUSBHub::HubAreAllPortsDisconnectedOrSuspended@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  __int64 v2; // r13@1
  uintptr_t v3; // r14@2
  uintptr_t v4; // rbx@2
  unsigned __int8 v5; // al@2
  uintptr_t v6; // rsi@8
  char v7; // r14@8
  uint32_t v8; // edi@8
  uintptr_t v9; // rdx@8
  uintptr_t v10; // rcx@8
  uintptr_t v11; // r8@8
  uintptr_t v13; // rax@26
  signed int v14; // ebx@27
  __int64 v15; // rcx@28
  __int64 v16; // r15@29
  char v17; // al@30
  int v18; // eax@37
  bool v19; // cf@51
  uintptr_t v20; // rsi@54
  bool v21; // cl@54
  uintptr_t v22; // rdx@57
  uintptr_t v23; // rcx@57
  uintptr_t v24; // r8@57
  uintptr_t v25; // rcx@60
  uintptr_t v26; // rdx@60
  uintptr_t v27; // rax@63
  uintptr_t v28; // rdx@63
  __int64 v29; // [sp+0h] [bp-30h]@1

  v29 = a2;
  v2 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    v3 = *((_DWORD *)this + 74);
    v4 = *((_QWORD *)this + 21);
    v5 = IOService::isInactive(this);
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1025u, v3, v4, v5, *((_BYTE *)this + 218), 0LL);
  }
  if ( !*((_QWORD *)this + 52) )
  {
    if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v6 = *((_DWORD *)this + 74);
      v7 = 0;
      v8 = 86839332;
      v9 = 0LL;
      v10 = 0LL;
      v11 = 4LL;
      goto LABEL_23;
    }
    return 0;
  }
  if ( *((_BYTE *)this + 1077) )
  {
    if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v6 = *((_DWORD *)this + 74);
      v7 = 0;
      v8 = 86839332;
      v9 = 0LL;
      v10 = 0LL;
      v11 = 5LL;
      goto LABEL_23;
    }
    return 0;
  }
  if ( *((_BYTE *)this + 1076) )
  {
    if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v6 = *((_DWORD *)this + 74);
      v7 = 0;
      v8 = 86839332;
      v9 = 0LL;
      v10 = 0LL;
      v11 = 6LL;
      goto LABEL_23;
    }
    return 0;
  }
  if ( *((_BYTE *)this + 305)
    || (unsigned __int8)IOService::isInactive(this)
    || *((_BYTE *)this + 306)
    || *((_QWORD *)this + 21) < 3uLL )
  {
    if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v10 = *((_BYTE *)this + 306);
      v9 = *((_BYTE *)this + 305);
      v6 = *((_DWORD *)this + 74);
      v7 = 0;
      v8 = 86839332;
      v11 = 7LL;
      goto LABEL_23;
    }
    return 0;
  }
  LOBYTE(v13) = *((_BYTE *)this + 218);
  v7 = 1;
  if ( !(_BYTE)v13 )
    goto LABEL_83;
  v14 = 1;
  while ( 1 )
  {
    v15 = *((_QWORD *)this + 52);
    if ( !v15 )
    {
      if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v13 = (unsigned __int8)v13;
        v25 = (unsigned int)v14;
        v26 = *((_DWORD *)this + 74);
        v7 = 0;
        v24 = 0LL;
        goto LABEL_80;
      }
      goto LABEL_82;
    }
    v16 = *(_QWORD *)(v15 + 8LL * (unsigned int)(v14 - 1));
    if ( !v16 )
    {
      if ( !(*(_BYTE *)v2 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_82;
      v27 = (unsigned int)v14;
      v28 = *((_DWORD *)this + 74);
      v7 = 0;
      v23 = 0LL;
      v24 = 8LL;
      goto LABEL_76;
    }
    v17 = *(_BYTE *)(v16 + 107);
    if ( v17 || *(_BYTE *)(v16 + 104) || *(_BYTE *)(v16 + 110) )
    {
      if ( !(*(_BYTE *)v2 & 2) )
        goto LABEL_82;
      v20 = *((_DWORD *)this + 74);
      v21 = 1;
      if ( !v17 )
        v21 = ((*(_BYTE *)(v16 + 104) << 8) | *(_BYTE *)(v16 + 110)) != 0;
      if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_82;
      v22 = v21;
      v7 = 0;
      v23 = 0LL;
      v24 = 9LL;
LABEL_81:
      kernel_debug(0x52D1024u, v20, v22, v23, v24, 0LL);
      goto LABEL_83;
    }
    if ( *(_BYTE *)(v16 + 401) || *(_BYTE *)(v16 + 402) || *(_BYTE *)(v16 + 100) )
      goto LABEL_82;
    LODWORD(v13) = AppleUSBHub::GetPortStatus(this, (__int64)&v29, (unsigned __int16)v14);
    if ( (_DWORD)v13 )
      break;
    LOWORD(v18) = v29;
    if ( !(BYTE1(v29) & 1) && *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      kernel_debug(0x52D1024u, *((_DWORD *)this + 74), (unsigned int)v14, *(_DWORD *)(v16 + 96), 1uLL, 0LL);
      LOWORD(v18) = v29;
    }
    v18 = (unsigned __int16)v18;
    if ( (v18 & 5) == 1 || WORD1(v29) )
    {
      if ( !(*(_BYTE *)v2 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_82;
      v27 = (unsigned int)v14;
      v28 = *((_DWORD *)this + 74);
      v7 = 0;
      v23 = 0LL;
      v24 = 11LL;
      goto LABEL_76;
    }
    if ( v18 & 8 )
    {
      if ( !(*(_BYTE *)v2 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_82;
      v27 = (unsigned int)v14;
      v28 = *((_DWORD *)this + 74);
      v7 = 0;
      v23 = 0LL;
      v24 = 12LL;
      goto LABEL_76;
    }
    if ( BYTE1(v18) & 0x80 && *((_BYTE *)this + 160) && *((_QWORD *)this + 18) && *((_BYTE *)this + 427) )
    {
      if ( !(*(_BYTE *)v2 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_82;
      v27 = (unsigned int)v14;
      v28 = *((_DWORD *)this + 74);
      v7 = 0;
      v23 = 0LL;
      v24 = 13LL;
LABEL_76:
      v20 = v28;
      v22 = v27;
      goto LABEL_81;
    }
    LODWORD(v13) = ((unsigned __int8)(v13 & 0xE0) | ((unsigned int)v13 >> 6) & 0x100) >> 5;
    if ( (v13 & 0xE) == 6 && *((_BYTE *)this + 160) && __PAIR__(*((_BYTE *)this + 427), *((_BYTE *)this + 426)) )
    {
      if ( !(*(_BYTE *)v2 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_82;
      v13 = (unsigned __int16)v13;
      v25 = (unsigned int)v14;
      v26 = *((_DWORD *)this + 74);
      v7 = 0;
      v24 = 14LL;
LABEL_80:
      v20 = v26;
      v22 = v25;
      v23 = v13;
      goto LABEL_81;
    }
    LODWORD(v13) = *((_BYTE *)this + 218);
    v19 = v14++ < (unsigned int)v13;
    if ( !v19 )
      goto LABEL_83;
  }
  if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v13 = (signed int)v13;
    v25 = (unsigned int)v14;
    v26 = *((_DWORD *)this + 74);
    v7 = 0;
    v24 = 2LL;
    goto LABEL_80;
  }
LABEL_82:
  v7 = 0;
LABEL_83:
  if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v10 = (unsigned __int8)v7;
    v9 = *((_QWORD *)this + 21);
    v6 = *((_DWORD *)this + 74);
    v8 = 86839334;
    v11 = 0LL;
LABEL_23:
    kernel_debug(v8, v6, v9, v10, v11, 0LL);
  }
  return v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000007C62) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SuspendPorts(AppleUSBHub *this, unsigned int a2)
{
  AppleUSBHub *v2; // r12@1
  __int64 v3; // rbx@1
  __int64 v4; // r14@1
  __int64 v5; // r13@5
  unsigned __int8 v6; // al@5
  uintptr_t v7; // r15@6
  uintptr_t v8; // rcx@7
  __int64 v9; // rdx@7
  __int64 v10; // rbx@8
  __int64 v11; // r15@16
  unsigned int v12; // ebx@20
  uintptr_t v13; // rax@21
  const OSMetaClass *v14; // rdx@21
  uintptr_t v15; // r13@21
  __int64 v16; // rax@22
  __int64 v17; // r15@22
  uintptr_t v18; // r14@24
  signed __int64 v19; // r12@24
  unsigned __int16 v20; // ax@24
  int (__fastcall *v21)(_QWORD, _QWORD, _QWORD); // r14@27
  unsigned __int16 v22; // ax@27
  int v23; // eax@34
  int v24; // eax@43
  signed int v25; // ebx@47
  const OSMetaClassBase *v27; // [sp+10h] [bp-40h]@20
  __int64 v28; // [sp+18h] [bp-38h]@16
  int v29; // [sp+24h] [bp-2Ch]@16

  v2 = this;
  v3 = OSArray::withCapacity((OSArray *)*((_BYTE *)this + 218), a2);
  v4 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1029u, *((_DWORD *)this + 74), *((_BYTE *)this + 218), 0LL, 0LL, 0LL);
  if ( v3 )
  {
    v5 = v3;
    v6 = *((_BYTE *)this + 218);
    if ( v6 )
    {
      v7 = 0LL;
      do
      {
        v8 = v7++;
        v9 = *((_QWORD *)this + 52);
        if ( v9 )
        {
          v10 = *(_QWORD *)(v9 + 8 * v8);
          if ( v10 )
          {
            (*(void (__fastcall **)(_QWORD))(*(_QWORD *)v10 + 32LL))(*(_QWORD *)(v9 + 8 * v8));
            *(_BYTE *)(v10 + 407) = 0;
            if ( *(_DWORD *)(v10 + 96) == 3 )
            {
              if ( *(_QWORD *)(v10 + 80) )
              {
                (*(void (__fastcall **)(__int64, __int64))(*(_QWORD *)v5 + 440LL))(v5, v10);
                if ( *(_BYTE *)v4 & 2 )
                {
                  if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                    kernel_debug(0x52D1028u, *((_DWORD *)this + 74), v7, 0LL, 1uLL, 0LL);
                }
              }
            }
            (*(void (__fastcall **)(__int64))(*(_QWORD *)v10 + 40LL))(v10);
            v6 = *((_BYTE *)this + 218);
          }
        }
      }
      while ( (signed int)v7 < v6 );
    }
    v28 = v5;
    v11 = v5;
    v29 = (*(int (__fastcall **)(__int64))(*(_QWORD *)v5 + 304LL))(v5);
    if ( v29 > 0 )
    {
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1028u, *((_DWORD *)this + 74), v29, 0LL, 2uLL, 0LL);
      v12 = 0;
      (*(void (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleUSBHub *, OSArray *, uintptr_t), __int64, signed __int64, _QWORD, _QWORD))(**((_QWORD **)this + 34) + 456LL))(
        *((_QWORD *)this + 34),
        AppleUSBHub::ProcessAllNotificationsForEvent,
        v5,
        1LL,
        0LL,
        0LL);
      v27 = *(const OSMetaClassBase **)off_1A020[0];
      do
      {
        LODWORD(v13) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v11 + 488LL))(v11, v12);
        v15 = v13;
        if ( v13 )
        {
          v16 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)v2 + 17), v27, v14);
          v17 = v16;
          if ( v16 )
          {
            if ( *(_BYTE *)v4 & 2 )
            {
              v18 = *((_DWORD *)v2 + 74);
              v19 = v15 + 80;
              v20 = (*(int (__fastcall **)(_QWORD, const OSMetaClassBase *))(**(_QWORD **)(v15 + 80) + 2248LL))(
                      *(_QWORD *)(v15 + 80),
                      v27);
              if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                kernel_debug(0x52D1028u, v18, v20, 0LL, 3uLL, 0LL);
            }
            else
            {
              v19 = v15 + 80;
            }
            v21 = *(int (__fastcall **)(_QWORD, _QWORD, _QWORD))(*(_QWORD *)v17 + 3136LL);
            v22 = (*(int (**)(void))(**(_QWORD **)v19 + 2248LL))();
            LODWORD(v16) = v21(v17, v22, 0LL);
            v2 = this;
            v4 = off_1A080[0];
            if ( (_DWORD)v16 && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(0x52D1028u, *((_DWORD *)this + 74), (signed int)v16, 0LL, 4uLL, 0LL);
          }
          v11 = v28;
          if ( *(_BYTE *)v4 & 2 )
          {
            v16 = off_1A098;
            if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(0x52D1028u, *((_DWORD *)v2 + 74), v15, 0LL, 5uLL, 0LL);
          }
          v23 = AppleUSBHubPort::SuspendPort(v15, v16, 0, 1);
          if ( v23 )
          {
            if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(0x52D1028u, *((_DWORD *)v2 + 74), v23, 0LL, 6uLL, 0LL);
          }
          else
          {
            *(_DWORD *)(v15 + 96) = 1;
          }
        }
        ++v12;
      }
      while ( v29 != v12 );
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1028u, *((_DWORD *)v2 + 74), 0LL, 0LL, 7uLL, 0LL);
      v24 = (*(int (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleUSBHub *, OSArray *, uintptr_t), __int64, signed __int64, _QWORD, _QWORD))(**((_QWORD **)v2 + 34) + 456LL))(
              *((_QWORD *)v2 + 34),
              AppleUSBHub::ProcessAllNotificationsForEvent,
              v11,
              2LL,
              0LL,
              0LL);
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1028u, *((_DWORD *)v2 + 74), v24, 0LL, 8uLL, 0LL);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v11 + 344LL))(v11);
    }
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v11 + 40LL))(v11);
    v25 = 0;
  }
  else
  {
    v25 = -536870211;
    if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1028u, *((_DWORD *)this + 74), 0LL, 0LL, 0LL, 0LL);
  }
  if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D102Au, *((_DWORD *)v2 + 74), *((_BYTE *)v2 + 218), v25, 0LL, 0LL);
  return (unsigned int)v25;
}
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (00000000000080B8) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::ProcessAllNotificationsForEvent(AppleUSBHub *this, OSArray *a2, uintptr_t a3)
{
  AppleUSBHub *v3; // r14@1
  OSSet *v4; // r15@1
  OSSet *v5; // r12@1
  signed int v6; // ebx@4
  uintptr_t v7; // rdx@5
  unsigned int v8; // ebx@10
  __int64 v9; // rax@11
  OSSet *v10; // r14@12
  __int64 v11; // r15@18
  uintptr_t v12; // rbx@20
  int v13; // eax@20
  char *v14; // rsi@22
  int v15; // eax@22
  uintptr_t v16; // rbx@25
  int v17; // eax@25
  uintptr_t arg3; // [sp+8h] [bp-48h]@1
  char *v20; // [sp+18h] [bp-38h]@9
  __int64 v21; // [sp+20h] [bp-30h]@19

  arg3 = a3;
  v3 = this;
  v4 = (OSSet *)(unsigned int)(*(int (__fastcall **)(OSArray *))(*(_QWORD *)a2 + 304LL))(a2);
  v5 = (OSSet *)OSSet::withCapacity(v4, (unsigned int)a2);
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D10C5u, *((_DWORD *)this + 74), (uintptr_t)a2, arg3, (signed int)v4, 0LL);
  v6 = -536870211;
  if ( v5 )
  {
    v7 = *((_QWORD *)this + 36);
    if ( v7 )
    {
      v6 = -536870206;
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D10C4u, *((_DWORD *)this + 74), v7, 0LL, 1uLL, 0LL);
      goto LABEL_30;
    }
    v20 = (char *)this + 288;
    *((_QWORD *)this + 36) = v5;
    if ( (signed int)v4 > 0 )
    {
      v8 = 0;
      do
      {
        LODWORD(v9) = (*(int (__fastcall **)(OSArray *, _QWORD))(*(_QWORD *)a2 + 488LL))(a2, v8);
        if ( v9 )
        {
          v10 = *(OSSet **)(v9 + 88);
          if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(0x52D10C4u, *((_DWORD *)this + 74), *(_DWORD *)(v9 + 36), 0LL, 0LL, 0LL);
          AppleUSBHub::SendUSBNotifications(this, v10, arg3, v5);
        }
        ++v8;
      }
      while ( (_DWORD)v4 != v8 );
    }
    if ( !(*(int (__fastcall **)(OSSet *))(*(_QWORD *)v5 + 304LL))(v5) )
    {
LABEL_29:
      v3 = this;
      *(_QWORD *)v20 = 0LL;
      (*(void (__fastcall **)(OSSet *))(*(_QWORD *)v5 + 40LL))(v5);
      v6 = 0;
      goto LABEL_30;
    }
    v11 = off_1A098;
    while ( 1 )
    {
      clock_interval_to_deadline(3LL, 1000000000LL, &v21);
      if ( *(_BYTE *)off_1A080[0] & 2 )
      {
        v12 = *((_DWORD *)this + 74);
        v13 = (*(int (__fastcall **)(OSSet *, signed __int64))(*(_QWORD *)v5 + 304LL))(v5, 1000000000LL);
        if ( *(_DWORD *)v11 & 0xFFFFFFF7 )
          kernel_debug(0x52D10C4u, v12, (unsigned int)v13, 0LL, 2uLL, 0LL);
      }
      v14 = (char *)this + 288;
      v15 = (*(int (__fastcall **)(_QWORD, char *, __int64, signed __int64))(**((_QWORD **)this + 34) + 496LL))(
              *((_QWORD *)this + 34),
              v20,
              v21,
              2LL);
      if ( v15 == -536870174 )
        goto LABEL_27;
      if ( v15 == 1 )
        break;
LABEL_28:
      if ( !(*(int (__fastcall **)(OSSet *))(*(_QWORD *)v5 + 304LL))(v5) )
        goto LABEL_29;
    }
    if ( *(_BYTE *)off_1A080[0] & 2 )
    {
      v16 = *((_DWORD *)this + 74);
      v17 = (*(int (__fastcall **)(OSSet *))(*(_QWORD *)v5 + 304LL))(v5);
      if ( *(_DWORD *)v11 & 0xFFFFFFF7 )
      {
        v14 = (char *)v16;
        kernel_debug(0x52D10C4u, v16, (unsigned int)v17, 0LL, 3uLL, 0LL);
      }
    }
LABEL_27:
    (*(void (__fastcall **)(OSSet *, char *))(*(_QWORD *)v5 + 344LL))(v5, v14);
    goto LABEL_28;
  }
LABEL_30:
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D10C6u, *((_DWORD *)v3 + 74), v6, 0LL, 0LL, 0LL);
  return (unsigned int)v6;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2C768: using guessed type int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD);

//----- (000000000000837A) ----------------------------------------------------
__int64 __usercall AppleUSBHub::RaisePowerState@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  AppleUSBHub *v2; // rbx@1
  __int64 v3; // rdi@1
  __int64 result; // rax@2
  __int64 v5; // [sp-4h] [bp-10h]@1

  v5 = a2;
  v2 = this;
  v3 = *((_QWORD *)this + 34);
  if ( v3 )
  {
    (*(void (__fastcall **)(__int64, __int64 (__fastcall *)(uintptr_t, uintptr_t, void *, void *, void *, void *), signed __int64, char *, _QWORD, _QWORD))(*(_QWORD *)v3 + 456LL))(
      v3,
      AppleUSBHub::ChangeRaisedPowerState,
      1LL,
      (char *)&v5 + 4,
      0LL,
      0LL);
    result = HIDWORD(v5);
  }
  else
  {
    result = *((_DWORD *)v2 + 181);
    *((_DWORD *)v2 + 181) = result + 1;
    HIDWORD(v5) = result;
  }
  if ( (_DWORD)result == 1 )
    result = IOService::changePowerStateTo(v2, 4uLL);
  return result;
}

//----- (00000000000083DE) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::ClearPortFeature(AppleUSBHub *this, __int16 a2, __int16 a3)
{
  __int16 v3; // r14@1
  signed int v4; // ebx@4
  int v5; // er12@6
  char v7; // [sp+0h] [bp-40h]@6
  char v8; // [sp+1h] [bp-3Fh]@6
  __int16 v9; // [sp+2h] [bp-3Eh]@6
  __int16 v10; // [sp+4h] [bp-3Ch]@6
  __int16 v11; // [sp+6h] [bp-3Ah]@6
  __int64 v12; // [sp+8h] [bp-38h]@6

  v3 = a3;
  if ( !*((_BYTE *)this + 426) || *((_BYTE *)this + 160) || (unsigned __int16)(a2 | 0x10) != 18 )
  {
    v7 = 35;
    v8 = 1;
    v9 = a2;
    v10 = a3;
    v11 = 0;
    v12 = 0LL;
    v4 = 0;
    v5 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v7, 0);
    if ( v5 )
    {
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1030u, *((_DWORD *)this + 74), (unsigned __int16)a2, (unsigned __int16)v3, v5, 0LL);
      v4 = v5;
    }
  }
  else
  {
    v4 = -536870206;
    if ( (unsigned __int16)a3 <= (unsigned int)*((_BYTE *)this + 218) )
      v4 = AppleUSBHub::SetPortFeature(this, 5, a3);
  }
  return (unsigned int)v4;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (00000000000084CA) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SetPortPower(AppleUSBHub *this, unsigned int a2, int a3)
{
  __int64 result; // rax@2

  if ( a2 <= *((_BYTE *)this + 218) )
  {
    if ( a3 == 1 )
      result = AppleUSBHub::SetPortFeature(this, 8, a2);
    else
      result = AppleUSBHub::ClearPortFeature(this, 8, a2);
  }
  else
  {
    result = 3758097090LL;
  }
  return result;
}

//----- (0000000000008502) ----------------------------------------------------
int __fastcall AppleUSBHub::IncrementOutstandingResumes(AppleUSBHub *this)
{
  AppleUSBHub *v1; // rax@1
  __int64 v2; // rdi@1

  v1 = this;
  v2 = *((_QWORD *)this + 34);
  if ( v2 )
    LODWORD(v1) = (*(int (__fastcall **)(__int64, __int64 (__fastcall *)(uintptr_t, uintptr_t, void *, void *, void *, void *), signed __int64, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v2 + 456LL))(
                    v2,
                    AppleUSBHub::ChangeOutstandingResumes,
                    1LL,
                    0LL,
                    0LL,
                    0LL);
  else
    ++*((_DWORD *)v1 + 182);
  return (signed int)v1;
}

//----- (000000000000853E) ----------------------------------------------------
bool __fastcall AppleUSBHub::HubStatusChanged(AppleUSBHub *this)
{
  signed int v1; // ebx@1
  __int64 v2; // rdx@2
  __int64 v3; // r8@2
  __int16 v4; // ax@3
  unsigned __int64 v5; // rcx@9
  uintptr_t v6; // rsi@16
  bool v7; // r15@17
  __int64 v8; // rax@20
  unsigned __int64 v10; // [sp+8h] [bp-48h]@9
  __int64 v11; // [sp+10h] [bp-40h]@9
  char v12; // [sp+18h] [bp-38h]@1
  char v13; // [sp+19h] [bp-37h]@1
  __int16 v14; // [sp+1Ah] [bp-36h]@1
  __int16 v15; // [sp+1Ch] [bp-34h]@1
  __int16 v16; // [sp+1Eh] [bp-32h]@1
  AppleUSBHub *v17; // [sp+20h] [bp-30h]@1

  AppleUSBHub::IncrementOutstandingIO(this, 0);
  v12 = -96;
  v13 = 0;
  v14 = 0;
  v15 = 0;
  v16 = 4;
  v17 = (AppleUSBHub *)((char *)this + 246);
  v1 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v12, 0);
  if ( !v1 )
  {
    v4 = *((_WORD *)this + 124);
    if ( v4 & 1 )
    {
      v12 = 32;
      v13 = 1;
      v14 = 0;
      v15 = 0;
      v16 = 0;
      v17 = 0LL;
      v1 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v12, 0);
      if ( v1 )
      {
        v2 = (__int64)"AppleUSBHub::FatalError 0x%x: %s";
        v3 = (__int64)"clear hub power status feature";
        goto LABEL_16;
      }
      v12 = -96;
      v13 = 0;
      v14 = 0;
      v15 = 0;
      v16 = 4;
      v17 = (AppleUSBHub *)((char *)this + 246);
      v1 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v12, 0);
      if ( v1 )
      {
LABEL_15:
        v2 = (__int64)"AppleUSBHub::FatalError 0x%x: %s";
        v3 = (__int64)"get status (second in hub status change)";
        goto LABEL_16;
      }
      v4 = *((_WORD *)this + 124);
    }
    if ( !(v4 & 2) )
      goto LABEL_27;
    clock_get_uptime(&v11);
    v11 -= *((_QWORD *)this + 131);
    absolutetime_to_nanoseconds(v11, &v10);
    v5 = v10 >> 9;
    v10 = 19342813113834067LL * (v10 >> 9) >> 64 >> 11;
    if ( !*((_BYTE *)this + 1042) || v5 >= 0x39BDF3B )
    {
      (*(void (__fastcall **)(_QWORD, signed __int64))(**((_QWORD **)this + 18) + 2456LL))(*((_QWORD *)this + 18), 3LL);
      *((_BYTE *)this + 1042) = 1;
      clock_get_uptime((char *)this + 1048);
    }
    v12 = 32;
    v13 = 1;
    v14 = 1;
    v15 = 0;
    v16 = 0;
    v17 = 0LL;
    v1 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v12, 0);
    if ( v1 )
    {
      v2 = (__int64)"AppleUSBHub::FatalError 0x%x: %s";
      v3 = (__int64)"clear hub over-current feature";
      goto LABEL_16;
    }
    IOSleep(3000LL);
    v12 = -96;
    v13 = 0;
    v14 = 0;
    v15 = 0;
    v16 = 4;
    v17 = (AppleUSBHub *)((char *)this + 246);
    v1 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v12, 0);
    if ( !v1 )
    {
LABEL_27:
      v6 = (uintptr_t)"kResetOnPowerStatusChange";
      LODWORD(v8) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 696LL))(
                      *((_QWORD *)this + 18),
                      "kResetOnPowerStatusChange");
      v7 = 1;
      if ( v8 != **(_QWORD **)off_1A090[0] )
        goto LABEL_21;
      v1 = -536870187;
      if ( !(*((_BYTE *)this + 246) & 1) )
        goto LABEL_21;
      goto LABEL_17;
    }
    goto LABEL_15;
  }
  v2 = (__int64)"AppleUSBHub::FatalError 0x%x: %s";
  v3 = (__int64)"get status (first in hub status change)";
LABEL_16:
  v6 = 1431519814LL;
  KernelDebugLogInternal(1LL, 1431519814LL, v2, (unsigned int)v1, v3);
LABEL_17:
  v7 = v1 == 0;
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v6 = *((_DWORD *)this + 74);
    kernel_debug(0x52D1028u, v6, v1, 0LL, 2uLL, 0LL);
  }
  (*(void (__fastcall **)(AppleUSBHub *, uintptr_t))(*(_QWORD *)this + 32LL))(this, v6);
  AppleUSBHub::ResetMyPort(this);
  LODWORD(v8) = (*(int (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 40LL))(this);
LABEL_21:
  AppleUSBHub::DecrementOutstandingIO(this, v8, 0);
  return v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A090: using guessed type __int64 off_1A090[2];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2C750: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);
// 2C760: using guessed type int __fastcall clock_get_uptime(_QWORD);

//----- (0000000000008818) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::GetHubStatus(AppleUSBHub *a1, __int64 a2)
{
  char v3; // [sp+8h] [bp-18h]@1
  char v4; // [sp+9h] [bp-17h]@1
  __int16 v5; // [sp+Ah] [bp-16h]@1
  __int16 v6; // [sp+Ch] [bp-14h]@1
  __int16 v7; // [sp+Eh] [bp-12h]@1
  __int64 v8; // [sp+10h] [bp-10h]@1

  v3 = -96;
  v4 = 0;
  v5 = 0;
  v6 = 0;
  v7 = 4;
  v8 = a2;
  return AppleUSBHub::DoDeviceRequestWithRetries(a1, (__int64)&v3, 0);
}

//----- (0000000000008850) ----------------------------------------------------
int __fastcall AppleUSBHub::FatalError(AppleUSBHub *this, unsigned int a2, const char *a3)
{
  return KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBHub::FatalError 0x%x: %s", a2, a3);
}
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000008872) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::ClearHubFeature(AppleUSBHub *this, __int16 a2)
{
  char v3; // [sp+8h] [bp-18h]@1
  char v4; // [sp+9h] [bp-17h]@1
  __int16 v5; // [sp+Ah] [bp-16h]@1
  __int16 v6; // [sp+Ch] [bp-14h]@1
  __int16 v7; // [sp+Eh] [bp-12h]@1
  __int64 v8; // [sp+10h] [bp-10h]@1

  v3 = 32;
  v4 = 1;
  v5 = a2;
  v6 = 0;
  v7 = 0;
  v8 = 0LL;
  return AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v3, 0);
}

//----- (00000000000088AC) ----------------------------------------------------
char __usercall AppleUSBHub::GetInternalHubErrataBits@<al>(AppleUSBHub *this@<rdi>, unsigned int *a2@<rsi>, __int64 a3@<rax>)
{
  __int64 v3; // r14@2
  __int64 v4; // rax@2
  IORegistryEntry *v5; // rax@3
  const OSMetaClass *v6; // rdx@3
  IORegistryEntry *v7; // r12@3
  const OSMetaClassBase *v8; // r13@5
  __int64 v9; // r14@5
  char v10; // r15@5
  IOUSBControllerV3 *v11; // rax@7
  unsigned int v12; // eax@9
  unsigned int v14; // [sp+14h] [bp-2Ch]@6

  if ( AppleUSBHub::IsHubDeviceInternal(this, a3)
    && (v3 = off_1A078[0],
        LODWORD(v4) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 18) + 792LL))(
                        *((_QWORD *)this + 18),
                        *(_QWORD *)off_1A078[0]),
        v4)
    && (LODWORD(v5) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v4 + 792LL))(v4, *(_QWORD *)v3),
        (v7 = v5) != 0LL)
    && *((_BYTE *)this + 218) )
  {
    v8 = *(const OSMetaClassBase **)off_1A020[0];
    v9 = 0LL;
    v10 = 0;
    do
    {
      v14 = 0;
      if ( *((_QWORD *)this + 18) )
      {
        v11 = (IOUSBControllerV3 *)OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)this + 17), v8, v6);
        if ( v11 )
        {
          if ( (unsigned __int8)IOUSBControllerV3::GetInternalHubErrataBits(
                                  v11,
                                  v7,
                                  (signed int)v9 + 1,
                                  *((_DWORD *)this + 74),
                                  &v14) )
          {
            v12 = v14;
            *a2 |= v14;
            *((_DWORD *)this + v9 + 190) = v12;
            v10 = 1;
          }
        }
      }
      ++v9;
    }
    while ( (signed int)v9 < *((_BYTE *)this + 218) );
  }
  else
  {
    v10 = 0;
  }
  return v10 & 1;
}
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A078: using guessed type __int64 off_1A078[5];
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (00000000000089AC) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::GetHubPortErrataBits(AppleUSBHub *this, int a2)
{
  return *((_DWORD *)this + (unsigned int)(a2 - 1) + 190);
}

//----- (00000000000089BC) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::DoDeviceRequestWithRetries(AppleUSBHub *this, __int64 a2, char a3)
{
  signed int v3; // er14@1
  int v4; // er13@1
  int v5; // eax@1
  signed int v6; // ecx@1
  signed int v7; // er12@2
  bool v8; // zf@6
  bool v9; // sf@6
  signed int v10; // er12@15
  int v11; // er12@18
  signed int v12; // ecx@25
  unsigned __int8 v14; // [sp+4h] [bp-4Ch]@1
  int v15; // [sp+8h] [bp-48h]@2
  signed int v16; // [sp+10h] [bp-40h]@2
  signed int v17; // [sp+14h] [bp-3Ch]@1
  __int64 v18; // [sp+18h] [bp-38h]@18
  char v19; // [sp+20h] [bp-30h]@18

  v14 = a3 ^ 1;
  v3 = 100;
  v17 = 3;
  v4 = -536870208;
  v5 = 2;
  v6 = 3;
  while ( 1 )
  {
    v16 = v6;
    v15 = v5;
    v7 = v4;
    while ( 1 )
    {
      if ( (unsigned __int8)IOService::isInactive(this) )
        goto LABEL_27;
      v4 = AppleUSBHub::DoDeviceRequest((__int64)this, a2);
      v7 = 0;
      if ( !v4 )
        goto LABEL_32;
      if ( v4 != -536870165 )
        break;
      v8 = v3 == 0;
      v9 = v3 < 0;
      v7 = -536870165;
      --v3;
      if ( v9 || v8 )
        goto LABEL_32;
    }
    if ( *((_BYTE *)this + 306) )
      break;
    if ( v4 > -536854456 )
    {
      if ( (unsigned int)(v4 + 536854455) <= 0xE )
      {
        v12 = 16641;
        if ( _bittest((const unsigned int *)&v12, v4 + 536854455) )
        {
LABEL_26:
          v7 = v4;
LABEL_27:
          if ( v7 == -536854447 )
          {
            if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(0x52D1048u, *((_DWORD *)this + 74), 0LL, 0LL, 3uLL, 0LL);
            (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 32LL))(this);
            AppleUSBHub::ResetMyPort(this);
            (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 40LL))(this);
            v7 = -536854447;
          }
          goto LABEL_32;
        }
      }
    }
    else if ( v4 == -536870208 || v4 == -536870201 )
    {
      goto LABEL_26;
    }
    v7 = -536854449;
    if ( (v4 == -536854449) & v14 )
      goto LABEL_32;
    v10 = v17;
    if ( v16 < 3 )
      v10 = 30;
    if ( (unsigned __int8)(*(int (__fastcall **)(_QWORD, __int64))(**((_QWORD **)this + 35) + 312LL))(
                            *((_QWORD *)this + 35),
                            a2) )
    {
      v17 = v10;
      clock_interval_to_deadline((unsigned int)v10, 1000000LL, &v18);
      v11 = (*(int (__fastcall **)(_QWORD, char *, __int64, signed __int64))(**((_QWORD **)this + 34) + 496LL))(
              *((_QWORD *)this + 34),
              &v19,
              v18,
              2LL);
      if ( !(unsigned __int8)(*(int (**)(void))(**((_QWORD **)this + 35) + 312LL))()
        && *(_BYTE *)off_1A080[0] & 2
        && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1048u, *((_DWORD *)this + 74), v11, 0LL, 2uLL, 0LL);
    }
    else
    {
      v17 = v10;
      IOSleep((unsigned int)v10);
    }
    v6 = v15;
    v5 = v15 - 1;
    v7 = v4;
    if ( v15 <= 0 )
      goto LABEL_27;
  }
  v7 = -536870208;
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1048u, *((_DWORD *)this + 74), 0xFFFFFFFFE00002C0LL, 0LL, 1uLL, 0LL);
LABEL_32:
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1048u, *((_DWORD *)this + 74), v7, 0LL, 4uLL, 0LL);
  return (unsigned int)v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2C768: using guessed type int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD);

//----- (0000000000008C78) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::GetPortState(AppleUSBHub *this, unsigned __int8 *a2, __int16 a3)
{
  char v4; // [sp+8h] [bp-18h]@1
  char v5; // [sp+9h] [bp-17h]@1
  __int16 v6; // [sp+Ah] [bp-16h]@1
  __int16 v7; // [sp+Ch] [bp-14h]@1
  __int16 v8; // [sp+Eh] [bp-12h]@1
  unsigned __int8 *v9; // [sp+10h] [bp-10h]@1

  v4 = -93;
  v5 = 2;
  v6 = 0;
  v7 = a3;
  v8 = 1;
  v9 = a2;
  return AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v4, 0);
}

//----- (0000000000008CAE) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SetPortFeature(AppleUSBHub *this, __int16 a2, __int16 a3)
{
  unsigned __int16 v3; // r12@1
  signed int v4; // er15@1
  char v6; // [sp+8h] [bp-38h]@6
  char v7; // [sp+9h] [bp-37h]@6
  __int16 v8; // [sp+Ah] [bp-36h]@6
  __int16 v9; // [sp+Ch] [bp-34h]@6
  __int16 v10; // [sp+Eh] [bp-32h]@6
  __int64 v11; // [sp+10h] [bp-30h]@6

  v3 = (unsigned __int8)a3;
  v4 = -536870206;
  if ( (unsigned __int8)a3 <= (unsigned int)*((_BYTE *)this + 218) )
  {
    if ( !*((_BYTE *)this + 426) || *((_BYTE *)this + 160) || a2 != 2 )
    {
      v6 = 35;
      v7 = 3;
      v8 = a2;
      v9 = a3;
      v10 = 0;
      v11 = 0LL;
      v4 = AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v6, 0);
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D102Cu, *((_DWORD *)this + 74), (unsigned __int16)a2, v3, v4, 0LL);
    }
    else
    {
      v4 = AppleUSBHub::SetPortFeature(this, 5u, (unsigned __int8)a3 | 0x300u);
    }
  }
  return (unsigned int)v4;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000008D8E) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SetPortLinkState(AppleUSBHub *this, __int16 a2, unsigned int a3)
{
  __int64 result; // rax@2

  if ( a3 <= *((_BYTE *)this + 218) )
    result = AppleUSBHub::SetPortFeature(this, 5, (a2 << 8) + (unsigned __int16)a3);
  else
    result = 3758097090LL;
  return result;
}

//----- (0000000000008DB8) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::GetPortErrorCount(AppleUSBHub *this, __int16 a2, unsigned __int16 *a3)
{
  char v4; // [sp+8h] [bp-18h]@1
  char v5; // [sp+9h] [bp-17h]@1
  __int16 v6; // [sp+Ah] [bp-16h]@1
  __int16 v7; // [sp+Ch] [bp-14h]@1
  __int16 v8; // [sp+Eh] [bp-12h]@1
  unsigned __int16 *v9; // [sp+10h] [bp-10h]@1
  int v10; // [sp+18h] [bp-8h]@1

  v4 = -93;
  v5 = 13;
  v6 = 0;
  v7 = a2;
  v8 = 2;
  v9 = a3;
  v10 = 0;
  return AppleUSBHub::DoDeviceRequestWithRetries(this, (__int64)&v4, 0);
}

//----- (0000000000008DF4) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SetPortU1Timeout(AppleUSBHub *this, __int16 a2, unsigned int a3)
{
  __int64 result; // rax@2

  if ( a3 <= *((_BYTE *)this + 218) )
    result = AppleUSBHub::SetPortFeature(this, 23, (a2 << 8) + (unsigned __int16)a3);
  else
    result = 3758097090LL;
  return result;
}

//----- (0000000000008E1E) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SetPortU2Timeout(AppleUSBHub *this, __int16 a2, unsigned int a3)
{
  __int64 result; // rax@2

  if ( a3 <= *((_BYTE *)this + 218) )
    result = AppleUSBHub::SetPortFeature(this, 24, (a2 << 8) + (unsigned __int16)a3);
  else
    result = 3758097090LL;
  return result;
}

//----- (0000000000008E48) ----------------------------------------------------
int __fastcall AppleUSBHub::DoDeviceRequest(__int64 a1, __int64 a2)
{
  __int64 v2; // rbx@1
  IOService *v3; // rdi@2
  int v4; // er15@6

  v2 = a1;
  if ( (unsigned __int8)IOService::isInactive((IOService *)a1)
    || (v3 = *(IOService **)(a1 + 144)) == 0LL
    || (unsigned __int8)IOService::isInactive(v3)
    || !(unsigned __int8)(*(int (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(v2 + 144) + 1504LL))(
                           *(_QWORD *)(v2 + 144),
                           v2) )
  {
    v4 = -536870208;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1048u, *(_DWORD *)(v2 + 296), 0xFFFFFFFFE00002C0LL, 0LL, 0LL, 0LL);
  }
  else
  {
    if ( !*(_BYTE *)(v2 + 304) )
      return (*(int (__fastcall **)(_QWORD, __int64, signed __int64, _QWORD, _QWORD))(**(_QWORD **)(v2 + 144) + 2424LL))(
               *(_QWORD *)(v2 + 144),
               a2,
               5000LL,
               0LL,
               0LL);
    v4 = (*(int (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 144) + 2440LL))(*(_QWORD *)(v2 + 144), 0LL);
    IOSleep(*(_DWORD *)(v2 + 184));
    if ( !v4 )
      return (*(int (__fastcall **)(_QWORD, __int64, signed __int64, _QWORD, _QWORD))(**(_QWORD **)(v2 + 144) + 2424LL))(
               *(_QWORD *)(v2 + 144),
               a2,
               5000LL,
               0LL,
               0LL);
  }
  return v4;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000008F38) ----------------------------------------------------
__int64 __usercall AppleUSBHub::WaitForPowerOn@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>, __int64 a3@<rsi>)
{
  AppleUSBHub *v3; // r12@1
  signed int v4; // er14@2
  __int64 v5; // rdi@3
  uintptr_t v6; // rsi@13
  uintptr_t v7; // rdx@13
  uintptr_t v8; // rcx@13
  uintptr_t v9; // r8@13
  unsigned __int64 v10; // rbx@18
  uintptr_t v11; // r14@18
  __int64 v12; // r15@18
  __int64 v13; // r13@18
  uintptr_t v14; // rdx@20
  __int64 v15; // rax@26
  uintptr_t v16; // rbx@29
  uintptr_t v17; // rsi@30
  uintptr_t v18; // rdx@30
  uintptr_t v19; // r8@30
  int v20; // ecx@31
  __int64 v22; // [sp+0h] [bp-30h]@1

  v22 = a2;
  v3 = this;
  if ( *((_QWORD *)this + 21) == 4LL )
  {
    v4 = 0;
    if ( *((_DWORD *)this + 41) != 3 )
      return (unsigned int)v4;
  }
  v5 = *((_QWORD *)this + 35);
  if ( !v5 || !*((_QWORD *)v3 + 34) )
  {
    v4 = -536870199;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v6 = *((_DWORD *)v3 + 74);
      v7 = 0LL;
      v8 = 0LL;
      v9 = 1LL;
      goto LABEL_42;
    }
    return (unsigned int)v4;
  }
  if ( (unsigned __int8)(*(int (**)(void))(*(_QWORD *)v5 + 304LL))()
    && *(_BYTE *)off_1A080[0] & 2
    && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1084u, *((_DWORD *)v3 + 74), 0LL, 0LL, 2uLL, 0LL);
  if ( !(unsigned __int8)(*(int (**)(void))(**((_QWORD **)v3 + 35) + 312LL))() )
  {
    v10 = (unsigned __int64)((unsigned __int128)(0x0CCCCCCCCCCCCCCCDLL * a3) >> 64) >> 3;
    v11 = (signed int)v10 - 1LL;
    v12 = off_1A080[0];
    v13 = off_1A098;
    while ( 1 )
    {
      v14 = *((_QWORD *)v3 + 21);
      if ( v14 >= 4 && *((_DWORD *)v3 + 41) != 3 )
        break;
      if ( (signed int)v10 <= 0 )
        break;
      if ( *(_BYTE *)v12 & 2 && *(_DWORD *)v13 & 0xFFFFFFF7 )
        kernel_debug(0x52D1084u, *((_DWORD *)v3 + 74), v14, v11, 9uLL, 0LL);
      IOSleep(10LL);
      LODWORD(v10) = v10 - 1;
      --v11;
    }
    goto LABEL_36;
  }
  if ( *((_BYTE *)v3 + 433) )
  {
    v4 = -536870199;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v6 = *((_DWORD *)v3 + 74);
      v7 = 0LL;
      v8 = 0LL;
      v9 = 3LL;
      goto LABEL_42;
    }
    return (unsigned int)v4;
  }
  clock_interval_to_deadline((unsigned int)a3, 1000000LL, &v22);
  *((_BYTE *)v3 + 433) = 1;
  LODWORD(v15) = (*(int (__fastcall **)(_QWORD, signed __int64, __int64, signed __int64))(**((_QWORD **)v3 + 34) + 496LL))(
                   *((_QWORD *)v3 + 34),
                   (char *)v3 + 433,
                   v22,
                   2LL);
  *((_BYTE *)v3 + 433) = 0;
  if ( (signed int)v15 >= 0 )
  {
    v20 = v15;
    if ( (unsigned int)v15 <= 3 )
    {
      v15 = (__int64)off_93C8;
      switch ( v20 )
      {
        case 0:
          if ( !(*(_BYTE *)off_1A080[0] & 2) )
            goto LABEL_36;
          v16 = *((_QWORD *)v3 + 21);
          if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
            goto LABEL_37;
          v17 = *((_DWORD *)v3 + 74);
          v18 = 0LL;
          v19 = 12LL;
          goto LABEL_35;
        case 1:
          if ( !(*(_BYTE *)off_1A080[0] & 2) )
            goto LABEL_36;
          v16 = *((_QWORD *)v3 + 21);
          if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
            goto LABEL_37;
          v17 = *((_DWORD *)v3 + 74);
          v18 = 0LL;
          v19 = 4LL;
          goto LABEL_35;
        case 2:
          if ( !(*(_BYTE *)off_1A080[0] & 2) )
            goto LABEL_36;
          v16 = *((_QWORD *)v3 + 21);
          if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
            goto LABEL_37;
          v17 = *((_DWORD *)v3 + 74);
          v18 = 0LL;
          v19 = 5LL;
          goto LABEL_35;
        case 3:
          if ( !(*(_BYTE *)off_1A080[0] & 2) )
            goto LABEL_36;
          v16 = *((_QWORD *)v3 + 21);
          if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
            goto LABEL_37;
          v17 = *((_DWORD *)v3 + 74);
          v18 = 0LL;
          v19 = 6LL;
          break;
        default:
          goto LABEL_32;
      }
      goto LABEL_35;
    }
  }
  else if ( (_DWORD)v15 == -536870174 )
  {
    if ( *(_BYTE *)off_1A080[0] & 2 )
    {
      v16 = *((_QWORD *)v3 + 21);
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v17 = *((_DWORD *)v3 + 74);
        v18 = 0LL;
        v19 = 7LL;
LABEL_35:
        kernel_debug(0x52D1084u, v17, v18, v16, v19, 0LL);
        goto LABEL_36;
      }
      goto LABEL_37;
    }
LABEL_36:
    v16 = *((_QWORD *)v3 + 21);
    goto LABEL_37;
  }
LABEL_32:
  if ( !(*(_BYTE *)off_1A080[0] & 2) )
    goto LABEL_36;
  v16 = *((_QWORD *)v3 + 21);
  if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v18 = (signed int)v15;
    v17 = *((_DWORD *)v3 + 74);
    v19 = 8LL;
    goto LABEL_35;
  }
LABEL_37:
  if ( v16 == 4 && *((_DWORD *)v3 + 41) != 3 )
  {
    v4 = 0;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v6 = *((_DWORD *)v3 + 74);
      v4 = 0;
      v7 = 4LL;
      v8 = 0LL;
      v9 = 10LL;
      goto LABEL_42;
    }
  }
  else
  {
    v4 = -536870199;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v8 = *((_DWORD *)v3 + 41);
      v6 = *((_DWORD *)v3 + 74);
      v9 = 11LL;
      v7 = v16;
LABEL_42:
      kernel_debug(0x52D1084u, v6, v7, v8, v9, 0LL);
      return (unsigned int)v4;
    }
  }
  return (unsigned int)v4;
}
// 93C8: using guessed type void *__ptr32 off_93C8[4];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2C768: using guessed type int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD);

//----- (00000000000093D8) ----------------------------------------------------
int __fastcall AppleUSBHub::TakeDoPortActionLock(AppleUSBHub *this)
{
  AppleUSBHub *v1; // rbx@1
  __int64 v2; // rdi@1
  int result; // eax@4

  v1 = this;
  v2 = *((_QWORD *)this + 35);
  if ( v2 && *((_QWORD *)v1 + 34) && !(unsigned __int8)(*(int (__cdecl **)(__int64))(*(_QWORD *)v2 + 304LL))(v2) )
    result = (*(int (__fastcall **)(_QWORD, __int64 (__usercall *)@<rax>(AppleUSBHub *@<rdi>, OSObject *@<rsi>, void *@<rdx>, void *@<rcx>, void *@<r8>, void *@<r9>, __int64@<rax>), signed __int64, _QWORD, _QWORD, _QWORD))(**((_QWORD **)v1 + 34) + 456LL))(
               *((_QWORD *)v1 + 34),
               AppleUSBHub::ChangeDoPortActionLock,
               1LL,
               0LL,
               0LL,
               0LL);
  else
    result = -536870174;
  return result;
}

//----- (000000000000943E) ----------------------------------------------------
int __fastcall AppleUSBHub::ReleaseDoPortActionLock(AppleUSBHub *this)
{
  __int64 v1; // rdi@2
  int result; // eax@3

  if ( *((_QWORD *)this + 35) && (v1 = *((_QWORD *)this + 34)) != 0 )
    result = (*(int (__fastcall **)(__int64, __int64 (__usercall *)@<rax>(AppleUSBHub *@<rdi>, OSObject *@<rsi>, void *@<rdx>, void *@<rcx>, void *@<r8>, void *@<r9>, __int64@<rax>), _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v1 + 456LL))(
               v1,
               AppleUSBHub::ChangeDoPortActionLock,
               0LL,
               0LL,
               0LL,
               0LL);
  else
    result = -536870174;
  return result;
}

//----- (000000000000947E) ----------------------------------------------------
char __fastcall AppleUSBHub::InterruptReadHandlerEntry(AppleUSBHub *this, OSObject *a2, void *a3, unsigned int a4)
{
  unsigned int v4; // er14@1
  signed int v5; // er15@1
  AppleUSBHub *v6; // rax@1
  AppleUSBHub *v7; // rbx@1
  __int64 v8; // rax@2

  v4 = a4;
  v5 = (signed int)a3;
  v6 = (AppleUSBHub *)OSMetaClassBase::safeMetaCast(
                        this,
                        (const OSMetaClassBase *)&AppleUSBHub::gMetaClass,
                        (const OSMetaClass *)a3);
  v7 = v6;
  if ( v6 )
  {
    AppleUSBHub::InterruptReadHandler(v6, v5, v4);
    LOBYTE(v6) = AppleUSBHub::DecrementOutstandingIO(v7, v8, 0);
  }
  return (char)v6;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (00000000000094D0) ----------------------------------------------------
void __fastcall AppleUSBHub::InterruptReadHandler(AppleUSBHub *this, signed int a2, unsigned int a3)
{
  unsigned int v3; // er15@1
  AppleUSBHub *v4; // r14@1
  __int64 v5; // r12@1
  __int64 v6; // rdi@8
  __int64 v7; // rax@9
  __int64 v8; // rdi@20
  signed int v9; // eax@23
  __int64 v10; // rdi@31
  __int64 v11; // rax@33
  signed int v12; // eax@36
  __int64 v13; // rdi@38

  v3 = a3;
  v4 = this;
  OSCompareAndSwap(1LL, 0LL, (char *)this + 324);
  v5 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1038u, *((_DWORD *)this + 74), a2, v3, 2uLL, 0LL);
  (*(void (__fastcall **)(AppleUSBHub *, _QWORD, _QWORD))(*(_QWORD *)this + 616LL))(
    this,
    "Interrupt Pending",
    **(_QWORD **)off_1A088[0]);
  if ( a2 >= 0 )
  {
    if ( a2 )
      goto LABEL_35;
LABEL_12:
    *((_DWORD *)v4 + 77) = 3;
    if ( !*((_QWORD *)v4 + 52) && *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1038u, *((_DWORD *)v4 + 74), 3uLL, 0LL, 1uLL, 0LL);
    if ( *((_BYTE *)v4 + 306) || !*((_QWORD *)v4 + 52) )
      return;
    AppleUSBHub::IncrementOutstandingIO(v4, 0);
    if ( !*((_BYTE *)v4 + 160) )
      (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v4 + 2128LL))(v4, 0LL);
    (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v4 + 32LL))(v4, 0LL);
    v8 = *((_QWORD *)v4 + 42);
LABEL_33:
    LODWORD(v11) = thread_call_enter(v8);
    if ( (_DWORD)v11 == 1 )
    {
      AppleUSBHub::DecrementOutstandingIO(v4, v11, 0);
      (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v4 + 40LL))(v4, 0LL);
    }
    return;
  }
  if ( a2 <= -536854528 )
  {
    switch ( a2 + 536870169 )
    {
      case 1:
        if ( !(unsigned __int8)IOService::isInactive(this) )
        {
          v6 = *((_QWORD *)this + 32);
          if ( v6 )
          {
            (*(void (**)(void))(*(_QWORD *)v6 + 312LL))();
            AppleUSBHub::IncrementOutstandingIO(v4, 0);
            (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v4 + 32LL))(v4, 0LL);
            LODWORD(v7) = thread_call_enter(*((_QWORD *)v4 + 45));
            if ( (_DWORD)v7 == 1 )
            {
              AppleUSBHub::DecrementOutstandingIO(v4, v7, 0);
              (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v4 + 40LL))(v4, 0LL);
            }
          }
        }
        goto LABEL_12;
      case 6:
        goto LABEL_26;
      case 0:
        goto LABEL_30;
      default:
        goto LABEL_35;
      case 4:
        if ( (unsigned __int8)IOService::isInactive(this) || *((_BYTE *)this + 306) || *((_BYTE *)this + 307) )
          return;
        break;
    }
    goto LABEL_40;
  }
  if ( a2 <= -536854454 )
  {
    if ( (unsigned int)(a2 + 536854527) > 0xF )
      goto LABEL_35;
    v9 = 63591;
    if ( !_bittest((const unsigned int *)&v9, a2 + 536854527) )
      goto LABEL_35;
    goto LABEL_30;
  }
  if ( a2 == -536854453 )
  {
LABEL_26:
    if ( !*((_BYTE *)this + 305) && !(unsigned __int8)IOService::isInactive(this) )
      AppleUSBHub::CallCheckForDeadHub(this);
    return;
  }
  if ( a2 == -536854449 )
  {
LABEL_30:
    if ( (unsigned __int8)IOService::isInactive(this) )
      return;
    v10 = *((_QWORD *)this + 32);
    if ( !v10 )
      return;
    (*(void (**)(void))(*(_QWORD *)v10 + 312LL))();
    *((_BYTE *)v4 + 318) = 1;
    (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)v4 + 32LL))(v4);
    AppleUSBHub::IncrementOutstandingIO(v4, 0);
    v8 = *((_QWORD *)v4 + 45);
    goto LABEL_33;
  }
LABEL_35:
  if ( !(unsigned __int8)IOService::isInactive(this) )
  {
    v12 = *((_DWORD *)this + 41);
    if ( v12 == -1 || v12 >= 3 )
    {
      v13 = *((_QWORD *)this + 32);
      if ( v13 )
        (*(void (**)(void))(*(_QWORD *)v13 + 312LL))();
LABEL_40:
      *((_BYTE *)v4 + 318) = 1;
      return;
    }
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A088: using guessed type __int64 off_1A088[3];
// 1A098: using guessed type __int64 off_1A098;
// 2BAD0: using guessed type int __fastcall OSCompareAndSwap(_QWORD, _QWORD, _QWORD);
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (00000000000097D8) ----------------------------------------------------
int __fastcall AppleUSBHub::CallCheckForDeadHub(AppleUSBHub *this)
{
  __int64 v1; // rax@1

  LODWORD(v1) = IOService::isInactive(this);
  if ( !(_BYTE)v1 )
  {
    AppleUSBHub::IncrementOutstandingIO(this, 0);
    (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)this + 32LL))(this, 0LL);
    LODWORD(v1) = thread_call_enter(*((_QWORD *)this + 44));
    if ( (_DWORD)v1 == 1 )
    {
      AppleUSBHub::DecrementOutstandingIO(this, v1, 0);
      LODWORD(v1) = (*(int (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)this + 40LL))(this, 0LL);
    }
  }
  return v1;
}
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (000000000000982E) ----------------------------------------------------
unsigned __int8 __fastcall AppleUSBHub::ResetPortZero(AppleUSBHub *this)
{
  unsigned __int8 result; // al@1
  __int64 v2; // rcx@2
  unsigned int v3; // ebx@4
  __int64 v4; // r12@7
  uintptr_t v5; // r15@7
  int v6; // eax@9

  result = IOService::isInactive(this);
  if ( !result )
  {
    v2 = *((_QWORD *)this + 52);
    if ( v2 )
    {
      result = *((_BYTE *)this + 218);
      if ( result )
      {
        v3 = 1;
        while ( 1 )
        {
          if ( v2 )
          {
            v4 = v3 - 1;
            v5 = *(_QWORD *)(v2 + 8 * v4);
            if ( v5 )
            {
              (*(void (__fastcall **)(_QWORD))(*(_QWORD *)v5 + 32LL))(*(_QWORD *)(v2 + 8 * v4));
              if ( *(_BYTE *)(v5 + 100) )
              {
                v6 = *((_DWORD *)this + 114);
                if ( _bittest((const unsigned int *)&v6, v4) )
                {
                  if ( *((_DWORD *)this + v4 + 115) == *(_DWORD *)(v5 + 396) )
                  {
                    if ( *(_BYTE *)off_1A080[0] & 2 )
                    {
                      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                      {
                        kernel_debug(0x52D103Cu, *((_DWORD *)this + 74), v3, 0LL, 0LL, 0LL);
                        v6 = *((_DWORD *)this + 114);
                      }
                    }
                    *((_DWORD *)this + 114) = v6 & ~(1 << (v3 - 1));
                    AppleUSBHubPort::ReleaseDevZeroLock(v5);
                  }
                }
              }
              (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)v5 + 40LL))(v5);
              result = *((_BYTE *)this + 218);
            }
          }
          ++v3;
          if ( v3 > result )
            break;
          v2 = *((_QWORD *)this + 52);
        }
      }
    }
  }
  return result;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000000994C) ----------------------------------------------------
void __fastcall AppleUSBHub::ProcessStatusChanged(AppleUSBHub *this)
{
  AppleUSBHub *v1; // rbx@1
  __int64 v2; // rdi@2
  uintptr_t *v3; // rax@4
  __int64 v4; // rcx@4
  __int64 v5; // r8@4
  uintptr_t *v6; // r14@6
  signed __int64 v7; // rdi@11
  __int64 v8; // rax@11
  uintptr_t *v9; // rdx@14
  uintptr_t v10; // r15@15
  signed int v11; // er13@15
  int v12; // er14@15
  uintptr_t v13; // rax@16
  __int64 v14; // rcx@17
  AppleUSBHubPort *v15; // r12@18
  IOPMrootDomain *v16; // rax@19
  __int64 v17; // rax@19
  __int64 v18; // rax@19
  char v19; // al@19
  int v20; // eax@23
  uintptr_t v21; // rsi@30
  uintptr_t v22; // rdx@30
  uintptr_t v23; // r8@30
  uintptr_t *v24; // [sp+0h] [bp-30h]@14

  v1 = this;
  if ( (unsigned __int8)IOService::isInactive(this) )
    return;
  v2 = *((_QWORD *)this + 33);
  if ( !v2 || !*((_QWORD *)v1 + 52) )
    return;
  LODWORD(v3) = (*(int (__cdecl **)(__int64))(*(_QWORD *)v2 + 736LL))(v2);
  if ( !v3 )
  {
    KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBHub::ProcessStatusChanged: No interrupt pipe buffer!", v4, v5);
    return;
  }
  if ( *(_BYTE *)v3 == 255 )
    return;
  *((_BYTE *)v1 + 318) = 1;
  v6 = v3;
  if ( *(_BYTE *)v3 & 1 && !AppleUSBHub::HubStatusChanged(v1) )
  {
    if ( !(*(_BYTE *)off_1A080[0] & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      return;
    v21 = *((_DWORD *)v1 + 74);
    v22 = 0LL;
    v23 = 2LL;
LABEL_34:
    kernel_debug(0x52D1040u, v21, v22, 0LL, v23, 0LL);
    return;
  }
  if ( (unsigned __int8)IOService::isInactive(v1) || !*((_QWORD *)v1 + 33) || !*((_QWORD *)v1 + 52) )
  {
    if ( !(*(_BYTE *)off_1A080[0] & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      return;
    v21 = *((_DWORD *)v1 + 74);
    v22 = 1LL;
    v23 = 1LL;
    goto LABEL_34;
  }
  v7 = (signed __int64)v1;
  AppleUSBHub::IncrementOutstandingIO(v1, 0);
  v8 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    v8 = off_1A098;
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v7 = 86845444LL;
      kernel_debug(0x52D2804u, *((_DWORD *)v1 + 74), *(_BYTE *)v6, *((_DWORD *)v1 + 74), 0LL, 0LL);
    }
  }
  v9 = v6;
  v24 = v6;
  if ( *((_BYTE *)v1 + 218) )
  {
    v10 = 0LL;
    v11 = 2;
    v12 = 0;
    do
    {
      v13 = v10++;
      if ( *((_BYTE *)v9 + v12) & (unsigned __int8)v11 )
      {
        v14 = *((_QWORD *)v1 + 52);
        if ( v14 )
        {
          v15 = *(AppleUSBHubPort **)(v14 + 8 * v13);
          if ( v15 )
          {
            v16 = (IOPMrootDomain *)IOService::getPMRootDomain((IOService *)v7);
            IOPMrootDomain::wakeFromDoze(v16);
            AppleUSBHub::IncrementOutstandingIO(v1, 0);
            v18 = AppleUSBHub::RaisePowerState(v1, v17);
            AppleUSBHub::WaitForPowerOn(v1, v18, 2000LL);
            v7 = (signed __int64)v15;
            v19 = AppleUSBHubPort::StatusChanged(v15);
            v9 = v24;
            if ( !v19 && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            {
              v7 = 86839360LL;
              kernel_debug(0x52D1040u, *((_DWORD *)v1 + 74), v10, *((_DWORD *)v1 + 42), *((_DWORD *)v1 + 41), 0LL);
              v9 = v24;
            }
          }
        }
      }
      v11 *= 2;
      v20 = v11 > 128;
      if ( v11 > 128 )
        v11 = 1;
      v12 += v20;
      v8 = *((_BYTE *)v1 + 218);
    }
    while ( (signed int)v10 < (signed int)v8 );
  }
  AppleUSBHub::DecrementOutstandingIO(v1, v8, 0);
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000009C0A) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::RearmInterruptRead(AppleUSBHub *this)
{
  AppleUSBHub *v1; // r15@1
  char *v2; // r14@1
  int v3; // ebx@1
  unsigned __int64 v4; // rax@2
  __int64 v5; // rax@11
  __int64 v6; // rdi@12
  __int64 v7; // rax@16
  AppleUSBHub *v9; // [sp+0h] [bp-30h]@15
  char (__fastcall *v10)(AppleUSBHub *, OSObject *, void *, unsigned int); // [sp+8h] [bp-28h]@15
  __int64 v11; // [sp+10h] [bp-20h]@15

  v1 = this;
  v2 = (char *)this + 324;
  v3 = -536870174;
  if ( !(unsigned __int8)OSCompareAndSwap(0LL, 1LL, (char *)this + 324) )
  {
LABEL_20:
    OSCompareAndSwap(1LL, 0LL, v2);
    return (unsigned int)v3;
  }
  v4 = *((_QWORD *)this + 21);
  if ( v4 <= 3 )
  {
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1044u, *((_DWORD *)this + 74), (signed int)v4, 4uLL, 1uLL, 0LL);
    *((_BYTE *)this + 318) = 1;
    goto LABEL_22;
  }
  AppleUSBHub::IncrementOutstandingIO(this, 0);
  if ( !*((_QWORD *)this + 52) && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1044u, *((_DWORD *)this + 74), 0LL, 0LL, 2uLL, 0LL);
  v5 = IOService::isInactive(this);
  if ( !(_BYTE)v5 && (v6 = *((_QWORD *)this + 33)) != 0 && *((_QWORD *)v1 + 32) && *((_QWORD *)v1 + 52) )
  {
    v9 = v1;
    v10 = AppleUSBHub::InterruptReadHandlerEntry;
    v11 = 0LL;
    (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v6 + 712LL))(v6, *((_BYTE *)v1 + 408));
    v3 = (*(int (__fastcall **)(_QWORD, _QWORD, __int64 *, _QWORD))(**((_QWORD **)v1 + 32) + 320LL))(
           *((_QWORD *)v1 + 32),
           *((_QWORD *)v1 + 33),
           &v9,
           0LL);
    if ( v3 )
    {
      v7 = off_1A080[0];
      if ( *(_BYTE *)off_1A080[0] & 2 )
      {
        v7 = off_1A098;
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D1044u, *((_DWORD *)v1 + 74), v3, *((_DWORD *)v1 + 81), 3uLL, 0LL);
      }
      AppleUSBHub::DecrementOutstandingIO(v1, v7, 0);
      goto LABEL_20;
    }
  }
  else
  {
    AppleUSBHub::DecrementOutstandingIO(v1, v5, 0);
  }
LABEL_22:
  v3 = 0;
  if ( !(unsigned __int8)IOService::isInactive(v1) )
    (*(void (__fastcall **)(AppleUSBHub *, _QWORD, _QWORD))(*(_QWORD *)v1 + 616LL))(
      v1,
      "Interrupt Pending",
      **(_QWORD **)off_1A090[0]);
  return (unsigned int)v3;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A090: using guessed type __int64 off_1A090[2];
// 1A098: using guessed type __int64 off_1A098;
// 2BAD0: using guessed type int __fastcall OSCompareAndSwap(_QWORD, _QWORD, _QWORD);

//----- (0000000000009E08) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::PrintHubDescriptor(__int64 a1, __int64 a2)
{
  __int64 v2; // r14@1
  __int64 v3; // r12@1
  __int64 v4; // rsi@2
  __int64 v5; // rsi@2
  __int64 v6; // rsi@2
  __int64 v7; // rbx@2
  int v8; // eax@3
  __int64 v9; // r13@5
  __int64 v10; // rsi@6
  __int64 v11; // rsi@6
  __int64 v13; // [sp+8h] [bp-58h]@1
  __int64 v14; // [sp+10h] [bp-50h]@1
  __int64 v15; // [sp+18h] [bp-48h]@1
  __int64 v16; // [sp+20h] [bp-40h]@1
  __int64 v17; // [sp+28h] [bp-38h]@1
  __int64 v18; // [sp+30h] [bp-30h]@1

  v2 = a2;
  v3 = off_1A070[0];
  v18 = *(_QWORD *)off_1A070[0];
  v17 = 0LL;
  v13 = (__int64)"nosw";
  v14 = (__int64)"comp";
  v15 = (__int64)"ppoc";
  v16 = (__int64)"nooc";
  if ( *(_BYTE *)a2 )
  {
    IOLog("hub descriptor: (%d bytes)\n");
    v4 = *(_BYTE *)(a2 + 1);
    IOLog("\thubType = %d\n");
    v5 = *(_BYTE *)(v2 + 2);
    IOLog("\tnumPorts = %d\n");
    v6 = *(_WORD *)(v2 + 3);
    IOLog("\tcharacteristics = %x ( ");
    v7 = 0LL;
    do
    {
      v8 = *(_WORD *)(v2 + 3);
      if ( _bittest((const unsigned int *)&v8, v7) )
        IOLog("%s ");
      v9 = *(&v13 + v7++);
    }
    while ( v9 );
    IOLog(")\n");
    v10 = 2 * (unsigned int)*(_BYTE *)(v2 + 5);
    IOLog("\tpowerOnToGood = %d ms\n");
    v11 = *(_BYTE *)(v2 + 6);
    IOLog("\thubCurrent = %d\n");
    IOLog("\tremovablePortFlags = %p %p\n");
    IOLog("\tpwrCtlPortFlags    = %p %p\n");
  }
  return *(_QWORD *)v3;
}
// 1A070: using guessed type __int64 off_1A070[6];
// 2BAB0: using guessed type int __fastcall IOLog(_QWORD);

//----- (0000000000009F98) ----------------------------------------------------
void __fastcall AppleUSBHub::CheckForDeadHub(AppleUSBHub *this)
{
  uintptr_t v1; // rsi@4
  uintptr_t v2; // rdx@4
  uintptr_t v3; // rcx@4
  uintptr_t v4; // r8@4
  char *v5; // r14@9
  uintptr_t v6; // rsi@9
  char v7; // al@9
  __int64 v8; // r12@9
  int v9; // ecx@9
  uintptr_t v10; // rcx@13
  int v11; // er15@16
  int v12; // eax@16
  int v13; // eax@20
  int v14; // eax@21
  __int64 v15; // rdi@26
  uintptr_t v16; // rdx@34
  uintptr_t v17; // rsi@34
  uintptr_t v18; // r8@34
  int v19; // eax@50
  int v20; // ecx@51
  uintptr_t v21; // rsi@63
  uintptr_t v22; // r8@63
  uintptr_t arg2; // [sp+Ch] [bp-24h]@16

  if ( (unsigned __int8)IOService::isInactive(this) )
  {
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v1 = *((_DWORD *)this + 74);
      v2 = 0LL;
      v3 = 0LL;
      v4 = 0LL;
LABEL_31:
      kernel_debug(0x52D108Cu, v1, v2, v3, v4, 0LL);
      return;
    }
    return;
  }
  if ( !*((_BYTE *)this + 306) )
  {
    v5 = (char *)this + 1072;
    v6 = 1LL;
    v7 = OSCompareAndSwap(0LL, 1LL, (char *)this + 1072);
    v8 = off_1A080[0];
    v9 = *(_DWORD *)off_1A080[0] & 2;
    if ( !v7 )
    {
      if ( v9 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v3 = *((_BYTE *)this + 305);
        v1 = *((_DWORD *)this + 74);
        v2 = *((_DWORD *)this + 77);
        v4 = 10LL;
        goto LABEL_31;
      }
      return;
    }
    if ( v9 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v6 = *((_DWORD *)this + 74);
      kernel_debug(0x52D108Cu, v6, *((_DWORD *)this + 77), *((_BYTE *)this + 305), 2uLL, 0LL);
    }
    v10 = *((_QWORD *)this + 18);
    if ( !v10 || !*((_QWORD *)this + 25) || !*((_QWORD *)this + 32) )
    {
      if ( !(*(_BYTE *)v8 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_36;
      v16 = *((_QWORD *)this + 25);
      v17 = *((_DWORD *)this + 74);
      v18 = 9LL;
      goto LABEL_35;
    }
    LODWORD(arg2) = 0;
    (*(void (__fastcall **)(uintptr_t, uintptr_t))(*(_QWORD *)v10 + 32LL))(v10, v6);
    v11 = (*(int (__fastcall **)(_QWORD, uintptr_t *))(**((_QWORD **)this + 18) + 2488LL))(
            *((_QWORD *)this + 18),
            &arg2);
    (*(void (**)(void))(**((_QWORD **)this + 18) + 40LL))();
    v12 = *(_DWORD *)v8 & 2;
    if ( v11 )
    {
      if ( v12 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D108Cu, *((_DWORD *)this + 74), v11, *((_DWORD *)this + 77), 3uLL, 0LL);
      v13 = *((_DWORD *)this + 77);
      if ( v13 )
      {
        v14 = v13 - 1;
        *((_DWORD *)this + 77) = v14;
        if ( v14 )
        {
          if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(0x52D108Cu, *((_DWORD *)this + 74), 0LL, 0LL, 5uLL, 0LL);
          *((_BYTE *)this + 318) = 1;
LABEL_26:
          v15 = *((_QWORD *)this + 32);
          if ( v15 )
            (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v15 + 488LL))(v15, 1LL);
          goto LABEL_36;
        }
      }
      *((_BYTE *)this + 305) = 1;
      if ( !(*(_BYTE *)v8 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      {
LABEL_36:
        *(_DWORD *)v5 = 0;
        return;
      }
      v17 = *((_DWORD *)this + 74);
      v16 = 0LL;
      v10 = 0LL;
      v18 = 4LL;
LABEL_35:
      kernel_debug(0x52D108Cu, v17, v16, v10, v18, 0LL);
      goto LABEL_36;
    }
    if ( v12 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D108Cu, *((_DWORD *)this + 74), (unsigned int)arg2, *((_DWORD *)this + 77), 6uLL, 0LL);
    if ( arg2 & 8 && !(unsigned __int8)IOService::isInactive(this) )
    {
      if ( arg2 & 0x10 )
      {
        if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D108Cu, *((_DWORD *)this + 74), *((_DWORD *)this + 77), 0LL, 0xDuLL, 0LL);
        *((_BYTE *)this + 318) = 1;
        v19 = *((_DWORD *)this + 77);
        if ( v19 )
        {
          *((_DWORD *)this + 77) = v19 - 1;
          v20 = *(_DWORD *)v8 & 2;
          if ( v19 != 1 )
          {
            if ( v20 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(0x52D108Cu, *((_DWORD *)this + 74), 0LL, 0LL, 7uLL, 0LL);
            goto LABEL_26;
          }
          if ( !v20 )
            goto LABEL_68;
        }
        else if ( !(*(_BYTE *)v8 & 2) )
        {
          goto LABEL_68;
        }
        if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        {
LABEL_68:
          (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 32LL))(this);
          AppleUSBHub::ResetMyPort(this);
          (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 40LL))(this);
          goto LABEL_36;
        }
        v21 = *((_DWORD *)this + 74);
        v22 = 12LL;
LABEL_67:
        kernel_debug(0x52D108Cu, v21, 0LL, 0LL, v22, 0LL);
        goto LABEL_68;
      }
      IOSleep(300LL);
      if ( !(unsigned __int8)IOService::isInactive(this) )
      {
        if ( !(*(_BYTE *)v8 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
          goto LABEL_68;
        v21 = *((_DWORD *)this + 74);
        v22 = 14LL;
        goto LABEL_67;
      }
    }
    *((_BYTE *)this + 305) = 1;
    if ( !(*(_BYTE *)v8 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      goto LABEL_36;
    v16 = *((_QWORD *)this + 18);
    v17 = *((_DWORD *)this + 74);
    v10 = 0LL;
    v18 = 8LL;
    goto LABEL_35;
  }
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v1 = *((_DWORD *)this + 74);
    v2 = 0LL;
    v3 = 0LL;
    v4 = 1LL;
    goto LABEL_31;
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAD0: using guessed type int __fastcall OSCompareAndSwap(_QWORD, _QWORD, _QWORD);

//----- (000000000000A446) ----------------------------------------------------
void __fastcall AppleUSBHub::ClearFeatureEndpointHalt(AppleUSBHub *this)
{
  AppleUSBHub *v1; // r15@1
  char *v2; // rsi@2
  signed int v3; // ebx@2
  __int64 v4; // rdi@3
  char v5; // [sp+0h] [bp-30h]@2
  char v6; // [sp+1h] [bp-2Fh]@4
  __int16 v7; // [sp+2h] [bp-2Eh]@4
  __int16 v8; // [sp+4h] [bp-2Ch]@4
  __int16 v9; // [sp+6h] [bp-2Ah]@4
  __int64 v10; // [sp+8h] [bp-28h]@4

  v1 = this;
  if ( !(unsigned __int8)IOService::isInactive(this) )
  {
    v2 = (char *)&dword_18;
    bzero(&v5, 0x18uLL);
    v3 = -2;
    do
    {
      v4 = *((_QWORD *)v1 + 32);
      if ( !v4 )
        break;
      v5 = 2;
      v6 = 1;
      v7 = 0;
      v8 = (unsigned __int8)(*(int (__fastcall **)(__int64, char *))(*(_QWORD *)v4 + 400LL))(v4, v2) | 0x80;
      v9 = 0;
      v10 = 0LL;
      v2 = &v5;
      if ( !(*(int (__fastcall **)(_QWORD, char *, signed __int64, _QWORD, _QWORD))(**((_QWORD **)v1 + 18) + 2424LL))(
              *((_QWORD *)v1 + 18),
              &v5,
              5000LL,
              0LL,
              0LL) )
        break;
      IOSleep(100LL);
      ++v3;
    }
    while ( v3 );
  }
}
// 18: using guessed type int;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (000000000000A4F0) ----------------------------------------------------
char __usercall AppleUSBHub::CheckForActivePorts@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  __int64 v2; // rax@1
  OSMetaClassBase *v3; // rax@3
  const OSMetaClass *v4; // rdx@3
  __int64 v5; // r15@3
  unsigned int v6; // er13@4
  unsigned int v7; // ebx@5
  int v8; // eax@15
  __int64 v10; // [sp-4h] [bp-30h]@1

  v10 = a2;
  LOBYTE(v2) = IOService::isInactive(this);
  if ( !(_BYTE)v2 )
  {
    if ( *((_BYTE *)this + 1078)
      && (LODWORD(v3) = (*(int (__cdecl **)(_QWORD))(**((_QWORD **)this + 18) + 2480LL))(*((_QWORD *)this + 18)),
          v2 = OSMetaClassBase::safeMetaCast(v3, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, v4),
          (v5 = v2) != 0)
      && (v6 = *(_BYTE *)(v2 + 218)) != 0 )
    {
      v7 = 0;
      while ( 1 )
      {
        HIDWORD(v10) = 0;
        ++v7;
        LODWORD(v2) = (*(int (__fastcall **)(__int64, _QWORD, char *))(*(_QWORD *)v5 + 2152LL))(
                        v5,
                        v7,
                        (char *)&v10 + 4);
        if ( !(_DWORD)v2 )
        {
          LOBYTE(v2) = BYTE4(v10) & 8;
          if ( (WORD2(v10) & 0x1008) == 4104 )
            break;
        }
        if ( (signed int)v7 >= (signed int)v6 )
          goto LABEL_9;
      }
    }
    else
    {
LABEL_9:
      if ( !*((_BYTE *)this + 162) && *((_DWORD *)this + 41) == -1 )
      {
        *((_BYTE *)this + 431) = 0;
        v2 = AppleUSBHub::WaitForAbandonPortCheck(this);
        if ( (_DWORD)v2 )
        {
          LOBYTE(v2) = AppleUSBHub::HubAreAllPortsDisconnectedOrSuspended(this, v2);
          if ( (_BYTE)v2 )
          {
            if ( *((_BYTE *)this + 431) )
            {
              *((_BYTE *)this + 431) = 0;
            }
            else
            {
              *((_BYTE *)this + 161) = 1;
              v8 = (*(int (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 2208LL))(this);
              LOBYTE(v2) = IOService::changePowerStateToPriv(this, (unsigned int)v8);
            }
          }
        }
      }
    }
  }
  return v2;
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000A5FC) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::WaitForAbandonPortCheck(AppleUSBHub *this)
{
  int v1; // er14@3
  __int64 result; // rax@3

  if ( *((_QWORD *)this + 35) && *((_QWORD *)this + 34) )
  {
    (*(void (**)(void))(*(_QWORD *)this + 32LL))();
    (*(void (**)(void))(**((_QWORD **)this + 35) + 32LL))();
    (*(void (**)(void))(**((_QWORD **)this + 34) + 32LL))();
    v1 = (*(int (__fastcall **)(_QWORD, int (__usercall *)@<eax>(AppleUSBHub *@<rdi>, __int64@<rax>), _QWORD, _QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 34) + 456LL))(
           *((_QWORD *)this + 34),
           AppleUSBHub::WaitForAbandonPortCheckGated,
           0LL,
           0LL,
           0LL,
           0LL);
    (*(void (**)(void))(**((_QWORD **)this + 34) + 40LL))();
    (*(void (**)(void))(**((_QWORD **)this + 35) + 40LL))();
    (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 40LL))(this);
    result = (unsigned int)v1;
  }
  else
  {
    result = 3758097097LL;
  }
  return result;
}

//----- (000000000000A694) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::WaitForPortResumes(AppleUSBHub *this)
{
  AppleUSBHub *v1; // r15@1
  __int64 v2; // rbx@1
  __int64 v3; // rax@1
  const OSMetaClass *v4; // rdx@1
  char *v5; // rbx@3
  __int64 v6; // rcx@7
  char v7; // r14@9
  signed int v8; // er13@11
  signed __int64 v9; // rbx@12
  __int64 v10; // rcx@15
  __int64 v11; // r12@17
  int v12; // eax@21
  int v13; // eax@33
  __int64 v14; // rax@40
  __int64 v15; // rax@43
  signed __int64 v16; // r13@44
  __int64 v17; // rcx@45
  __int64 v18; // r12@46
  int v19; // eax@48
  char v20; // r13@61
  uintptr_t v21; // rbx@61
  int v22; // eax@64
  uintptr_t v23; // rdx@67
  uintptr_t v24; // rsi@67
  uintptr_t v25; // r8@67
  uintptr_t v26; // r12@72
  __int64 v27; // rax@74
  char v28; // r13@84
  __int64 v29; // rbx@84
  __int64 v30; // rcx@85
  __int64 v31; // r14@86
  const OSMetaClassBase *v32; // rsi@91
  __int64 v33; // r12@91
  __int64 v34; // rdi@92
  int (__fastcall *v35)(_QWORD, _QWORD, _QWORD); // r14@93
  unsigned __int16 v36; // ax@93
  __int64 v37; // rax@97
  __int64 v38; // rdi@99
  uintptr_t v39; // rbx@102
  int v40; // eax@102
  __int64 v42; // [sp+0h] [bp-50h]@1
  const OSMetaClassBase *v43; // [sp+8h] [bp-48h]@9
  __int64 v44; // [sp+10h] [bp-40h]@9
  uintptr_t arg3; // [sp+18h] [bp-38h]@21
  __int64 v46; // [sp+20h] [bp-30h]@1

  v1 = this;
  v2 = off_1A070[0];
  v46 = *(_QWORD *)off_1A070[0];
  v3 = *((_BYTE *)this + 218);
  v4 = (const OSMetaClass *)((char *)&v42 - ((v3 + 15) & 0xFFFFFFFFFFFFFFF0LL));
  if ( *((_QWORD *)this + 52) )
  {
    if ( *(_BYTE *)off_1A080[0] & 2 )
    {
      v5 = (char *)&v42 - ((v3 + 15) & 0xFFFFFFFFFFFFFFF0LL);
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        kernel_debug(0x52D104Du, *((_DWORD *)this + 74), 0LL, 0LL, 0LL, 0LL);
        LOBYTE(v3) = *((_BYTE *)this + 218);
      }
    }
    else
    {
      v5 = (char *)&v42 - ((v3 + 15) & 0xFFFFFFFFFFFFFFF0LL);
    }
    if ( (_BYTE)v3 )
    {
      v3 = (unsigned __int8)v3;
      v6 = 0LL;
      do
        v5[v6++] = 0;
      while ( (signed int)v6 < (signed int)v3 );
    }
    v44 = (__int64)v5;
    LODWORD(v43) = 100;
    v7 = 1;
    while ( 1 )
    {
      if ( (signed int)v43 <= 0 )
      {
LABEL_83:
        LOBYTE(v3) = *((_BYTE *)this + 218);
        if ( (_BYTE)v3 )
        {
          v43 = *(const OSMetaClassBase **)off_1A020[0];
          v28 = 1;
          v29 = 0LL;
          do
          {
            v30 = *((_QWORD *)v1 + 52);
            if ( v30 )
            {
              v31 = *(_QWORD *)(v30 + 8 * v29);
              if ( v31 )
              {
                if ( *(_BYTE *)(v44 + v29) )
                {
                  if ( v28 & 1 )
                  {
                    LODWORD(v3) = IOSleep(*(_DWORD *)(v31 + 128));
                    v28 = 0;
                  }
                  if ( *((_QWORD *)v1 + 18) )
                  {
                    v32 = v43;
                    v3 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)v1 + 17), v43, v4);
                    v33 = v3;
                    if ( v3 )
                    {
                      v34 = *(_QWORD *)(v31 + 80);
                      if ( v34 )
                      {
                        v35 = *(int (__fastcall **)(_QWORD, _QWORD, _QWORD))(*(_QWORD *)v3 + 3136LL);
                        v36 = (*(int (__fastcall **)(__int64, const OSMetaClassBase *))(*(_QWORD *)v34 + 2248LL))(
                                v34,
                                v32);
                        LODWORD(v3) = v35(v33, v36, 1LL);
                        if ( (_DWORD)v3 )
                        {
                          if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                            kernel_debug(0x52D104Cu, *((_DWORD *)v1 + 74), (signed int)v3, 0LL, 5uLL, 0LL);
                        }
                      }
                    }
                  }
                  v37 = AppleUSBHub::DecrementOutstandingResumes(v1, v3);
                  AppleUSBHub::DecrementOutstandingIO(v1, v37, 0);
                  LOBYTE(v3) = *((_BYTE *)v1 + 218);
                }
              }
            }
            ++v29;
          }
          while ( (signed int)v29 < (unsigned __int8)v3 );
        }
        goto LABEL_99;
      }
      v8 = 30;
      if ( v7 & 1 )
      {
        do
        {
          --v8;
          v7 = 0;
          LODWORD(v9) = 0;
LABEL_14:
          while ( 1 )
          {
            v3 = *((_BYTE *)this + 218);
            if ( (signed int)v9 >= (signed int)v3 )
              break;
            v10 = *((_QWORD *)this + 52);
            v9 = (signed int)v9 + 1LL;
            while ( 1 )
            {
              if ( v10 )
              {
                v11 = *(_QWORD *)(v10 + 8 * v9 - 8);
                if ( v11 )
                {
                  if ( *(_DWORD *)(v11 + 96) == 1 )
                    break;
                }
              }
              ++v9;
              v4 = (const OSMetaClass *)(unsigned int)(v9 - 1);
              if ( (signed int)v4 >= (signed int)v3 )
                goto LABEL_56;
            }
            LODWORD(arg3) = 0;
            v12 = AppleUSBHub::GetPortStatus(this, (__int64)&arg3, (unsigned __int16)v9);
            if ( v12 )
            {
              if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                kernel_debug(0x52D104Cu, *((_DWORD *)this + 74), v12, v9, 1uLL, 0LL);
              *(_BYTE *)(v44 + v9 - 1) = 1;
              *(_DWORD *)(v11 + 96) = 3;
              *(_BYTE *)(v11 + 401) = 0;
            }
            if ( BYTE2(arg3) & 4 || *((_BYTE *)this + 427) && BYTE2(arg3) & 0x40 )
            {
              if ( BYTE2(arg3) & 4 )
                AppleUSBHub::ClearPortFeature(this, 18, v9);
              if ( *((_BYTE *)this + 427) && BYTE2(arg3) & 0x40 )
              {
                v13 = AppleUSBHub::GetPortStatus(this, (__int64)&arg3, (unsigned __int16)v9);
                if ( v13 )
                {
                  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                    kernel_debug(0x52D104Cu, *((_DWORD *)this + 74), v13, v9, 1uLL, 0LL);
                  *(_BYTE *)(v44 + v9 - 1) = 1;
                  *(_DWORD *)(v11 + 96) = 3;
                  *(_BYTE *)(v11 + 401) = 0;
                }
                else if ( !(((unsigned int)(unsigned __int16)arg3 >> 5) & 7 | ((unsigned int)(unsigned __int16)arg3 >> 11) & 8) )
                {
                  AppleUSBHub::ClearPortFeature(this, 25, v9);
                }
              }
              v14 = v44;
              *(_BYTE *)(v44 + v9 - 1) = 1;
              *(_DWORD *)(v11 + 96) = 3;
              if ( *(_BYTE *)(v11 + 401) )
              {
                *(_BYTE *)(v11 + 401) = 0;
                if ( *(_BYTE *)(v11 + 403) )
                {
                  *(_BYTE *)(v11 + 403) = 0;
                  AppleUSBHub::LowerPowerState(this, v14);
                }
              }
              v15 = *((_BYTE *)this + 218);
              if ( (signed int)v9 < (signed int)v15 )
              {
                HIDWORD(v42) = v8;
                v16 = v9;
                while ( 1 )
                {
                  v17 = *((_QWORD *)this + 52);
                  if ( v17 )
                  {
                    v18 = *(_QWORD *)(v17 + 8 * v16);
                    if ( v18 )
                    {
                      if ( *(_DWORD *)(v18 + 96) == 1 )
                      {
                        v19 = AppleUSBHubPort::SuspendPort(*(_QWORD *)(v17 + 8 * v16), v15, 0, 0);
                        if ( !v19 )
                        {
                          v8 = 30;
                          goto LABEL_13;
                        }
                        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                          kernel_debug(0x52D104Cu, *((_DWORD *)this + 74), v19, v16 + 1, 3uLL, 0LL);
                        v15 = v44;
                        *(_BYTE *)(v44 + v16) = 1;
                        *(_DWORD *)(v18 + 96) = 3;
                        *(_BYTE *)(v18 + 401) = 0;
                        LOBYTE(v15) = *((_BYTE *)this + 218);
                      }
                    }
                  }
                  ++v16;
                  if ( (signed int)v16 >= (unsigned __int8)v15 )
                  {
                    v8 = HIDWORD(v42);
                    goto LABEL_14;
                  }
                }
              }
            }
            else
            {
LABEL_13:
              v7 = 1;
            }
          }
LABEL_56:
          if ( !v7 )
            goto LABEL_83;
          LODWORD(v3) = IOSleep(1LL);
        }
        while ( v7 & 1 && v8 > 0 );
        if ( v7 & 1 )
          break;
      }
LABEL_82:
      LODWORD(v43) = (_DWORD)v43 - 1;
      if ( !(v7 & 1) )
        goto LABEL_83;
    }
    if ( *((_BYTE *)this + 218) )
    {
      v20 = 0;
      v21 = 1LL;
      while ( 1 )
      {
        v26 = *(_QWORD *)(*((_QWORD *)this + 52) + 8 * v21 - 8);
        if ( !v26 || *(_DWORD *)(v26 + 96) != 1 )
          goto LABEL_80;
        LODWORD(arg3) = 0;
        v27 = AppleUSBHub::GetPortStatus(this, (__int64)&arg3, (unsigned __int16)v21);
        if ( (_DWORD)v27 )
          break;
        v7 = 1;
        if ( !(BYTE2(arg3) & 4) )
        {
          if ( arg3 & 4 )
          {
            v22 = AppleUSBHubPort::SuspendPort(v26, v27, 0, 0);
            if ( v22 )
            {
              if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              {
                v23 = v22;
                v24 = *((_DWORD *)this + 74);
                v25 = 3LL;
                goto LABEL_78;
              }
LABEL_79:
              *(_BYTE *)(v44 + v21 - 1) = 1;
              *(_DWORD *)(v26 + 96) = 3;
              *(_BYTE *)(v26 + 401) = 0;
LABEL_80:
              v7 = v20;
              goto LABEL_81;
            }
          }
          else if ( !*(_BYTE *)(v26 + 401) )
          {
            if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(0x52D104Cu, *((_DWORD *)this + 74), v21, arg3, 4uLL, 0LL);
            goto LABEL_80;
          }
        }
LABEL_81:
        v3 = *((_BYTE *)this + 218);
        ++v21;
        v20 = v7;
        if ( (signed int)v21 - 1 >= (signed int)v3 )
          goto LABEL_82;
      }
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v23 = (signed int)v27;
        v24 = *((_DWORD *)this + 74);
        v25 = 2LL;
LABEL_78:
        kernel_debug(0x52D104Cu, v24, v23, v21, v25, 0LL);
      }
      goto LABEL_79;
    }
LABEL_99:
    v38 = *((_QWORD *)v1 + 92);
    if ( v38 && (*(int (**)(void))(*(_QWORD *)v38 + 304LL))() )
    {
      if ( *(_BYTE *)off_1A080[0] & 2 )
      {
        v39 = *((_DWORD *)v1 + 74);
        v40 = (*(int (**)(void))(**((_QWORD **)v1 + 92) + 304LL))();
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D104Cu, v39, (unsigned int)v40, 0LL, 0LL, 0LL);
      }
      (*(void (__fastcall **)(_QWORD, __int64 (__fastcall *)(AppleUSBHub *, OSArray *, uintptr_t), _QWORD, signed __int64, _QWORD, _QWORD))(**((_QWORD **)v1 + 34) + 456LL))(
        *((_QWORD *)v1 + 34),
        AppleUSBHub::ProcessAllNotificationsForEvent,
        *((_QWORD *)v1 + 92),
        8LL,
        0LL,
        0LL);
      (*(void (**)(void))(**((_QWORD **)v1 + 92) + 344LL))();
    }
    v2 = off_1A070[0];
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D104Eu, *((_DWORD *)v1 + 74), 0LL, 0LL, 0LL, 0LL);
  }
  return *(_QWORD *)v2;
}
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A070: using guessed type __int64 off_1A070[6];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000ADE0) ----------------------------------------------------
__int64 __usercall AppleUSBHub::DecrementOutstandingResumes@<rax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  AppleUSBHub *v2; // rbx@1
  __int64 v3; // rdi@1
  __int64 result; // rax@2
  __int64 v5; // [sp-4h] [bp-10h]@1

  v5 = a2;
  v2 = this;
  ++AppleUSBHub::DecrementOutstandingResumes(void)::gSerial;
  v3 = *((_QWORD *)this + 34);
  if ( v3 )
  {
    (*(void (__fastcall **)(__int64, __int64 (__fastcall *)(uintptr_t, uintptr_t, void *, void *, void *, void *), signed __int64, char *, _QWORD, _QWORD))(*(_QWORD *)v3 + 456LL))(
      v3,
      AppleUSBHub::ChangeOutstandingResumes,
      -1LL,
      (char *)&v5 + 4,
      0LL,
      0LL);
    result = HIDWORD(v5);
  }
  else
  {
    result = (unsigned int)(*((_DWORD *)v2 + 182) - 1);
    *((_DWORD *)v2 + 182) = result;
    HIDWORD(v5) = result;
  }
  if ( !(_DWORD)result )
  {
    if ( *((_BYTE *)v2 + 428) )
    {
      *((_BYTE *)v2 + 428) = 0;
      result = IOService::acknowledgeSetPowerState(v2);
    }
  }
  return result;
}
// 1BCF0: using guessed type int AppleUSBHub::DecrementOutstandingResumes(void)::gSerial;

//----- (000000000000AE56) ----------------------------------------------------
char __fastcall AppleUSBHub::IsHSRootHub(AppleUSBHub *this)
{
  char result; // al@2

  if ( !__PAIR__(*((_BYTE *)this + 426), *((_BYTE *)this + 425)) || (result = 1, !*((_BYTE *)this + 160)) )
    result = 0;
  return result;
}

//----- (000000000000AE7C) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::GetPortInformation(AppleUSBHub *this, int a2, unsigned int *a3)
{
  unsigned int *v3; // r12@1
  AppleUSBHub *v4; // rbx@1
  unsigned int v5; // er15@4
  int v6; // er14@4
  __int64 v7; // rax@4
  __int64 v8; // r12@5
  int v9; // eax@6
  char v10; // di@10
  unsigned int v11; // ecx@13
  unsigned __int8 v13; // [sp+7h] [bp-39h]@18
  unsigned int *v14; // [sp+8h] [bp-38h]@5
  int v15; // [sp+10h] [bp-30h]@9

  v3 = a3;
  v4 = this;
  if ( !(unsigned __int8)IOService::isInactive(this) && *((_QWORD *)this + 35) && *((_QWORD *)this + 34) )
  {
    v5 = 0;
    AppleUSBHub::IncrementOutstandingIO(this, 0);
    v6 = 2 * (*((_BYTE *)this + 160) != 0);
    v7 = *((_QWORD *)this + 52);
    if ( v7 )
    {
      v14 = v3;
      v8 = *(_QWORD *)(v7 + 8LL * (unsigned int)(a2 - 1));
      LOBYTE(v7) = 1;
      if ( v8 )
      {
        v9 = v6 | *(_BYTE *)(v8 + 101);
        v6 |= *(_BYTE *)(v8 + 101) | 0x1000;
        if ( !*(_BYTE *)(v8 + 102) )
          v6 = v9;
        LOBYTE(v7) = !AppleUSBHubPort::ShouldApplyDisconnectWorkaround((AppleUSBHubPort *)v8);
      }
      v15 = 0;
      if ( *((_BYTE *)this + 304) )
      {
        v10 = 1;
        if ( v8 && (unsigned int)(*(_DWORD *)(v8 + 96) - 1) < 2 )
          v6 |= 0x38u;
        v11 = 0;
        v3 = v14;
LABEL_14:
        v6 |= 8 * (v11 & 2) | 8 * (v11 & 4) | 16 * (v11 & 8) | 4 * (v11 & 0x10) | (v11 >> 3) & 0x100;
        if ( !((unsigned __int8)v7 | (*((_BYTE *)v4 + 1040) == 0)) )
        {
          if ( *((_BYTE *)v4 + 426) )
          {
            v6 |= 0x18u;
          }
          else if ( !v10 )
          {
            v6 |= 0x18u;
          }
        }
        goto LABEL_22;
      }
      v13 = v7;
      v7 = AppleUSBHub::GetPortStatus(this, (__int64)&v15, (unsigned __int16)a2);
      if ( !(_DWORD)v7 )
      {
        v11 = (unsigned __int16)v15;
        v10 = 1;
        v3 = v14;
        LODWORD(v7) = v13;
        if ( v15 & 1 )
        {
          v6 |= 8 * (BYTE2(v15) & 1) ^ 8;
          v10 = 0;
        }
        goto LABEL_14;
      }
      v5 = v7;
      v3 = v14;
    }
LABEL_22:
    *v3 = v6;
    AppleUSBHub::DecrementOutstandingIO(v4, v7, 0);
    return v5;
  }
  *v3 = 0;
  return -536870208;
}

//----- (000000000000B03E) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::ResetPort(AppleUSBHub *this, unsigned int a2)
{
  unsigned int v2; // er14@4
  __int64 result; // rax@4

  if ( !(unsigned __int8)IOService::isInactive(this) && *((_QWORD *)this + 35) && *((_QWORD *)this + 34) )
  {
    (*(void (**)(void))(*(_QWORD *)this + 32LL))();
    (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 2128LL))(this);
    v2 = AppleUSBHub::DoPortAction(this, 0xE0004001uLL, a2, 0);
    (*(void (__fastcall **)(AppleUSBHub *, signed __int64))(*(_QWORD *)this + 40LL))(this, 3758112769LL);
    result = v2;
  }
  else
  {
    result = 3758097088LL;
  }
  return result;
}

//----- (000000000000B0AA) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SuspendPort(AppleUSBHub *this, unsigned int a2, char a3)
{
  char v3; // r15@1
  unsigned int v4; // er14@4
  __int64 result; // rax@4

  v3 = a3;
  if ( !(unsigned __int8)IOService::isInactive(this) && *((_QWORD *)this + 35) && *((_QWORD *)this + 34) )
  {
    (*(void (__cdecl **)(AppleUSBHub *))(*(_QWORD *)this + 32LL))(this);
    (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 2128LL))(this);
    v4 = AppleUSBHub::DoPortAction(this, (v3 == 0) | 0xE0004002, a2, 0);
    (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 40LL))(this);
    result = v4;
  }
  else
  {
    result = 3758097088LL;
  }
  return result;
}

//----- (000000000000B12C) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::ReEnumeratePort(AppleUSBHub *this, unsigned int a2, unsigned int a3)
{
  unsigned int v3; // er14@1
  unsigned int v4; // er14@4
  __int64 result; // rax@4

  v3 = a3;
  if ( !(unsigned __int8)IOService::isInactive(this) && *((_QWORD *)this + 35) && *((_QWORD *)this + 34) )
  {
    (*(void (__cdecl **)(AppleUSBHub *))(*(_QWORD *)this + 32LL))(this);
    (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 2128LL))(this);
    v4 = AppleUSBHub::DoPortAction(this, 0xE0004006uLL, a2, v3);
    (*(void (__fastcall **)(AppleUSBHub *, signed __int64))(*(_QWORD *)this + 40LL))(this, 3758112774LL);
    result = v4;
  }
  else
  {
    result = 3758097088LL;
  }
  return result;
}

//----- (000000000000B1A6) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::ChangeOutstandingIO(uintptr_t arg2, uintptr_t a2, void *a3, void *a4, void *a5, void *a6)
{
  void *v6; // r14@1
  void *v7; // r15@1
  uintptr_t v8; // rax@1
  uintptr_t v9; // r12@1
  signed int v10; // er13@3

  v6 = a4;
  v7 = a3;
  v8 = OSMetaClassBase::safeMetaCast(
         (OSMetaClassBase *)arg2,
         (const OSMetaClassBase *)&AppleUSBHub::gMetaClass,
         (const OSMetaClass *)a3);
  v9 = v8;
  if ( v8 )
  {
    if ( (_DWORD)a2 == -1 )
    {
      --*(_DWORD *)(v8 + 720);
      v10 = 0;
      if ( v6 )
        *(_BYTE *)(v8 + 320) = 0;
    }
    else if ( (_DWORD)a2 == 1 )
    {
      ++*(_DWORD *)(v8 + 720);
      v10 = 0;
      if ( v6 )
        *(_BYTE *)(v8 + 320) = 1;
    }
    else
    {
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1058u, v8, (unsigned int)a2, 0LL, 1uLL, 0LL);
      v10 = -536870206;
    }
    if ( v7 )
      *(_DWORD *)v7 = *(_DWORD *)(v9 + 720);
  }
  else
  {
    v10 = -536870206;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1058u, 0LL, arg2, 0LL, 0LL, 0LL);
  }
  return (unsigned int)v10;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000B2BE) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::ChangeRaisedPowerState(uintptr_t arg2, uintptr_t a2, void *a3, void *a4, void *a5, void *a6)
{
  void *v6; // r15@1
  uintptr_t v7; // rax@1
  uintptr_t v8; // r12@1
  signed int v9; // er14@3

  v6 = a3;
  v7 = OSMetaClassBase::safeMetaCast(
         (OSMetaClassBase *)arg2,
         (const OSMetaClassBase *)&AppleUSBHub::gMetaClass,
         (const OSMetaClass *)a3);
  v8 = v7;
  if ( v7 )
  {
    if ( (_DWORD)a2 == -1 )
    {
      --*(_DWORD *)(v7 + 724);
      v9 = 0;
    }
    else if ( (_DWORD)a2 == 1 )
    {
      ++*(_DWORD *)(v7 + 724);
      v9 = 0;
    }
    else
    {
      v9 = -536870206;
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D105Cu, v7, (unsigned int)a2, 0LL, 1uLL, 0LL);
    }
    if ( v6 )
      *(_DWORD *)v6 = *(_DWORD *)(v8 + 724);
  }
  else
  {
    v9 = -536870206;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D105Cu, 0LL, arg2, 0LL, 0LL, 0LL);
  }
  return (unsigned int)v9;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000B3AE) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::ChangeOutstandingResumes(uintptr_t arg2, uintptr_t a2, void *a3, void *a4, void *a5, void *a6)
{
  void *v6; // r15@1
  uintptr_t v7; // rax@1
  uintptr_t v8; // r12@1
  signed int v9; // er14@3

  v6 = a3;
  v7 = OSMetaClassBase::safeMetaCast(
         (OSMetaClassBase *)arg2,
         (const OSMetaClassBase *)&AppleUSBHub::gMetaClass,
         (const OSMetaClass *)a3);
  v8 = v7;
  if ( v7 )
  {
    if ( (_DWORD)a2 == -1 )
    {
      --*(_DWORD *)(v7 + 728);
      v9 = 0;
    }
    else if ( (_DWORD)a2 == 1 )
    {
      ++*(_DWORD *)(v7 + 728);
      v9 = 0;
    }
    else
    {
      v9 = -536870206;
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1060u, v7, (unsigned int)a2, 0LL, 1uLL, 0LL);
    }
    if ( v6 )
      *(_DWORD *)v6 = *(_DWORD *)(v8 + 728);
  }
  else
  {
    v9 = -536870206;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1060u, 0LL, arg2, 0LL, 0LL, 0LL);
  }
  return (unsigned int)v9;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000B49E) ----------------------------------------------------
__int64 __usercall AppleUSBHub::ChangeDoPortActionLock@<rax>(AppleUSBHub *this@<rdi>, OSObject *a2@<rsi>, void *a3@<rdx>, void *a4@<rcx>, void *a5@<r8>, void *a6@<r9>, __int64 a7@<rax>)
{
  uintptr_t v7; // rax@1
  uintptr_t v8; // r12@1
  signed __int64 v9; // r14@2
  __int64 v10; // rbx@6
  int v11; // eax@10
  signed int v12; // er14@18
  uintptr_t v13; // rdx@20
  uintptr_t v14; // r8@20
  __int64 v16; // [sp+0h] [bp-30h]@1

  v16 = a7;
  v7 = OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHub::gMetaClass, (const OSMetaClass *)a3);
  v8 = v7;
  if ( !a2 )
  {
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1088u, v7, 0LL, 0LL, 8uLL, 0LL);
    *(_BYTE *)(v8 + 432) = 0;
    (*(void (__fastcall **)(_QWORD, signed __int64, signed __int64))(**(_QWORD **)(v8 + 272) + 488LL))(
      *(_QWORD *)(v8 + 272),
      v8 + 432,
      1LL);
    goto LABEL_25;
  }
  v9 = v7 + 432;
  if ( !*(_BYTE *)(v7 + 432) )
  {
    if ( !(*(_BYTE *)off_1A080[0] & 2)
      || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7)
      || (kernel_debug(0x52D1088u, v7, 0LL, 0LL, 0LL, 0LL), !*(_BYTE *)(v8 + 432)) )
    {
LABEL_16:
      *(_BYTE *)v9 = 1;
LABEL_25:
      v12 = 0;
      return (unsigned int)v12;
    }
  }
  v10 = off_1A080[0];
  while ( 2 )
  {
    clock_interval_to_deadline(30LL, 1000000000LL, &v16);
    if ( *(_BYTE *)v10 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1088u, v8, 0LL, 0LL, 1uLL, 0LL);
    v11 = (*(int (__fastcall **)(_QWORD, signed __int64, __int64, signed __int64))(**(_QWORD **)(v8 + 272) + 496LL))(
            *(_QWORD *)(v8 + 272),
            v8 + 432,
            v16,
            2LL);
    if ( v11 >= 0 )
    {
      switch ( v11 )
      {
        case 0:
          if ( *(_BYTE *)v10 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(0x52D1088u, v8, *(_BYTE *)(v8 + 432), 0LL, 2uLL, 0LL);
          if ( !*(_BYTE *)v9 )
            goto LABEL_16;
          continue;
        case 1:
          v12 = -536870174;
          if ( !(*(_BYTE *)v10 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
            return (unsigned int)v12;
          v13 = *(_BYTE *)(v8 + 432);
          v14 = 7LL;
          goto LABEL_29;
        case 2:
          v12 = -536870174;
          if ( !(*(_BYTE *)v10 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
            return (unsigned int)v12;
          v13 = *(_BYTE *)(v8 + 432);
          v14 = 3LL;
          goto LABEL_29;
        case 3:
          v12 = -536870174;
          if ( !(*(_BYTE *)v10 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
            return (unsigned int)v12;
          v13 = *(_BYTE *)(v8 + 432);
          v14 = 4LL;
          goto LABEL_29;
        default:
          break;
      }
LABEL_26:
      v12 = -536870174;
      if ( *(_BYTE *)v10 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v13 = *(_BYTE *)(v8 + 432);
        v14 = 6LL;
        goto LABEL_29;
      }
      return (unsigned int)v12;
    }
    break;
  }
  if ( v11 != -536870174 )
    goto LABEL_26;
  v12 = -536870174;
  if ( *(_BYTE *)v10 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v13 = *(_BYTE *)(v8 + 432);
    v14 = 5LL;
LABEL_29:
    kernel_debug(0x52D1088u, v8, v13, 0LL, v14, 0LL);
  }
  return (unsigned int)v12;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);
// 2C768: using guessed type int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD);

//----- (000000000000B7A0) ----------------------------------------------------
int __fastcall AppleUSBHub::EnterTestMode(AppleUSBHub *this)
{
  AppleUSBHub *v1; // r15@1
  int result; // eax@1
  const OSMetaClass *v3; // rdx@2
  __int64 v4; // r14@3
  const OSMetaClass *v5; // rdx@9
  __int64 v6; // rax@10
  unsigned __int8 v7; // cl@15
  __int64 v8; // rbx@15
  __int64 v9; // rax@16
  uintptr_t v10; // rdi@17

  v1 = this;
  result = -536870206;
  if ( !*((_BYTE *)this + 425) )
    return result;
  *((_BYTE *)this + 1077) = 1;
  (*(void (__cdecl **)(AppleUSBHub *))(*(_QWORD *)this + 2128LL))(this);
  if ( *((_BYTE *)this + 160) )
  {
    v4 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)this + 17), *(const OSMetaClassBase **)off_1A018[0], v3);
    if ( v4 )
    {
      if ( *(_BYTE *)off_1A080[0] & 2 )
      {
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D1064u, *((_DWORD *)this + 74), 0LL, 0LL, 1uLL, 0LL);
      }
      return (*(int (__fastcall **)(__int64, signed __int64, _QWORD))(*(_QWORD *)v4 + 2712LL))(v4, 10LL, 0LL);
    }
LABEL_21:
    *((_BYTE *)this + 1077) = 0;
    return -536870206;
  }
  result = 0;
  if ( !*((_QWORD *)this + 52) )
    return result;
  if ( AppleUSBHub::IsHubDeviceInternal(this, 0LL) )
  {
    v6 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)this + 17), *(const OSMetaClassBase **)off_1A018[0], v5);
    if ( !v6 )
      goto LABEL_21;
    (*(void (__fastcall **)(__int64, signed __int64, _QWORD))(*(_QWORD *)v6 + 2712LL))(
      v6,
      254LL,
      *((_BYTE *)this + 218));
  }
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1064u, *((_DWORD *)this + 74), *((_BYTE *)this + 218), 0LL, 2uLL, 0LL);
  v7 = *((_BYTE *)this + 218);
  v8 = 0LL;
  result = 0;
  if ( v7 )
  {
    do
    {
      v9 = *((_QWORD *)v1 + 52);
      if ( v9 )
      {
        v10 = *(_QWORD *)(v9 + 8 * v8);
        if ( v10 )
        {
          AppleUSBHubPort::SuspendPort(v10, v9, 0, 1);
          v7 = *((_BYTE *)v1 + 218);
        }
      }
      ++v8;
      result = 0;
    }
    while ( (signed int)v8 < v7 );
  }
  return result;
}
// 1A018: using guessed type _QWORD off_1A018[17];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000B94C) ----------------------------------------------------
int __usercall AppleUSBHub::LeaveTestMode@<eax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>, const OSMetaClass *a3@<rdx>)
{
  signed int v3; // er14@1
  __int64 v4; // r15@3
  const OSMetaClass *v6; // rdx@8
  __int64 v7; // rax@9

  v3 = -536870206;
  if ( !*((_BYTE *)this + 425) )
    return v3;
  if ( !*((_BYTE *)this + 160) )
  {
    if ( AppleUSBHub::IsHubDeviceInternal(this, a2) )
    {
      v7 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)this + 17), *(const OSMetaClassBase **)off_1A018[0], v6);
      if ( !v7 )
        return v3;
      (*(void (__fastcall **)(__int64, signed __int64, _QWORD))(*(_QWORD *)v7 + 2712LL))(
        v7,
        255LL,
        *((_BYTE *)this + 218));
    }
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1068u, *((_DWORD *)this + 74), 0LL, 0LL, 2uLL, 0LL);
    (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 32LL))(this);
    AppleUSBHub::ResetMyPort(this);
    (*(void (__fastcall **)(AppleUSBHub *))(*(_QWORD *)this + 40LL))(this);
    return 0;
  }
  v4 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)this + 17), *(const OSMetaClassBase **)off_1A018[0], a3);
  if ( !v4 )
    return v3;
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1068u, *((_DWORD *)this + 74), 0LL, 0LL, 1uLL, 0LL);
  }
  return (*(int (__fastcall **)(__int64, signed __int64, _QWORD))(*(_QWORD *)v4 + 2712LL))(v4, 11LL, 0LL);
}
// 1A018: using guessed type _QWORD off_1A018[17];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000BA92) ----------------------------------------------------
int __fastcall AppleUSBHub::PutPortIntoTestMode(AppleUSBHub *this, unsigned int a2, unsigned int a3)
{
  unsigned int v3; // er14@1
  int v4; // er12@3
  int result; // eax@4
  int v6; // eax@5

  v3 = a3;
  if ( *((_BYTE *)this + 425) && *((_BYTE *)this + 1077) && (v4 = a2 + 1, a2 + 1 <= *((_BYTE *)this + 218)) )
  {
    v6 = *(_DWORD *)off_1A080[0] & 2;
    if ( *((_BYTE *)this + 160) )
    {
      if ( v6 )
      {
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D106Cu, *((_DWORD *)this + 74), (unsigned int)v4, a3, 1uLL, 0LL);
      }
      result = (*(int (__fastcall **)(_QWORD, _QWORD, _QWORD))(**((_QWORD **)this + 17) + 2712LL))(
                 *((_QWORD *)this + 17),
                 v3,
                 a2);
    }
    else
    {
      if ( v6 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D106Cu, *((_DWORD *)this + 74), (unsigned int)v4, a3, 2uLL, 0LL);
      result = AppleUSBHub::SetPortFeature(this, 21, v4 + ((_WORD)v3 << 8));
    }
  }
  else
  {
    result = -536870206;
  }
  return result;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000000BB90) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SetIndicatorForPort(AppleUSBHub *this, unsigned int a2, __int16 a3)
{
  __int64 result; // rax@2

  if ( a2 <= *((_BYTE *)this + 218) )
    result = AppleUSBHub::SetPortFeature(this, 22, (a3 << 8) + (unsigned __int16)a2);
  else
    result = 3758097090LL;
  return result;
}

//----- (000000000000BBBA) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::GetPortIndicatorControl(AppleUSBHub *this, unsigned int a2, unsigned int *a3)
{
  unsigned int *v3; // r12@1
  signed int v4; // er15@1
  char v6; // [sp+8h] [bp-28h]@2
  char v7; // [sp+9h] [bp-27h]@6

  v3 = a3;
  v4 = -536870206;
  if ( a2 <= *((_BYTE *)this + 218) )
  {
    v4 = AppleUSBHub::GetPortStatus(this, (__int64)&v6, (unsigned __int16)a2);
    if ( v4 )
    {
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1070u, *((_DWORD *)this + 74), (unsigned __int16)a2, v4, 0LL, 0LL);
    }
    else
    {
      if ( v7 & 0x10 )
        *v3 = 1;
      else
        *v3 = 0;
      v4 = 0;
    }
  }
  return (unsigned int)v4;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000000BC60) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SetIndicatorsToAutomatic(AppleUSBHub *this)
{
  int v1; // ecx@1
  __int64 result; // rax@1
  signed __int64 v3; // rbx@2
  __int64 v4; // r12@2
  __int64 v5; // r13@2
  signed int v6; // er15@3

  v1 = *((_BYTE *)this + 218);
  result = 3758097095LL;
  if ( *((_BYTE *)this + 218) )
  {
    v3 = 1LL;
    v4 = off_1A080[0];
    v5 = off_1A098;
    do
    {
      v6 = -536870206;
      if ( (unsigned __int16)v3 > (unsigned int)v1 || (v6 = AppleUSBHub::SetPortFeature(this, 22, v3), result = 0LL, v6) )
      {
        if ( *(_BYTE *)v4 & 2 )
        {
          if ( *(_DWORD *)v5 & 0xFFFFFFF7 )
            kernel_debug(0x52D1074u, *((_DWORD *)this + 74), v3, v6, 0LL, 0LL);
        }
        result = (unsigned int)v6;
      }
      ++v3;
      v1 = *((_BYTE *)this + 218);
    }
    while ( (signed int)v3 - 1 < v1 );
  }
  return result;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000000BD0E) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::GetPortPower(AppleUSBHub *this, unsigned int a2, unsigned int *a3)
{
  unsigned int *v3; // r12@1
  signed int v4; // er15@1
  char v6; // [sp+8h] [bp-28h]@2
  char v7; // [sp+9h] [bp-27h]@6

  v3 = a3;
  v4 = -536870206;
  if ( a2 <= *((_BYTE *)this + 218) )
  {
    v4 = AppleUSBHub::GetPortStatus(this, (__int64)&v6, (unsigned __int16)a2);
    if ( v4 )
    {
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1078u, *((_DWORD *)this + 74), (unsigned __int16)a2, v4, 0LL, 0LL);
    }
    else
    {
      if ( v7 & 1 )
        *v3 = 1;
      else
        *v3 = 0;
      v4 = 0;
    }
  }
  return (unsigned int)v4;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000000BDB4) ----------------------------------------------------
void __fastcall AppleUSBHub::DisablePowerManagement(AppleUSBHub *this, int a2)
{
  *((_BYTE *)this + 1076) = a2 != 0;
}

//----- (000000000000BDC4) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::GetPortPowerMgmtState(AppleUSBHub *this, unsigned int a2, unsigned __int64 *a3)
{
  __int64 result; // rax@1
  __int64 v4; // rcx@3
  __int64 v5; // rcx@4
  unsigned __int64 v6; // rax@5
  bool v7; // zf@5
  unsigned __int64 v8; // rcx@5

  result = 3758097090LL;
  if ( (_WORD)a2 )
  {
    if ( a2 <= *((_BYTE *)this + 218) )
    {
      v4 = *((_QWORD *)this + 52);
      result = 3758097095LL;
      if ( v4 )
      {
        v5 = *(_QWORD *)(v4 + 8LL * (signed int)(a2 - 1));
        if ( v5 )
        {
          v6 = *(_DWORD *)(v5 + 96);
          *a3 = v6;
          v7 = (*(_QWORD *)(v5 + 80) == 0LL && v6 == 3) == 0;
          v8 = 5LL;
          if ( v7 )
            v8 = v6;
          *a3 = v8;
          result = 0LL;
        }
      }
    }
  }
  return result;
}

//----- (000000000000BE26) ----------------------------------------------------
int __fastcall AppleUSBHub::EnsureUsability(AppleUSBHub *this)
{
  AppleUSBHub *v1; // r14@1
  __int64 v2; // rdi@2
  __int64 v3; // rax@6
  signed int v5; // ebx@10
  char v6; // al@11

  v1 = this;
  if ( (unsigned __int8)IOService::isInactive(this) )
    return 0;
  v2 = *((_QWORD *)this + 35);
  if ( !v2 || !*((_QWORD *)v1 + 34) )
    return 0;
  if ( (unsigned __int8)(*(int (**)(void))(*(_QWORD *)v2 + 312LL))() )
  {
    if ( *((_QWORD *)v1 + 48) )
    {
      AppleUSBHub::IncrementOutstandingIO(v1, 0);
      (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v1 + 32LL))(v1, 0LL);
      LODWORD(v3) = thread_call_enter(*((_QWORD *)v1 + 48));
      if ( (_DWORD)v3 == 1 )
      {
        AppleUSBHub::DecrementOutstandingIO(v1, v3, 0);
        (*(void (__fastcall **)(AppleUSBHub *, _QWORD))(*(_QWORD *)v1 + 40LL))(v1, 0LL);
      }
    }
    return 0;
  }
  AppleUSBHub::AbandonPortCheck(v1);
  if ( *((_BYTE *)v1 + 429) )
  {
    v5 = -199;
    do
    {
      IOSleep(2LL);
      v6 = *((_BYTE *)v1 + 429);
      if ( !v6 )
        break;
    }
    while ( v5++ != 0 );
    if ( v6 && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D107Cu, *((_DWORD *)v1 + 74), 0LL, 0LL, 0LL, 0LL);
  }
  return (*(int (__fastcall **)(AppleUSBHub *))(off_1A060[0] + 2144))(v1);
}
// 1A060: using guessed type __int64 off_1A060[8];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (000000000000BF28) ----------------------------------------------------
int __usercall AppleUSBHub::WaitForAbandonPortCheckGated@<eax>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  int result; // eax@1
  __int64 v3; // [sp+0h] [bp-10h]@1

  v3 = a2;
  clock_interval_to_deadline(32LL, 1000000LL, &v3);
  *((_BYTE *)this + 430) = 1;
  result = (*(int (__fastcall **)(_QWORD, char *, __int64, signed __int64))(**((_QWORD **)this + 34) + 496LL))(
             *((_QWORD *)this + 34),
             (char *)this + 430,
             v3,
             2LL);
  *((_BYTE *)this + 430) = 0;
  if ( (unsigned int)result <= 3 )
    result = *((_DWORD *)qword_19EC8 + result);
  return result;
}
// 19EC8: using guessed type __int64 qword_19EC8[3];
// 2C768: using guessed type int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD);

//----- (000000000000BF8A) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::InitialDelay(AppleUSBHub *this)
{
  __int64 v1; // rax@1

  v1 = IOService::isInactive(this);
  if ( !(_BYTE)v1 )
    LODWORD(v1) = IOSleep(1500LL);
  return AppleUSBHub::LowerPowerState(this, v1);
}
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (000000000000BFB4) ----------------------------------------------------
void __fastcall AppleUSBHub::HubResetPortAfterPowerChangeDone(AppleUSBHub *this)
{
  AppleUSBHub *v1; // r14@1
  __int64 v2; // r15@1
  uintptr_t v3; // rsi@7
  uint32_t v4; // edi@7
  uintptr_t v5; // rsi@8
  __int64 v6; // rax@11
  int v7; // ebx@11
  __int64 v8; // rdi@21
  uintptr_t v9; // rbx@31
  __int64 v10; // r12@31
  int v11; // eax@32
  __int64 v12; // rdi@46
  int v13; // eax@48
  uintptr_t v14; // rdx@51
  uintptr_t v15; // rsi@51
  uintptr_t v16; // rcx@51
  uintptr_t v17; // r8@51
  int v18; // eax@52
  uintptr_t v19; // rsi@55
  uintptr_t v20; // r8@55

  v1 = this;
  v2 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D10D1u, *((_DWORD *)this + 74), 0LL, 0LL, 0LL, 0LL);
  if ( (unsigned __int8)IOService::isInactive(this) )
  {
    if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v3 = *((_DWORD *)this + 74);
      v4 = 86839504;
LABEL_72:
      kernel_debug(v4, v3, 0LL, 0LL, 0LL, 0LL);
      return;
    }
    return;
  }
  v5 = 0LL;
  AppleUSBHub::IncrementOutstandingIO(this, 0);
  if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v5 = *((_DWORD *)this + 74);
    kernel_debug(0x52D10D0u, v5, 0LL, 0LL, 1uLL, 0LL);
  }
  LODWORD(v6) = (*(int (__fastcall **)(_QWORD, uintptr_t))(**((_QWORD **)this + 18) + 2232LL))(
                  *((_QWORD *)this + 18),
                  v5);
  v7 = v6;
  if ( (_DWORD)v6 || (v6 = IOService::isInactive(this), (_BYTE)v6) )
  {
    if ( *(_BYTE *)v2 & 2 )
    {
      v6 = off_1A098;
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D10D0u, *((_DWORD *)this + 74), v7, 0LL, 2uLL, 0LL);
    }
    *((_BYTE *)this + 317) = 1;
    goto LABEL_69;
  }
  if ( !*((_DWORD *)this + 75) )
  {
    *((_DWORD *)this + 75) = 1;
    if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10D0u, *((_DWORD *)this + 74), *((_BYTE *)this + 429), 0LL, 3uLL, 0LL);
    v8 = *((_QWORD *)this + 32);
    if ( v8 )
    {
      if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        kernel_debug(0x52D10D0u, *((_DWORD *)v1 + 74), 0LL, 0LL, 4uLL, 0LL);
        v8 = *((_QWORD *)v1 + 32);
      }
      (*(void (**)(void))(*(_QWORD *)v8 + 296LL))();
      (*(void (**)(void))(**((_QWORD **)v1 + 32) + 40LL))();
      *((_QWORD *)v1 + 32) = 0LL;
    }
    if ( !*((_QWORD *)v1 + 25) )
    {
LABEL_46:
      v12 = *((_QWORD *)v1 + 33);
      if ( v12 )
      {
        (*(void (**)(void))(*(_QWORD *)v12 + 40LL))();
        *((_QWORD *)v1 + 33) = 0LL;
      }
      v13 = AppleUSBHub::ConfigureHub(v1);
      if ( v13 )
      {
        if ( !(*(_BYTE *)v2 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
          goto LABEL_64;
        v14 = v13;
        v15 = *((_DWORD *)v1 + 74);
        v16 = 0LL;
        v17 = 9LL;
LABEL_63:
        kernel_debug(0x52D10D0u, v15, v14, v16, v17, 0LL);
LABEL_64:
        clock_get_uptime((char *)v1 + 1024);
        *((_DWORD *)v1 + 75) = 0;
        goto LABEL_65;
      }
      v18 = *(_DWORD *)v2 & 2;
      if ( *((_BYTE *)v1 + 426) )
      {
        if ( !v18 || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
          goto LABEL_60;
        v19 = *((_DWORD *)v1 + 74);
        v20 = 10LL;
      }
      else
      {
        if ( !v18 || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
          goto LABEL_60;
        v19 = *((_DWORD *)v1 + 74);
        v20 = 11LL;
      }
      kernel_debug(0x52D10D0u, v19, 0LL, 0LL, v20, 0LL);
LABEL_60:
      if ( !(*(_BYTE *)v2 & 2) )
        goto LABEL_64;
      v15 = *((_DWORD *)v1 + 74);
      if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_64;
      v14 = *((_WORD *)v1 + 122);
      v17 = 0LL;
      v16 = *((_DWORD *)v1 + 74);
      goto LABEL_63;
    }
    if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10D0u, *((_DWORD *)v1 + 74), 0LL, 0LL, 5uLL, 0LL);
    if ( *((_BYTE *)v1 + 429) )
    {
      v9 = 499LL;
      v10 = off_1A098;
      while ( 1 )
      {
        v11 = *(_DWORD *)v2 & 2;
        if ( (signed int)v9 <= 0 )
          break;
        if ( v11 && *(_DWORD *)v10 & 0xFFFFFFF7 )
          kernel_debug(0x52D10D0u, *((_DWORD *)v1 + 74), v9, 0LL, 6uLL, 0LL);
        IOSleep(10LL);
        --v9;
        if ( !*((_BYTE *)v1 + 429) )
          goto LABEL_37;
      }
      if ( !v11 )
        goto LABEL_42;
    }
    else
    {
LABEL_37:
      if ( !(*(_BYTE *)v2 & 2) )
      {
LABEL_42:
        (*(void (__fastcall **)(_QWORD, AppleUSBHub *, _QWORD))(**((_QWORD **)v1 + 25) + 1496LL))(
          *((_QWORD *)v1 + 25),
          v1,
          0LL);
        if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D10D0u, *((_DWORD *)v1 + 74), 0LL, 0LL, 8uLL, 0LL);
        (*(void (**)(void))(**((_QWORD **)v1 + 25) + 40LL))();
        *((_QWORD *)v1 + 25) = 0LL;
        goto LABEL_46;
      }
    }
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10D0u, *((_DWORD *)v1 + 74), 0LL, 0LL, 7uLL, 0LL);
    goto LABEL_42;
  }
LABEL_65:
  if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D10D0u, *((_DWORD *)v1 + 74), 0LL, 0LL, 0xCuLL, 0LL);
  IOService::changePowerStateToPriv(v1, 4uLL);
  v6 = IOService::powerOverrideOffPriv(v1);
LABEL_69:
  AppleUSBHub::DecrementOutstandingIO(v1, v6, 0);
  if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v3 = *((_DWORD *)v1 + 74);
    v4 = 86839506;
    goto LABEL_72;
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2C760: using guessed type int __fastcall clock_get_uptime(_QWORD);

//----- (000000000000C47C) ----------------------------------------------------
bool __usercall AppleUSBHub::IsHubDeviceInternalAndOnThunderbolt@<al>(AppleUSBHub *this@<rdi>, __int64 a2@<rax>)
{
  bool result; // al@2
  __int64 v3; // [sp-4h] [bp-10h]@1

  v3 = a2;
  HIDWORD(v3) = 0;
  if ( *((_BYTE *)this + 1069) )
  {
    result = *((_BYTE *)this + 1068) != 0;
  }
  else if ( (*(int (__fastcall **)(_QWORD, char *))(**((_QWORD **)this + 18) + 2488LL))(
              *((_QWORD *)this + 18),
              (char *)&v3 + 4) )
  {
    result = 0;
  }
  else
  {
    if ( (WORD2(v3) & 0x2004) == 8196 )
    {
      *((_BYTE *)this + 1068) = 1;
      result = 1;
    }
    else
    {
      result = *((_BYTE *)this + 1068) != 0;
    }
    *((_BYTE *)this + 1069) = 1;
  }
  return result;
}

//----- (000000000000C4F0) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::DeviceDisconnected(AppleUSBHub *this, unsigned __int16 a2, char *a3)
{
  char *v3; // r15@1
  unsigned __int16 v4; // r14@1
  AppleUSBHub *v5; // rbx@1
  __int64 v6; // rsi@1
  const OSMetaClass *v7; // rdx@1
  __int64 v8; // rax@1
  __int64 v9; // r12@1
  int v10; // er13@1
  __int64 v11; // rdi@4
  __int64 v12; // rax@5
  __int64 v13; // rax@6

  v3 = a3;
  v4 = a2;
  v5 = this;
  (*(void (__cdecl **)(AppleUSBHub *))(*(_QWORD *)this + 2128LL))(this);
  v6 = *(_QWORD *)off_1A018[0];
  v8 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)this + 17), *(const OSMetaClassBase **)off_1A018[0], v7);
  v9 = v8;
  v10 = -536870206;
  if ( v8 )
  {
    if ( AppleUSBHub::IsHubDeviceInternal(this, v8) || (v10 = 0, *((_BYTE *)this + 160)) )
    {
      v11 = *(_QWORD *)(v9 + 152);
      v10 = 0;
      if ( v11 )
      {
        LODWORD(v12) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v11 + 2608LL))(v11, v6);
        if ( v12 )
        {
          LODWORD(v13) = (*(int (__cdecl **)(_QWORD))(**(_QWORD **)(v9 + 152) + 2608LL))(*(_QWORD *)(v9 + 152));
          v10 = (*(int (__fastcall **)(__int64, signed __int64, AppleUSBHub *, char *))(*(_QWORD *)v13 + 1840LL))(
                  v13,
                  3758112795LL,
                  v5,
                  v3);
          if ( *(_BYTE *)off_1A080[0] & 2 )
          {
            if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(0x52D1090u, *((_DWORD *)v5 + 74), *(_QWORD *)(v9 + 152), v4, 0LL, 0LL);
          }
        }
      }
    }
  }
  return (unsigned int)v10;
}
// 1A018: using guessed type _QWORD off_1A018[17];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000C5EE) ----------------------------------------------------
int __fastcall AppleUSBHub::SwitchMux(AppleUSBHub *this, unsigned int a2, const OSMetaClass *a3)
{
  __int16 v3; // r15@1
  __int64 v4; // rax@1
  int result; // eax@2

  v3 = (signed __int16)a3;
  v4 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)this + 17), *(const OSMetaClassBase **)off_1A018[0], a3);
  if ( v4 )
    result = (*(int (__fastcall **)(__int64, _QWORD, AppleUSBHub *, signed __int64))(*(_QWORD *)v4 + 1840LL))(
               v4,
               a2,
               this,
               (unsigned __int16)v3 - 1LL);
  else
    result = 0;
  return result;
}
// 1A018: using guessed type _QWORD off_1A018[17];
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000C650) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::ProcessUSBNotification(AppleUSBHub *this, unsigned __int8 a2, IOUSBNotification *a3, uintptr_t a4)
{
  uintptr_t v4; // rbx@1
  uintptr_t v5; // r12@1
  AppleUSBHub *v6; // r14@1
  __int64 v7; // r13@1
  __int64 v8; // rax@5
  uintptr_t v9; // rdx@6
  signed int v10; // ecx@6
  __int64 v11; // rdi@7
  uintptr_t v12; // rbx@8
  __int64 v13; // rdi@13
  signed int v14; // er15@15
  char v15; // al@16
  int v16; // ecx@16
  __int64 v17; // rdi@23
  char v18; // al@24
  int v19; // ecx@24
  uintptr_t v20; // rsi@32
  uintptr_t v21; // rcx@32
  uintptr_t v22; // r8@32

  v4 = a4;
  v5 = (uintptr_t)a3;
  v6 = this;
  v7 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D10C1u, *((_DWORD *)this + 74), a2, (uintptr_t)a3, a4, 0LL);
  if ( v5 && (v8 = *((_QWORD *)this + 52)) != 0 )
  {
    v9 = *(_QWORD *)(v5 + 24);
    v10 = *((_BYTE *)this + 218);
    if ( !*((_BYTE *)this + 218) )
      goto LABEL_57;
    v11 = 0LL;
    do
    {
      v12 = *(_QWORD *)(v8 + 8 * v11);
      if ( *(_QWORD *)(v12 + 80) != v9 )
        v12 = 0LL;
      ++v11;
    }
    while ( (signed int)v11 < v10 && !v12 );
    if ( !v12 )
    {
LABEL_57:
      v14 = -536870206;
      if ( !(*(_BYTE *)v7 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_45;
      v20 = *((_DWORD *)v6 + 74);
      v21 = 0LL;
      v22 = 4LL;
      goto LABEL_44;
    }
    v13 = *(_QWORD *)(v12 + 88);
    if ( !v13 )
    {
      v13 = OSSet::withCapacity((OSSet *)((char *)&dword_0 + 1), 0);
      *(_QWORD *)(v12 + 88) = v13;
      if ( !v13 )
      {
        v14 = -536870211;
        if ( !(*(_BYTE *)v7 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
          goto LABEL_45;
        v20 = *((_DWORD *)v6 + 74);
        v21 = 0LL;
        v22 = 3LL;
        v9 = v12;
        goto LABEL_44;
      }
    }
    v14 = -536870206;
    if ( a2 == 2 )
    {
      v15 = (*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v13 + 480LL))(v13, v5);
      v16 = *(_DWORD *)v7 & 2;
      if ( v15 )
      {
        if ( v16 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D10C0u, *((_DWORD *)v6 + 74), v5, v12, 1uLL, 0LL);
        (*(void (__fastcall **)(_QWORD, uintptr_t))(**(_QWORD **)(v12 + 88) + 472LL))(*(_QWORD *)(v12 + 88), v5);
        v14 = 0;
        goto LABEL_45;
      }
      if ( !v16 || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_45;
      v20 = *((_DWORD *)v6 + 74);
      v22 = 2LL;
      v9 = v5;
      v21 = v12;
LABEL_44:
      kernel_debug(0x52D10C0u, v20, v9, v21, v22, 0LL);
      goto LABEL_45;
    }
    if ( a2 == 1 )
    {
      if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        kernel_debug(0x52D10C0u, *((_DWORD *)v6 + 74), v5, v12, 0LL, 0LL);
        v13 = *(_QWORD *)(v12 + 88);
      }
      (*(void (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v13 + 448LL))(v13, v5);
      v14 = 0;
    }
  }
  else
  {
    v9 = a2;
    if ( a2 != 3 )
    {
      v14 = -536870206;
      if ( !(*(_BYTE *)v7 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_45;
      v20 = *((_DWORD *)this + 74);
      v21 = 0LL;
      v22 = 7LL;
      goto LABEL_44;
    }
    v14 = 0;
    if ( !v4 )
      goto LABEL_45;
    v17 = *((_QWORD *)this + 36);
    if ( !v17 )
      goto LABEL_45;
    v18 = (*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v17 + 480LL))(v17, v4);
    v19 = *(_DWORD *)v7 & 2;
    if ( !v18 )
    {
      v14 = -536870206;
      if ( !v19 || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_45;
      v20 = *((_DWORD *)v6 + 74);
      v9 = 0LL;
      v21 = 0LL;
      v22 = 6LL;
      goto LABEL_44;
    }
    if ( v19 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D10C0u, *((_DWORD *)v6 + 74), v4, *((_QWORD *)v6 + 36), 5uLL, 0LL);
    (*(void (__fastcall **)(_QWORD, uintptr_t))(**((_QWORD **)v6 + 36) + 472LL))(*((_QWORD *)v6 + 36), v4);
    if ( !(*(int (__cdecl **)(_QWORD))(**((_QWORD **)v6 + 36) + 304LL))(*((_QWORD *)v6 + 36)) )
    {
      v14 = 0;
      (*(void (__fastcall **)(_QWORD, signed __int64, _QWORD))(**((_QWORD **)v6 + 34) + 488LL))(
        *((_QWORD *)v6 + 34),
        (char *)v6 + 288,
        0LL);
    }
  }
LABEL_45:
  if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D10C2u, *((_DWORD *)v6 + 74), v14, 0LL, 0LL, 0LL);
  return (unsigned int)v14;
}
// 0: using guessed type int;
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000000CA0A) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::SendUSBNotifications(AppleUSBHub *this, OSSet *a2, uintptr_t a3, OSSet *a4)
{
  OSSet *v4; // r15@1
  unsigned __int64 v5; // r12@1
  uintptr_t v6; // rbx@1
  __int64 v7; // r14@1
  __int64 v8; // rax@6
  __int64 v9; // r13@6
  uintptr_t v10; // rax@9
  IOUSBNotification *v11; // rbx@9

  v4 = a4;
  v5 = a3;
  v6 = (uintptr_t)a2;
  v7 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    a2 = (OSSet *)*((_DWORD *)this + 74);
    kernel_debug(0x52D10C9u, (uintptr_t)a2, v6, a3, (uintptr_t)a4, 0LL);
  }
  if ( v6 )
  {
    if ( v5 )
    {
      LODWORD(v8) = OSCollectionIterator::withCollection(v6);
      v9 = v8;
      if ( v8 )
      {
        while ( 1 )
        {
          LODWORD(v10) = (*(int (__fastcall **)(__int64, OSSet *))(*(_QWORD *)v9 + 296LL))(v9, a2);
          v11 = (IOUSBNotification *)v10;
          if ( !v10 )
            break;
          if ( (v5 & *(_QWORD *)(v10 + 40)) == v5 )
          {
            if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(0x52D10C8u, *((_DWORD *)this + 74), v10, *(_QWORD *)(v10 + 40), 0LL, 0LL);
            (*(void (__fastcall **)(OSSet *, IOUSBNotification *))(*(_QWORD *)v4 + 448LL))(v4, v11);
            a2 = (OSSet *)v5;
            IOUSBNotification::SendNotification(v11, v5, (void *)v11);
          }
        }
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v9 + 40LL))(v9);
      }
    }
  }
  if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D10CAu, *((_DWORD *)this + 74), 0LL, 0LL, 0LL, 0LL);
  return 0LL;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BFF0: using guessed type int __fastcall OSCollectionIterator::withCollection(_QWORD);

//----- (000000000000CB48) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::HubMessageToString(AppleUSBHub *this, signed int a2)
{
  __int64 result; // rax@6

  if ( a2 > -536854304 )
  {
    if ( a2 == -536854303 )
      return (__int64)"kIOUSBMessageMuxFromEHCIToXHCI";
    if ( a2 == -536854302 )
      return (__int64)"kIOUSBMessageMuxFromXHCIToEHCI";
    return (__int64)"UNKNOWN";
  }
  if ( a2 <= -536854528 )
  {
    if ( a2 > -536870065 )
    {
      if ( a2 == -536870064 )
        return (__int64)"kIOMessageDeviceSignaledWakeup";
    }
    else if ( a2 > -536870881 )
    {
      if ( a2 > -536870865 )
      {
        if ( a2 > -536870657 )
        {
          if ( a2 == -536870656 )
            return (__int64)"kIOMessageServiceIsRequestingClose";
          if ( a2 == -536870655 )
            return (__int64)"kIOMessageServiceIsAttemptingOpen";
          if ( a2 == -536870640 )
            return (__int64)"kIOMessageServiceWasClosed";
        }
        else if ( a2 == -536870864 )
        {
          return (__int64)"kIOMessageServiceIsResumed";
        }
      }
      else if ( a2 == -536870880 )
      {
        return (__int64)"kIOMessageServiceIsSuspended";
      }
    }
    else if ( a2 == -536870896 )
    {
      return (__int64)"kIOMessageServiceIsTerminated";
    }
    return (__int64)"UNKNOWN";
  }
  result = (__int64)"kIOUSBMessageHubResetPort";
  switch ( a2 + 536854527 )
  {
    case 1:
      result = (__int64)"kIOUSBMessageHubSuspendPort";
      break;
    case 2:
      result = (__int64)"kIOUSBMessageHubResumePort";
      break;
    case 3:
      result = (__int64)"kIOUSBMessageHubIsDeviceConnected";
      break;
    case 4:
      result = (__int64)"kIOUSBMessageHubIsPortEnabled";
      break;
    case 5:
      result = (__int64)"kIOUSBMessageHubReEnumeratePort";
      break;
    case 9:
      result = (__int64)"kIOUSBMessagePortHasBeenReset";
      break;
    case 10:
      result = (__int64)"kIOUSBMessagePortHasBeenResumed";
      break;
    case 11:
      result = (__int64)"kIOUSBMessageHubPortClearTT";
      break;
    case 12:
      result = (__int64)"kIOUSBMessagePortHasBeenSuspended";
      break;
    case 13:
      result = (__int64)"kIOUSBMessageFromThirdParty";
      break;
    case 14:
      result = (__int64)"kIOUSBMessagePortWasNotSuspended";
      break;
    case 15:
      result = (__int64)"kIOUSBMessageExpressCardCantWake";
      break;
    case 16:
      result = (__int64)"kIOUSBMessageCompositeDriverReconfigured";
      break;
    case 17:
      result = (__int64)"kIOUSBMessageHubSetPortRecoveryTime";
      break;
    case 18:
      result = (__int64)"kIOUSBMessageOvercurrentCondition";
      break;
    case 19:
      result = (__int64)"kIOUSBMessageNotEnoughPower";
      break;
    case 20:
      result = (__int64)"kIOUSBMessageController";
      break;
    case 21:
      result = (__int64)"kIOUSBMessageRootHubWakeEvent";
      break;
    case 22:
      result = (__int64)"kIOUSBMessageReleaseExtraCurrent";
      break;
    case 23:
      result = (__int64)"kIOUSBMessageReallocateExtraCurrent";
      break;
    case 26:
      result = (__int64)"kIOUSBMessageHubPortDeviceDisconnected";
      break;
    default:
      return (__int64)"UNKNOWN";
    case 0:
      return result;
  }
  return result;
}

//----- (000000000000CDC4) ----------------------------------------------------
char *__fastcall AppleUSBHub::FeatureName(AppleUSBHub *this, unsigned int a2)
{
  char *result; // rax@2

  if ( a2 > 0x1E )
    result = "Unknown Feature";
  else
    result = off_1AB10[a2];
  return result;
}
// 1AB10: using guessed type char *off_1AB10[31];

//----- (000000000000CDE6) ----------------------------------------------------
char *__fastcall AppleUSBHub::LinkStateName(AppleUSBHub *this, unsigned int a2)
{
  char *result; // rax@2

  if ( a2 > 0xF )
    result = "Unknown State";
  else
    result = off_1AC10[a2];
  return result;
}
// 1AC10: using guessed type char *off_1AC10[18];

//----- (000000000000CE08) ----------------------------------------------------
__int64 __fastcall AppleUSBHub::MetaClass::~MetaClass(AppleUSBHub::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (000000000000CE20) ----------------------------------------------------
__int64 `global constructor keyed to'_a()
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(&AppleUSBHub::gMetaClass, "AppleUSBHub", off_1A028[0], 1088LL);
  result = (__int64)off_1AA30;
  AppleUSBHub::gMetaClass = off_1AA30;
  return result;
}
// 1A028: using guessed type _QWORD off_1A028[15];
// 1AA30: using guessed type __int64 (__fastcall *off_1AA30[2])(AppleUSBHub::MetaClass *__hidden this);
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;
// 2BB40: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (000000000000CE60) ----------------------------------------------------
__int64 `global destructor keyed to'_a()
{
  return OSMetaClass::~OSMetaClass((OSMetaClass *)&AppleUSBHub::gMetaClass);
}
// 1BC60: using guessed type _QWORD AppleUSBHub::gMetaClass;

//----- (000000000000CE80) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::MetaClass::MetaClass(AppleUSBHubPort::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBHubPort", off_1A038[0], 432LL);
  result = (__int64)off_1AE10;
  *(_QWORD *)this = off_1AE10;
  return result;
}
// 1A038: using guessed type _QWORD off_1A038[13];
// 1AE10: using guessed type __int64 (__fastcall *off_1AE10[2])(AppleUSBHubPort::MetaClass *__hidden this);
// 2BB40: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (000000000000CEB2) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::MetaClass::~MetaClass(AppleUSBHubPort::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (000000000000CEBC) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::AppleUSBHubPort(__int64 a1)
{
  __int64 result; // rax@1

  OSObject::OSObject(a1);
  result = (__int64)off_1ACB0;
  *(_QWORD *)a1 = off_1ACB0;
  return result;
}
// 1ACB0: using guessed type __int64 (__fastcall *off_1ACB0[2])(AppleUSBHubPort *__hidden this);
// 2C0B0: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (000000000000CEDC) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::AppleUSBHubPort(__int64 a1)
{
  __int64 result; // rax@1

  OSObject::OSObject(a1);
  result = (__int64)off_1ACB0;
  *(_QWORD *)a1 = off_1ACB0;
  return result;
}
// 1ACB0: using guessed type __int64 (__fastcall *off_1ACB0[2])(AppleUSBHubPort *__hidden this);
// 2C0B0: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (000000000000CEFC) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::~AppleUSBHubPort(AppleUSBHubPort *this)
{
  return OSObject::~OSObject(this);
}

//----- (000000000000CF06) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::~AppleUSBHubPort(AppleUSBHubPort *this)
{
  return OSObject::~OSObject(this);
}

//----- (000000000000CF10) ----------------------------------------------------
void __fastcall AppleUSBHubPort::~AppleUSBHubPort(AppleUSBHubPort *this)
{
  OSObject::~OSObject(this);
  OSObject::operator delete((void *)this);
}

//----- (000000000000CF32) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::getMetaClass(AppleUSBHubPort *this)
{
  return (__int64)&AppleUSBHubPort::gMetaClass;
}
// 1BC88: using guessed type _QWORD AppleUSBHubPort::gMetaClass;

//----- (000000000000CF40) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::MetaClass::MetaClass(AppleUSBHubPort::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBHubPort", off_1A038[0], 432LL);
  result = (__int64)off_1AE10;
  *(_QWORD *)this = off_1AE10;
  return result;
}
// 1A038: using guessed type _QWORD off_1A038[13];
// 1AE10: using guessed type __int64 (__fastcall *off_1AE10[2])(AppleUSBHubPort::MetaClass *__hidden this);
// 2BB40: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (000000000000CF72) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::MetaClass::alloc(AppleUSBHubPort::MetaClass *this, unsigned __int64 a2)
{
  __int64 v2; // rbx@1

  v2 = OSObject::operator new((OSObject *)stru_1A0.segname, a2);
  OSObject::OSObject(v2);
  *(_QWORD *)v2 = off_1ACB0;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBHubPort::gMetaClass);
  return v2;
}
// 1A0: using guessed type section_64;
// 1ACB0: using guessed type __int64 (__fastcall *off_1ACB0[2])(AppleUSBHubPort *__hidden this);
// 1BC88: using guessed type _QWORD AppleUSBHubPort::gMetaClass;
// 2C0B0: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (000000000000CFB2) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::AppleUSBHubPort(__int64 a1)
{
  OSObject::OSObject(a1);
  *(_QWORD *)a1 = off_1ACB0;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBHubPort::gMetaClass);
}
// 1ACB0: using guessed type __int64 (__fastcall *off_1ACB0[2])(AppleUSBHubPort *__hidden this);
// 1BC88: using guessed type _QWORD AppleUSBHubPort::gMetaClass;
// 2C0B0: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (000000000000CFE2) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::AppleUSBHubPort(__int64 a1)
{
  OSObject::OSObject(a1);
  *(_QWORD *)a1 = off_1ACB0;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBHubPort::gMetaClass);
}
// 1ACB0: using guessed type __int64 (__fastcall *off_1ACB0[2])(AppleUSBHubPort *__hidden this);
// 1BC88: using guessed type _QWORD AppleUSBHubPort::gMetaClass;
// 2C0B0: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (000000000000D012) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::init(AppleUSBHubPort *this, AppleUSBHub *a2, unsigned __int64 a3, char *a4, unsigned __int8 a5, unsigned __int8 a6, bool a7, char *a8)
{
  unsigned __int8 v8; // r13@1
  int v9; // er14@1
  AppleUSBHub *v10; // r15@1
  uintptr_t v11; // rbx@1
  char *v12; // rsi@1
  bool v13; // cl@1
  int v14; // eax@1
  unsigned __int64 v15; // r8@4
  uintptr_t v16; // rcx@4
  unsigned __int8 v17; // ST00_1@8
  char *v18; // rdi@11
  __int64 v19; // rax@11
  __int64 v20; // r14@11
  __int64 v21; // rax@16
  __int64 v22; // rax@17
  __int64 v23; // rax@18
  __int64 v24; // rax@19
  __int64 v25; // rax@20
  __int64 v26; // rax@21
  __int64 v27; // rax@22
  int (__cdecl *v28)(OSObject *, void *, void *, void *, void *); // rdx@22
  __int64 v29; // rax@23
  __int64 v30; // rcx@23
  __int64 v31; // r8@23
  __int64 v32; // rax@24
  __int64 v33; // rcx@24
  __int64 v34; // r8@24
  __int64 v35; // rcx@25
  __int64 v36; // r8@25
  signed __int64 v37; // rsi@26
  __int64 v38; // rdi@29
  __int64 v39; // rdi@31
  signed int v40; // er15@33
  uintptr_t v41; // rcx@36
  unsigned __int64 v42; // rdx@36
  uintptr_t v43; // r8@36
  __int64 v44; // rdi@44
  __int64 v45; // rdi@55
  signed __int64 v47; // rsi@74
  __int64 v48; // rdi@77
  signed int v49; // [sp+4h] [bp-2Ch]@1

  v8 = a5;
  v9 = (signed int)a4;
  v49 = a3;
  v10 = a2;
  v11 = (uintptr_t)this;
  v12 = a8;
  v13 = a7;
  v14 = *(_DWORD *)off_1A080[0] & 2;
  if ( v10 )
  {
    if ( v14 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v15 = a7 | ((unsigned __int64)a6 << 8) | ((unsigned __int64)a5 << 16);
      v16 = (unsigned int)v9;
      a3 = (signed int)a3 | ((unsigned __int64)*((_DWORD *)v10 + 74) << 32);
LABEL_8:
      v17 = a6;
      kernel_debug(0x52D1465u, (uintptr_t)this, a3, v16, v15, 0LL);
      a6 = v17;
      v13 = a7;
      v12 = a8;
      goto LABEL_9;
    }
  }
  else if ( v14 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v15 = a7 | ((unsigned __int64)a6 << 8) | ((unsigned __int64)a5 << 16);
    v16 = (unsigned int)v9;
    a3 = (signed int)a3;
    goto LABEL_8;
  }
LABEL_9:
  *((_QWORD *)this + 6) = v10;
  *((_QWORD *)this + 5) = *((_QWORD *)v10 + 17);
  *((_QWORD *)this + 9) = (char *)v10 + 216;
  *((_DWORD *)this + 9) = v49;
  *((_QWORD *)this + 10) = 0LL;
  *((_DWORD *)this + 8) = v9;
  *((_BYTE *)this + 101) = v8;
  *((_BYTE *)this + 102) = a6;
  *((_DWORD *)this + 91) = 0;
  *((_BYTE *)this + 103) = 0;
  *((_BYTE *)this + 104) = 0;
  *((_BYTE *)this + 107) = 0;
  *((_BYTE *)this + 110) = 0;
  *((_BYTE *)this + 111) = 0;
  *((_BYTE *)this + 108) = 0;
  *((_DWORD *)this + 28) = 0;
  *((_BYTE *)this + 117) = 0;
  *((_DWORD *)this + 99) = 0;
  *((_BYTE *)this + 116) = 0;
  *((_BYTE *)this + 118) = 0;
  *((_DWORD *)this + 24) = 0;
  *((_BYTE *)this + 401) = 0;
  *((_DWORD *)this + 32) = 10;
  *((_BYTE *)this + 109) = 0;
  *((_BYTE *)this + 420) = v13;
  if ( v13 )
    strlcpy((char *)this + 421, v12, 5uLL);
  *((_DWORD *)this + 107) = 0xFFFF;
  v18 = (char *)this + 120;
  clock_get_uptime(v11 + 120);
  v19 = *(_QWORD *)(v11 + 48);
  v20 = off_1A080[0];
  if ( !v19 || !*(_QWORD *)(v11 + 40) || !*(_QWORD *)(v11 + 72) || v49 <= 0 || v49 >= 65 )
  {
    v40 = -536870206;
    if ( !(*(_BYTE *)off_1A080[0] & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      goto LABEL_67;
    v41 = *(_QWORD *)(v11 + 72);
    v42 = v49 | ((unsigned __int64)*(_DWORD *)(v19 + 296) << 32);
    v43 = 0LL;
LABEL_37:
    kernel_debug(0x52D1464u, v11, v42, v41, v43, 0LL);
    goto LABEL_67;
  }
  LODWORD(v21) = IOLockAlloc(v18, v12);
  *(_QWORD *)(v11 + 368) = v21;
  if ( !v21 )
  {
    v40 = -536870211;
    if ( !(*(_BYTE *)v20 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      goto LABEL_67;
    v42 = v49 | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v11 + 48) + 296LL) << 32);
    v41 = 0LL;
    v43 = 1LL;
    goto LABEL_37;
  }
  LODWORD(v22) = IOLockAlloc(v18, v12);
  *(_QWORD *)(v11 + 376) = v22;
  if ( !v22 )
  {
    if ( *(_BYTE *)v20 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1464u,
        v11,
        v49 | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v11 + 48) + 296LL) << 32),
        0LL,
        2uLL,
        0LL);
    v44 = *(_QWORD *)(v11 + 368);
    goto LABEL_66;
  }
  LODWORD(v23) = IOLockAlloc(v18, v12);
  *(_QWORD *)(v11 + 384) = v23;
  if ( !v23 )
  {
    if ( *(_BYTE *)v20 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1464u,
        v11,
        v49 | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v11 + 48) + 296LL) << 32),
        0LL,
        3uLL,
        0LL);
    IOLockFree(*(_QWORD *)(v11 + 368));
    v44 = *(_QWORD *)(v11 + 376);
    goto LABEL_66;
  }
  LODWORD(v24) = thread_call_allocate(AppleUSBHubPort::PortInitEntry, v11);
  *(_QWORD *)(v11 + 328) = v24;
  if ( !v24 )
  {
    if ( *(_BYTE *)v20 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1464u,
        v11,
        v49 | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v11 + 48) + 296LL) << 32),
        0LL,
        4uLL,
        0LL);
    goto LABEL_65;
  }
  LODWORD(v25) = thread_call_allocate(AppleUSBHubPort::PortStatusChangedHandlerEntry, v11);
  *(_QWORD *)(v11 + 336) = v25;
  if ( !v25 )
  {
    if ( *(_BYTE *)v20 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1464u,
        v11,
        v49 | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v11 + 48) + 296LL) << 32),
        0LL,
        5uLL,
        0LL);
    v45 = *(_QWORD *)(v11 + 328);
    goto LABEL_64;
  }
  LODWORD(v26) = thread_call_allocate(AppleUSBHubPort::AddDeviceEntry, v11);
  *(_QWORD *)(v11 + 344) = v26;
  if ( !v26 )
  {
    if ( *(_BYTE *)v20 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1464u,
        v11,
        v49 | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v11 + 48) + 296LL) << 32),
        0LL,
        6uLL,
        0LL);
    thread_call_free(*(_QWORD *)(v11 + 328));
    v45 = *(_QWORD *)(v11 + 336);
    goto LABEL_64;
  }
  LODWORD(v27) = thread_call_allocate(AppleUSBHubPort::EnablePowerAfterOvercurrentEntry, v11);
  *(_QWORD *)(v11 + 352) = v27;
  if ( !v27 )
  {
    if ( *(_BYTE *)v20 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1464u,
        v11,
        v49 | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v11 + 48) + 296LL) << 32),
        0LL,
        7uLL,
        0LL);
    thread_call_free(*(_QWORD *)(v11 + 328));
    thread_call_free(*(_QWORD *)(v11 + 336));
    v45 = *(_QWORD *)(v11 + 344);
LABEL_64:
    thread_call_free(v45);
LABEL_65:
    IOLockFree(*(_QWORD *)(v11 + 368));
    IOLockFree(*(_QWORD *)(v11 + 376));
    v44 = *(_QWORD *)(v11 + 384);
LABEL_66:
    IOLockFree(v44);
    v40 = -536870211;
    goto LABEL_67;
  }
  v29 = IOCommandGate::commandGate((IOCommandGate *)v11, 0LL, v28);
  *(_QWORD *)(v11 + 56) = v29;
  if ( !v29 )
  {
    KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBHubPort::init - unable to create command gate", v30, v31);
    v40 = -536870211;
    if ( !(*(_BYTE *)v20 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      goto LABEL_67;
    v42 = v49 | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v11 + 48) + 296LL) << 32);
    v41 = 0LL;
    v43 = 8LL;
    goto LABEL_37;
  }
  LODWORD(v32) = (*(int (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v11 + 48) + 1672LL))(*(_QWORD *)(v11 + 48), 0LL);
  *(_QWORD *)(v11 + 64) = v32;
  if ( v32 )
  {
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v32 + 32LL))(v32);
    if ( (*(int (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v11 + 64) + 320LL))(
           *(_QWORD *)(v11 + 64),
           *(_QWORD *)(v11 + 56)) )
    {
      v37 = 1431519814LL;
      KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBHubPort::init Couldn't add gate event source", v35, v36);
      if ( *(_BYTE *)v20 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v37 = v11;
        kernel_debug(
          0x52D1464u,
          v11,
          v49 | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v11 + 48) + 296LL) << 32),
          0LL,
          0xAuLL,
          0LL);
      }
      v38 = *(_QWORD *)(v11 + 56);
      if ( v38 )
        (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v38 + 40LL))(v38, v37);
      *(_QWORD *)(v11 + 56) = 0LL;
      v39 = *(_QWORD *)(v11 + 64);
      if ( v39 )
        (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v39 + 40LL))(v39, v37);
      *(_QWORD *)(v11 + 64) = 0LL;
      v40 = -536870211;
    }
    else
    {
      AppleUSBHubPort::InitPortVectors((AppleUSBHubPort *)v11);
      v40 = 0;
    }
  }
  else
  {
    v47 = 1431519814LL;
    KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBHubPort::init Couldn't get provider's workloop", v33, v34);
    if ( *(_BYTE *)v20 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v47 = v11;
      kernel_debug(
        0x52D1464u,
        v11,
        v49 | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v11 + 48) + 296LL) << 32),
        0LL,
        9uLL,
        0LL);
    }
    v48 = *(_QWORD *)(v11 + 56);
    if ( v48 )
      (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v48 + 40LL))(v48, v47);
    *(_QWORD *)(v11 + 56) = 0LL;
    v40 = -536870211;
  }
LABEL_67:
  if ( *(_BYTE *)v20 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1466u,
      v11,
      v49 | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v11 + 48) + 296LL) << 32),
      v40,
      0LL,
      0LL);
  return (unsigned int)v40;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BA88: using guessed type int __fastcall IOLockAlloc(_QWORD, _QWORD);
// 2BA90: using guessed type int __cdecl IOLockFree(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2C760: using guessed type int __fastcall clock_get_uptime(_QWORD);
// 2C7C0: using guessed type int __fastcall thread_call_allocate(_QWORD, _QWORD);
// 2C7E0: using guessed type int __fastcall thread_call_free(_QWORD);

//----- (000000000000D784) ----------------------------------------------------
int __fastcall AppleUSBHubPort::PortInitEntry(AppleUSBHubPort *this, OSObject *a2, const OSMetaClass *a3)
{
  __int64 v3; // rax@1
  __int64 v4; // rbx@1

  v3 = OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHubPort::gMetaClass, a3);
  v4 = v3;
  if ( v3 )
  {
    (*(void (__fastcall **)(__int64, _QWORD *))(*(_QWORD *)v3 + 288LL))(v3, &AppleUSBHubPort::gMetaClass);
    (*(void (__cdecl **)(_QWORD))(**(_QWORD **)(v4 + 48) + 40LL))(*(_QWORD *)(v4 + 48));
    LODWORD(v3) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v4 + 40LL))(v4);
  }
  return v3;
}
// 1BC88: using guessed type _QWORD AppleUSBHubPort::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000D7CA) ----------------------------------------------------
int __usercall AppleUSBHubPort::PortStatusChangedHandlerEntry@<eax>(AppleUSBHubPort *this@<rdi>, OSObject *a2@<rsi>, __int64 a3@<rax>, const OSMetaClass *a4@<rdx>)
{
  _QWORD *v4; // rsi@2
  __int64 v5; // rbx@2
  __int64 v6; // rax@3
  AppleUSBHub *v7; // rdi@3
  __int64 v8; // rax@4

  if ( this )
  {
    v4 = &AppleUSBHubPort::gMetaClass;
    a3 = OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHubPort::gMetaClass, a4);
    v5 = a3;
    if ( a3 )
    {
      LODWORD(v6) = (*(int (__fastcall **)(__int64, _QWORD *))(*(_QWORD *)a3 + 296LL))(a3, &AppleUSBHubPort::gMetaClass);
      v7 = *(AppleUSBHub **)(v5 + 48);
      if ( v7 )
      {
        v8 = AppleUSBHub::LowerPowerState(v7, v6);
        v4 = 0LL;
        AppleUSBHub::DecrementOutstandingIO(*(AppleUSBHub **)(v5 + 48), v8, 0);
      }
      LODWORD(a3) = (*(int (__fastcall **)(__int64, _QWORD *))(*(_QWORD *)v5 + 40LL))(v5, v4);
    }
  }
  return a3;
}
// 1BC88: using guessed type _QWORD AppleUSBHubPort::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000D824) ----------------------------------------------------
int __usercall AppleUSBHubPort::AddDeviceEntry@<eax>(AppleUSBHubPort *this@<rdi>, OSObject *a2@<rsi>, void *a3@<rdx>, uintptr_t a4@<rax>)
{
  int v4; // er14@1
  const OSMetaClass *v5; // rdx@2
  uintptr_t v6; // r15@2
  uintptr_t v7; // rbx@3
  __int64 v8; // r13@3
  uintptr_t v9; // rsi@4
  __int64 v10; // rax@4
  int v11; // er12@4
  IOUSBController *v12; // rdi@10
  __int64 v13; // rax@11

  v4 = (signed int)a2;
  if ( this )
  {
    a4 = OSMetaClassBase::safeMetaCast(
           this,
           (const OSMetaClassBase *)&AppleUSBHubPort::gMetaClass,
           (const OSMetaClass *)a3);
    v6 = a4;
    if ( a4 )
    {
      v7 = 2LL;
      v8 = off_1A080[0];
      do
      {
        v9 = (unsigned int)v4;
        v10 = AppleUSBHubPort::AddDevice(v6, (unsigned int)v4, v5);
        v11 = v10;
        if ( *(_BYTE *)v8 & 2 )
        {
          v10 = off_1A098;
          if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v9 = v6;
            kernel_debug(0x52D1408u, v6, v11, v7, 0x64uLL, 0LL);
          }
        }
        if ( v11 != -536870184 )
          break;
        --v7;
        v10 = (unsigned int)(v7 + 1);
      }
      while ( (signed int)v10 > 0 );
      AppleUSBHub::LowerPowerState(*(AppleUSBHub **)(v6 + 48), v10);
      (*(void (__fastcall **)(_QWORD, uintptr_t))(**(_QWORD **)(v6 + 48) + 40LL))(*(_QWORD *)(v6 + 48), v9);
      *(_BYTE *)(v6 + 110) = 0;
      if ( *(_BYTE *)(v6 + 108) )
      {
        v12 = *(IOUSBController **)(v6 + 40);
        if ( v12 )
        {
          v13 = IOUSBController::GetCommandGate(v12);
          if ( v13 )
            (*(void (__fastcall **)(__int64, signed __int64, signed __int64))(*(_QWORD *)v13 + 488LL))(
              v13,
              v6 + 110,
              1LL);
        }
      }
      LODWORD(a4) = (*(int (__fastcall **)(uintptr_t))(*(_QWORD *)v6 + 40LL))(v6);
    }
  }
  return a4;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 1BC88: using guessed type _QWORD AppleUSBHubPort::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000D922) ----------------------------------------------------
int __usercall AppleUSBHubPort::EnablePowerAfterOvercurrentEntry@<eax>(AppleUSBHubPort *this@<rdi>, OSObject *a2@<rsi>, uintptr_t a3@<rax>, const OSMetaClass *a4@<rdx>)
{
  uintptr_t v4; // rsi@2
  uintptr_t v5; // rbx@2
  __int64 v6; // r15@5
  __int64 v7; // rax@8
  IOUSBController *v8; // rdi@9
  __int64 v9; // r14@10

  if ( this )
  {
    v4 = (uintptr_t)&AppleUSBHubPort::gMetaClass;
    a3 = OSMetaClassBase::safeMetaCast(this, (const OSMetaClassBase *)&AppleUSBHubPort::gMetaClass, a4);
    v5 = a3;
    if ( a3 )
    {
      if ( !*(_BYTE *)(a3 + 418) )
      {
        v6 = off_1A080[0];
        if ( *(_BYTE *)off_1A080[0] & 2 )
        {
          a3 = off_1A098;
          if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v4 = v5;
            kernel_debug(0x52D143Cu, v5, *(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL), *(_DWORD *)(v5 + 36), 3uLL, 0LL);
          }
        }
        AppleUSBHubPort::EnablePowerAfterOvercurrent((AppleUSBHubPort *)v5, a3);
        AppleUSBHub::LowerPowerState(*(AppleUSBHub **)(v5 + 48), v7);
        (*(void (__fastcall **)(_QWORD, uintptr_t))(**(_QWORD **)(v5 + 48) + 40LL))(*(_QWORD *)(v5 + 48), v4);
        *(_BYTE *)(v5 + 111) = 0;
        if ( *(_BYTE *)(v5 + 108) )
        {
          v8 = *(IOUSBController **)(v5 + 40);
          if ( v8 )
          {
            v9 = IOUSBController::GetCommandGate(v8);
            if ( v9 )
            {
              if ( *(_BYTE *)v6 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                kernel_debug(0x52D143Cu, v5, *(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL), *(_DWORD *)(v5 + 36), 4uLL, 0LL);
              (*(void (__fastcall **)(__int64, signed __int64, signed __int64))(*(_QWORD *)v9 + 488LL))(
                v9,
                v5 + 111,
                1LL);
            }
          }
        }
        LODWORD(a3) = (*(int (__fastcall **)(uintptr_t))(*(_QWORD *)v5 + 40LL))(v5);
      }
    }
  }
  return a3;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 1BC88: using guessed type _QWORD AppleUSBHubPort::gMetaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000DA36) ----------------------------------------------------
unsigned __int64 __fastcall AppleUSBHubPort::InitPortVectors(AppleUSBHubPort *this)
{
  char *v1; // rdi@1
  unsigned __int64 result; // rax@1
  __int64 v3; // rbx@2
  signed int v4; // ebx@2

  v1 = (char *)this + 136;
  result = 0LL;
  do
  {
    *(_QWORD *)&v1[result + 16] = defaultPortVectors[result / 8 + 2];
    v3 = defaultPortVectors[result / 8];
    *(_QWORD *)&v1[result + 8] = defaultPortVectors[result / 8 + 1];
    *(_QWORD *)&v1[result] = v3;
    v4 = LODWORD(defaultPortVectors[result / 8 + 2]);
    if ( v4 > 127 )
    {
      if ( v4 != 128 )
        goto LABEL_20;
      *(_QWORD *)&v1[result] = AppleUSBHubPort::DefaultPortConfigErrChangeHandler;
LABEL_19:
      *(_QWORD *)&v1[result + 8] = 0LL;
      goto LABEL_20;
    }
    if ( v4 > 63 )
    {
      if ( v4 != 64 )
        goto LABEL_20;
      *(_QWORD *)&v1[result] = AppleUSBHubPort::DefaultPortLinkStateChangeHandler;
      goto LABEL_19;
    }
    if ( v4 > 31 )
    {
      if ( v4 != 32 )
        goto LABEL_20;
      *(_QWORD *)&v1[result] = AppleUSBHubPort::DefaultBHResetChangeHandler;
      goto LABEL_19;
    }
    if ( v4 > 15 )
    {
      if ( v4 != 16 )
        goto LABEL_20;
      *(_QWORD *)&v1[result] = AppleUSBHubPort::DefaultResetChangeHandler;
      goto LABEL_19;
    }
    switch ( v4 )
    {
      case 1:
        *(_QWORD *)&v1[result] = AppleUSBHubPort::DefaultConnectionChangeHandler;
        goto LABEL_19;
      case 2:
        *(_QWORD *)&v1[result] = AppleUSBHubPort::DefaultEnableChangeHandler;
        goto LABEL_19;
      case 4:
        *(_QWORD *)&v1[result] = AppleUSBHubPort::DefaultSuspendChangeHandler;
        goto LABEL_19;
      case 8:
        *(_QWORD *)&v1[result] = AppleUSBHubPort::DefaultOverCrntChangeHandler;
        goto LABEL_19;
      default:
        break;
    }
LABEL_20:
    result += 24LL;
  }
  while ( result != 192 );
  return result;
}
// 19EE0: using guessed type _QWORD defaultPortVectors[];

//----- (000000000000DB60) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::start(AppleUSBHubPort *this)
{
  __int64 v1; // rax@3
  __int64 v2; // rax@3
  __int64 v3; // rax@4

  if ( *((_QWORD *)this + 6) )
  {
    if ( *((_QWORD *)this + 41) )
    {
      (*(void (__cdecl **)(AppleUSBHubPort *))(*(_QWORD *)this + 32LL))(this);
      LODWORD(v1) = (*(int (__cdecl **)(_QWORD))(**((_QWORD **)this + 6) + 32LL))(*((_QWORD *)this + 6));
      AppleUSBHub::RaisePowerState(*((AppleUSBHub **)this + 6), v1);
      AppleUSBHub::IncrementOutstandingIO(*((AppleUSBHub **)this + 6), 0);
      LODWORD(v2) = thread_call_enter(*((_QWORD *)this + 41));
      if ( (_DWORD)v2 == 1 )
      {
        AppleUSBHub::DecrementOutstandingIO(*((AppleUSBHub **)this + 6), v2, 0);
        LODWORD(v3) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 6) + 40LL))(
                        *((_QWORD *)this + 6),
                        0LL);
        AppleUSBHub::LowerPowerState(*((AppleUSBHub **)this + 6), v3);
        (*(void (__fastcall **)(AppleUSBHubPort *))(*(_QWORD *)this + 40LL))(this);
      }
    }
  }
  return 0LL;
}
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (000000000000DBE2) ----------------------------------------------------
int __fastcall AppleUSBHubPort::free(AppleUSBHubPort *this)
{
  AppleUSBHubPort *v1; // rbx@1
  __int64 v2; // rdi@1
  __int64 v3; // rdi@3
  __int64 v4; // rdi@5

  v1 = this;
  v2 = *((_QWORD *)this + 46);
  if ( v2 )
  {
    IOLockFree(v2);
    *((_QWORD *)v1 + 46) = 0LL;
  }
  v3 = *((_QWORD *)v1 + 47);
  if ( v3 )
  {
    IOLockFree(v3);
    *((_QWORD *)v1 + 47) = 0LL;
  }
  v4 = *((_QWORD *)v1 + 48);
  if ( v4 )
  {
    IOLockFree(v4);
    *((_QWORD *)v1 + 48) = 0LL;
  }
  return (*(int (__fastcall **)(AppleUSBHubPort *))(off_1A068[0] + 160))(v1);
}
// 1A068: using guessed type __int64 off_1A068[7];
// 2BA90: using guessed type int __cdecl IOLockFree(_QWORD);

//----- (000000000000DC56) ----------------------------------------------------
int __fastcall AppleUSBHubPort::stop(AppleUSBHubPort *this, __int64 a2, const OSMetaClass *a3)
{
  uintptr_t v3; // r15@1
  signed __int64 v4; // rsi@1
  uintptr_t v5; // rdx@1
  __int64 v6; // rdi@8
  __int64 v7; // rax@9
  __int64 v8; // rbx@9
  __int64 v9; // r14@10
  char v10; // r12@14
  signed __int64 v11; // r13@22
  char v12; // r14@22
  uintptr_t v13; // r12@22
  int v14; // eax@24
  uintptr_t v15; // rcx@27
  uintptr_t v16; // rdx@27
  uintptr_t v17; // r8@27
  int v18; // eax@29
  int v19; // eax@34
  bool v20; // al@40
  bool v21; // al@54
  int v22; // eax@61
  __int64 v24; // rdi@86
  int v25; // eax@90
  __int64 v26; // rdi@94
  __int64 v27; // rdi@96
  __int64 v28; // rdi@98
  __int64 v29; // rdi@100
  __int64 v30; // rax@102
  __int64 v31; // rdi@103
  __int64 v32; // rdi@107
  __int64 v33; // [sp+0h] [bp-50h]@1
  signed __int64 v34; // [sp+8h] [bp-48h]@22
  __int64 v35; // [sp+10h] [bp-40h]@22
  signed __int64 v36; // [sp+18h] [bp-38h]@22
  char *v37; // [sp+20h] [bp-30h]@8

  v3 = (uintptr_t)this;
  v4 = *(_QWORD *)off_1A020[0];
  v33 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)this + 5), *(const OSMetaClassBase **)off_1A020[0], a3);
  (*(void (__fastcall **)(uintptr_t, signed __int64))(*(_QWORD *)v3 + 32LL))(v3, v4);
  if ( *((_BYTE *)this + 104) || *((_BYTE *)this + 107) || *((_BYTE *)this + 110) || *((_QWORD *)this + 44) )
  {
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v4 = (signed __int64)this;
      kernel_debug(
        0x52D1404u,
        (uintptr_t)this,
        *((_DWORD *)this + 9),
        *(_DWORD *)(*((_QWORD *)this + 6) + 296LL),
        1uLL,
        0LL);
    }
    v37 = (char *)this + 104;
    v6 = *((_QWORD *)this + 5);
    if ( v6
      && (LODWORD(v7) = (*(int (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v6 + 1672LL))(v6, v4), (v8 = v7) != 0) )
    {
      v9 = IOUSBController::GetCommandGate(*(IOUSBController **)(v3 + 40));
      if ( !v9 && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v4 = v3;
        kernel_debug(0x52D1404u, v3, *(_DWORD *)(v3 + 36), *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL), 3uLL, 0LL);
      }
      v10 = 1;
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v8 + 304LL))(v8, v4)
        && *(_BYTE *)off_1A080[0] & 2
        && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v4 = v3;
        kernel_debug(0x52D1404u, v3, *(_DWORD *)(v3 + 36), *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL), 4uLL, 0LL);
      }
    }
    else
    {
      v9 = 0LL;
      if ( *(_BYTE *)off_1A080[0] & 2 && (v9 = 0LL, *(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      {
        v10 = 0;
        v4 = v3;
        kernel_debug(0x52D1404u, v3, *(_DWORD *)(v3 + 36), *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL), 2uLL, 0LL);
        v8 = 0LL;
        v9 = 0LL;
      }
      else
      {
        v10 = 0;
        v8 = 0LL;
      }
    }
    v35 = v9;
    v34 = v3 + 111;
    v36 = v3 + 107;
    v11 = v3 + 110;
    v12 = v10 & (v9 != 0);
    v13 = 0LL;
    while ( 1 )
    {
      if ( !*v37 && !*(_BYTE *)v36 && !*(_BYTE *)v11 && !*(_BYTE *)v34 )
        break;
      if ( !v12
        || (unsigned __int8)(*(int (__fastcall **)(__int64))(*(_QWORD *)v8 + 304LL))(v8)
        || !(unsigned __int8)(*(int (__fastcall **)(__int64))(*(_QWORD *)v8 + 312LL))(v8) )
      {
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v4 = *(_DWORD *)(v3 + 36);
          kernel_debug(0x52D1404u, v4, *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL), v13, 5uLL, 0LL);
        }
        IOSleep(100LL);
        goto LABEL_69;
      }
      if ( *(_BYTE *)off_1A080[0] & 2 )
      {
        v4 = *(_DWORD *)(v3 + 36);
        v5 = *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL);
        v21 = 1;
        if ( !*(_BYTE *)(v3 + 104) && !*(_BYTE *)v36 && !*(_BYTE *)v11 )
          v21 = *(_BYTE *)v34 != 0;
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D1404u, v4, v5, v21, 0xDuLL, 0LL);
      }
      *(_BYTE *)(v3 + 108) = 1;
      if ( *(_BYTE *)(v3 + 104) )
      {
        v4 = (signed __int64)v37;
        v22 = (*(int (__fastcall **)(__int64, char *, signed __int64))(*(_QWORD *)v35 + 480LL))(v35, v37, 2LL);
        if ( v22 && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v15 = *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL);
          v16 = *(_DWORD *)(v3 + 36);
          v4 = v22;
          v17 = 6LL;
          goto LABEL_38;
        }
      }
      else if ( *(_BYTE *)v36 )
      {
        v4 = v3 + 107;
        v14 = (*(int (__fastcall **)(__int64, signed __int64, signed __int64))(*(_QWORD *)v35 + 480LL))(v35, v36, 2LL);
        if ( v14 && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v15 = *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL);
          v16 = *(_DWORD *)(v3 + 36);
          v4 = v14;
          v17 = 7LL;
LABEL_38:
          kernel_debug(0x52D1404u, v4, v16, v15, v17, 0LL);
          goto LABEL_39;
        }
      }
      else if ( *(_BYTE *)v11 )
      {
        v4 = v3 + 110;
        v18 = (*(int (__fastcall **)(__int64, signed __int64, signed __int64))(*(_QWORD *)v35 + 480LL))(
                v35,
                v3 + 110,
                2LL);
        if ( v18 && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v15 = *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL);
          v16 = *(_DWORD *)(v3 + 36);
          v4 = v18;
          v17 = 8LL;
          goto LABEL_38;
        }
      }
      else if ( *(_BYTE *)v34 )
      {
        v4 = v3 + 111;
        v19 = (*(int (__fastcall **)(__int64, signed __int64, signed __int64))(*(_QWORD *)v35 + 480LL))(v35, v34, 2LL);
        if ( v19 )
        {
          if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v15 = *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL);
            v16 = *(_DWORD *)(v3 + 36);
            v4 = v19;
            v17 = 9LL;
            goto LABEL_38;
          }
        }
      }
LABEL_39:
      *(_BYTE *)(v3 + 108) = 0;
      if ( *(_BYTE *)off_1A080[0] & 2 )
      {
        v4 = *(_DWORD *)(v3 + 36);
        v5 = *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL);
        v20 = 1;
        if ( !*(_BYTE *)(v3 + 104) && !*(_BYTE *)v36 && !*(_BYTE *)v11 )
          v20 = *(_BYTE *)v34 != 0;
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D1404u, v4, v5, v20, 0xAuLL, 0LL);
      }
LABEL_69:
      ++v13;
      if ( (unsigned int)v13 >= 0x258 )
      {
        if ( *v37 )
          goto LABEL_74;
        break;
      }
    }
  }
  if ( *(_BYTE *)(v3 + 107) || *(_BYTE *)(v3 + 110) || *(_BYTE *)(v3 + 111) )
  {
LABEL_74:
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v4 = v3;
      kernel_debug(0x52D1404u, v3, *(_DWORD *)(v3 + 36), *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL), 0xBuLL, 0LL);
    }
    return (*(int (__fastcall **)(uintptr_t, signed __int64))(*(_QWORD *)v3 + 40LL))(v3, v4);
  }
  *(_BYTE *)(v3 + 418) = 1;
  if ( *(_BYTE *)(v3 + 100) )
  {
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v4 = v3;
      kernel_debug(0x52D1404u, v3, *(_DWORD *)(v3 + 36), *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL), 0xCuLL, 0LL);
    }
    AppleUSBHubPort::ReleaseDeviceZero(v3);
  }
  AppleUSBHubPort::RemoveDevice((AppleUSBHubPort *)v3, v4, (const OSMetaClass *)v5);
  if ( v33 )
  {
    if ( (unsigned __int8)(*(int (__fastcall **)(__int64))(*(_QWORD *)v33 + 3144LL))(v33) )
    {
      if ( !(unsigned __int8)IOService::isInactive(*(IOService **)(v3 + 48)) )
      {
        v24 = *(_QWORD *)(v3 + 48);
        if ( !*(_BYTE *)(v24 + 304) )
        {
          if ( !*(_BYTE *)(v24 + 160) )
          {
LABEL_90:
            v4 = *(_WORD *)(v3 + 36);
            v25 = AppleUSBHub::SetPortPower((AppleUSBHub *)v24, v4, 0);
            if ( v25 && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            {
              v4 = v3;
              kernel_debug(0x52D1404u, v3, v25, 8uLL, 0LL, 0LL);
            }
            goto LABEL_94;
          }
          if ( !(unsigned __int8)(*(int (__fastcall **)(__int64))(*(_QWORD *)v33 + 3352LL))(v33) )
          {
            v24 = *(_QWORD *)(v3 + 48);
            goto LABEL_90;
          }
        }
      }
    }
  }
LABEL_94:
  v26 = *(_QWORD *)(v3 + 328);
  if ( v26 )
  {
    thread_call_cancel(v26);
    thread_call_free(*(_QWORD *)(v3 + 328));
    *(_QWORD *)(v3 + 328) = 0LL;
  }
  v27 = *(_QWORD *)(v3 + 336);
  if ( v27 )
  {
    thread_call_cancel(v27);
    thread_call_free(*(_QWORD *)(v3 + 336));
    *(_QWORD *)(v3 + 336) = 0LL;
  }
  v28 = *(_QWORD *)(v3 + 344);
  if ( v28 )
  {
    thread_call_cancel(v28);
    thread_call_free(*(_QWORD *)(v3 + 344));
    *(_QWORD *)(v3 + 344) = 0LL;
  }
  v29 = *(_QWORD *)(v3 + 352);
  if ( v29 )
  {
    thread_call_cancel(v29);
    thread_call_free(*(_QWORD *)(v3 + 352));
    *(_QWORD *)(v3 + 352) = 0LL;
  }
  v30 = *(_QWORD *)(v3 + 56);
  if ( v30 )
  {
    v31 = *(_QWORD *)(v3 + 64);
    if ( !v31
      || (v4 = *(_QWORD *)(v3 + 56),
          (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v31 + 328LL))(v31, v4),
          (v30 = *(_QWORD *)(v3 + 56)) != 0) )
      (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v30 + 40LL))(v30, v4);
    *(_QWORD *)(v3 + 56) = 0LL;
  }
  v32 = *(_QWORD *)(v3 + 64);
  if ( v32 )
    (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v32 + 40LL))(v32, v4);
  *(_QWORD *)(v3 + 64) = 0LL;
  return (*(int (__fastcall **)(uintptr_t, signed __int64))(*(_QWORD *)v3 + 40LL))(v3, v4);
}
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);
// 2C7C8: using guessed type int __cdecl thread_call_cancel(_QWORD);
// 2C7E0: using guessed type int __fastcall thread_call_free(_QWORD);

//----- (000000000000E3CA) ----------------------------------------------------
void __fastcall AppleUSBHubPort::ReleaseDeviceZero(uintptr_t arg1)
{
  __int64 v1; // rax@3

  if ( *(_QWORD *)(arg1 + 40) && *(_BYTE *)(arg1 + 100) )
  {
    v1 = off_1A080[0];
    if ( *(_BYTE *)off_1A080[0] & 2 )
    {
      v1 = off_1A098;
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D144Cu, arg1, *(_DWORD *)(arg1 + 36), *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), 0LL, 0LL);
    }
    AppleUSBHub::LowerPowerState(*(AppleUSBHub **)(arg1 + 48), v1);
    (*(void (__cdecl **)(_QWORD))(**(_QWORD **)(arg1 + 40) + 2440LL))(*(_QWORD *)(arg1 + 40));
    *(_BYTE *)(arg1 + 100) = 0;
  }
  else if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    kernel_debug(0x52D144Cu, arg1, *(_DWORD *)(arg1 + 36), *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), 1uLL, 0LL);
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000000E484) ----------------------------------------------------
void __fastcall AppleUSBHubPort::RemoveDevice(AppleUSBHubPort *this, __int64 a2, const OSMetaClass *a3)
{
  uintptr_t v3; // r13@1
  AppleUSBHubPort *v4; // rsi@1
  __int64 v5; // r12@1
  __int64 v6; // rbx@1
  uintptr_t v7; // r14@4
  signed __int64 v8; // rsi@4
  signed __int64 v9; // r15@5
  __int64 v10; // rax@13
  IOService *v11; // rdi@24
  __int64 v12; // rax@29
  signed __int64 v13; // rsi@29
  __int64 v14; // r12@33
  __int64 v15; // rbx@34
  unsigned int v16; // er15@41
  unsigned int v17; // er12@41

  v3 = (uintptr_t)this;
  v4 = *(AppleUSBHubPort **)off_1A020[0];
  v5 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)this + 5), *(const OSMetaClassBase **)off_1A020[0], a3);
  v6 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v4 = this;
    kernel_debug(
      0x52D1445u,
      (uintptr_t)this,
      *((_DWORD *)this + 9),
      *(_DWORD *)(*((_QWORD *)this + 6) + 296LL),
      *((_QWORD *)this + 10),
      0LL);
  }
  IOLockLock(*((_QWORD *)this + 48), v4);
  v7 = *((_QWORD *)this + 10);
  *((_QWORD *)this + 10) = 0LL;
  v8 = 18LL;
  bzero((char *)this + 12, 0x12uLL);
  IOLockUnlock(*((_QWORD *)this + 48), 18LL);
  if ( v7 )
  {
    v9 = IORegistryEntry::getPlane("IOUSB", (_BYTE *)&dword_10 + 2);
    if ( v5 )
    {
      v8 = v7;
      (*(void (__fastcall **)(__int64, uintptr_t, _QWORD))(*(_QWORD *)v5 + 3184LL))(v5, v7, 0LL);
    }
    if ( *((_BYTE *)this + 404) )
    {
      if ( *(_BYTE *)v6 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v8 = (signed __int64)this;
        kernel_debug(
          0x52D1444u,
          (uintptr_t)this,
          *((_DWORD *)this + 9),
          *(_DWORD *)(*((_QWORD *)this + 6) + 296LL),
          1uLL,
          0LL);
      }
      *((_DWORD *)this + 8) = 50;
      *((_BYTE *)this + 404) = 0;
    }
    if ( *((_BYTE *)this + 102) )
    {
      v10 = *((_QWORD *)this + 6);
      if ( *(_BYTE *)(v10 + 426) )
      {
        if ( *(_BYTE *)(v10 + 160) )
        {
          if ( *(_BYTE *)v6 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            kernel_debug(0x52D1444u, (uintptr_t)this, *((_DWORD *)this + 9), *(_DWORD *)(v10 + 296), 2uLL, 0LL);
            v10 = *((_QWORD *)this + 6);
          }
          v8 = 1LL;
          IOUSBHubDevice::UpdateUnconnectedExternalPorts(*(IOUSBHubDevice **)(v10 + 144), 1);
        }
      }
    }
    if ( v9 )
    {
      if ( *(_BYTE *)v6 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1444u,
          (uintptr_t)this,
          *((_DWORD *)this + 9),
          *(_DWORD *)(*((_QWORD *)this + 6) + 296LL),
          3uLL,
          0LL);
      v8 = v9;
      (*(void (__fastcall **)(uintptr_t, signed __int64))(*(_QWORD *)v7 + 896LL))(v7, v9);
    }
    v11 = (IOService *)*((_QWORD *)this + 6);
    if ( v11 && !(unsigned __int8)IOService::isInactive(v11) )
    {
      v14 = v6;
      if ( (*(int (__fastcall **)(uintptr_t, signed __int64))(*(_QWORD *)v7 + 1576LL))(v7, v8) )
      {
        v15 = 0LL;
        do
        {
          if ( (_DWORD)v15 == -100 )
            break;
          if ( *(_BYTE *)v14 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(
              0x52D1444u,
              *(_DWORD *)(v3 + 36),
              *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL),
              (v15 + 4294967395LL) & 0xFFFFFFFFLL,
              4uLL,
              0LL);
          IOSleep(100LL);
          --v15;
        }
        while ( (*(int (__fastcall **)(uintptr_t))(*(_QWORD *)v7 + 1576LL))(v7) );
      }
      v6 = v14;
      if ( (*(int (__fastcall **)(uintptr_t))(*(_QWORD *)v7 + 1576LL))(v7) )
      {
        v16 = *(_DWORD *)(v3 + 36);
        v17 = *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL);
        (*(void (__fastcall **)(uintptr_t, _QWORD))(*(_QWORD *)v7 + 904LL))(v7, 0LL);
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBHubPort: Port %d of Hub at 0x%x about to terminate a busy device (%s) after waiting 10 seconds",
          v16,
          v17);
        if ( *(_BYTE *)v6 & 2 )
        {
          if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(0x52D1444u, v3, *(_DWORD *)(v3 + 36), *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL), 5uLL, 0LL);
        }
      }
      if ( *(_BYTE *)v6 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1444u, v3, *(_DWORD *)(v3 + 36), *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL), 6uLL, 0LL);
      v12 = *(_QWORD *)v7;
      v13 = 3LL;
    }
    else
    {
      if ( *(_BYTE *)v6 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1444u, v3, *(_DWORD *)(v3 + 36), *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL), 7uLL, 0LL);
      v12 = *(_QWORD *)v7;
      v13 = 1LL;
    }
    (*(void (__fastcall **)(uintptr_t, signed __int64))(v12 + 1536))(v7, v13);
    if ( *(_BYTE *)v6 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1444u, *(_DWORD *)(v3 + 36), *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL), v7, 8uLL, 0LL);
    (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)v7 + 40LL))(v7);
  }
  else if ( *(_BYTE *)v6 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    kernel_debug(
      0x52D1444u,
      (uintptr_t)this,
      *((_DWORD *)this + 9),
      *(_DWORD *)(*((_QWORD *)this + 6) + 296LL),
      9uLL,
      0LL);
  }
  AppleUSBHubPort::InitPortVectors((AppleUSBHubPort *)v3);
  if ( *(_BYTE *)v6 & 2 )
  {
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(0x52D1446u, v3, *(_DWORD *)(v3 + 36), *(_DWORD *)(*(_QWORD *)(v3 + 48) + 296LL), v7, 0LL);
  }
}
// 10: using guessed type int;
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BA98: using guessed type int __fastcall IOLockLock(_QWORD, _QWORD);
// 2BAA8: using guessed type int __fastcall IOLockUnlock(_QWORD, _QWORD);
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000000E8D6) ----------------------------------------------------
char __fastcall AppleUSBHubPort::PortInit(uintptr_t arg1, __int64 a2)
{
  uintptr_t v2; // r14@1
  char *v3; // rsi@1
  unsigned int v4; // eax@1
  const char *v5; // rdx@2
  __int64 v6; // rax@8
  __int64 v7; // rax@8
  __int64 v8; // rax@8
  IOUSBController *v9; // rdi@9
  char v10; // al@19
  char v12; // [sp+8h] [bp-18h]@5
  __int16 v13; // [sp+Ah] [bp-16h]@16

  v2 = arg1 + 107;
  *(_BYTE *)(arg1 + 107) = 1;
  IOLockLock(*(_QWORD *)(arg1 + 376), a2);
  v3 = (char *)*(_WORD *)(arg1 + 36);
  v4 = AppleUSBHub::SetPortPower(*(AppleUSBHub **)(arg1 + 48), (unsigned int)v3, 1);
  if ( v4 )
  {
    v5 = "setting port power";
LABEL_7:
    v3 = (char *)v4;
    AppleUSBHubPort::FatalError((AppleUSBHubPort *)arg1, v4, v5);
    goto LABEL_8;
  }
  if ( *(_BYTE *)(arg1 + 101) || *(_BYTE *)(*(_QWORD *)(arg1 + 48) + 1056LL) )
  {
    IOSleep(2 * (unsigned int)*(_BYTE *)(*(_QWORD *)(arg1 + 72) + 5LL));
    v4 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(arg1 + 48), (__int64)&v12, *(_WORD *)(arg1 + 36));
    if ( v4 )
    {
      v5 = "getting port status (2)";
      goto LABEL_7;
    }
    v3 = (char *)*(_DWORD *)(arg1 + 36);
    if ( AppleUSBHub::GetHubPortErrataBits(*(AppleUSBHub **)(arg1 + 48), (int)v3) & 8 )
    {
      if ( !(v12 & 1) )
      {
        AppleUSBHubPort::PowerCycleDeviceAttachedToThisPort(arg1);
        IOSleep(2 * (unsigned int)*(_BYTE *)(*(_QWORD *)(arg1 + 72) + 5LL));
        v3 = &v12;
        v4 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(arg1 + 48), (__int64)&v12, *(_WORD *)(arg1 + 36));
        if ( v4 )
          goto LABEL_35;
      }
    }
    if ( v13 & 1 )
    {
      v4 = AppleUSBHub::ClearPortFeature(*(AppleUSBHub **)(arg1 + 48), 16, *(_WORD *)(arg1 + 36));
      if ( v4 )
      {
        v5 = "clearing port connection change";
        goto LABEL_7;
      }
      v10 = v13;
      if ( v13 & 0x10 )
      {
        v4 = AppleUSBHub::ClearPortFeature(*(AppleUSBHub **)(arg1 + 48), 20, *(_WORD *)(arg1 + 36));
        if ( v4 )
        {
LABEL_24:
          v5 = "clearing port reset change";
          goto LABEL_7;
        }
        v10 = v13;
      }
      if ( v10 & 4 )
      {
        v4 = AppleUSBHub::ClearPortFeature(*(AppleUSBHub **)(arg1 + 48), 18, *(_WORD *)(arg1 + 36));
        if ( v4 )
          goto LABEL_24;
      }
      v3 = &v12;
      v4 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(arg1 + 48), (__int64)&v12, *(_WORD *)(arg1 + 36));
      if ( v4 )
      {
LABEL_35:
        v5 = "getting port status (3)";
        goto LABEL_7;
      }
    }
    if ( v12 & 1 )
    {
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D280Cu, arg1, *(_DWORD *)(arg1 + 36), *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), 0LL, 0LL);
      v3 = 0LL;
      AppleUSBHubPort::LaunchAddDeviceThread((AppleUSBHubPort *)arg1, 0);
    }
  }
LABEL_8:
  LODWORD(v6) = IOLockUnlock(*(_QWORD *)(arg1 + 376), v3);
  *(_BYTE *)(arg1 + 107) = 0;
  v7 = AppleUSBHub::LowerPowerState(*(AppleUSBHub **)(arg1 + 48), v6);
  LOBYTE(v8) = AppleUSBHub::DecrementOutstandingIO(*(AppleUSBHub **)(arg1 + 48), v7, 0);
  if ( *(_BYTE *)(arg1 + 108) )
  {
    v9 = *(IOUSBController **)(arg1 + 40);
    if ( v9 )
    {
      v8 = IOUSBController::GetCommandGate(v9);
      if ( v8 )
        LOBYTE(v8) = (*(int (__fastcall **)(__int64, uintptr_t, signed __int64))(*(_QWORD *)v8 + 488LL))(v8, v2, 1LL);
    }
  }
  return v8;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BA98: using guessed type int __fastcall IOLockLock(_QWORD, _QWORD);
// 2BAA8: using guessed type int __fastcall IOLockUnlock(_QWORD, _QWORD);
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (000000000000EAEA) ----------------------------------------------------
void __fastcall AppleUSBHubPort::FatalError(AppleUSBHubPort *this, __int64 a2, const char *a3)
{
  __int64 v3; // r12@1
  uintptr_t v4; // rcx@3
  const OSMetaClass *v5; // rdx@4
  uintptr_t v6; // rcx@6

  v3 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v4 = (signed int)a2;
    a2 = (__int64)this;
    kernel_debug(
      0x52D1410u,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      v4,
      1uLL,
      0LL);
  }
  if ( !AppleUSBHub::IsHSRootHub(*((AppleUSBHub **)this + 6)) )
  {
    a2 = 1431519814LL;
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "AppleUSBHubPort::FatalError - Port %d of Hub at 0x%x reported error 0x%x while doing %s",
      *((_DWORD *)this + 9),
      *(_DWORD *)(*((_QWORD *)this + 6) + 296LL));
  }
  v6 = *((_QWORD *)this + 10);
  if ( v6 )
  {
    if ( *(_BYTE *)v3 & 2 )
    {
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        a2 = (__int64)this;
        kernel_debug(
          0x52D1410u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          v6,
          2uLL,
          0LL);
      }
    }
    AppleUSBHubPort::RemoveDevice(this, a2, v5);
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (000000000000EBF2) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::PowerCycleDeviceAttachedToThisPort(uintptr_t arg1)
{
  __int64 v1; // r15@1
  unsigned int v2; // er14@4

  v1 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1449u, arg1, *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), *(_DWORD *)(arg1 + 36), 0LL, 0LL);
  AppleUSBHubPort::SDControllerPower(arg1, 0);
  IOSleep(2 * (unsigned int)*(_BYTE *)(*(_QWORD *)(arg1 + 72) + 5LL));
  v2 = AppleUSBHubPort::SDControllerPower(arg1, 1u);
  if ( *(_BYTE *)v1 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D144Au,
      arg1,
      *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL),
      *(_DWORD *)(arg1 + 36),
      (signed int)v2,
      0LL);
  return v2;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (000000000000ECAA) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::LaunchAddDeviceThread(AppleUSBHubPort *this, unsigned int a2)
{
  __int64 v2; // rbx@1
  __int64 v3; // r15@2
  int v4; // er12@3
  __int64 result; // rax@3

  v2 = *((_QWORD *)this + 7);
  if ( v2 && (v3 = *((_QWORD *)this + 8)) != 0 )
  {
    (*(void (**)(void))(*(_QWORD *)this + 32LL))();
    (*(void (**)(void))(**((_QWORD **)this + 6) + 32LL))();
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v3 + 32LL))(v3);
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v2 + 32LL))(v2);
    v4 = (*(int (__fastcall **)(__int64, __int64 (__fastcall *)(uintptr_t, uintptr_t), _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v2 + 456LL))(
           v2,
           AppleUSBHubPort::LaunchAddDeviceThreadGated,
           a2,
           0LL,
           0LL,
           0LL);
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v2 + 40LL))(v2);
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v3 + 40LL))(v3);
    (*(void (**)(void))(**((_QWORD **)this + 6) + 40LL))();
    (*(void (__fastcall **)(AppleUSBHubPort *))(*(_QWORD *)this + 40LL))(this);
    result = (unsigned int)v4;
  }
  else
  {
    result = 3758097122LL;
  }
  return result;
}

//----- (000000000000ED4C) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::AddDevice(uintptr_t arg1, uintptr_t arg3, const OSMetaClass *a3)
{
  char v3; // r14@1
  uintptr_t v4; // r12@1
  __int64 v5; // r15@1
  uintptr_t v6; // rcx@3
  IOService *v7; // rdi@10
  int v8; // er13@12
  __int64 v9; // rdi@13
  __int64 v10; // rbx@13
  __int64 v11; // r14@13
  unsigned __int8 v12; // al@13
  __int64 v14; // rdi@19
  uintptr_t v15; // rcx@19
  unsigned __int64 v16; // rdx@23
  uintptr_t v17; // r8@23
  int v18; // eax@24
  int v19; // eax@32
  signed __int64 v20; // rdx@36
  __int64 v21; // rdi@37
  char v22; // al@38
  __int64 v23; // rdi@47
  __int16 v24; // dx@52
  signed __int64 v25; // rsi@52
  char v26; // al@60
  signed int v27; // ebx@61
  int v28; // eax@61
  uintptr_t v29; // rcx@64
  unsigned __int64 v30; // rdx@64
  uintptr_t v31; // r8@64
  const OSMetaClass *v32; // rdx@69
  char v33; // al@77
  char v34; // r14@80
  uintptr_t v35; // rcx@90
  bool v36; // al@109
  signed int v37; // er14@112
  uintptr_t v38; // rbx@112
  int v39; // ecx@119
  int v40; // eax@124
  int v41; // ecx@128
  uintptr_t v42; // rcx@139
  unsigned __int64 v43; // rdx@139
  uintptr_t v44; // r8@139
  unsigned int v45; // eax@166
  int v46; // eax@167
  __int64 v47; // rdi@173
  int v48; // eax@174
  __int64 v49; // rax@183
  uintptr_t v50; // [sp+0h] [bp-40h]@111
  signed int v51; // [sp+Ch] [bp-34h]@111
  uintptr_t arg4; // [sp+10h] [bp-30h]@1

  v3 = arg3;
  v4 = arg1;
  LODWORD(arg4) = 0;
  v5 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v6 = (unsigned int)arg3;
    arg3 = arg1;
    kernel_debug(
      0x52D1409u,
      arg1,
      *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
      v6,
      0LL,
      0LL);
  }
  if ( v3 & 1 )
  {
    if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      arg3 = arg1;
      kernel_debug(
        0x52D1408u,
        arg1,
        *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
        0LL,
        0LL,
        0LL);
    }
    AppleUSBHubPort::RemoveDevice((AppleUSBHubPort *)arg1, arg3, a3);
  }
  if ( (unsigned __int8)IOService::isInactive(*(IOService **)(arg1 + 48))
    || (v7 = *(IOService **)(*(_QWORD *)(arg1 + 48) + 144LL)) == 0LL
    || (unsigned __int8)IOService::isInactive(v7) )
  {
    v8 = 0;
    if ( *(_BYTE *)v5 & 2 )
    {
      v9 = *(_QWORD *)(v4 + 48);
      v10 = *(_DWORD *)(v9 + 296);
      v11 = *(_DWORD *)(v4 + 36);
      v12 = IOService::isInactive((IOService *)v9);
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v8 = 0;
        kernel_debug(0x52D1408u, v4, v11 | (v10 << 32), v12, 4uLL, 0LL);
      }
    }
    goto LABEL_15;
  }
  v14 = *(_QWORD *)(v4 + 48);
  v15 = *(_DWORD *)(v14 + 164);
  if ( (signed __int64)v15 <= 2 && (_DWORD)v15 != -1 )
  {
    v8 = 0;
    if ( !(*(_BYTE *)v5 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      goto LABEL_15;
    v16 = *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(v14 + 296) << 32);
    v8 = 0;
    v17 = 5LL;
    goto LABEL_56;
  }
  v8 = AppleUSBHub::GetPortStatus((AppleUSBHub *)v14, (__int64)&arg4, *(_WORD *)(v4 + 36));
  v18 = *(_DWORD *)v5 & 2;
  if ( v8 )
  {
    if ( !v18 || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      goto LABEL_15;
    v15 = v8;
    v16 = *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32);
    v17 = 6LL;
    goto LABEL_56;
  }
  if ( v18 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1408u,
      v4,
      *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
      arg4,
      7uLL,
      0LL);
  if ( !(arg4 & 1) )
  {
    v8 = 0;
    if ( !(*(_BYTE *)v5 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      goto LABEL_15;
    v16 = *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32);
    v8 = 0;
    v15 = 0LL;
    v17 = 8LL;
LABEL_56:
    kernel_debug(0x52D1408u, v4, v16, v15, v17, 0LL);
    goto LABEL_15;
  }
  v19 = *(_DWORD *)v5 & 2;
  if ( *(_BYTE *)(v4 + 100) )
  {
    if ( v19 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1408u,
        v4,
        *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
        0LL,
        0xEuLL,
        0LL);
    goto LABEL_36;
  }
  if ( v19 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1408u,
      v4,
      *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
      *(_QWORD *)(v4 + 40),
      9uLL,
      0LL);
  v26 = AppleUSBHubPort::AcquireDeviceZero(v4);
  *(_BYTE *)(v4 + 100) = v26;
  if ( v26 )
  {
    v27 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(v4 + 48), (__int64)&arg4, *(_WORD *)(v4 + 36));
    v28 = *(_DWORD *)v5 & 2;
    if ( v27 )
    {
      if ( !v28 || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_162;
      v29 = v27;
      v30 = *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32);
      LOBYTE(v8) = 0;
      v31 = 11LL;
    }
    else
    {
      if ( v28 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1408u,
          v4,
          *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
          arg4,
          0xCuLL,
          0LL);
      if ( arg4 & 1 )
      {
LABEL_36:
        v20 = 152LL;
        if ( !(v3 & 2) )
        {
          v21 = *(_QWORD *)(v4 + 48);
          v20 = 152LL;
          if ( *(_BYTE *)(v21 + 426) )
          {
            v22 = AppleUSBHub::IsHSRootHub((AppleUSBHub *)v21);
            v20 = 152LL;
            if ( !v22 )
            {
              if ( !*(_BYTE *)(v4 + 392)
                && !(((unsigned int)(unsigned __int16)arg4 >> 5) & 7 | ((unsigned int)(unsigned __int16)arg4 >> 11) & 8) )
              {
                if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                  kernel_debug(
                    0x52D1408u,
                    v4,
                    *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
                    0LL,
                    0xFuLL,
                    0LL);
                v45 = arg4;
                *(_DWORD *)(v4 + 360) = arg4;
                v8 = (*(int (__fastcall **)(uintptr_t, _QWORD, _QWORD))(*(_QWORD *)v4 + 304LL))(
                       v4,
                       v45 >> 16,
                       (unsigned __int16)v45);
                goto LABEL_167;
              }
              v20 = 152LL;
              if ( *(_BYTE *)v5 & 2 )
              {
                v20 = 152LL;
                if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                {
                  kernel_debug(
                    0x52D1408u,
                    v4,
                    *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
                    *(_BYTE *)(v4 + 392),
                    0x10uLL,
                    0LL);
                  v20 = 152LL;
                }
              }
            }
          }
        }
        do
        {
          if ( *(_DWORD *)(v4 + v20) == 16 )
          {
            *(_QWORD *)(v4 + v20 - 16) = AppleUSBHubPort::AddDeviceResetChangeHandler;
            *(_QWORD *)(v4 + v20 - 8) = 0LL;
          }
          v20 += 24LL;
        }
        while ( v20 != 344 );
        *(_BYTE *)(v4 + 109) = 1;
        v23 = *(_QWORD *)(v4 + 48);
        if ( *(_BYTE *)(v23 + 426) && *(_BYTE *)(v4 + 392) )
        {
          if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            kernel_debug(
              0x52D1408u,
              v4,
              *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(v23 + 296) << 32),
              0LL,
              0x11uLL,
              0LL);
            v23 = *(_QWORD *)(v4 + 48);
          }
          v24 = *(_WORD *)(v4 + 36);
          v25 = 28LL;
        }
        else
        {
          if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            kernel_debug(
              0x52D1408u,
              v4,
              *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(v23 + 296) << 32),
              0LL,
              0x12uLL,
              0LL);
            v23 = *(_QWORD *)(v4 + 48);
          }
          v24 = *(_WORD *)(v4 + 36);
          v25 = 4LL;
        }
        v8 = AppleUSBHub::SetPortFeature((AppleUSBHub *)v23, v25, v24);
        if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v25 = v4;
          kernel_debug(
            0x52D1408u,
            v4,
            *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
            v8,
            0x13uLL,
            0LL);
        }
        if ( v8 != -536854455 )
        {
          if ( !v8 )
          {
            IOSleep(1LL);
            v8 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(v4 + 48), (__int64)&arg4, *(_WORD *)(v4 + 36));
            if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(
                0x52D1408u,
                v4,
                *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
                arg4,
                0x17uLL,
                0LL);
            v33 = arg4;
            if ( arg4 & 0x10 || arg4 & 0x100000 || *(_DWORD *)(v4 + 364) == 4 )
            {
              v34 = 1;
              if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              {
                kernel_debug(
                  0x52D1408u,
                  v4,
                  *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
                  0LL,
                  0x18uLL,
                  0LL);
                v33 = arg4;
              }
            }
            else
            {
              v34 = 0;
            }
            if ( !(v33 & 1) )
            {
              if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                kernel_debug(
                  0x52D1408u,
                  v4,
                  *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
                  0LL,
                  0x19uLL,
                  0LL);
              v27 = -536870199;
              if ( v34 )
                goto LABEL_162;
              v8 = -536870199;
              goto LABEL_158;
            }
            v36 = v34 == 0;
            if ( !v34 && !v8 )
            {
              v51 = 1;
              v50 = 0LL;
              do
              {
                v37 = 256;
                v38 = 1LL;
                while ( 1 )
                {
                  v8 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(v4 + 48), (__int64)&arg4, *(_WORD *)(v4 + 36));
                  if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                    kernel_debug(
                      0x52D1408u,
                      v4,
                      *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
                      arg4,
                      0x1AuLL,
                      0LL);
                  if ( !*(_BYTE *)(v4 + 100) )
                    break;
                  if ( arg4 & 0x100010 || *(_DWORD *)(v4 + 364) == 4 )
                  {
                    LOBYTE(v38) = 1;
                    goto LABEL_148;
                  }
                  v39 = *(_DWORD *)v5 & 2;
                  if ( !(arg4 & 1) )
                  {
                    v8 = -536870199;
                    if ( v39 )
                    {
                      v38 = v50;
                      if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
                        goto LABEL_148;
                      v43 = *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32);
                      v42 = 0LL;
                      v44 = 28LL;
                      goto LABEL_146;
                    }
                    goto LABEL_147;
                  }
                  if ( v39 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                    kernel_debug(
                      0x52D1408u,
                      v4,
                      *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
                      v38,
                      0x1DuLL,
                      0LL);
                  if ( v37 == 12800 )
                  {
                    v40 = *(_DWORD *)v5 & 2;
                    if ( !*(_BYTE *)(v4 + 100) )
                    {
                      v8 = -536870199;
                      if ( v40 )
                      {
                        v38 = v50;
                        if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
                          goto LABEL_148;
                        v43 = *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32);
                        v42 = 0LL;
                        v44 = 30LL;
                        goto LABEL_146;
                      }
LABEL_147:
                      v38 = v50;
                      goto LABEL_148;
                    }
                    if ( v40 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                      kernel_debug(
                        0x52D1408u,
                        v4,
                        *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
                        (*(_DWORD *)(v4 + 364) << 16) | v51 | 0x3200,
                        0x1FuLL,
                        0LL);
                    v41 = AppleUSBHub::SetPortFeature(*(AppleUSBHub **)(v4 + 48), 4, *(_WORD *)(v4 + 36));
                    v8 = 0;
                    if ( v41 )
                    {
                      if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                      {
                        v8 = v41;
                        kernel_debug(
                          0x52D1408u,
                          v4,
                          *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
                          v41,
                          0x20uLL,
                          0LL);
                      }
                      else
                      {
                        v8 = v41;
                      }
                    }
                  }
                  IOSleep(10LL);
                  if ( (signed int)v38 <= 49 )
                  {
                    ++v38;
                    v37 += 256;
                    if ( !v8 )
                      continue;
                  }
                  goto LABEL_147;
                }
                LOBYTE(v38) = 1;
                if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                {
                  v42 = v51 | v37;
                  v43 = *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32);
                  v44 = 27LL;
LABEL_146:
                  kernel_debug(0x52D1408u, v4, v43, v42, v44, 0LL);
                }
LABEL_148:
                v36 = (v38 & 1) == 0;
                if ( v51 > 4 )
                  break;
                if ( v38 & 1 )
                  break;
                v50 = v38;
                ++v51;
              }
              while ( !v8 );
            }
            if ( v36 )
            {
LABEL_158:
              v27 = -536870199;
              if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              {
                v29 = v8;
                v30 = *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32);
                LOBYTE(v8) = 0;
                v31 = 33LL;
                goto LABEL_161;
              }
LABEL_162:
              LOBYTE(v8) = 0;
              goto LABEL_168;
            }
LABEL_167:
            v46 = v8;
            v8 = 0;
            v27 = v46;
            if ( !v46 )
              goto LABEL_15;
            goto LABEL_168;
          }
          if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v25 = v4;
            kernel_debug(
              0x52D1408u,
              v4,
              *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
              v8,
              0x14uLL,
              0LL);
          }
        }
        v35 = *(_QWORD *)(v4 + 80);
        if ( v35 )
        {
          if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v25 = v4;
            kernel_debug(
              0x52D1408u,
              v4,
              *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
              v35,
              0x15uLL,
              0LL);
          }
          AppleUSBHubPort::RemoveDevice((AppleUSBHubPort *)v4, v25, v32);
        }
        if ( v8 == -536854447 )
        {
          if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(
              0x52D1408u,
              v4,
              *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
              0LL,
              0x16uLL,
              0LL);
          AppleUSBHub::CallCheckForDeadHub(*(AppleUSBHub **)(v4 + 48));
          LOBYTE(v8) = 1;
          v27 = -536854447;
          goto LABEL_168;
        }
        goto LABEL_167;
      }
      v27 = -536870163;
      if ( !(*(_BYTE *)v5 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
        goto LABEL_162;
      v30 = *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32);
      LOBYTE(v8) = 0;
      v29 = 0LL;
      v31 = 13LL;
    }
LABEL_161:
    kernel_debug(0x52D1408u, v4, v30, v29, v31, 0LL);
LABEL_168:
    if ( *(_BYTE *)(v4 + 100) )
    {
      if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1408u,
          v4,
          *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
          v27,
          0x22uLL,
          0LL);
      if ( !(_BYTE)v8 )
      {
        v47 = *(_QWORD *)(v4 + 48);
        if ( !*(_BYTE *)(v47 + 426) )
        {
          v48 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v47, 1, *(_WORD *)(v4 + 36));
          v27 = 0;
          if ( v48 )
          {
            v27 = v48;
            if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(
                0x52D1408u,
                v4,
                *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
                v48,
                0x23uLL,
                0LL);
            AppleUSBHubPort::FatalError((AppleUSBHubPort *)v4, (unsigned int)v27, "clearing port feature (1)");
            if ( v27 == -536854447 )
            {
              if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                kernel_debug(
                  0x52D1408u,
                  v4,
                  *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
                  0xFFFFFFFFE0004051LL,
                  0x24uLL,
                  0LL);
              AppleUSBHub::CallCheckForDeadHub(*(AppleUSBHub **)(v4 + 48));
              v27 = -536854447;
            }
          }
        }
      }
      AppleUSBHubPort::ReleaseDeviceZero(v4);
      v49 = 0LL;
      do
      {
        if ( *(_DWORD *)(v4 + v49 + 152) == 16 )
        {
          *(_QWORD *)(v4 + v49 + 136) = AppleUSBHubPort::DefaultResetChangeHandler;
          *(_QWORD *)(v4 + v49 + 144) = 0LL;
        }
        v49 += 24LL;
      }
      while ( v49 != 192 );
    }
    v8 = v27;
    goto LABEL_15;
  }
  if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1408u,
      v4,
      *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
      *(_QWORD *)(v4 + 40),
      0xAuLL,
      0LL);
  AppleUSBHubPort::FatalError((AppleUSBHubPort *)v4, 3758097100LL, "acquiring device zero");
  v8 = 0;
LABEL_15:
  if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D140Au,
      v4,
      *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
      v8,
      arg4,
      0LL);
  return (unsigned int)v8;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (000000000000FC08) ----------------------------------------------------
char __fastcall AppleUSBHubPort::AcquireDeviceZero(uintptr_t arg1)
{
  signed __int64 v1; // rbx@1
  __int64 v2; // r15@1
  __int64 v3; // r14@1
  __int64 v4; // rax@2
  __int64 v6; // rax@8

  v1 = 2LL;
  v2 = off_1A080[0];
  v3 = off_1A098;
  while ( 1 )
  {
    LODWORD(v4) = (*(int (**)(void))(**(_QWORD **)(arg1 + 40) + 2432LL))();
    if ( !(_DWORD)v4 )
      break;
    if ( *(_BYTE *)v2 & 2 )
    {
      if ( *(_DWORD *)v3 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D144Cu,
          arg1,
          *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
          v1 | (v4 << 32),
          3uLL,
          0LL);
    }
    IOSleep(1000LL);
    --v1;
    if ( (signed int)v1 + 1 <= 0 )
      return 0;
  }
  v6 = (unsigned int)(*(_DWORD *)(arg1 + 396) + 1);
  *(_DWORD *)(arg1 + 396) = v6;
  if ( *(_BYTE *)v2 & 2 && *(_DWORD *)v3 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D144Cu,
      arg1,
      *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
      (unsigned int)v6,
      2uLL,
      0LL);
  AppleUSBHub::RaisePowerState(*(AppleUSBHub **)(arg1 + 48), v6);
  return 1;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (000000000000FCFE) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::SetPortVector(__int64 a1, __int64 a2, __int64 a3, int a4)
{
  __int64 result; // rax@1

  result = 0LL;
  do
  {
    if ( *(_DWORD *)(a1 + result + 152) == a4 )
    {
      *(_QWORD *)(a1 + result + 136) = a2;
      *(_QWORD *)(a1 + result + 144) = a3;
    }
    result += 24LL;
  }
  while ( result != 192 );
  return result;
}

//----- (000000000000FD2C) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::AddDeviceResetChangeHandler(AppleUSBHubPort *this, unsigned int a2, const OSMetaClass *a3)
{
  __int16 v3; // r15@1
  IOUSBDevice *v4; // r12@1
  uintptr_t v5; // rbx@1
  __int64 v6; // r13@1
  AppleUSBHubPort *v7; // rsi@1
  IOUSBController *v8; // r14@1
  signed int v9; // er15@23
  unsigned __int64 v10; // rdx@25
  uintptr_t v11; // r8@25
  uintptr_t v12; // r15@27
  __int16 v13; // cx@34
  unsigned __int64 v14; // rdx@37
  uintptr_t v15; // r8@37
  __int64 v16; // rax@46
  unsigned int v17; // er15@70
  unsigned __int16 v18; // ax@70
  __int64 v19; // rax@72
  __int64 v20; // rdi@73
  __int64 v21; // rax@77
  __int64 v22; // rsi@77
  int v23; // eax@81
  __int64 v24; // rdi@85
  __int64 v25; // rax@92
  __int64 v26; // rsi@97
  __int64 v27; // rdx@97
  __int64 v28; // rdi@99
  unsigned int v29; // eax@100
  uintptr_t v30; // r15@111
  __int64 v31; // rax@119
  __int64 v32; // r8@120
  __int64 v33; // rdi@128
  int v34; // eax@129
  signed __int64 v35; // rax@133
  void *v36; // rsi@140
  IOUSBDevice *v37; // rax@140
  IOUSBDevice *v38; // r15@142
  __int64 v39; // rdi@147
  OSMetaClassBase *v40; // r13@149
  unsigned __int16 v41; // r15@149
  __int16 v42; // r14@149
  int v43; // er12@149
  const OSMetaClass *v44; // rdx@149
  __int64 v45; // rax@149
  const char *v46; // rsi@150
  int v47; // eax@150
  __int64 v48; // rdi@154
  __int64 v49; // rax@161
  __int64 v50; // rsi@167
  __int64 v51; // rdx@167
  IOUSBDevice *v52; // rax@175
  const char *v53; // rax@176
  __int64 v54; // rdx@176
  __int64 v55; // rcx@176
  __int64 v56; // rax@186
  signed __int64 v57; // rax@191
  __int64 v58; // rdi@195
  int v59; // eax@196
  IOUSBController *v61; // r15@214
  __int64 v62; // rax@214
  __int64 v63; // rax@215
  __int64 v64; // r14@215
  void (__fastcall *v65)(_QWORD, _QWORD); // r14@217
  __int16 v66; // ax@217
  unsigned __int16 v67; // r14@218
  unsigned __int16 v68; // ax@218
  unsigned int v69; // ecx@218
  int *v70; // rdx@218
  signed __int64 v71; // rsi@218
  uintptr_t v72; // r13@228
  signed __int64 v73; // rsi@232
  IOUSBDevice *v74; // r14@232
  int v75; // er12@232
  __int64 v76; // rdx@250
  unsigned __int8 v77; // r13@252
  uintptr_t v78; // r13@256
  __int64 v79; // rax@257
  __int64 v80; // rdx@263
  __int64 v81; // rcx@268
  __int64 v82; // rax@274
  __int64 v83; // rax@280
  int v84; // eax@290
  int v85; // ecx@290
  int v86; // er14@299
  bool v87; // zf@299
  int v88; // er14@300
  unsigned __int8 v89; // [sp+1Fh] [bp-61h]@149
  unsigned __int8 arg3; // [sp+20h] [bp-60h]@149
  signed int arg3a; // [sp+20h] [bp-60h]@252
  unsigned int v92; // [sp+28h] [bp-58h]@149
  int (__fastcall *v93)(_QWORD, _QWORD, _QWORD); // [sp+28h] [bp-58h]@228
  unsigned __int8 v94; // [sp+30h] [bp-50h]@36
  IOUSBDevice *v95; // [sp+30h] [bp-50h]@147
  IOUSBDevice *v96; // [sp+30h] [bp-50h]@228
  __int64 v97; // [sp+38h] [bp-48h]@1
  unsigned __int16 v98; // [sp+40h] [bp-40h]@1
  char v99; // [sp+42h] [bp-3Eh]@58
  __int64 v100; // [sp+50h] [bp-30h]@1

  v3 = (signed __int16)a3;
  v4 = (IOUSBDevice *)a2;
  v5 = (uintptr_t)this;
  v6 = off_1A070[0];
  v100 = *(_QWORD *)off_1A070[0];
  v98 = 0;
  v7 = *(AppleUSBHubPort **)off_1A020[0];
  v97 = OSMetaClassBase::safeMetaCast(*((OSMetaClassBase **)this + 5), *(const OSMetaClassBase **)off_1A020[0], a3);
  v8 = (IOUSBController *)off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v7 = this;
    kernel_debug(
      0x52D1415u,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      (unsigned __int16)v3 | ((unsigned __int64)(unsigned __int16)v4 << 16),
      *((_BYTE *)this + 100),
      0LL);
  }
  *((_WORD *)this + 213) = 0;
  if ( *((_BYTE *)this + 400) )
  {
    IOSleep(100LL);
    *((_BYTE *)this + 400) = 0;
  }
  if ( *((_DWORD *)this + 91) == 3 )
    goto LABEL_110;
  if ( (unsigned __int8)v4 & 2 && *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v7 = this;
    kernel_debug(
      0x52D1414u,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      0LL,
      0x25uLL,
      0LL);
  }
  if ( !(v3 & 1) )
  {
    if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1414u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        0LL,
        0x26uLL,
        0LL);
    *((_DWORD *)this + 91) = 3;
    goto LABEL_21;
  }
  if ( (unsigned __int8)v4 & 1 )
  {
    if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1414u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        0LL,
        0x27uLL,
        0LL);
    *((_DWORD *)this + 91) = 3;
    *((_BYTE *)this + 392) = 0;
LABEL_21:
    v6 = off_1A070[0];
LABEL_124:
    v9 = -536870208;
    if ( *((_BYTE *)this + 100) )
    {
      if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1414u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          0xFFFFFFFFE00002C0LL,
          0LL,
          0LL);
      v33 = *((_QWORD *)this + 6);
      if ( !*(_BYTE *)(v33 + 426) )
      {
        v34 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v33, 1, *(_WORD *)(v5 + 36));
        if ( *(_BYTE *)v8 & 2 )
        {
          if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(
              0x52D1414u,
              v5,
              *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
              v34,
              0x37uLL,
              0LL);
        }
      }
      AppleUSBHubPort::ReleaseDeviceZero(v5);
    }
    goto LABEL_133;
  }
  if ( *((_BYTE *)this + 360) & 0x10 )
  {
    v9 = 0;
    v6 = off_1A070[0];
    if ( !(*(_BYTE *)v8 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      goto LABEL_133;
    v10 = *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32);
    v9 = 0;
    v11 = 40LL;
LABEL_41:
    kernel_debug(0x52D1414u, (uintptr_t)this, v10, 0LL, v11, 0LL);
    goto LABEL_133;
  }
  v6 = off_1A070[0];
  if ( *((_BYTE *)this + 100) )
  {
    v12 = 10LL;
    if ( *((_BYTE *)this + 392) )
    {
      v12 = 300LL;
      if ( *(_BYTE *)v8 & 2 )
      {
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v7 = this;
          kernel_debug(
            0x52D1414u,
            (uintptr_t)this,
            *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
            0x12CuLL,
            0x29uLL,
            0LL);
        }
      }
    }
    if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v7 = this;
      kernel_debug(
        0x52D1414u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        v12,
        0x2AuLL,
        0LL);
    }
    IOSleep((unsigned int)v12);
    v13 = *((_WORD *)this + 180);
    if ( HIBYTE(v13) & 2 )
    {
      *((_BYTE *)this + 30) = 0;
      if ( *(_BYTE *)v8 & 2 )
      {
        v94 = 8;
        if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
          goto LABEL_67;
        v14 = *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32);
        v15 = 43LL;
LABEL_51:
        v7 = this;
        kernel_debug(0x52D1414u, (uintptr_t)this, v14, 0LL, v15, 0LL);
        goto LABEL_67;
      }
      goto LABEL_66;
    }
    if ( HIBYTE(v13) & 4 )
    {
      *((_BYTE *)this + 30) = 2;
      if ( *(_BYTE *)v8 & 2 )
      {
        v94 = 64;
        if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
          goto LABEL_67;
        v14 = *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32);
        v15 = 44LL;
        goto LABEL_51;
      }
      v94 = 64;
    }
    else
    {
      v16 = *((_QWORD *)this + 6);
      if ( !*(_BYTE *)(v16 + 426) || !(*((_WORD *)this + 180) & 0x2000) )
      {
        *((_BYTE *)this + 30) = 1;
        if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v7 = this;
          kernel_debug(
            0x52D1414u,
            (uintptr_t)this,
            *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(v16 + 296) << 32),
            0LL,
            0x2EuLL,
            0LL);
          v16 = *((_QWORD *)this + 6);
        }
        if ( *(_DWORD *)(v16 + 296) == -49283072 )
        {
          v94 = 8;
          if ( *((_DWORD *)this + 9) == 1 )
          {
            v7 = (AppleUSBHubPort *)(&dword_C + 2);
            if ( PEGetModelName(&v99, 14LL) )
            {
              v7 = (AppleUSBHubPort *)"MacBookAir4,2";
              if ( !strncmp(&v99, "MacBookAir4,2", 0xDuLL) )
              {
                if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                  kernel_debug(
                    0x52D1414u,
                    (uintptr_t)this,
                    *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
                    0LL,
                    5uLL,
                    0LL);
                if ( !*(_BYTE *)(*((_QWORD *)this + 6) + 426LL) )
                  AppleUSBHub::ClearPortFeature(*((AppleUSBHub **)this + 6), 1, *((_WORD *)this + 18));
                AppleUSBHubPort::SDControllerReset(this);
                AppleUSBHubPort::ReleaseDeviceZero((uintptr_t)this);
                *((_QWORD *)this + 10) = 0LL;
                v9 = -536870208;
                goto LABEL_209;
              }
            }
          }
          goto LABEL_67;
        }
LABEL_66:
        v94 = 8;
        goto LABEL_67;
      }
      *((_BYTE *)this + 30) = 3;
      if ( *(_BYTE *)v8 & 2 )
      {
        v94 = 9;
        if ( !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
          goto LABEL_67;
        v14 = *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(v16 + 296) << 32);
        v15 = 45LL;
        goto LABEL_51;
      }
      v94 = 9;
    }
LABEL_67:
    if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v7 = this;
      kernel_debug(
        0x52D1414u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        0LL,
        0x2FuLL,
        0LL);
    }
    v4 = v8;
    v8 = (IOUSBController *)*((_QWORD *)this + 5);
    v17 = *((_BYTE *)this + 30);
    v18 = (*(int (__fastcall **)(_QWORD, AppleUSBHubPort *))(**(_QWORD **)(*((_QWORD *)this + 6) + 144LL) + 2248LL))(
            *(_QWORD *)(*((_QWORD *)this + 6) + 144LL),
            v7);
    v9 = DoConfigureDeviceZero(v8, v94, (const OSMetaClass *)v17, v18, *((_DWORD *)this + 9));
    if ( v9 )
    {
      if ( v9 == -536854458 )
      {
        v19 = *((_QWORD *)this + 6);
        if ( !v19 )
          goto LABEL_99;
        v20 = *(_QWORD *)(v19 + 144);
        if ( !v20 )
          goto LABEL_99;
        if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          kernel_debug(
            0x52D1414u,
            v5,
            *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(v19 + 296) << 32),
            0xFFFFFFFFE0004046LL,
            8uLL,
            0LL);
          v20 = *(_QWORD *)(*(_QWORD *)(v5 + 48) + 144LL);
        }
        v21 = *(_QWORD *)v20;
        v22 = (*(_DWORD *)(v5 + 36) << 24) | 7u;
      }
      else
      {
        if ( v9 != -536854459 )
          goto LABEL_99;
        v25 = *((_QWORD *)this + 6);
        if ( !v25 || !*(_QWORD *)(v25 + 144) )
          goto LABEL_99;
        if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          kernel_debug(
            0x52D1414u,
            (uintptr_t)this,
            *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(v25 + 296) << 32),
            0xFFFFFFFFE0004045LL,
            7uLL,
            0LL);
          v25 = *((_QWORD *)this + 6);
        }
        v26 = *((_DWORD *)this + 9);
        v27 = *(_DWORD *)(v25 + 296);
        IOLog("The USB stack is not able to enumerate the device at Port %d of hub at 0x%x because the USB hardware ran out of device slots\n");
        v20 = *(_QWORD *)(*((_QWORD *)this + 6) + 144LL);
        v21 = *(_QWORD *)v20;
        v22 = (*(_DWORD *)(v5 + 36) << 24) | 6u;
      }
      (*(void (__fastcall **)(__int64, __int64))(v21 + 2456))(v20, v22);
LABEL_99:
      *(_BYTE *)(v5 + 392) = 1;
      *(_DWORD *)(v5 + 364) = 3;
      v28 = *(_QWORD *)(v5 + 48);
      if ( !*(_BYTE *)(v28 + 426) )
      {
        v29 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v28, 1, *(_WORD *)(v5 + 36));
        v8 = (IOUSBController *)v29;
        v9 = 0;
        if ( v29 )
        {
          AppleUSBHubPort::FatalError((AppleUSBHubPort *)v5, v29, "clearing port feature (2)");
          v9 = (signed int)v8;
        }
      }
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1414u,
          v5,
          *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
          v9,
          6uLL,
          0LL);
      goto LABEL_105;
    }
    *((_BYTE *)this + 392) = 1;
    bzero((char *)this + 12, 0x12uLL);
    v8 = v4;
    if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1414u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        0LL,
        0x30uLL,
        0LL);
    v23 = AppleUSBHubPort::GetDevZeroDescriptorWithRetries((uintptr_t)this);
    if ( v23 )
    {
      *((_BYTE *)this + 392) = 1;
      *((_DWORD *)this + 91) = 3;
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1414u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          v23,
          9uLL,
          0LL);
      v24 = *((_QWORD *)this + 6);
      if ( *(_BYTE *)(v24 + 426)
        || (v9 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v24, 1, *(_WORD *)(v5 + 36))) == 0 )
      {
        AppleUSBHubPort::ReleaseDeviceZero(v5);
        *(_DWORD *)(v5 + 364) = 5;
        v9 = AppleUSBHubPort::DetachDevice((AppleUSBHubPort *)v5);
        goto LABEL_209;
      }
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1414u,
          v5,
          *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
          v9,
          0xAuLL,
          0LL);
      AppleUSBHubPort::FatalError((AppleUSBHubPort *)v5, (unsigned int)v9, "clearing port feature (2)");
LABEL_105:
      AppleUSBHubPort::ReleaseDeviceZero(v5);
      *(_QWORD *)(v5 + 80) = 0LL;
      goto LABEL_209;
    }
    if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1414u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        *((_BYTE *)this + 19),
        0x31uLL,
        0LL);
LABEL_110:
    if ( *((_BYTE *)this + 393) )
    {
      v30 = 33 * (unsigned int)*((_BYTE *)this + 393);
      if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1414u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          v30,
          0xBuLL,
          0LL);
      IOSleep((unsigned int)v30);
    }
    *((_BYTE *)this + 392) = 0;
    *((_DWORD *)this + 91) = 4;
    if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1414u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        0LL,
        0x32uLL,
        0LL);
    if ( *((_BYTE *)this + 16) == 9 )
    {
      v31 = *((_QWORD *)this + 6);
      if ( *(_BYTE *)(v31 + 296) & 0xF0 )
      {
        (*(void (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v31 + 144) + 2456LL))(
          *(_QWORD *)(v31 + 144),
          (*((_DWORD *)this + 9) << 24) | 9u);
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "A USB Hub (connected to the hub at 0x%x) has been plugged in but it will result in an illegal configuration.  The hub will not be enabled.",
          *(_DWORD *)(*((_QWORD *)this + 6) + 296LL),
          v32);
        if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1414u,
            (uintptr_t)this,
            *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
            0LL,
            1uLL,
            0LL);
        AppleUSBHubPort::ReleaseDeviceZero((uintptr_t)this);
        *((_QWORD *)this + 10) = 0LL;
        goto LABEL_124;
      }
      v36 = &v98;
      v37 = (IOUSBDevice *)IOUSBController::MakeHubDevice(*((IOUSBController **)this + 5), &v98);
    }
    else
    {
      v36 = &v98;
      v37 = (IOUSBDevice *)IOUSBController::MakeDevice(*((IOUSBController **)this + 5), &v98);
    }
    v38 = v37;
    if ( v37 && v98 )
    {
      IOSleep(2LL);
      if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v36 = (void *)this;
        kernel_debug(
          0x52D1414u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          v98,
          0xDuLL,
          0LL);
      }
      v95 = v38;
      AppleUSBHubPort::ReleaseDeviceZero((uintptr_t)this);
      *((_DWORD *)this + 91) = 0;
      v39 = 33 * (unsigned int)*((_BYTE *)this + 393);
      if ( (_DWORD)v39 )
        IOSleep(v39);
      *(_DWORD *)(v5 + 364) = 0;
      v40 = *(OSMetaClassBase **)(v5 + 40);
      v41 = v98;
      v89 = *(_BYTE *)(v5 + 19);
      arg3 = *(_BYTE *)(v5 + 30);
      v92 = *(_DWORD *)(v5 + 32);
      v42 = (*(int (__fastcall **)(_QWORD, void *))(**(_QWORD **)(*(_QWORD *)(v5 + 48) + 144LL) + 2248LL))(
              *(_QWORD *)(*(_QWORD *)(v5 + 48) + 144LL),
              v36);
      v43 = *(_DWORD *)(v5 + 36);
      v45 = OSMetaClassBase::safeMetaCast(v40, *(const OSMetaClassBase **)off_1A018[0], v44);
      if ( v45 )
      {
        v4 = v95;
        v46 = (const char *)v95;
        v47 = (*(int (__fastcall **)(__int64, IOUSBDevice *, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v45 + 2640LL))(
                v45,
                v95,
                v41,
                v89,
                arg3,
                v92);
      }
      else
      {
        v4 = v95;
        v46 = (const char *)v95;
        v47 = IOUSBController::CreateDevice(v40, v95, v41, v89, arg3, v92);
      }
      v6 = off_1A070[0];
      v8 = (IOUSBController *)off_1A080[0];
      if ( v47 )
      {
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v46 = (const char *)v5;
          kernel_debug(
            0x52D1414u,
            v5,
            *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
            0LL,
            0x12uLL,
            0LL);
        }
        (*(void (__fastcall **)(IOUSBDevice *, const char *))(*(_QWORD *)v4 + 40LL))(v4, v46);
      }
      else
      {
        (*(void (__fastcall **)(IOUSBDevice *, const char *))(*(_QWORD *)v4 + 32LL))(v4, v46);
        *(_QWORD *)(v5 + 80) = v4;
        v52 = v4;
        if ( *(_BYTE *)(v5 + 406) )
        {
          *(_BYTE *)(v5 + 406) = 0;
          LODWORD(v53) = (*(int (__fastcall **)(IOUSBDevice *, _QWORD))(*(_QWORD *)v4 + 904LL))(v4, 0LL);
          v46 = v53;
          v54 = *(_DWORD *)(v5 + 36);
          v55 = *(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL);
          IOLog("The USB device %s (Port %d of Hub at 0x%x) may have caused a wake by being connected\n");
          if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v46 = (const char *)v5;
            kernel_debug(
              0x52D1414u,
              v5,
              *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
              0LL,
              0x11uLL,
              0LL);
          }
          v52 = *(IOUSBDevice **)(v5 + 80);
        }
        if ( v52 )
        {
          *(_DWORD *)(v5 + 112) = 0;
          *(_BYTE *)(v5 + 117) = 0;
          if ( *(_BYTE *)(v5 + 116) )
          {
            v46 = (const char *)1431519814;
            KernelDebugLogInternal(
              1LL,
              1431519814LL,
              "The IOUSBFamily has successfully enumerated the device (Port %d of Hub at 0x%x).",
              *(_DWORD *)(v5 + 36),
              *(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL));
            if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            {
              v46 = (const char *)v5;
              kernel_debug(
                0x52D1414u,
                v5,
                *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
                0LL,
                0x16uLL,
                0LL);
            }
            *(_BYTE *)(v5 + 116) = 0;
          }
          v56 = IORegistryEntry::getPlane("IOUSB", v46);
          if ( v56 )
          {
            (*(void (__fastcall **)(IOUSBDevice *, _QWORD, __int64))(*(_QWORD *)v4 + 856LL))(
              v4,
              *(_QWORD *)(*(_QWORD *)(v5 + 48) + 144LL),
              v56);
            goto LABEL_214;
          }
          goto LABEL_211;
        }
      }
      if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1414u,
          v5,
          *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
          0LL,
          0x13uLL,
          0LL);
      *(_BYTE *)(v5 + 103) = 1;
      v57 = 152LL;
      do
      {
        if ( *(_DWORD *)(v5 + v57) == 16 )
        {
          *(_QWORD *)(v5 + v57 - 16) = AppleUSBHubPort::DefaultResetChangeHandler;
          *(_QWORD *)(v5 + v57 - 8) = 0LL;
        }
        v57 += 24LL;
      }
      while ( v57 != 344 );
      v58 = *(_QWORD *)(v5 + 48);
      if ( !*(_BYTE *)(v58 + 426) )
      {
        v59 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v58, 1, *(_WORD *)(v5 + 36));
        if ( v59 )
        {
          if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(
              0x52D1414u,
              v5,
              *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
              v59,
              0x36uLL,
              0LL);
        }
      }
      if ( *(_BYTE *)(v5 + 100) )
      {
        if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1414u,
            v5,
            *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
            0LL,
            0x14uLL,
            0LL);
        AppleUSBHubPort::ReleaseDeviceZero(v5);
      }
      IOSleep(10LL);
      if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1414u,
          v5,
          *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
          0LL,
          0x15uLL,
          0LL);
      v9 = 0;
      AppleUSBHubPort::LaunchAddDeviceThread((AppleUSBHubPort *)v5, 0);
    }
    else
    {
      if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1414u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          v98 | ((_QWORD)v37 << 32),
          3uLL,
          0LL);
      v48 = *((_QWORD *)this + 6);
      if ( *(_BYTE *)(v48 + 426)
        || (v9 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v48, 1, *(_WORD *)(v5 + 36))) == 0 )
      {
        AppleUSBHubPort::ReleaseDeviceZero(v5);
        *(_DWORD *)(v5 + 364) = 5;
        if ( v98 == 65534 )
        {
          v49 = *(_QWORD *)(v5 + 48);
          if ( v49 )
          {
            if ( !*(_BYTE *)(v49 + 427) && *(_QWORD *)(v49 + 144) )
            {
              if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              {
                kernel_debug(
                  0x52D1414u,
                  v5,
                  *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(v49 + 296) << 32),
                  0LL,
                  0x39uLL,
                  0LL);
                v49 = *(_QWORD *)(v5 + 48);
              }
              v50 = *(_DWORD *)(v5 + 36);
              v51 = *(_DWORD *)(v49 + 296);
              IOLog("The USB stack is not able to enumerate the device at Port %d of hub at 0x%x because we have too many USB devices\n");
              (*(void (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(*(_QWORD *)(v5 + 48) + 144LL) + 2456LL))(
                *(_QWORD *)(*(_QWORD *)(v5 + 48) + 144LL),
                (*(_DWORD *)(v5 + 36) << 24) | 6u);
            }
          }
        }
        AppleUSBHubPort::DetachDevice((AppleUSBHubPort *)v5);
        v9 = -536870208;
      }
      else
      {
        if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1414u,
            v5,
            *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
            v9,
            0xCuLL,
            0LL);
        AppleUSBHubPort::FatalError((AppleUSBHubPort *)v5, (unsigned int)v9, "clearing port feature (3)");
        AppleUSBHubPort::ReleaseDeviceZero(v5);
        *(_DWORD *)(v5 + 364) = 5;
        *(_QWORD *)(v5 + 80) = 0LL;
      }
    }
    goto LABEL_209;
  }
  v9 = 0;
  if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v10 = *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32);
    v9 = 0;
    v11 = 51LL;
    goto LABEL_41;
  }
LABEL_133:
  while ( 1 )
  {
    v35 = 152LL;
    do
    {
      if ( *(_DWORD *)(v5 + v35) == 16 )
      {
        *(_QWORD *)(v5 + v35 - 16) = AppleUSBHubPort::DefaultResetChangeHandler;
        *(_QWORD *)(v5 + v35 - 8) = 0LL;
      }
      v35 += 24LL;
    }
    while ( v35 != 344 );
    if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1416u,
        v5,
        *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
        v9,
        0LL,
        0LL);
LABEL_209:
    if ( *(_QWORD *)v6 == v100 )
      return (unsigned int)v9;
LABEL_211:
    if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1414u,
        v5,
        *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
        0LL,
        2uLL,
        0LL);
LABEL_214:
    v61 = v8;
    (*(void (__fastcall **)(IOUSBDevice *, char[8], _QWORD, signed __int64))(*(_QWORD *)v4 + 640LL))(
      v4,
      "PortNum",
      *(_DWORD *)(v5 + 36),
      32LL);
    v62 = *(_QWORD *)(v5 + 48);
    if ( *(_BYTE *)(v62 + 160) )
    {
      LODWORD(v63) = (*(int (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v62 + 144) + 744LL))(
                       *(_QWORD *)(v62 + 144),
                       "PortNumberOffset");
      v64 = v63;
      if ( v63 )
      {
        (*(void (__fastcall **)(IOUSBDevice *, _QWORD, __int64))(*(_QWORD *)v4 + 616LL))(v4, "PortNumberOffset", v63);
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v64 + 40LL))(v64);
      }
    }
    (*(void (__fastcall **)(IOUSBDevice *))(*(_QWORD *)v4 + 2176LL))(v4);
    (*(void (__fastcall **)(IOUSBDevice *, _QWORD))(*(_QWORD *)v4 + 2472LL))(v4, *(_QWORD *)(v5 + 48));
    v65 = *(void (__fastcall **)(_QWORD, _QWORD))(*(_QWORD *)v4 + 2560LL);
    v66 = IOUSBDevice::GetIsochDelay(*(IOUSBDevice **)(*(_QWORD *)(v5 + 48) + 144LL));
    v65(v4, (unsigned __int16)(*(_WORD *)(*(_QWORD *)(v5 + 72) + 8LL) + v66));
    if ( !*(_BYTE *)(v5 + 101) )
    {
      v67 = (*(int (__fastcall **)(IOUSBDevice *))(*(_QWORD *)v4 + 2288LL))(v4);
      v68 = (*(int (__fastcall **)(IOUSBDevice *))(*(_QWORD *)v4 + 2296LL))(v4);
      v69 = 0;
      v70 = &dword_19FC4;
      v71 = v67;
      while ( *((_WORD *)v70 - 2) != v67 || *((_WORD *)v70 - 1) > (unsigned int)v68 || *(_WORD *)v70 < (unsigned int)v68 )
      {
        ++v69;
        v70 = (int *)((char *)v70 + 6);
        if ( v69 >= 9 )
          goto LABEL_225;
      }
    }
    v71 = (signed __int64)"non-removable";
    (*(void (__fastcall **)(IOUSBDevice *, _QWORD, _QWORD))(*(_QWORD *)v4 + 624LL))(v4, "non-removable", "yes");
LABEL_225:
    if ( *(_BYTE *)(*(_QWORD *)(v5 + 48) + 1064LL) && !*(_BYTE *)(v5 + 101) && *(_DWORD *)(v5 + 32) == 50 )
    {
      v93 = *(int (__fastcall **)(_QWORD, _QWORD, _QWORD))(off_1A050[0] + 2512);
      v96 = *(IOUSBDevice **)(off_1A050[0] + 2520);
      v72 = 2LL;
      while ( 1 )
      {
        if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1414u,
            v5,
            *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
            v72,
            0x17uLL,
            0LL);
        v73 = 1LL;
        v74 = v4;
        v75 = v93(v4, 1LL, 400LL);
        if ( (unsigned int)v75 > 0x18F )
          break;
        if ( v75 )
        {
          if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(
              0x52D1414u,
              v5,
              *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
              (unsigned int)v75,
              0x18uLL,
              0LL);
          ((void (__fastcall *)(IOUSBDevice *, signed __int64, _QWORD))v96)(v74, 1LL, (unsigned int)v75);
        }
        if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1414u,
            v5,
            *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
            0LL,
            0x19uLL,
            0LL);
        v71 = 2LL;
        v4 = v74;
        ((void (__fastcall *)(IOUSBDevice *, signed __int64, signed __int64))v96)(v74, 2LL, 400LL);
        IOSleep(100LL);
        --v72;
        if ( (signed int)v72 + 1 <= 0 )
          goto LABEL_268;
      }
      if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v73 = v5;
        kernel_debug(
          0x52D1414u,
          v5,
          *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
          (unsigned int)v75,
          0x1AuLL,
          0LL);
      }
      if ( *(_BYTE *)(v5 + 16) == 9 )
      {
        if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1414u,
            v5,
            *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
            0LL,
            0x1BuLL,
            0LL);
        v76 = (unsigned int)v75;
        v4 = v74;
        (*(void (__fastcall **)(IOUSBDevice *, _QWORD, __int64, signed __int64))(*(_QWORD *)v74 + 640LL))(
          v74,
          "HubWakePowerReserved",
          v76,
          32LL);
        goto LABEL_251;
      }
      v77 = (*(int (__fastcall **)(IOUSBDevice *, signed __int64))(*(_QWORD *)v74 + 2312LL))(v74, v73);
      arg3a = v77;
      if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1414u,
          v5,
          *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
          v77,
          0x1CuLL,
          0LL);
      if ( v77 )
      {
        v78 = 0LL;
        while ( 1 )
        {
          LODWORD(v79) = (*(int (__fastcall **)(IOUSBDevice *, _QWORD))(*(_QWORD *)v74 + 2216LL))(
                           v74,
                           (unsigned __int8)v78);
          if ( v79 )
          {
            if ( (unsigned int)*(_BYTE *)(v79 + 8) >= 0x33 )
              break;
          }
          ++v78;
          if ( (signed int)v78 >= arg3a )
            goto LABEL_260;
        }
        v4 = v74;
        if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1414u,
            v5,
            *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
            v78,
            0x1DuLL,
            0LL);
LABEL_251:
        *(_BYTE *)(v5 + 404) = 1;
        *(_DWORD *)(v5 + 32) = 250;
        IOUSBDevice::SetBusPowerAvailable(v4, 0xFAu);
      }
      else
      {
LABEL_260:
        if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1414u,
            v5,
            *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
            (unsigned int)v75,
            0x1EuLL,
            0LL);
        v80 = (unsigned int)v75;
        v4 = v74;
        ((void (__fastcall *)(IOUSBDevice *, signed __int64, __int64))v96)(v74, 1LL, v80);
      }
      if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1414u,
          v5,
          *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
          0LL,
          0x1FuLL,
          0LL);
      v71 = 4LL;
      v93(v4, 4LL, 0LL);
    }
LABEL_268:
    v81 = v97;
    v6 = off_1A070[0];
    v8 = v61;
    if ( v97 )
    {
      if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        kernel_debug(
          0x52D1414u,
          v5,
          *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
          0LL,
          0x20uLL,
          0LL);
        v81 = v97;
      }
      v71 = (signed __int64)v4;
      (*(void (__fastcall **)(__int64, IOUSBDevice *, signed __int64))(*(_QWORD *)v81 + 3184LL))(v81, v4, 1LL);
    }
    if ( *(_BYTE *)(v5 + 102) )
    {
      v82 = *(_QWORD *)(v5 + 48);
      if ( *(_BYTE *)(v82 + 426) )
      {
        if ( *(_BYTE *)(v82 + 160) )
        {
          if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            kernel_debug(
              0x52D1414u,
              v5,
              *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(v82 + 296) << 32),
              0LL,
              0x21uLL,
              0LL);
            v82 = *(_QWORD *)(v5 + 48);
          }
          v71 = 0xFFFFFFFFLL;
          IOUSBHubDevice::UpdateUnconnectedExternalPorts(*(IOUSBHubDevice **)(v82 + 144), -1);
        }
      }
    }
    v83 = *(_QWORD *)(v5 + 48);
    if ( !*(_BYTE *)(v83 + 160)
      || (unsigned __int16)(*(int (__fastcall **)(_QWORD, signed __int64, int *))(**(_QWORD **)(v83 + 144) + 2296LL))(
                             *(_QWORD *)(v83 + 144),
                             v71,
                             v70) != 32775
      || !*(_BYTE *)(*(_QWORD *)(v5 + 48) + 1080LL)
      || !*(_BYTE *)(v5 + 102)
      || (unsigned __int8)(*(int (__fastcall **)(IOUSBDevice *))(*(_QWORD *)v4 + 2256LL))(v4) != 2
      || *(_BYTE *)(v5 + 16) != 9
      || (unsigned int)*(_WORD *)(v5 + 14) > 0x2FF )
      goto LABEL_294;
    if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1414u,
        v5,
        *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
        0LL,
        0x22uLL,
        0LL);
    v84 = AppleUSBHub::SwitchMux(*(AppleUSBHub **)(v5 + 48), 0xE00040E2, (const OSMetaClass *)*(_WORD *)(v5 + 36));
    v85 = *(_DWORD *)v61 & 2;
    if ( v84 )
    {
      if ( v85 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1414u,
          v5,
          *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
          v84,
          0x23uLL,
          0LL);
LABEL_294:
      if ( *(_BYTE *)v61 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D281Cu, v5, *(_DWORD *)(v5 + 36), *(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL), 0LL, 0LL);
      (*(void (__fastcall **)(IOUSBDevice *, _QWORD, int *))(*(_QWORD *)v4 + 1456LL))(v4, 0LL, v70);
      goto LABEL_298;
    }
    if ( v85 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1414u,
        v5,
        *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
        0LL,
        0x24uLL,
        0LL);
LABEL_298:
    if ( *(_BYTE *)(v5 + 412) )
    {
      v86 = *(_WORD *)(v5 + 414);
      v87 = v86 == (unsigned __int16)(*(int (__fastcall **)(IOUSBDevice *))(*(_QWORD *)v4 + 2288LL))(v4);
      v8 = v61;
      if ( !v87
        || (v88 = *(_WORD *)(v5 + 416),
            v87 = v88 == (unsigned __int16)(*(int (__fastcall **)(IOUSBDevice *))(*(_QWORD *)v4 + 2296LL))(v4),
            v8 = v61,
            !v87) )
        *(_BYTE *)(v5 + 412) = 0;
    }
    (*(void (__fastcall **)(IOUSBDevice *))(*(_QWORD *)v4 + 40LL))(v4);
    v9 = 0;
  }
}
// C: using guessed type int;
// 19FC4: using guessed type int dword_19FC4;
// 1A018: using guessed type _QWORD off_1A018[17];
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A050: using guessed type __int64 off_1A050[10];
// 1A070: using guessed type __int64 off_1A070[6];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAB0: using guessed type int __fastcall IOLog(_QWORD);
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2BAD8: using guessed type int __fastcall PEGetModelName(_QWORD, _QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (00000000000117DC) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::DefaultResetChangeHandler(uintptr_t arg1)
{
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D145Cu,
      arg1,
      *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
      0LL,
      0LL,
      0LL);
  return 0LL;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000001182C) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::LaunchAddDeviceThreadGated(uintptr_t arg1, uintptr_t a2)
{
  signed int v2; // er14@1
  __int64 v3; // rax@3
  __int64 v4; // rax@4

  v2 = -536870174;
  if ( !*(_BYTE *)(arg1 + 418) )
  {
    v2 = 0;
    if ( !*(_BYTE *)(arg1 + 110) )
    {
      (*(void (__cdecl **)(uintptr_t))(*(_QWORD *)arg1 + 32LL))(arg1);
      LODWORD(v3) = (*(int (__cdecl **)(_QWORD))(**(_QWORD **)(arg1 + 48) + 32LL))(*(_QWORD *)(arg1 + 48));
      AppleUSBHub::RaisePowerState(*(AppleUSBHub **)(arg1 + 48), v3);
      *(_BYTE *)(arg1 + 110) = 1;
      a2 = (unsigned int)a2;
      if ( thread_call_enter1(*(_QWORD *)(arg1 + 344), (unsigned int)a2) == 1 )
      {
        v4 = off_1A080[0];
        if ( *(_BYTE *)off_1A080[0] & 2 )
        {
          v4 = off_1A098;
          if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            a2 = arg1;
            kernel_debug(
              0x52D2808u,
              arg1,
              *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
              0LL,
              0x18uLL,
              0LL);
          }
        }
        AppleUSBHub::LowerPowerState(*(AppleUSBHub **)(arg1 + 48), v4);
        (*(void (__fastcall **)(_QWORD, uintptr_t))(**(_QWORD **)(arg1 + 48) + 40LL))(*(_QWORD *)(arg1 + 48), a2);
        (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
        *(_BYTE *)(arg1 + 110) = 0;
      }
    }
  }
  return (unsigned int)v2;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2C7D8: using guessed type int __fastcall thread_call_enter1(_QWORD, _QWORD);

//----- (0000000000011906) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::CallAddDeviceResetChangeHandlerDirectly(AppleUSBHubPort *this, AppleUSBHubPort *a2, unsigned __int16 a3)
{
  unsigned __int16 v3; // r14@1
  AppleUSBHubPort *v4; // r12@1
  signed int v5; // ebx@2
  __int64 v6; // rcx@7
  __int64 v7; // r8@7
  signed int v8; // er14@7
  IOUSBController *v9; // rdi@15
  __int64 v10; // rax@16

  v3 = a3;
  v4 = this;
  if ( IOLockTryLock(*((_QWORD *)this + 46)) )
  {
LABEL_5:
    if ( !IOLockTryLock(*((_QWORD *)this + 47)) )
      IOLockLock(*((_QWORD *)this + 47), a2);
    *((_WORD *)this + 52) = 1;
    a2 = (AppleUSBHubPort *)(unsigned __int16)a2;
    v8 = AppleUSBHubPort::AddDeviceResetChangeHandler(this, (unsigned __int16)a2, (const OSMetaClass *)v3);
    if ( v8 )
    {
      if ( *((_BYTE *)this + 116) )
      {
        a2 = (AppleUSBHubPort *)1431519814;
        KernelDebugLogInternal(1LL, 1431519814LL, "The IOUSBFamily was not able to enumerate a device.", v6, v7);
        *((_BYTE *)this + 116) = 0;
        if ( *(_BYTE *)off_1A080[0] & 2 )
        {
          if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            a2 = this;
            kernel_debug(
              0x52D2808u,
              (uintptr_t)this,
              *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
              v8,
              0x17uLL,
              0LL);
          }
        }
      }
      if ( *((_BYTE *)this + 100) )
        AppleUSBHubPort::ReleaseDeviceZero((uintptr_t)this);
    }
    IOLockUnlock(*((_QWORD *)this + 46), a2);
    IOLockUnlock(*((_QWORD *)this + 47), a2);
    *((_BYTE *)this + 104) = 0;
    if ( *((_BYTE *)this + 108) )
    {
      v9 = (IOUSBController *)*((_QWORD *)this + 5);
      if ( v9 )
      {
        v10 = IOUSBController::GetCommandGate(v9);
        if ( v10 )
          (*(void (__fastcall **)(__int64, signed __int64, signed __int64))(*(_QWORD *)v10 + 488LL))(
            v10,
            (char *)v4 + 104,
            1LL);
      }
    }
  }
  else
  {
    v5 = -11;
    while ( 1 )
    {
      ++v5;
      if ( !v5 )
        break;
      IOSleep(50LL);
      if ( IOLockTryLock(*((_QWORD *)this + 46)) )
        goto LABEL_5;
    }
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "USB: Failed to obtain the _runLock for port %d of hub at locationID 0x%x within 500 ms!",
      *((_DWORD *)this + 9),
      *(_DWORD *)(*((_QWORD *)this + 6) + 296LL));
    v8 = -536870199;
  }
  return (unsigned int)v8;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BA98: using guessed type int __fastcall IOLockLock(_QWORD, _QWORD);
// 2BAA0: using guessed type int __fastcall IOLockTryLock(_QWORD);
// 2BAA8: using guessed type int __fastcall IOLockUnlock(_QWORD, _QWORD);
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000011AA8) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::Suspend(uintptr_t arg1, unsigned __int8 a2, char a3, __int64 a4, __int64 a5)
{
  unsigned __int8 v5; // r15@1
  uintptr_t v6; // rbx@1
  uintptr_t v7; // r14@1
  __int64 v8; // rax@4
  __int64 v9; // rdi@5
  OSMetaClassBase *v10; // rax@6
  __int64 v11; // rsi@6
  const OSMetaClass *v12; // rdx@6
  __int64 v13; // rax@6
  __int64 v14; // r12@6
  __int64 v15; // rdi@7
  void (__fastcall *v16)(_QWORD, _QWORD, _QWORD); // r13@8
  unsigned __int16 v17; // ax@8
  unsigned int v18; // er15@12
  __int64 v19; // r12@13
  __int64 v20; // r13@14

  v5 = a2;
  v6 = arg1;
  v7 = arg1 + 96;
  if ( a2 && *(_DWORD *)v7 == 1 )
  {
    if ( a3 )
    {
      v8 = *(_QWORD *)(arg1 + 48);
      if ( v8 )
      {
        v9 = *(_QWORD *)(v8 + 144);
        if ( v9 )
        {
          LODWORD(v10) = (*(int (__cdecl **)(__int64))(*(_QWORD *)v9 + 2264LL))(v9);
          v11 = *(_QWORD *)off_1A020[0];
          v13 = OSMetaClassBase::safeMetaCast(v10, *(const OSMetaClassBase **)off_1A020[0], v12);
          v14 = v13;
          if ( v13 )
          {
            v15 = *(_QWORD *)(v6 + 80);
            if ( v15 )
            {
              v16 = *(void (__fastcall **)(_QWORD, _QWORD, _QWORD))(*(_QWORD *)v13 + 3136LL);
              v17 = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v15 + 2248LL))(v15, v11);
              v16(v14, v17, 1LL);
            }
          }
        }
      }
    }
    else
    {
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "AppleUSBHub::Suspend - expected port to be suspended for conversion, but it is not!!",
        a4,
        a5);
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D140Cu,
          arg1,
          *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
          0LL,
          3uLL,
          0LL);
    }
  }
  *(_DWORD *)(v6 + 96) = v5 + 1;
  v18 = AppleUSBHub::SetPortFeature(*(AppleUSBHub **)(v6 + 48), 2, *(_WORD *)(v6 + 36));
  if ( !v18 )
  {
    v19 = *(_QWORD *)(v6 + 56);
    if ( v19 && (v20 = *(_QWORD *)(v6 + 64)) != 0 )
    {
      (*(void (__fastcall **)(uintptr_t, signed __int64))(*(_QWORD *)v6 + 32LL))(v6, 2LL);
      (*(void (__cdecl **)(_QWORD))(**(_QWORD **)(v6 + 48) + 32LL))(*(_QWORD *)(v6 + 48));
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v20 + 32LL))(v20);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v19 + 32LL))(v19);
      (*(void (__fastcall **)(__int64, __int64 (__fastcall *)(uintptr_t, void *, unsigned __int64), uintptr_t, signed __int64, _QWORD, _QWORD))(*(_QWORD *)v19 + 456LL))(
        v19,
        AppleUSBHubPort::WaitForSuspendCommandGated,
        v7,
        10LL,
        0LL,
        0LL);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v19 + 40LL))(v19);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v20 + 40LL))(v20);
      (*(void (__cdecl **)(_QWORD))(**(_QWORD **)(v6 + 48) + 40LL))(*(_QWORD *)(v6 + 48));
      (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)v6 + 40LL))(v6);
    }
    else
    {
      IOSleep(10LL);
    }
  }
  return v18;
}
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (0000000000011C74) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::WaitForSuspendCommandGated(uintptr_t arg1, void *a2, uintptr_t a3)
{
  uintptr_t v3; // r15@1
  signed int v4; // er14@1
  __int64 v5; // rax@2
  uintptr_t v6; // rcx@6
  uintptr_t v7; // r8@6
  int v8; // ecx@7
  uintptr_t v9; // rdx@10
  uintptr_t v10; // rsi@10
  __int64 v12; // [sp+8h] [bp-28h]@2

  v3 = a3;
  v4 = -536870210;
  if ( !*(_QWORD *)(arg1 + 56) )
    return (unsigned int)v4;
  clock_interval_to_deadline((unsigned int)a3, 1000000LL, &v12);
  LODWORD(v5) = (*(int (__fastcall **)(_QWORD, void *, __int64, signed __int64))(**(_QWORD **)(arg1 + 56) + 496LL))(
                  *(_QWORD *)(arg1 + 56),
                  a2,
                  v12,
                  2LL);
  if ( (signed int)v5 >= 0 )
  {
    v8 = v5;
    if ( (unsigned int)v5 <= 3 )
    {
      v5 = (__int64)off_11E98;
      switch ( v8 )
      {
        case 0:
          v4 = 0;
          if ( !(*(_BYTE *)off_1A080[0] & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
            return (unsigned int)v4;
          v6 = *(_QWORD *)(*(_QWORD *)(arg1 + 48) + 168LL);
          v4 = 0;
          v7 = 3LL;
          goto LABEL_24;
        case 1:
          v4 = -536870186;
          if ( !(*(_BYTE *)off_1A080[0] & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
            return (unsigned int)v4;
          v6 = *(_QWORD *)(*(_QWORD *)(arg1 + 48) + 168LL);
          v7 = 4LL;
          goto LABEL_24;
        case 2:
          v4 = -536870174;
          if ( !(*(_BYTE *)off_1A080[0] & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
            return (unsigned int)v4;
          v6 = *(_QWORD *)(*(_QWORD *)(arg1 + 48) + 168LL);
          v7 = 5LL;
          goto LABEL_24;
        case 3:
          v4 = -536870174;
          if ( !(*(_BYTE *)off_1A080[0] & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
            return (unsigned int)v4;
          v6 = *(_QWORD *)(*(_QWORD *)(arg1 + 48) + 168LL);
          v7 = 6LL;
          break;
        default:
          goto LABEL_8;
      }
      goto LABEL_24;
    }
    goto LABEL_8;
  }
  if ( (_DWORD)v5 != -536870174 )
  {
LABEL_8:
    v4 = -536870174;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v6 = *(_QWORD *)(*(_QWORD *)(arg1 + 48) + 168LL);
      v9 = (signed int)v5;
      v7 = 8LL;
      v10 = arg1;
LABEL_25:
      kernel_debug(0x52D1438u, v10, v9, v6, v7, 0LL);
      return (unsigned int)v4;
    }
    return (unsigned int)v4;
  }
  v4 = -536870174;
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v6 = *(_QWORD *)(*(_QWORD *)(arg1 + 48) + 168LL);
    v7 = 7LL;
LABEL_24:
    v10 = arg1;
    v9 = v3;
    goto LABEL_25;
  }
  return (unsigned int)v4;
}
// 11E98: using guessed type void *__ptr32 off_11E98[4];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2C768: using guessed type int __fastcall clock_interval_to_deadline(_QWORD, _QWORD, _QWORD);

//----- (0000000000011EA8) ----------------------------------------------------
__int64 __usercall AppleUSBHubPort::Resume@<rax>(uintptr_t arg1@<rdi>, __int64 a2@<rax>)
{
  uintptr_t v2; // rsi@1
  __int64 v3; // rax@1
  __int64 v4; // rdx@1
  unsigned int v5; // er14@1
  __int64 v6; // rax@2
  __int64 (__fastcall *v7)(AppleUSBHubPort *); // rcx@2
  __int64 v8; // r15@11
  __int64 v9; // r12@12
  __int64 v10; // rax@13
  signed int v11; // ebx@16
  __int64 v13; // [sp+0h] [bp-30h]@1

  v13 = a2;
  (*(void (__cdecl **)(uintptr_t))(*(_QWORD *)arg1 + 32LL))(arg1);
  (*(void (__cdecl **)(_QWORD))(**(_QWORD **)(arg1 + 48) + 32LL))(*(_QWORD *)(arg1 + 48));
  v2 = 2LL;
  v3 = AppleUSBHub::ClearPortFeature(*(AppleUSBHub **)(arg1 + 48), 2, *(_WORD *)(arg1 + 36));
  v5 = v3;
  if ( (_DWORD)v3 )
  {
    v6 = 0LL;
    v7 = AppleUSBHubPort::DefaultSuspendChangeHandler;
    do
    {
      if ( *(_DWORD *)(arg1 + v6 + 152) == 4 )
      {
        *(_QWORD *)(arg1 + v6 + 136) = AppleUSBHubPort::DefaultSuspendChangeHandler;
        *(_QWORD *)(arg1 + v6 + 144) = 0LL;
      }
      v6 += 24LL;
    }
    while ( v6 != 192 );
  }
  else
  {
    *(_BYTE *)(arg1 + 401) = 1;
    AppleUSBHub::RaisePowerState(*(AppleUSBHub **)(arg1 + 48), v3);
    if ( *(_BYTE *)(arg1 + 403) && *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v2 = arg1;
      kernel_debug(
        0x52D140Cu,
        arg1,
        *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
        0LL,
        0LL,
        0LL);
    }
    *(_BYTE *)(arg1 + 403) = 1;
    v8 = *(_QWORD *)(arg1 + 56);
    if ( v8
      && (v9 = *(_QWORD *)(arg1 + 64)) != 0
      && (v10 = *(_QWORD *)(arg1 + 48), *(_QWORD *)(v10 + 168) == 4LL)
      && *(_DWORD *)(v10 + 324) )
    {
      (*(void (__fastcall **)(_QWORD, uintptr_t))(*(_QWORD *)v9 + 32LL))(*(_QWORD *)(arg1 + 64), v2);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v8 + 32LL))(v8);
      v2 = (uintptr_t)AppleUSBHubPort::WaitForSuspendCommandGated;
      (*(void (__fastcall **)(__int64, __int64 (__fastcall *)(uintptr_t, void *, unsigned __int64), uintptr_t, signed __int64, _QWORD, _QWORD))(*(_QWORD *)v8 + 456LL))(
        v8,
        AppleUSBHubPort::WaitForSuspendCommandGated,
        arg1 + 96,
        1000LL,
        0LL,
        0LL);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v8 + 40LL))(v8);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v9 + 40LL))(v9);
    }
    else
    {
      v11 = 6;
      do
      {
        IOSleep(20LL);
        v2 = (uintptr_t)&v13;
        if ( !(unsigned int)AppleUSBHub::GetPortStatus(
                              *(AppleUSBHub **)(arg1 + 48),
                              (__int64)&v13,
                              *(_WORD *)(arg1 + 36))
          && BYTE2(v13) & 4 )
          break;
        if ( (unsigned __int8)IOService::isInactive(*(IOService **)(arg1 + 48)) )
          break;
        --v11;
      }
      while ( v11 > 0 );
    }
  }
  (*(void (__fastcall **)(_QWORD, uintptr_t, __int64, __int64 (__fastcall *)(AppleUSBHubPort *)))(**(_QWORD **)(arg1 + 48)
                                                                                                + 40LL))(
    *(_QWORD *)(arg1 + 48),
    v2,
    v4,
    v7);
  (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
  return v5;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000012060) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::DefaultSuspendChangeHandler(AppleUSBHubPort *this)
{
  return 0LL;
}

//----- (0000000000012068) ----------------------------------------------------
int __fastcall AppleUSBHubPort::MessageDeviceClients(AppleUSBHubPort *this, unsigned int a2, void *a3, __int64 a4)
{
  __int64 v4; // r14@1
  void *v5; // r15@1
  __int64 v6; // rbx@1
  int result; // eax@2

  v4 = a4;
  v5 = a3;
  v6 = *((_QWORD *)this + 10);
  if ( v6 )
  {
    (*(void (__fastcall **)(_QWORD))(*(_QWORD *)v6 + 32LL))(*((_QWORD *)this + 10));
    (*(void (__fastcall **)(__int64, _QWORD, void *, __int64))(*(_QWORD *)v6 + 1856LL))(v6, a2, v5, v4);
    result = (*(int (__fastcall **)(__int64))(*(_QWORD *)v6 + 40LL))(v6);
  }
  return result;
}

//----- (00000000000120BE) ----------------------------------------------------
__int64 __usercall AppleUSBHubPort::SuspendPort@<rax>(uintptr_t arg1@<rdi>, __int64 a2@<rax>, unsigned __int8 a3@<dl>, char a4@<sil>)
{
  unsigned __int8 v4; // r15@1
  uintptr_t v5; // r13@1
  signed int v6; // ebx@2
  signed int v8; // er14@6
  __int64 v9; // r8@9
  signed __int64 v10; // rax@9
  __int64 v11; // rax@13
  __int64 v12; // r15@16
  __int64 v13; // rdi@19
  int v14; // eax@20
  __int64 v16; // [sp+0h] [bp-30h]@1

  v16 = a2;
  v4 = a3;
  v5 = arg1;
  if ( *(_BYTE *)(arg1 + 401) )
  {
    v6 = -9;
    do
    {
      IOSleep(10LL);
      if ( !*(_BYTE *)(arg1 + 401) )
        break;
    }
    while ( v6++ != 0 );
  }
  if ( (unsigned __int8)IOService::isInactive(*(IOService **)(arg1 + 48)) )
  {
    v8 = 0;
    if ( !a4 && *(_DWORD *)(arg1 + 96) == 2 )
      *(_DWORD *)(arg1 + 96) = 3;
  }
  else
  {
    v8 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(arg1 + 48), (__int64)&v16, *(_WORD *)(arg1 + 36));
    v10 = 152LL;
    if ( !v8 )
    {
      do
      {
        if ( *(_DWORD *)(arg1 + v10) == 4 )
        {
          *(_QWORD *)(arg1 + v10 - 16) = AppleUSBHubPort::HandleSuspendPortHandler;
          *(_QWORD *)(arg1 + v10 - 8) = 0LL;
        }
        v10 += 24LL;
      }
      while ( v10 != 344 );
      v11 = v16 & 4;
      if ( a4 )
      {
        v8 = AppleUSBHubPort::Suspend(arg1, v4, (_WORD)v11 != 0, (__int64)AppleUSBHubPort::HandleSuspendPortHandler, v9);
        if ( AppleUSBHubPort::HasExpressCardCantWake((AppleUSBHubPort *)arg1) || *(_BYTE *)(arg1 + 412) )
        {
          v12 = off_1A080[0];
          if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(
              0x52D140Cu,
              arg1,
              *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
              *(_QWORD *)(arg1 + 80),
              1uLL,
              0LL);
          v13 = *(_QWORD *)(arg1 + 48);
          if ( !*(_BYTE *)(v13 + 426) )
          {
            v14 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v13, 1, *(_WORD *)(v5 + 36));
            if ( v14 )
            {
              if ( *(_BYTE *)v12 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                kernel_debug(
                  0x52D140Cu,
                  v5,
                  *(_DWORD *)(v5 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v5 + 48) + 296LL) << 32),
                  v14,
                  2uLL,
                  0LL);
            }
          }
        }
      }
      else
      {
        v8 = -536854457;
        if ( (_WORD)v11 )
          v8 = AppleUSBHubPort::Resume(arg1, v11);
      }
    }
  }
  return (unsigned int)v8;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000012298) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::HandleSuspendPortHandler(uintptr_t arg1, __int64 a2, char a3)
{
  char v3; // r15@1
  uintptr_t v4; // rbx@1
  char v5; // r12@1
  signed __int64 v6; // rax@1
  __int64 v7; // rax@5
  __int64 v8; // r8@5
  int v9; // eax@8
  __int64 v10; // r15@17
  __int64 v11; // rdi@17
  __int64 v12; // rdi@19
  __int64 v13; // rax@20
  char v14[8]; // rsi@20
  __int64 v15; // rdx@22
  __int64 v16; // rcx@22
  __int64 v17; // r15@23
  __int64 v19; // [sp+0h] [bp-40h]@16
  unsigned int v20; // [sp+Ch] [bp-34h]@1
  unsigned __int64 v21; // [sp+10h] [bp-30h]@17
  unsigned __int64 v22; // [sp+18h] [bp-28h]@17

  v3 = a3;
  v4 = arg1;
  v20 = 0;
  v5 = *(_BYTE *)(arg1 + 401);
  v6 = 152LL;
  do
  {
    if ( *(_DWORD *)(arg1 + v6) == 4 )
    {
      *(_QWORD *)(arg1 + v6 - 16) = AppleUSBHubPort::DefaultSuspendChangeHandler;
      *(_QWORD *)(arg1 + v6 - 8) = 0LL;
    }
    v6 += 24LL;
  }
  while ( v6 != 344 );
  LODWORD(v7) = IOSleep(10LL);
  if ( *(_BYTE *)(arg1 + 401) )
  {
    *(_BYTE *)(arg1 + 401) = 0;
    if ( *(_BYTE *)(arg1 + 403) )
    {
      *(_BYTE *)(arg1 + 403) = 0;
      AppleUSBHub::LowerPowerState(*(AppleUSBHub **)(arg1 + 48), v7);
    }
  }
  v9 = *(_DWORD *)(arg1 + 96);
  if ( v9 == 1 )
  {
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "AppleUSBHub::HandleSuspendPortHandler - port(%d) in portPMState(usbHPPMS_pm_suspended) - should not be here!",
      *(_DWORD *)(arg1 + 36),
      v8);
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D140Cu,
        arg1,
        *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
        0LL,
        4uLL,
        0LL);
  }
  else if ( v9 == 2 && v3 & 1 )
  {
    if ( !v5 && !*(_BYTE *)(arg1 + 407) )
    {
      absolutetime_to_nanoseconds(*(_QWORD *)(*(_QWORD *)(arg1 + 48) + 1024LL), &v19);
      if ( v19 )
      {
        v10 = *(_QWORD *)(arg1 + 48);
        v21 = 0LL;
        clock_get_uptime(&v22);
        v11 = v22 - *(_QWORD *)(v10 + 1024);
        if ( v22 <= *(_QWORD *)(v10 + 1024)
          || (v22 -= *(_QWORD *)(v10 + 1024), absolutetime_to_nanoseconds(v11, &v21), v21 <= 0x3B9AC9FF) )
        {
          v12 = *(_QWORD *)(v4 + 80);
          if ( v12 )
          {
            LODWORD(v13) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v12 + 904LL))(v12, 0LL);
            *(_QWORD *)v14 = v13;
          }
          else
          {
            *(_QWORD *)v14 = "Unknown";
          }
          v15 = *(_DWORD *)(v4 + 36);
          v16 = *(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL);
          IOLog("The USB device %s (Port %d of Hub at 0x%x) may have caused a wake by issuing a remote wakeup (1)\n");
          (*(void (__fastcall **)(_QWORD, char[8]))(**(_QWORD **)(v4 + 80) + 32LL))(
            *(_QWORD *)(v4 + 80),
            *(_QWORD *)v14);
          (*(void (__fastcall **)(_QWORD, signed __int64, _QWORD, _QWORD))(**(_QWORD **)(v4 + 80) + 1856LL))(
            *(_QWORD *)(v4 + 80),
            3758097232LL,
            0LL,
            0LL);
          (*(void (**)(void))(**(_QWORD **)(v4 + 80) + 40LL))();
        }
      }
    }
    v17 = *(_QWORD *)(v4 + 80);
    if ( v17 )
    {
      (*(void (__fastcall **)(_QWORD))(*(_QWORD *)v17 + 32LL))(*(_QWORD *)(v4 + 80));
      (*(void (__fastcall **)(__int64, signed __int64, int *, signed __int64))(*(_QWORD *)v17 + 1856LL))(
        v17,
        3758112779LL,
        &v20,
        4LL);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v17 + 40LL))(v17);
    }
  }
  *(_DWORD *)(v4 + 96) = 3;
  AppleUSBHubPort::WakeSuspendCommand(v4, (void *)(v4 + 96));
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D140Cu,
      v4,
      *(_DWORD *)(v4 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v4 + 48) + 296LL) << 32),
      (signed int)v20,
      5uLL,
      0LL);
  return v20;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAB0: using guessed type int __fastcall IOLog(_QWORD);
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2C750: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);
// 2C760: using guessed type int __fastcall clock_get_uptime(_QWORD);

//----- (000000000001251E) ----------------------------------------------------
bool __fastcall AppleUSBHubPort::HasExpressCardCantWake(AppleUSBHubPort *this)
{
  AppleUSBHubPort *v1; // rax@1
  __int64 v2; // rdi@1
  __int64 v3; // rcx@2
  __int64 v4; // rax@4
  bool result; // al@4

  v1 = this;
  v2 = *((_QWORD *)this + 10);
  if ( v2 && (v3 = *((_QWORD *)v1 + 6), *(_BYTE *)(v3 + 1057)) && *(_DWORD *)(v3 + 1060) == *((_DWORD *)v1 + 9) )
  {
    LODWORD(v4) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v2 + 696LL))(v2, "ExpressCardCantWake");
    result = v4 == **(_QWORD **)off_1A090[0];
  }
  else
  {
    result = 0;
  }
  return result;
}
// 1A090: using guessed type __int64 off_1A090[2];

//----- (000000000001256C) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::ReEnumeratePort(AppleUSBHubPort *this, __int64 a2)
{
  signed int v2; // er14@1
  const OSMetaClass *v3; // rdx@2

  v2 = -536870174;
  if ( !*((_BYTE *)this + 418) )
  {
    (*(void (__cdecl **)(AppleUSBHubPort *))(*(_QWORD *)this + 32LL))(this);
    *((_BYTE *)this + 400) = (unsigned int)a2 >> 31;
    if ( a2 & 1 )
    {
      a2 = *((_DWORD *)this + 9);
      if ( AppleUSBHub::GetHubPortErrataBits(*((AppleUSBHub **)this + 6), a2) & 8 )
        return AppleUSBHubPort::PowerCycleDeviceAttachedToThisPort((uintptr_t)this);
    }
    AppleUSBHubPort::RemoveDevice(this, a2, v3);
    if ( *((_BYTE *)this + 418) )
    {
      (*(void (__fastcall **)(AppleUSBHubPort *))(*(_QWORD *)this + 40LL))(this);
    }
    else
    {
      *((_DWORD *)this + 24) = 3;
      AppleUSBHubPort::LaunchAddDeviceThread(this, 2u);
      (*(void (__fastcall **)(AppleUSBHubPort *, signed __int64))(*(_QWORD *)this + 40LL))(this, 2LL);
      v2 = 0;
    }
  }
  return (unsigned int)v2;
}

//----- (0000000000012612) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::ClearTT(AppleUSBHubPort *this, char a2, unsigned int a3)
{
  int v3; // er15@1
  int v4; // ebx@1
  signed __int16 v5; // ax@1
  __int64 result; // rax@3
  char v7; // [sp+0h] [bp-30h]@3
  char v8; // [sp+1h] [bp-2Fh]@3
  __int16 v9; // [sp+2h] [bp-2Eh]@3
  __int16 v10; // [sp+4h] [bp-2Ch]@3
  __int16 v11; // [sp+6h] [bp-2Ah]@3
  __int64 v12; // [sp+8h] [bp-28h]@3
  int v13; // [sp+10h] [bp-20h]@3

  v3 = (unsigned __int8)(a3 >> 16);
  v4 = (a3 >> 5) & 0x1800 | (a3 >> 8) & 0xF | 16 * (a3 & 0x7F) | (a3 >> 9) & 0x8000;
  v5 = 1;
  if ( a2 )
    v5 = *((_WORD *)this + 18);
  v7 = 35;
  v8 = 8;
  v9 = (a3 >> 5) & 0x1800 | (a3 >> 8) & 0xF | 16 * (a3 & 0x7F) | (a3 >> 9) & 0x8000;
  v10 = v5;
  v11 = 0;
  v12 = 0LL;
  v13 = 0;
  result = AppleUSBHub::DoDeviceRequestWithRetries(*((AppleUSBHub **)this + 6), (__int64)&v7, 0);
  if ( !((unsigned int)result | v3) )
  {
    v9 = v4 ^ 0x8000;
    result = AppleUSBHub::DoDeviceRequestWithRetries(*((AppleUSBHub **)this + 6), (__int64)&v7, 0);
  }
  return result;
}

//----- (00000000000126C0) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::ResetPort(AppleUSBHubPort *this, AppleUSBHubPort *a2)
{
  uintptr_t v2; // rbx@1
  __int64 v3; // r14@1
  __int16 *v4; // rsi@8
  __int64 v5; // rdi@8
  char v6; // cl@8
  int v7; // ecx@11
  signed int v8; // eax@11
  bool v9; // dl@13
  signed int v10; // er12@13
  char v11; // al@16
  __int64 v12; // rcx@16
  __int64 v13; // rdi@20
  __int16 v14; // ax@20
  unsigned int v15; // eax@22
  __int64 v16; // rcx@22
  int v17; // eax@37
  bool v18; // zf@39
  __int64 v19; // r14@45
  char v21; // [sp+Ch] [bp-34h]@5
  unsigned __int16 v22; // [sp+10h] [bp-30h]@8
  unsigned int v23; // [sp+14h] [bp-2Ch]@1

  v2 = (uintptr_t)this;
  v23 = 0;
  v3 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    a2 = this;
    kernel_debug(
      0x52D1451u,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      0LL,
      0LL,
      0LL);
  }
  if ( AppleUSBHubPort::ShouldApplyDisconnectWorkaround(this) )
  {
    IOSleep(500LL);
    v21 = 1;
  }
  else
  {
    v21 = 0;
  }
  if ( IOLockTryLock(*((_QWORD *)this + 46)) )
  {
    IOLockUnlock(*((_QWORD *)this + 46), a2);
    v4 = (__int16 *)&v22;
    v23 = AppleUSBHub::GetPortStatus(*((AppleUSBHub **)this + 6), (__int64)&v22, *((_WORD *)this + 18));
    v5 = *((_QWORD *)this + 6);
    v6 = 0;
    if ( *(_BYTE *)(v5 + 426) )
    {
      v6 = *(_BYTE *)(v5 + 426);
      if ( (((unsigned int)v22 >> 5) & 7 | ((unsigned int)v22 >> 11) & 8) == 3 )
      {
        v4 = (_WORD *)(&dword_10 + 2);
        AppleUSBHub::ClearPortFeature((AppleUSBHub *)v5, 18, *(_WORD *)(v2 + 36));
        v6 = *(_BYTE *)(*(_QWORD *)(v2 + 48) + 426LL);
      }
    }
    v23 = -536870187;
    v7 = 2 * (v6 != 0) + 4;
    v8 = -536870187;
LABEL_13:
    v9 = v8 != 0;
    v10 = v7;
    while ( 1 )
    {
      if ( v10 <= 0 || !v9 )
      {
        if ( v9 )
        {
          v19 = *(_QWORD *)(v2 + 80);
          if ( v19 )
          {
            (*(void (__fastcall **)(_QWORD, __int16 *))(*(_QWORD *)v19 + 32LL))(*(_QWORD *)(v2 + 80), v4);
            (*(void (__fastcall **)(__int64, signed __int64, __int64, int *))(*(_QWORD *)v19 + 1840LL))(
              v19,
              3758112778LL,
              v19,
              &v23);
            (*(void (__fastcall **)(__int64))(*(_QWORD *)v19 + 40LL))(v19);
            v8 = v23;
          }
        }
        v3 = off_1A080[0];
        if ( v8
          && !(unsigned int)AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(v2 + 48), (__int64)&v22, *(_WORD *)(v2 + 36))
          && v22 & 1 )
          AppleUSBHubPort::LaunchAddDeviceThread((AppleUSBHubPort *)v2, 1u);
        goto LABEL_55;
      }
      --v10;
      v11 = AppleUSBHubPort::AcquireDeviceZero(v2);
      *(_BYTE *)(v2 + 100) = v11;
      v12 = 0LL;
      if ( v11 )
      {
        do
        {
          if ( *(_DWORD *)(v2 + v12 + 152) == 16 )
          {
            *(_QWORD *)(v2 + v12 + 136) = AppleUSBHubPort::HandleResetPortHandler;
            *(_QWORD *)(v2 + v12 + 144) = 0LL;
          }
          v12 += 24LL;
        }
        while ( v12 != 192 );
        v13 = *(_QWORD *)(v2 + 48);
        v14 = 4;
        if ( *(_BYTE *)(v13 + 426) != 0 && v10 > 2 )
          v14 = 28;
        v4 = (__int16 *)(unsigned __int16)v14;
        v15 = AppleUSBHub::SetPortFeature((AppleUSBHub *)v13, v14, *(_WORD *)(v2 + 36));
        v23 = v15;
        v16 = 0LL;
        if ( v15 )
        {
          do
          {
            if ( *(_DWORD *)(v2 + v16 + 152) == 16 )
            {
              *(_QWORD *)(v2 + v16 + 136) = AppleUSBHubPort::DefaultResetChangeHandler;
              *(_QWORD *)(v2 + v16 + 144) = 0LL;
            }
            v16 += 24LL;
          }
          while ( v16 != 192 );
        }
        else
        {
          if ( !v21 )
            goto LABEL_34;
          IOSleep(100LL);
          v15 = v23;
        }
        if ( !v15 )
        {
LABEL_34:
          *(_BYTE *)(v2 + 402) = 1;
          IOUSBController::WaitForReleaseDeviceZero(*(IOUSBController **)(v2 + 40));
          if ( *(_BYTE *)(v2 + 402) )
          {
            v23 = -536870187;
            *(_BYTE *)(v2 + 402) = 0;
          }
          goto LABEL_36;
        }
        v11 = *(_BYTE *)(v2 + 100);
      }
      else
      {
        v23 = -536870196;
      }
      if ( v11 )
        AppleUSBHubPort::ReleaseDeviceZero(v2);
LABEL_36:
      v8 = 0;
      v9 = 0;
      if ( v23 )
      {
        v4 = (__int16 *)&v22;
        v17 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(v2 + 48), (__int64)&v22, *(_WORD *)(v2 + 36));
        v7 = 0;
        if ( !v17 )
        {
          if ( *(_BYTE *)(*(_QWORD *)(v2 + 48) + 426LL) )
            v18 = (((unsigned __int8)v22 >> 5) | ((unsigned int)v22 >> 11) & 8) == 5;
          else
            v18 = (v22 & 1) == 0;
          if ( v18 )
            v10 = 0;
          v7 = v10;
        }
        v8 = v23;
        goto LABEL_13;
      }
    }
  }
  if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1450u,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      0LL,
      0LL,
      0LL);
  *((_BYTE *)this + 103) = 1;
  v23 = -536870187;
LABEL_55:
  if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1452u,
      v2,
      *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
      (signed int)v23,
      0LL,
      0LL);
  return v23;
}
// 10: using guessed type int dword_10;
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAA0: using guessed type int __fastcall IOLockTryLock(_QWORD);
// 2BAA8: using guessed type int __fastcall IOLockUnlock(_QWORD, _QWORD);
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000012A80) ----------------------------------------------------
bool __fastcall AppleUSBHubPort::ShouldApplyDisconnectWorkaround(AppleUSBHubPort *this)
{
  AppleUSBHubPort *v1; // rbx@1
  unsigned __int64 v2; // rcx@2
  __int64 v3; // rdi@3
  bool result; // al@3
  __int64 v5; // rax@5
  __int64 v6; // rcx@5
  OSMetaClassBase *v7; // rax@7
  __int64 v8; // rsi@7
  const OSMetaClass *v9; // rdx@7
  __int64 v10; // rax@7
  __int64 v11; // [sp+0h] [bp-20h]@1
  unsigned __int64 v12; // [sp+8h] [bp-18h]@2
  __int64 v13; // [sp+10h] [bp-10h]@2

  v1 = this;
  absolutetime_to_nanoseconds(*(_QWORD *)(*((_QWORD *)this + 6) + 1024LL), &v11);
  if ( !v11 )
    return 0;
  clock_get_uptime(&v13);
  v13 -= *(_QWORD *)(*((_QWORD *)this + 6) + 1024LL);
  absolutetime_to_nanoseconds(v13, &v12);
  v2 = v12;
  v12 = 4835703278458516699LL * v12 >> 64 >> 18;
  if ( !*(_BYTE *)(*((_QWORD *)this + 6) + 1040LL) )
    return 0;
  v3 = *((_QWORD *)this + 10);
  result = 0;
  if ( v3 )
  {
    if ( v2 >> 11 <= 0x1DCD64 )
    {
      LODWORD(v5) = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v3 + 696LL))(v3, "kHasMSCInterface");
      v6 = v5;
      result = 1;
      if ( v6 != **(_QWORD **)off_1A090[0] && !*(_BYTE *)(*((_QWORD *)v1 + 6) + 160LL) )
      {
        LODWORD(v7) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)v1 + 10) + 696LL))(
                        *((_QWORD *)v1 + 10),
                        "bDeviceClass");
        v8 = *(_QWORD *)off_1A030[0];
        v10 = OSMetaClassBase::safeMetaCast(v7, *(const OSMetaClassBase **)off_1A030[0], v9);
        if ( v10 )
          return (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v10 + 328LL))(v10, v8) == 9;
        return 0;
      }
    }
  }
  return result;
}
// 1A030: using guessed type _QWORD off_1A030[14];
// 1A090: using guessed type __int64 off_1A090[2];
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);
// 2C750: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);
// 2C760: using guessed type int __fastcall clock_get_uptime(_QWORD);

//----- (0000000000012B8E) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::HandleResetPortHandler(AppleUSBHubPort *this, signed __int64 a2, __int64 a3, __int64 (__fastcall *a4)(uintptr_t arg1), __int64 a5)
{
  char v5; // r14@1
  uintptr_t v6; // rbx@1
  __int64 v7; // r13@1
  signed __int64 v8; // rax@1
  unsigned __int64 v9; // rcx@3
  __int64 v10; // rax@10
  __int64 v11; // rax@12
  signed __int64 v12; // rdi@22
  __int16 v13; // ax@24
  char v14; // r15@25
  char v15; // r12@25
  IOUSBController *v16; // r14@32
  unsigned __int16 v17; // ax@32
  __int64 v18; // rdi@33
  unsigned int v19; // eax@34
  __int64 v20; // rdi@43
  IOUSBController *v21; // r14@44
  unsigned __int16 v22; // ax@44
  signed __int64 v23; // rsi@44
  const OSMetaClass *v24; // rdx@44
  __int64 v25; // r14@46
  __int64 v26; // r15@46
  unsigned __int16 v27; // ax@46
  __int64 v28; // rdi@48
  int v29; // eax@49
  __int64 v30; // r14@53
  __int64 v31; // rbx@62
  __int64 v32; // r14@64
  unsigned int v33; // er15@65
  unsigned __int16 v34; // r12@66
  void (__fastcall *v35)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD); // ST08_8@67
  unsigned int v36; // ST04_4@67
  unsigned __int16 v37; // ax@67
  __int64 v38; // rdi@72
  __int64 v39; // rdi@87
  int v40; // eax@88
  __int64 v41; // r14@95
  signed __int64 v42; // rax@95
  unsigned __int16 v44; // [sp+12h] [bp-2Eh]@65
  int v45; // [sp+14h] [bp-2Ch]@1

  v5 = a2;
  v6 = (uintptr_t)this;
  v45 = 0;
  v7 = off_1A080[0];
  v8 = 152LL;
  if ( *(_BYTE *)off_1A080[0] & 2 )
  {
    a4 = (__int64 (__fastcall *)(uintptr_t))off_1A098;
    v8 = 152LL;
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v9 = (unsigned __int16)a3 | ((unsigned __int64)(unsigned __int16)a2 << 16);
      a2 = (signed __int64)this;
      kernel_debug(
        0x52D1419u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        v9,
        *((_BYTE *)this + 100),
        0LL);
      v8 = 152LL;
    }
  }
  do
  {
    if ( *(_DWORD *)((char *)this + v8) == 16 )
    {
      a4 = AppleUSBHubPort::DefaultResetChangeHandler;
      *(_QWORD *)((char *)this + v8 - 16) = AppleUSBHubPort::DefaultResetChangeHandler;
      *(_QWORD *)((char *)this + v8 - 8) = 0LL;
    }
    v8 += 24LL;
  }
  while ( v8 != 344 );
  *((_WORD *)this + 213) = 0;
  if ( *((_BYTE *)this + 400) )
  {
    IOSleep(100LL);
    *((_BYTE *)this + 400) = 0;
  }
  if ( *((_DWORD *)this + 91) != 3 )
  {
    v10 = *((_QWORD *)this + 6);
    if ( !*(_BYTE *)(v10 + 426) && *((_BYTE *)this + 360) & 0x10 )
    {
      v11 = 0LL;
      a4 = (__int64 (__fastcall *)(uintptr_t))AppleUSBHubPort::HandleResetPortHandler;
      do
      {
        if ( *(_DWORD *)((char *)this + v11 + 152) == 16 )
        {
          *(_QWORD *)((char *)this + v11 + 136) = AppleUSBHubPort::HandleResetPortHandler;
          *(_QWORD *)((char *)this + v11 + 144) = 0LL;
        }
        v11 += 24LL;
      }
      while ( v11 != 192 );
      *((_BYTE *)this + 402) = 0;
      v45 = 0;
LABEL_95:
      v41 = *(_QWORD *)(v6 + 80);
      v42 = 152LL;
      if ( !v41 )
      {
        do
        {
LABEL_98:
          if ( *(_DWORD *)(v6 + v42) == 16 )
          {
            *(_QWORD *)(v6 + v42 - 16) = AppleUSBHubPort::DefaultResetChangeHandler;
            *(_QWORD *)(v6 + v42 - 8) = 0LL;
          }
          v42 += 24LL;
        }
        while ( v42 != 344 );
        if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D141Au,
            v6,
            *(_DWORD *)(v6 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v6 + 48) + 296LL) << 32),
            v45,
            0LL,
            0LL);
        return (unsigned int)v45;
      }
      (*(void (__fastcall **)(_QWORD, signed __int64, __int64, __int64 (__fastcall *)(uintptr_t), __int64))(*(_QWORD *)v41 + 32LL))(
        *(_QWORD *)(v6 + 80),
        a2,
        a3,
        a4,
        a5);
      (*(void (__fastcall **)(__int64, signed __int64, __int64, int *))(*(_QWORD *)v41 + 1840LL))(
        v41,
        3758112778LL,
        v41,
        &v45);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v41 + 40LL))(v41);
LABEL_97:
      v42 = 152LL;
      goto LABEL_98;
    }
    if ( v5 & 1 )
    {
      if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        a2 = (signed __int64)this;
        kernel_debug(
          0x52D1418u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(v10 + 296) << 32),
          0LL,
          4uLL,
          0LL);
      }
      *((_BYTE *)this + 402) = 0;
      v45 = 0;
      AppleUSBHubPort::ReleaseDeviceZero((uintptr_t)this);
      *((_DWORD *)this + 91) = 3;
LABEL_85:
      if ( v45 && *(_BYTE *)(v6 + 100) )
      {
        v39 = *(_QWORD *)(v6 + 48);
        if ( !*(_BYTE *)(v39 + 426) )
        {
          a2 = 1LL;
          v40 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v39, 1, *(_WORD *)(v6 + 36));
          if ( *(_BYTE *)v7 & 2 )
          {
            if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            {
              a2 = v6;
              kernel_debug(
                0x52D1418u,
                v6,
                *(_DWORD *)(v6 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v6 + 48) + 296LL) << 32),
                v40,
                0xDuLL,
                0LL);
            }
          }
        }
        *(_BYTE *)(v6 + 402) = 1;
        if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          a2 = v6;
          kernel_debug(
            0x52D1418u,
            v6,
            *(_DWORD *)(v6 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v6 + 48) + 296LL) << 32),
            v45,
            0xAuLL,
            0LL);
        }
        AppleUSBHubPort::ReleaseDeviceZero(v6);
      }
      goto LABEL_95;
    }
    v12 = 300LL;
    if ( !*(_BYTE *)(v6 + 392) )
      v12 = 10LL;
    IOSleep(v12);
    v13 = *(_WORD *)(v6 + 360);
    if ( HIBYTE(v13) & 2 )
    {
      *(_BYTE *)(v6 + 30) = 0;
      v14 = 8;
      v15 = 0;
    }
    else if ( HIBYTE(v13) & 4 )
    {
      *(_BYTE *)(v6 + 30) = 2;
      v14 = 64;
      v15 = 2;
    }
    else if ( *(_BYTE *)(*(_QWORD *)(v6 + 48) + 426LL) && *(_WORD *)(v6 + 360) & 0x2000 )
    {
      *(_BYTE *)(v6 + 30) = 3;
      v14 = 9;
      v15 = 3;
    }
    else
    {
      *(_BYTE *)(v6 + 30) = 1;
      v14 = 8;
      v15 = 1;
    }
    v16 = *(IOUSBController **)(v6 + 40);
    v17 = (*(int (**)(void))(**(_QWORD **)(*(_QWORD *)(v6 + 48) + 144LL) + 2248LL))();
    a2 = (unsigned __int8)v14;
    DoConfigureDeviceZero(v16, v14, (const OSMetaClass *)(unsigned __int8)v15, v17, *(_DWORD *)(v6 + 36));
    *(_BYTE *)(v6 + 392) = 1;
    v45 = AppleUSBHubPort::GetDevZeroDescriptorWithRetries(v6);
    if ( v45 )
    {
      *(_BYTE *)(v6 + 392) = 1;
      *(_DWORD *)(v6 + 364) = 3;
      v18 = *(_QWORD *)(v6 + 48);
      if ( *(_BYTE *)(v18 + 426)
        || (v19 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v18, 1, *(_WORD *)(v6 + 36)), (v45 = v19) == 0) )
      {
        if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1418u,
            v6,
            *(_DWORD *)(v6 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v6 + 48) + 296LL) << 32),
            0LL,
            5uLL,
            0LL);
        AppleUSBHubPort::ReleaseDeviceZero(v6);
        *(_DWORD *)(v6 + 364) = 5;
      }
      else
      {
        if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          kernel_debug(0x52D1418u, v6, *(_DWORD *)(v6 + 36), (signed int)v19, 1uLL, 0LL);
          v19 = v45;
        }
        AppleUSBHubPort::FatalError((AppleUSBHubPort *)v6, v19, "clearing port feature (4)");
        AppleUSBHubPort::ReleaseDeviceZero(v6);
        *(_QWORD *)(v6 + 80) = 0LL;
      }
      return (unsigned int)v45;
    }
  }
  if ( *(_BYTE *)(v6 + 393) )
    IOSleep(33 * (unsigned int)*(_BYTE *)(v6 + 393));
  if ( !v45 )
    *(_BYTE *)(v6 + 392) = 0;
  *(_DWORD *)(v6 + 364) = 4;
  v20 = *(_QWORD *)(v6 + 80);
  if ( !v20 )
  {
LABEL_72:
    v38 = 33 * (unsigned int)*(_BYTE *)(v6 + 393);
    if ( (_DWORD)v38 )
      IOSleep(v38);
    *(_DWORD *)(v6 + 364) = 0;
    if ( !*(_QWORD *)(v6 + 80) && *(_BYTE *)(v6 + 100) )
    {
      *(_BYTE *)(v6 + 402) = 1;
      if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        a2 = v6;
        kernel_debug(
          0x52D1418u,
          v6,
          *(_DWORD *)(v6 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v6 + 48) + 296LL) << 32),
          0LL,
          9uLL,
          0LL);
      }
      AppleUSBHubPort::ReleaseDeviceZero(v6);
    }
    *(_DWORD *)(v6 + 112) = 0;
    *(_BYTE *)(v6 + 117) = 0;
    if ( *(_BYTE *)(v6 + 116) )
    {
      a2 = 1431519814LL;
      KernelDebugLogInternal(1LL, 1431519814LL, "The IOUSBFamily has successfully enumerated the device.", a4, a5);
      if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        a2 = v6;
        kernel_debug(
          0x52D1418u,
          v6,
          *(_DWORD *)(v6 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v6 + 48) + 296LL) << 32),
          0LL,
          0xBuLL,
          0LL);
      }
      *(_BYTE *)(v6 + 116) = 0;
    }
    goto LABEL_85;
  }
  v21 = *(IOUSBController **)(v6 + 40);
  v22 = (*(int (__fastcall **)(__int64, signed __int64, __int64, __int64 (__fastcall *)(uintptr_t), __int64))(*(_QWORD *)v20 + 2248LL))(
          v20,
          a2,
          a3,
          a4,
          a5);
  v23 = v22;
  v45 = IOUSBController::SetDeviceZeroAddress(v21, v22);
  if ( !v45 )
  {
    a2 = *(_QWORD *)off_1A020[0];
    v32 = OSMetaClassBase::safeMetaCast(*(OSMetaClassBase **)(v6 + 40), *(const OSMetaClassBase **)off_1A020[0], v24);
    if ( v32 )
    {
      v44 = 0;
      LOWORD(v33) = (*(int (__fastcall **)(_QWORD, signed __int64))(**(_QWORD **)(v6 + 80) + 2248LL))(
                      *(_QWORD *)(v6 + 80),
                      a2);
      a2 = (unsigned __int16)v33;
      if ( !(*(int (__fastcall **)(__int64, _QWORD, __int16 *))(*(_QWORD *)v32 + 3304LL))(
              v32,
              (unsigned __int16)v33,
              &v44) )
      {
        a2 = v44;
        (*(void (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v6 + 80) + 2552LL))(*(_QWORD *)(v6 + 80), v44);
        v34 = v44;
        v33 = (unsigned __int16)v33;
        if ( (unsigned __int16)v33 != v44 )
        {
          v35 = *(void (__fastcall **)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v32 + 2896LL);
          v36 = *(_BYTE *)(v6 + 30);
          v37 = (*(int (**)(void))(**(_QWORD **)(*(_QWORD *)(v6 + 48) + 144LL) + 2248LL))();
          a2 = v33;
          v35(v32, v33, v34, v36, v37, *(_DWORD *)(v6 + 36));
        }
      }
    }
    IOSleep(2LL);
    if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      a2 = v6;
      kernel_debug(
        0x52D1418u,
        v6,
        *(_DWORD *)(v6 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v6 + 48) + 296LL) << 32),
        0LL,
        7uLL,
        0LL);
    }
    *(_BYTE *)(v6 + 402) = 0;
    AppleUSBHubPort::ReleaseDeviceZero(v6);
    *(_DWORD *)(v6 + 364) = 0;
    goto LABEL_72;
  }
  if ( *(_BYTE *)v7 & 2 )
  {
    v25 = *(_DWORD *)(*(_QWORD *)(v6 + 48) + 296LL);
    v26 = *(_DWORD *)(v6 + 36);
    v27 = (*(int (__fastcall **)(_QWORD, signed __int64))(**(_QWORD **)(v6 + 80) + 2248LL))(*(_QWORD *)(v6 + 80), v23);
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v23 = v6;
      kernel_debug(0x52D1418u, v6, v26 | (v25 << 32), v27, 0LL, 0LL);
    }
  }
  v28 = *(_QWORD *)(v6 + 48);
  if ( !*(_BYTE *)(v28 + 426) )
  {
    v23 = 1LL;
    v29 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v28, 1, *(_WORD *)(v6 + 36));
    v45 = v29;
    if ( v29 )
    {
      if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v23 = v6;
        kernel_debug(
          0x52D1418u,
          v6,
          *(_DWORD *)(v6 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v6 + 48) + 296LL) << 32),
          v29,
          2uLL,
          0LL);
      }
      AppleUSBHubPort::ReleaseDeviceZero(v6);
      *(_DWORD *)(v6 + 364) = 5;
      v30 = *(_QWORD *)(v6 + 80);
      if ( v30 )
      {
        if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v23 = v6;
          kernel_debug(
            0x52D1418u,
            v6,
            *(_DWORD *)(v6 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v6 + 48) + 296LL) << 32),
            *(_QWORD *)(v6 + 80),
            3uLL,
            0LL);
        }
        (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v30 + 32LL))(v30, v23);
        (*(void (__fastcall **)(__int64, signed __int64, __int64, int *))(*(_QWORD *)v30 + 1840LL))(
          v30,
          3758112778LL,
          v30,
          &v45);
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v30 + 40LL))(v30);
      }
      AppleUSBHubPort::FatalError((AppleUSBHubPort *)v6, (unsigned int)v45, "clearing port feature (5)");
      goto LABEL_97;
    }
  }
  if ( *(_BYTE *)v7 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v23 = v6;
    kernel_debug(
      0x52D1418u,
      v6,
      *(_DWORD *)(v6 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v6 + 48) + 296LL) << 32),
      0LL,
      6uLL,
      0LL);
  }
  AppleUSBHubPort::ReleaseDeviceZero(v6);
  *(_DWORD *)(v6 + 364) = 5;
  v31 = *(_QWORD *)(v6 + 80);
  if ( v31 )
  {
    v45 = -536870208;
    (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v31 + 32LL))(v31, v23);
    (*(void (__fastcall **)(__int64, signed __int64, __int64, int *))(*(_QWORD *)v31 + 1840LL))(
      v31,
      3758112778LL,
      v31,
      &v45);
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v31 + 40LL))(v31);
  }
  return (unsigned int)v45;
}
// 1A020: using guessed type _QWORD off_1A020[16];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (00000000000134B0) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::SDControllerReset(AppleUSBHubPort *this)
{
  __int64 v1; // r12@1
  unsigned int v2; // edx@1
  uintptr_t v3; // r14@1
  signed int v4; // er15@1
  signed __int64 v5; // rsi@2
  __int64 v6; // rax@2
  __int64 v7; // rbx@2
  __int64 result; // rax@7
  int v9; // [sp+Ch] [bp-34h]@1
  __int64 v10; // [sp+10h] [bp-30h]@1
  __int64 v11; // [sp+18h] [bp-28h]@1

  v1 = off_1A070[0];
  v11 = *(_QWORD *)off_1A070[0];
  v9 = 0;
  v10 = 0LL;
  v3 = AppleUSBHubPort::FindSDCardReaderACPIPlatformDevice((uintptr_t)this, 0);
  v4 = -536870212;
  if ( v3 )
  {
    v9 = 1;
    v5 = 4LL;
    v6 = OSNumber::withNumber((OSNumber *)((char *)&dword_0 + 1), 4uLL, v2);
    v7 = v6;
    v4 = -536870212;
    if ( v6 )
    {
      v10 = v6;
      (*(void (__fastcall **)(uintptr_t, _QWORD, int *, __int64 *, signed __int64, _QWORD))(*(_QWORD *)v3 + 2256LL))(
        v3,
        "SRST",
        &v9,
        &v10,
        1LL,
        0LL);
      IOSleep(100LL);
      v9 = 0;
      v5 = 0LL;
      v4 = -536870212;
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, _QWORD, signed __int64))(*(_QWORD *)v7 + 280LL))(
                              v7,
                              0LL,
                              4LL) )
      {
        v10 = v7;
        v5 = (signed __int64)"SRST";
        (*(void (__fastcall **)(uintptr_t, _QWORD, int *, __int64 *, signed __int64, _QWORD))(*(_QWORD *)v3 + 2256LL))(
          v3,
          "SRST",
          &v9,
          &v10,
          1LL,
          0LL);
        v4 = 0;
      }
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v7 + 40LL))(v7);
    }
    (*(void (__fastcall **)(uintptr_t, signed __int64))(*(_QWORD *)v3 + 40LL))(v3, v5);
  }
  result = *(_QWORD *)v1;
  if ( *(_QWORD *)v1 == v11 )
    result = (unsigned int)v4;
  return result;
}
// 0: using guessed type int dword_0;
// 1A070: using guessed type __int64 off_1A070[6];
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (00000000000135D0) ----------------------------------------------------
int __fastcall DoConfigureDeviceZero(IOUSBController *this, unsigned __int8 a2, const OSMetaClass *a3, unsigned __int16 a4, unsigned int a5)
{
  unsigned int v5; // er14@1
  unsigned __int16 v6; // r15@1
  unsigned __int8 v7; // r12@1
  __int64 v8; // rax@1
  int result; // eax@2

  v5 = a5;
  v6 = a4;
  v7 = (unsigned __int8)a3;
  v8 = OSMetaClassBase::safeMetaCast(this, *(const OSMetaClassBase **)off_1A018[0], a3);
  if ( v8 )
    result = (*(int (__fastcall **)(__int64, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v8 + 2648LL))(
               v8,
               a2,
               v7,
               v6,
               v5);
  else
    result = IOUSBController::ConfigureDeviceZero(this, a2, v7);
  return result;
}
// 1A018: using guessed type _QWORD off_1A018[17];
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (000000000001364C) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::GetDevZeroDescriptorWithRetries(uintptr_t arg1)
{
  uintptr_t v1; // rbx@1
  uintptr_t v2; // r12@1
  signed int v3; // ecx@1
  __int64 v4; // r15@1
  __int64 v5; // r14@1
  int v6; // ecx@2
  signed __int16 v7; // ax@2
  int v8; // er13@5
  int v9; // eax@16
  int v10; // eax@22
  uintptr_t v11; // r13@24
  signed int v12; // eax@24
  signed int v13; // ebx@25
  signed int v14; // er12@25
  signed int v15; // edx@32
  uintptr_t v16; // rcx@36
  signed int v17; // eax@43
  __int64 v18; // r9@29
  __int64 v19; // ST00_8@29
  uintptr_t v20; // rcx@56
  unsigned __int64 v21; // rdx@56
  uintptr_t v22; // r8@56
  __int64 v23; // rax@65
  signed int v25; // [sp+1Ch] [bp-74h]@1
  int v26; // [sp+20h] [bp-70h]@23
  int v27; // [sp+2Ch] [bp-64h]@2
  __int64 v28; // [sp+30h] [bp-60h]@65
  __int64 v29; // [sp+38h] [bp-58h]@65
  __int16 v30; // [sp+40h] [bp-50h]@65
  __int64 v31; // [sp+48h] [bp-48h]@65
  __int64 v32; // [sp+50h] [bp-40h]@65
  __int16 v33; // [sp+58h] [bp-38h]@65
  __int16 v34; // [sp+60h] [bp-30h]@16

  v1 = arg1;
  v2 = arg1 + 12;
  v3 = 4;
  v4 = off_1A080[0];
  v5 = off_1A098;
  v25 = 30;
  while ( 1 )
  {
    v27 = v3;
    bzero((void *)v2, 0x12uLL);
    v6 = *(_BYTE *)(v1 + 30);
    v7 = 18;
    if ( v6 != 2 )
    {
      v7 = 8;
      if ( (unsigned __int8)v6 == 3 )
        v7 = 18;
    }
    v8 = IOUSBController::GetDeviceZeroDescriptor(*(_QWORD *)(v1 + 40), v2, (unsigned __int16)v7);
    if ( v8 == -536870168 )
    {
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)v5 & 0xFFFFFFF7 )
        kernel_debug(0x52D142Cu, v1, *(_DWORD *)(v1 + 36), *(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL), 1uLL, 0LL);
      if ( *(_BYTE *)(v1 + 13) == 1 && *(_BYTE *)v2 == 18 && (unsigned __int8)(*(_BYTE *)(v1 + 19) - 8) <= 0x38u )
      {
        v8 = 0;
        if ( !(*(_BYTE *)v4 & 2) || !(*(_DWORD *)v5 & 0xFFFFFFF7) )
          goto LABEL_64;
        v20 = *(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL);
        v21 = *(_DWORD *)(v1 + 36);
        v8 = 0;
        v22 = 2LL;
        goto LABEL_63;
      }
    }
    if ( !v8 )
    {
      if ( (unsigned __int8)(*(_BYTE *)(v1 + 19) - 8) < 0x39u )
        goto LABEL_36;
      v18 = *(_QWORD *)(v1 + 12);
      v19 = *(_QWORD *)(v1 + 20);
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "The USB Family found a device at  port %d of hub @ 0x%x with a bad USB device descriptor (0x%qx, 0x%qx )",
        *(_DWORD *)(v1 + 36),
        *(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL));
      v8 = -536870167;
      if ( !(*(_BYTE *)v4 & 2) || !(*(_DWORD *)v5 & 0xFFFFFFF7) )
        goto LABEL_64;
      v20 = *(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL);
      v21 = *(_DWORD *)(v1 + 36);
      v22 = 6LL;
LABEL_63:
      kernel_debug(0x52D142Cu, v1, v21, v20, v22, 0LL);
      goto LABEL_64;
    }
    if ( *(_BYTE *)v4 & 2 && *(_DWORD *)v5 & 0xFFFFFFF7 )
      kernel_debug(0x52D142Cu, v1, *(_DWORD *)(v1 + 36), v8, 3uLL, 0LL);
    v9 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(v1 + 48), (__int64)&v34, *(_WORD *)(v1 + 36));
    if ( v9 )
      break;
    if ( !(v34 & 1) )
    {
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)v5 & 0xFFFFFFF7 )
        kernel_debug(0x52D142Cu, v1, *(_DWORD *)(v1 + 36), *(_DWORD *)(v1 + 364), 8uLL, 0LL);
      *(_DWORD *)(v1 + 364) = 3;
      v8 = -536870208;
      goto LABEL_64;
    }
    if ( v34 & 4 )
    {
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)v5 & 0xFFFFFFF7 )
        kernel_debug(0x52D142Cu, v1, *(_DWORD *)(v1 + 36), *(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL), 5uLL, 0LL);
      v10 = AppleUSBHub::ClearPortFeature(*(AppleUSBHub **)(v1 + 48), 2, *(_WORD *)(v1 + 36));
      if ( v10 )
      {
        if ( !(*(_BYTE *)v4 & 2) || !(*(_DWORD *)v5 & 0xFFFFFFF7) )
          goto LABEL_64;
        v20 = v10;
        v21 = *(_DWORD *)(v1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL) << 32);
        v22 = 11LL;
        goto LABEL_63;
      }
    }
    v26 = v8;
    if ( v8 == -536854447 )
    {
      v11 = v1;
      v12 = 1;
      if ( *(_BYTE *)(v1 + 30) == 3 || (v13 = 3, v14 = 2, v12 = v27, v27 != 2) && v27 != 4 )
      {
LABEL_32:
        v15 = v25;
        if ( v12 == 1 )
          v15 = 30;
        v14 = v12;
        v13 = v15;
        goto LABEL_35;
      }
    }
    else
    {
      v11 = v1;
      v12 = v27;
      if ( v27 != 2 )
        goto LABEL_32;
      v14 = 2;
      v13 = 3;
    }
LABEL_35:
    IOSleep((unsigned int)v13);
    v25 = v13;
    v27 = v14 - 1;
    v2 = arg1 + 12;
    v1 = v11;
    v8 = v26;
LABEL_36:
    v16 = *(_DWORD *)(*(_QWORD *)(v1 + 48) + 164LL);
    if ( (signed __int64)v16 <= 2 && (_DWORD)v16 != -1 && *(_BYTE *)v4 & 2 && *(_DWORD *)v5 & 0xFFFFFFF7 )
      kernel_debug(0x52D142Cu, v1, *(_DWORD *)(v1 + 36), v16, 7uLL, 0LL);
    v3 = v27;
    if ( v8 )
    {
      if ( v27 )
      {
        v17 = *(_DWORD *)(*(_QWORD *)(v1 + 48) + 164LL);
        if ( v17 == -1 || v17 > 2 )
          continue;
      }
    }
    goto LABEL_64;
  }
  if ( *(_BYTE *)v4 & 2 && *(_DWORD *)v5 & 0xFFFFFFF7 )
    kernel_debug(0x52D142Cu, v1, *(_DWORD *)(v1 + 36), v9, 4uLL, 0LL);
  AppleUSBHubPort::FatalError((AppleUSBHubPort *)v1, (unsigned int)v8, "getting port status (4)");
LABEL_64:
  if ( AppleUSBHub::GetHubPortErrataBits(*(AppleUSBHub **)(v1 + 48), *(_DWORD *)(v1 + 36)) & 8 )
  {
    v33 = 261;
    v32 = 289074824771667372LL;
    v31 = 648518346391683346LL;
    v30 = *(_WORD *)(v2 + 16);
    v23 = *(_QWORD *)v2;
    v29 = *(_QWORD *)(v2 + 8);
    v28 = v23;
    WORD2(v29) = 5;
    if ( memcmp(&v31, &v28, 0x12uLL) )
    {
      if ( *(_BYTE *)v4 & 2 && *(_DWORD *)v5 & 0xFFFFFFF7 )
        kernel_debug(0x52D142Cu, v1, *(_DWORD *)(v1 + 36), *(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL), 9uLL, 0LL);
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "USB: Verified DeviceDescriptor for 0x%04x, 0x%04x",
        *(_WORD *)(v1 + 20),
        *(_WORD *)(v1 + 22));
      AppleUSBHubPort::PowerCycleDeviceAttachedToThisPort(v1);
      v8 = -536870911;
    }
  }
  if ( *(_BYTE *)v4 & 2 && *(_DWORD *)v5 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D142Cu,
      v1,
      *(_DWORD *)(v1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL) << 32),
      v8,
      0xAuLL,
      0LL);
  return (unsigned int)v8;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2BEC8: using guessed type int __fastcall IOUSBController::GetDeviceZeroDescriptor(_QWORD, _QWORD, _QWORD);

//----- (0000000000013B4E) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::DetachDevice(AppleUSBHubPort *this)
{
  uintptr_t v1; // rbx@1
  __int64 v2; // r12@1
  unsigned __int64 v3; // rdx@12
  uintptr_t v4; // r8@12
  int v5; // eax@13
  signed int v6; // er14@18
  int v8; // eax@23
  int v9; // eax@24
  const char *v10; // rdx@28
  int v11; // er15@29
  int v12; // eax@41
  __int64 v13; // rdi@60
  int v14; // eax@61
  int v15; // eax@65
  signed __int64 v16; // rax@68
  uintptr_t arg3; // [sp+8h] [bp-28h]@24

  v1 = (uintptr_t)this;
  v2 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1428u,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      *((_DWORD *)this + 28),
      0LL,
      0LL);
  if ( !*((_BYTE *)this + 116) )
  {
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "The IOUSBFamily is having trouble enumerating a USB device that has been plugged in.  It will keep retrying.  (Port %d of Hub at 0x%x)",
      *((_DWORD *)this + 9),
      *(_DWORD *)(*((_QWORD *)this + 6) + 296LL));
    if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1428u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        0LL,
        1uLL,
        0LL);
    *((_BYTE *)this + 116) = 1;
  }
  if ( *((_BYTE *)this + 117) )
  {
    if ( !(*(_BYTE *)v2 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      goto LABEL_18;
    v3 = *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32);
    v4 = 2LL;
    goto LABEL_17;
  }
  v5 = *((_DWORD *)this + 28);
  if ( v5 == 9 )
  {
    *((_BYTE *)this + 117) = 1;
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "The IOUSBFamily gave up enumerating a USB device after 10 retries.  (Port %d of Hub at 0x%x)",
      *((_DWORD *)this + 9),
      *(_DWORD *)(*((_QWORD *)this + 6) + 296LL));
    if ( !(*(_BYTE *)v2 & 2) || !(*(_DWORD *)off_1A098 & 0xFFFFFFF7) )
      goto LABEL_18;
    v3 = *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32);
    v4 = 3LL;
LABEL_17:
    kernel_debug(0x52D1428u, (uintptr_t)this, v3, 0LL, v4, 0LL);
LABEL_18:
    *((_DWORD *)this + 91) = 3;
    v6 = -536870163;
    goto LABEL_19;
  }
  v8 = v5 + 1;
  *((_DWORD *)this + 28) = v8;
  if ( !(v8 & 3) )
  {
    v11 = 100 * v8;
    if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1428u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        (unsigned int)v11,
        4uLL,
        0LL);
    v6 = AppleUSBHub::SetPortPower(*((AppleUSBHub **)this + 6), *((_WORD *)this + 18), 0);
    if ( v6 )
    {
      if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1428u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          v6,
          5uLL,
          0LL);
      v10 = "clearing port power feature";
    }
    else
    {
      IOSleep((unsigned int)v11);
      v6 = AppleUSBHub::SetPortPower(*((AppleUSBHub **)this + 6), *((_WORD *)this + 18), 1);
      if ( !v6 )
      {
        IOSleep(100LL);
        goto LABEL_18;
      }
      if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1428u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          v6,
          6uLL,
          0LL);
      v10 = "setting port power feature";
    }
LABEL_51:
    AppleUSBHubPort::FatalError(this, (unsigned int)v6, v10);
    goto LABEL_19;
  }
  v6 = AppleUSBHub::GetPortStatus(*((AppleUSBHub **)this + 6), (__int64)&arg3, *((_WORD *)this + 18));
  v9 = *(_DWORD *)v2 & 2;
  if ( v6 )
  {
    if ( v9 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1428u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        v6,
        7uLL,
        0LL);
    v10 = "getting port status (5)";
    goto LABEL_51;
  }
  if ( v9 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1428u,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      arg3,
      8uLL,
      0LL);
  if ( arg3 & 1 )
  {
    IOSleep(300LL);
    v6 = AppleUSBHub::GetPortStatus(*((AppleUSBHub **)this + 6), (__int64)&arg3, *((_WORD *)this + 18));
    v12 = *(_DWORD *)v2 & 2;
    if ( v6 )
    {
      if ( v12 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1428u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          v6,
          0xAuLL,
          0LL);
      v10 = "getting port status (6)";
      goto LABEL_51;
    }
    if ( v12 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1428u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        arg3,
        0xBuLL,
        0LL);
    if ( arg3 & 1 )
    {
      v13 = *((_QWORD *)this + 6);
      if ( !*(_BYTE *)(v13 + 426) )
      {
        v14 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v13, 1, *(_WORD *)(v1 + 36));
        if ( *(_BYTE *)v2 & 2 )
        {
          if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(
              0x52D1428u,
              v1,
              *(_DWORD *)(v1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL) << 32),
              v14,
              0x10uLL,
              0LL);
        }
      }
      if ( BYTE2(arg3) & 1 )
      {
        v15 = AppleUSBHub::ClearPortFeature(*(AppleUSBHub **)(v1 + 48), 16, *(_WORD *)(v1 + 36));
        if ( *(_BYTE *)v2 & 2 )
        {
          if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(
              0x52D1428u,
              v1,
              *(_DWORD *)(v1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL) << 32),
              v15,
              0x11uLL,
              0LL);
        }
      }
      *(_BYTE *)(v1 + 103) = 1;
      v16 = 152LL;
      do
      {
        if ( *(_DWORD *)(v1 + v16) == 16 )
        {
          *(_QWORD *)(v1 + v16 - 16) = AppleUSBHubPort::DefaultResetChangeHandler;
          *(_QWORD *)(v1 + v16 - 8) = 0LL;
        }
        v16 += 24LL;
      }
      while ( v16 != 344 );
      if ( *(_BYTE *)(v1 + 420) )
      {
        if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1428u,
            v1,
            *(_DWORD *)(v1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL) << 32),
            0LL,
            0xFuLL,
            0LL);
        AppleUSBHub::DeviceDisconnected(*(AppleUSBHub **)(v1 + 48), *(_WORD *)(v1 + 36), (char *)(v1 + 421));
      }
      if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1428u,
          v1,
          *(_DWORD *)(v1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL) << 32),
          0LL,
          0xCuLL,
          0LL);
      AppleUSBHubPort::LaunchAddDeviceThread((AppleUSBHubPort *)v1, 1u);
      v6 = -536870184;
    }
    else
    {
      v6 = 0;
      if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v6 = 0;
        kernel_debug(
          0x52D1428u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          0LL,
          0xDuLL,
          0LL);
      }
    }
  }
  else
  {
    if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1428u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        0LL,
        9uLL,
        0LL);
    *((_DWORD *)this + 91) = 3;
    v6 = -536870208;
  }
LABEL_19:
  if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1428u,
      v1,
      *(_DWORD *)(v1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL) << 32),
      v6,
      0xEuLL,
      0LL);
  return (unsigned int)v6;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000014262) ----------------------------------------------------
char __fastcall AppleUSBHubPort::IsCaptiveOverride(AppleUSBHubPort *this, int a2, unsigned __int16 a3)
{
  unsigned int v3; // ecx@1
  int *v4; // rdi@1
  char result; // al@4

  v3 = 0;
  v4 = &dword_19FC4;
  a2 = (unsigned __int16)a2;
  while ( 1 )
  {
    if ( *((_WORD *)v4 - 2) == a2 && *((_WORD *)v4 - 1) <= (unsigned int)a3 )
    {
      result = 1;
      if ( *(_WORD *)v4 >= (unsigned int)a3 )
        break;
    }
    ++v3;
    v4 = (int *)((char *)v4 + 6);
    if ( v3 >= 9 )
      return 0;
  }
  return result;
}
// 19FC4: using guessed type int dword_19FC4;

//----- (00000000000142A0) ----------------------------------------------------
void __fastcall AppleUSBHubPort::WakeSuspendCommand(uintptr_t arg1, void *a2)
{
  uintptr_t v2; // rbx@1
  __int64 v3; // rdi@1
  __int64 v4; // rax@2
  __int64 v5; // rax@3
  uintptr_t v6; // r8@7

  v2 = arg1;
  v3 = *(_QWORD *)(arg1 + 40);
  if ( v3 )
  {
    LODWORD(v4) = (*(int (**)(void))(*(_QWORD *)v3 + 1672LL))();
    if ( v4 )
    {
      v5 = IOUSBController::GetCommandGate(*(IOUSBController **)(v2 + 40));
      if ( v5 )
      {
        (*(void (__fastcall **)(__int64, void *, signed __int64))(*(_QWORD *)v5 + 488LL))(v5, a2, 1LL);
        return;
      }
    }
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v6 = 1LL;
LABEL_11:
      kernel_debug(0x52D1434u, v2, 0LL, 0LL, v6, 0LL);
      return;
    }
  }
  else if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    v6 = 2LL;
    goto LABEL_11;
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000014358) ----------------------------------------------------
__int64 __usercall AppleUSBHubPort::HandleLinkState@<rax>(AppleUSBHubPort *this@<rdi>, __int64 a2@<rax>, unsigned int a3@<edx>)
{
  char v3; // r14@1
  AppleUSBHubPort *v4; // rbx@1
  unsigned int v5; // eax@1
  signed int v6; // er15@2
  __int64 v7; // rax@6
  AppleUSBHub *v8; // rdi@10
  __int16 v9; // dx@10
  __int16 v10; // si@10
  __int64 v12; // [sp+0h] [bp-20h]@1

  v12 = a2;
  v3 = a3;
  v4 = this;
  v5 = ((unsigned __int8)a3 >> 5) | (a3 >> 11) & 8;
  if ( (unsigned __int16)((((unsigned __int8)a3 >> 5) | (a3 >> 11) & 8) - 7) <= 4u )
  {
    IOSleep(10LL);
    v6 = AppleUSBHub::GetPortStatus(*((AppleUSBHub **)this + 6), (__int64)&v12, *((_WORD *)this + 18));
    if ( v6 )
      return (unsigned int)v6;
    v3 = v12;
    v5 = ((unsigned int)(unsigned __int16)v12 >> 5) & 7 | ((unsigned int)(unsigned __int16)v12 >> 11) & 8;
  }
  v5 = (unsigned __int16)v5;
  if ( (unsigned __int16)v5 == 4 )
  {
    v6 = AppleUSBHub::GetPortStatus(*((AppleUSBHub **)this + 6), (__int64)&v12, *((_WORD *)this + 18));
    if ( !v6 )
    {
      v6 = -536870174;
      if ( BYTE1(v12) & 1 )
      {
        if ( !(v3 & 8) )
        {
          v6 = AppleUSBHub::SetPortLinkState(*((AppleUSBHub **)this + 6), 5, *((_WORD *)this + 18));
          if ( !v6 )
          {
            IOSleep(10LL);
            v8 = (AppleUSBHub *)*((_QWORD *)this + 6);
            v9 = *((_WORD *)v4 + 18);
            v10 = 4;
LABEL_11:
            v6 = AppleUSBHub::SetPortFeature(v8, v10, v9);
            IOSleep(100LL);
            return (unsigned int)v6;
          }
        }
      }
    }
  }
  else
  {
    v6 = 0;
    if ( v5 - 6 <= 5 )
    {
      v7 = 0LL;
      do
      {
        if ( *(_DWORD *)((char *)this + v7 + 152) == 16 )
        {
          *(_QWORD *)((char *)this + v7 + 136) = AppleUSBHubPort::DefaultResetChangeHandler;
          *(_QWORD *)((char *)this + v7 + 144) = 0LL;
        }
        v7 += 24LL;
      }
      while ( v7 != 192 );
      v8 = (AppleUSBHub *)*((_QWORD *)this + 6);
      v9 = *((_WORD *)v4 + 18);
      v10 = 28;
      goto LABEL_11;
    }
  }
  return (unsigned int)v6;
}
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (000000000001449E) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::DefaultOverCrntChangeHandler(uintptr_t arg1)
{
  uintptr_t v1; // rsi@1
  unsigned int v2; // er14@1
  __int64 v3; // rax@11
  __int16 v4; // r12@11
  bool v5; // r15@11
  unsigned __int64 v6; // rcx@13
  __int64 v7; // rax@17
  __int64 v8; // rax@18
  unsigned __int64 v10; // [sp+8h] [bp-38h]@13
  __int64 v11; // [sp+10h] [bp-30h]@13
  __int16 v12; // [sp+18h] [bp-28h]@1
  __int16 v13; // [sp+1Ah] [bp-26h]@2

  v1 = (uintptr_t)&v12;
  v2 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(arg1 + 48), (__int64)&v12, *(_WORD *)(arg1 + 36));
  if ( !v2 && v13 != 31 )
  {
    if ( v12 & 8 || !*(_BYTE *)(*(_QWORD *)(arg1 + 48) + 160LL) )
    {
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D141Cu, arg1, *(_DWORD *)(arg1 + 36), *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), 1uLL, 0LL);
      v3 = *(_QWORD *)(arg1 + 48);
      v4 = *(_WORD *)(v3 + 219);
      v5 = 1;
      if ( *(_BYTE *)(v3 + 426) )
        v5 = *(_BYTE *)(v3 + 160) == 0 || v12 >= 0;
      clock_get_uptime(&v11);
      v11 -= *(_QWORD *)(arg1 + 120);
      v1 = (uintptr_t)&v10;
      absolutetime_to_nanoseconds(v11, &v10);
      v6 = v10 >> 9;
      v10 = 19342813113834067LL * (v10 >> 9) >> 64 >> 11;
      if ( v5 && (!*(_BYTE *)(arg1 + 118) || v6 >= 0x39BDF3B) )
      {
        v1 = (v4 & 0x18) == 8;
        AppleUSBHubPort::DisplayOverCurrentNotice(arg1, v1, *(_BYTE *)(arg1 + 36));
        *(_BYTE *)(arg1 + 118) = 1;
        clock_get_uptime(arg1 + 120);
      }
    }
    else if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v1 = arg1;
      kernel_debug(0x52D141Cu, arg1, *(_DWORD *)(arg1 + 36), 0LL, 2uLL, 0LL);
    }
    (*(void (__fastcall **)(uintptr_t, uintptr_t))(*(_QWORD *)arg1 + 32LL))(arg1, v1);
    LODWORD(v7) = (*(int (**)(void))(**(_QWORD **)(arg1 + 48) + 32LL))();
    AppleUSBHub::RaisePowerState(*(AppleUSBHub **)(arg1 + 48), v7);
    *(_BYTE *)(arg1 + 111) = 1;
    if ( thread_call_enter(*(_QWORD *)(arg1 + 352)) == 1 )
    {
      v8 = off_1A080[0];
      if ( *(_BYTE *)off_1A080[0] & 2 )
      {
        v8 = off_1A098;
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v1 = arg1;
          kernel_debug(0x52D141Cu, arg1, *(_DWORD *)(arg1 + 36), *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), 3uLL, 0LL);
        }
      }
      AppleUSBHub::LowerPowerState(*(AppleUSBHub **)(arg1 + 48), v8);
      (*(void (__fastcall **)(_QWORD, uintptr_t))(**(_QWORD **)(arg1 + 48) + 40LL))(*(_QWORD *)(arg1 + 48), v1);
      (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
      *(_BYTE *)(arg1 + 111) = 0;
    }
  }
  return v2;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2C750: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);
// 2C760: using guessed type int __fastcall clock_get_uptime(_QWORD);
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (00000000000146BE) ----------------------------------------------------
void __fastcall AppleUSBHubPort::DisplayOverCurrentNotice(uintptr_t arg1, unsigned __int8 a2, unsigned __int8 a3)
{
  unsigned __int8 v3; // r14@1
  uintptr_t v4; // rbx@1
  __int64 v5; // r12@1
  uintptr_t v6; // rdx@4
  __int64 v7; // rdi@5
  signed __int64 v8; // rsi@7

  v3 = a3;
  v4 = arg1;
  v5 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1430u, arg1, *(_DWORD *)(arg1 + 36), a2, 1uLL, 0LL);
  v6 = *(_QWORD *)(arg1 + 48);
  if ( v6 && (v7 = *(_QWORD *)(v6 + 144)) != 0 )
  {
    if ( a2 )
      v8 = (v3 << 24) | 2u;
    else
      v8 = 3LL;
    (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v7 + 2456LL))(v7, v8);
  }
  else if ( *(_BYTE *)v5 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    kernel_debug(0x52D1430u, v4, v6, 0LL, 2uLL, 0LL);
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000001478C) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::DefaultEnableChangeHandler(AppleUSBHubPort *this)
{
  unsigned int v1; // eax@1
  unsigned int v2; // ebx@1
  char v4; // [sp+8h] [bp-18h]@1

  v1 = AppleUSBHub::GetPortStatus(*((AppleUSBHub **)this + 6), (__int64)&v4, *((_WORD *)this + 18));
  v2 = v1;
  if ( v1 )
    AppleUSBHubPort::FatalError(this, v1, "getting port status (1)");
  return v2;
}

//----- (00000000000147CE) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::DefaultConnectionChangeHandler(AppleUSBHubPort *this, __int16 a2, __int16 a3)
{
  __int64 v3; // r15@1
  uintptr_t v4; // rcx@25
  signed int v5; // edx@30
  signed int v6; // er14@34
  __int64 v7; // rsi@35
  __int64 v8; // rax@35
  const OSMetaClass *v9; // rdx@35
  __int64 v10; // r14@37
  char v11; // al@40
  int v12; // eax@48
  signed int v14; // eax@55
  int v15; // [sp+Ch] [bp-24h]@1
  uintptr_t arg3; // [sp+10h] [bp-20h]@1

  v15 = 1;
  LOWORD(arg3) = a3;
  WORD1(arg3) = a2;
  v3 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1421u,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      arg3,
      0LL,
      0LL);
  *((_BYTE *)this + 106) = 0;
  if ( *((_BYTE *)this + 392) )
  {
    *((_BYTE *)this + 106) = 1;
    IOSleep(300LL);
    if ( !(arg3 & 1) )
      goto LABEL_10;
  }
  else
  {
    if ( !(arg3 & 1) )
    {
      v15 = 0;
LABEL_10:
      *((_BYTE *)this + 106) = 2;
      *((_DWORD *)this + 24) = 3;
      *((_DWORD *)this + 28) = 0;
      *((_BYTE *)this + 117) = 0;
      goto LABEL_11;
    }
    *((_BYTE *)this + 106) = 2;
    IOSleep(100LL);
  }
LABEL_11:
  if ( *((_BYTE *)this + 420) && !*((_QWORD *)this + 10) && !(arg3 & 1) )
    AppleUSBHub::DeviceDisconnected(*((AppleUSBHub **)this + 6), *((_WORD *)this + 18), (char *)this + 421);
  if ( *((_BYTE *)this + 100) )
  {
    if ( *((_BYTE *)this + 402) )
    {
      if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1420u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          0LL,
          5uLL,
          0LL);
      *((_BYTE *)this + 402) = 0;
    }
    *((_BYTE *)this + 106) = 3;
    if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1420u,
        (uintptr_t)this,
        *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
        0LL,
        2uLL,
        0LL);
    AppleUSBHubPort::ReleaseDeviceZero((uintptr_t)this);
  }
  v4 = *((_QWORD *)this + 10);
  if ( v4 )
  {
    if ( (*((_BYTE *)this + 401) || *((_BYTE *)this + 419))
      && *((_WORD *)this + 10) == 1452
      && (unsigned __int16)(*((_WORD *)this + 11) + 31479) <= 8u )
    {
      v5 = 385;
      if ( _bittest((const unsigned int *)&v5, *((_WORD *)this + 11) + 31479) )
      {
        if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1420u,
            (uintptr_t)this,
            *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
            v4,
            1uLL,
            0LL);
        *((_BYTE *)this + 419) = 0;
        v6 = 0;
        goto LABEL_50;
      }
    }
    v7 = *((_DWORD *)this + 9);
    v8 = AppleUSBHub::GetHubPortErrataBits(*((AppleUSBHub **)this + 6), v7);
    if ( v8 & 4 && AppleUSBHubPort::ShouldIgnoreDisconnect(this, v8) )
    {
      v10 = *((_QWORD *)this + 10);
      if ( v10 )
      {
        (*(void (__fastcall **)(_QWORD))(*(_QWORD *)v10 + 32LL))(*((_QWORD *)this + 10));
        (*(void (__fastcall **)(__int64, signed __int64, int *, signed __int64))(*(_QWORD *)v10 + 1856LL))(
          v10,
          3758112995LL,
          &v15,
          4LL);
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v10 + 40LL))(v10);
      }
      *((_DWORD *)this + 24) = (v15 != 0) | 2;
      v6 = 0;
      goto LABEL_50;
    }
    *((_BYTE *)this + 419) = 0;
    if ( *((_BYTE *)this + 405) )
    {
      v6 = 0;
      if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v6 = 0;
        kernel_debug(
          0x52D1420u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          0LL,
          0LL,
          0LL);
      }
      goto LABEL_50;
    }
    *((_BYTE *)this + 106) = 4;
    *((_DWORD *)this + 24) = 3;
    if ( *((_BYTE *)this + 420) )
    {
      v7 = *((_WORD *)this + 18);
      AppleUSBHub::DeviceDisconnected(*((AppleUSBHub **)this + 6), v7, (char *)this + 421);
    }
    AppleUSBHubPort::RemoveDevice(this, v7, v9);
    v11 = 5;
  }
  else
  {
    v11 = 6;
  }
  *((_BYTE *)this + 106) = v11;
  v12 = AppleUSBHub::GetPortStatus(*((AppleUSBHub **)this + 6), (__int64)&arg3, *((_WORD *)this + 18));
  v6 = v12;
  if ( v12 )
  {
    *((_BYTE *)this + 106) = 7;
    *((_BYTE *)this + 103) = 1;
    AppleUSBHubPort::FatalError(this, (unsigned int)v12, "getting port status (7)");
  }
  else
  {
    *((_BYTE *)this + 106) = 8;
    if ( BYTE2(arg3) & 1 )
    {
      v14 = *((_DWORD *)this + 102);
      *((_DWORD *)this + 102) = v14 + 1;
      v6 = -536870199;
      if ( v14 <= 4 )
      {
        *((_BYTE *)this + 103) = 1;
        v6 = 0;
      }
    }
    else
    {
      v6 = 0;
      if ( arg3 & 1 )
      {
        if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1420u,
            (uintptr_t)this,
            *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
            0LL,
            4uLL,
            0LL);
        *((_DWORD *)this + 91) = 2;
        *((_BYTE *)this + 106) = 9;
        v6 = 0;
        AppleUSBHubPort::LaunchAddDeviceThread(this, 0);
        *((_BYTE *)this + 106) = 10;
      }
    }
  }
LABEL_50:
  *((_BYTE *)this + 405) = 0;
  if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1422u,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      v6,
      0LL,
      0LL);
  return (unsigned int)v6;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000014C22) ----------------------------------------------------
bool __usercall AppleUSBHubPort::ShouldIgnoreDisconnect@<al>(AppleUSBHubPort *this@<rdi>, __int64 a2@<rax>)
{
  uintptr_t v2; // rbx@1
  bool v3; // r15@1
  __int64 v5; // [sp-4h] [bp-20h]@1

  v5 = a2;
  HIDWORD(v5) = 0;
  v2 = AppleUSBHubPort::FindSDCardReaderACPIPlatformDevice((uintptr_t)this, 1);
  v3 = 1;
  if ( v2 )
  {
    (*(void (__fastcall **)(uintptr_t, _QWORD, char *, _QWORD, _QWORD, _QWORD))(*(_QWORD *)v2 + 2256LL))(
      v2,
      "GBHV",
      (char *)&v5 + 4,
      0LL,
      0LL,
      0LL);
    v3 = HIDWORD(v5) != 0;
    (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)v2 + 40LL))(v2);
  }
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1448u, *(_DWORD *)(*((_QWORD *)this + 6) + 296LL), *((_DWORD *)this + 9), v3, 8uLL, 0LL);
  return v3;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000014CCA) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::DefaultBHResetChangeHandler(uintptr_t arg1, unsigned __int16 a2, unsigned __int16 a3)
{
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1458u,
      arg1,
      *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
      a3 | ((unsigned __int64)a2 << 16),
      0LL,
      0LL);
  return 0LL;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000014D28) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::DefaultPortLinkStateChangeHandler(AppleUSBHubPort *this, unsigned __int16 a2, unsigned int a3)
{
  unsigned int v3; // ebx@1
  __int64 v4; // r15@1
  __int64 v5; // rax@4
  unsigned int v6; // ebx@4

  v3 = a3;
  v4 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D145Du,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      (unsigned __int16)a3 | ((unsigned __int64)a2 << 16),
      0LL,
      0LL);
  v5 = (unsigned __int8)((unsigned __int8)v3 >> 5) | (unsigned __int16)((v3 >> 11) & 8);
  *((_DWORD *)this + 107) = v5;
  v6 = AppleUSBHubPort::HandleLinkState(this, v5, (unsigned __int16)v3);
  if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D145Eu,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      (signed int)v6,
      0LL,
      0LL);
  return v6;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000014E00) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::DefaultPortConfigErrChangeHandler(uintptr_t arg1, __int64 a2, unsigned int a3)
{
  unsigned int v3; // er14@1
  __int64 v4; // r12@1
  unsigned int v5; // er14@4
  unsigned int v6; // er14@8
  int v7; // ecx@11
  signed __int64 v8; // rax@11
  unsigned int v9; // er15@16
  signed __int64 v10; // rax@21
  unsigned __int16 v12; // [sp+6h] [bp-2Ah]@1
  uintptr_t arg3; // [sp+8h] [bp-28h]@4

  v3 = a3;
  v12 = 0;
  AppleUSBHub::GetPortErrorCount(*(AppleUSBHub **)(arg1 + 48), *(_WORD *)(arg1 + 36), &v12);
  v4 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1455u,
      arg1,
      *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
      ((unsigned __int8)v3 >> 5) | (v3 >> 11) & 8,
      v12,
      0LL);
  IOSleep(100LL);
  v5 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(arg1 + 48), (__int64)&arg3, *(_WORD *)(arg1 + 36));
  if ( v5 )
  {
    if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1454u,
        arg1,
        *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
        (signed int)v5,
        0LL,
        0LL);
  }
  else
  {
    v6 = (unsigned __int16)arg3;
    if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1454u,
        arg1,
        *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
        arg3,
        1uLL,
        0LL);
    v7 = ((unsigned __int8)v6 >> 5) | (v6 >> 11) & 8;
    v8 = 152LL;
    if ( v7 == 6 )
    {
      v10 = 152LL;
      if ( *(_BYTE *)v4 & 2 )
      {
        v10 = 152LL;
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          kernel_debug(
            0x52D1454u,
            arg1,
            *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
            0LL,
            3uLL,
            0LL);
          v10 = 152LL;
        }
      }
      do
      {
        if ( *(_DWORD *)(arg1 + v10) == 16 )
        {
          *(_QWORD *)(arg1 + v10 - 16) = AppleUSBHubPort::DefaultResetChangeHandler;
          *(_QWORD *)(arg1 + v10 - 8) = 0LL;
        }
        v10 += 24LL;
      }
      while ( v10 != 344 );
      v5 = AppleUSBHub::SetPortFeature(*(AppleUSBHub **)(arg1 + 48), 28, *(_WORD *)(arg1 + 36));
      if ( v5 && *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D1454u,
          arg1,
          *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
          (signed int)v5,
          2uLL,
          0LL);
      IOSleep(100LL);
    }
    else
    {
      v5 = 0;
      if ( (unsigned int)(v7 - 4) <= 1 )
      {
        do
        {
          if ( *(_DWORD *)(arg1 + v8) == 16 )
          {
            *(_QWORD *)(arg1 + v8 - 16) = AppleUSBHubPort::HandleResetPortHandler;
            *(_QWORD *)(arg1 + v8 - 8) = 0LL;
          }
          v8 += 24LL;
        }
        while ( v8 != 344 );
        v9 = AppleUSBHub::SetPortFeature(*(AppleUSBHub **)(arg1 + 48), 4, *(_WORD *)(arg1 + 36));
        IOSleep(100LL);
        if ( v9 )
        {
          if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            kernel_debug(
              0x52D1454u,
              arg1,
              *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
              (signed int)v9,
              2uLL,
              0LL);
          v5 = v9;
        }
      }
    }
  }
  if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1456u,
      arg1,
      *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
      (signed int)v5,
      0LL,
      0LL);
  return v5;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000015148) ----------------------------------------------------
void __fastcall AppleUSBHubPort::PortStatusChangedHandler(AppleUSBHubPort *this, AppleUSBHubPort *a2)
{
  uintptr_t v2; // rbx@1
  __int64 v3; // r12@1
  __int64 v4; // r14@17
  __int64 v5; // rdi@23
  unsigned int v6; // eax@24
  signed __int64 v7; // r8@24
  __int64 v8; // rsi@24
  unsigned __int16 v9; // cx@25
  __int64 v10; // rax@25
  unsigned int v11; // er15@36
  bool v12; // al@36
  unsigned int v13; // er15@43
  __int64 v14; // rcx@44
  int v15; // eax@44
  char v16; // r13@44
  signed __int64 v17; // r12@44
  __int64 v18; // r15@44
  uintptr_t v19; // r14@44
  unsigned int v20; // eax@51
  int v21; // eax@52
  int v22; // eax@53
  char *v23; // rcx@62
  uintptr_t v24; // rdi@62
  unsigned int v25; // er13@66
  bool v26; // zf@68
  unsigned int v27; // eax@73
  const char *v28; // rdx@77
  unsigned int v29; // er14@90
  int v30; // er15@104
  __int64 v31; // r14@104
  IOUSBController *v32; // rdi@119
  __int64 v33; // r14@120
  char *v34; // [sp+0h] [bp-40h]@17
  __int64 v35; // [sp+8h] [bp-38h]@17
  unsigned __int16 v36; // [sp+16h] [bp-2Ah]@24

  v2 = (uintptr_t)this;
  v3 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    a2 = this;
    kernel_debug(
      0x52D2809u,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      0LL,
      0LL,
      0LL);
  }
  if ( IOLockTryLock(*((_QWORD *)this + 46)) )
  {
    if ( !IOLockTryLock(*((_QWORD *)this + 47)) )
    {
      if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        a2 = this;
        kernel_debug(
          0x52D2808u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          0LL,
          2uLL,
          0LL);
      }
      IOLockLock(*((_QWORD *)this + 47), a2);
      if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D2808u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          0LL,
          3uLL,
          0LL);
    }
    *((_WORD *)this + 52) = 1;
    if ( *((_BYTE *)this + 109) )
    {
      if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D2808u,
          (uintptr_t)this,
          *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
          0LL,
          4uLL,
          0LL);
      IOSleep(100LL);
      *((_BYTE *)this + 109) = 0;
    }
    v34 = (char *)this + 104;
    v4 = (__int64)((char *)this + 360);
    v35 = (__int64)((char *)this + 360);
LABEL_70:
    if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D2808u,
        v2,
        *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
        0LL,
        5uLL,
        0LL);
    v27 = AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(v2 + 48), v4, *(_WORD *)(v2 + 36));
    v8 = v27;
    if ( v27 )
    {
      if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        kernel_debug(
          0x52D2808u,
          v2,
          *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
          (signed int)v27,
          6uLL,
          0LL);
        v8 = (unsigned int)v8;
      }
      *(_BYTE *)(v2 + 105) = 1;
      v28 = "get status (first in port status change)";
LABEL_90:
      v29 = v8;
      AppleUSBHubPort::FatalError((AppleUSBHubPort *)v2, v8, v28);
LABEL_91:
      v7 = v29;
    }
    else
    {
      if ( *(_WORD *)v4 == 0xFFFF && *(_WORD *)(v2 + 362) == 0xFFFF )
      {
        if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D2808u,
            v2,
            *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
            0LL,
            7uLL,
            0LL);
        v8 = 0LL;
        AppleUSBHubPort::FatalError((AppleUSBHubPort *)v2, 0LL, "probably a PC card was ejected");
        v7 = 3758097088LL;
        goto LABEL_104;
      }
      if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(
          0x52D2808u,
          v2,
          *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
          *(_QWORD *)(v2 + 360),
          0LL,
          0LL);
      *(_BYTE *)(v2 + 105) = 2;
      v5 = *(_QWORD *)(v2 + 48);
      if ( *(_BYTE *)(v5 + 426) )
      {
        v36 = 0;
        v6 = AppleUSBHub::GetPortErrorCount((AppleUSBHub *)v5, *(_WORD *)(v2 + 36), &v36);
        v7 = v6;
        v8 = 0x100000000LL;
        if ( !v6 )
        {
          v9 = v36;
          v10 = *(_WORD *)(v2 + 426);
          if ( v36 > (unsigned int)v10 )
          {
            if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            {
              kernel_debug(
                0x52D2808u,
                v2,
                *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
                v36 - v10,
                8uLL,
                0LL);
              v8 = 0x100000000LL;
              v9 = v36;
            }
            *(_WORD *)(v2 + 426) = v9;
          }
          v7 = 0LL;
        }
      }
      else
      {
        v7 = 0LL;
        v8 = 0x100000000LL;
      }
      *(_BYTE *)(v2 + 103) = 0;
      while ( 1 )
      {
        if ( *(_BYTE *)(*(_QWORD *)(v2 + 48) + 1040LL) )
        {
          if ( *(_BYTE *)(v2 + 360) & 1 )
          {
            if ( *(_BYTE *)(v2 + 362) & 1 )
            {
              v11 = v7;
              v12 = AppleUSBHubPort::ShouldApplyDisconnectWorkaround((AppleUSBHubPort *)v2);
              v7 = v11;
              *(_BYTE *)(v2 + 405) = v12;
              if ( *(_BYTE *)v3 & 2 )
              {
                if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                {
                  kernel_debug(
                    0x52D2808u,
                    v2,
                    *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
                    v12,
                    9uLL,
                    0LL);
                  v7 = v11;
                }
              }
            }
          }
        }
        if ( *(_BYTE *)(v2 + 401) )
        {
          if ( *(_BYTE *)(v2 + 362) & 1 )
          {
            *(_BYTE *)(v2 + 419) = 1;
            if ( *(_BYTE *)v3 & 2 )
            {
              if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              {
                v13 = v7;
                kernel_debug(
                  0x52D2808u,
                  v2,
                  *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
                  0LL,
                  0xAuLL,
                  0LL);
                v7 = v13;
              }
            }
          }
        }
        *(_BYTE *)(v2 + 105) = 3;
        v14 = *(_WORD *)(v2 + 362);
        v15 = 0;
        v16 = 0;
        v17 = 156LL;
        v18 = 0LL;
        v19 = 0LL;
        while ( !((unsigned int)v14 & *(_DWORD *)(v2 + v17 - 4)) )
        {
          ++v19;
          v18 += v8;
          v17 += 24LL;
          v16 -= 20;
          v15 += 0x10000;
          if ( (signed int)v19 > 7 )
            goto LABEL_92;
        }
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D2808u,
            v2,
            *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
            v15 | *(_WORD *)(v2 + v17),
            0xBuLL,
            0LL);
        *(_BYTE *)(v2 + 105) = 4;
        v20 = AppleUSBHub::ClearPortFeature(*(AppleUSBHub **)(v2 + 48), *(_WORD *)(v2 + v17), *(_WORD *)(v2 + 36));
        v8 = v20;
        if ( v20 )
        {
          if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            kernel_debug(
              0x52D2808u,
              v2,
              *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
              (signed int)v20,
              0xCuLL,
              0LL);
            v8 = (unsigned int)v8;
          }
          v28 = "clear port vector bit feature";
          goto LABEL_90;
        }
        *(_BYTE *)(v2 + 105) = 5;
        v21 = 0;
        if ( (signed int)v19 > 7 )
          goto LABEL_115;
        *(_BYTE *)(v2 + 105) = 6;
        v8 = (unsigned int)AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(v2 + 48), v35, *(_WORD *)(v2 + 36));
        v22 = *(_DWORD *)off_1A080[0] & 2;
        if ( (_DWORD)v8 )
        {
          if ( v22 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            kernel_debug(
              0x52D2808u,
              v2,
              *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
              (signed int)v8,
              0xDuLL,
              0LL);
            v8 = (unsigned int)v8;
          }
          v28 = "get status (second in port status change)";
          goto LABEL_90;
        }
        if ( v22 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D2808u,
            v2,
            *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
            *(_QWORD *)(v2 + 360),
            0xFuLL,
            0LL);
        if ( *(_WORD *)v35 == 0xFFFF && *(_WORD *)(v2 + 362) == 0xFFFF )
        {
          v8 = 0LL;
          AppleUSBHubPort::FatalError((AppleUSBHubPort *)v2, 0LL, "status and change flags are 0xffff");
          v7 = 3758097088LL;
          if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v8 = v2;
            kernel_debug(
              0x52D2808u,
              v2,
              *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
              0LL,
              0xEuLL,
              0LL);
            v7 = 3758097088LL;
          }
          goto LABEL_104;
        }
        *(_BYTE *)(v2 + 105) = 7;
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D2808u,
            v2,
            *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
            v19,
            0x10uLL,
            0LL);
        *(_BYTE *)(v2 + 105) = 21 - v16;
        v23 = *(char **)(v2 + v17 - 20);
        v24 = v2 + *(_QWORD *)(v2 + v17 - 12);
        if ( (unsigned __int8)v23 & 1 )
          v23 = *(char **)&v23[*(_QWORD *)v24 - 1];
        v3 = off_1A080[0];
        v8 = *(_WORD *)(v2 + 362);
        v7 = (unsigned int)((int (__fastcall *)(uintptr_t, __int64, _QWORD))v23)(v24, v8, *(_WORD *)(v2 + 360));
        *(_BYTE *)(v2 + 105) = 22 - v16;
        if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v25 = v7;
          v8 = v2;
          kernel_debug(
            0x52D2808u,
            v2,
            *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
            (signed int)v7,
            0x11uLL,
            0LL);
          v7 = v25;
        }
        *(_BYTE *)(v2 + 105) = 8;
        if ( (_DWORD)v7 )
          break;
        v26 = (_DWORD)v19 == 4;
        v4 = v35;
        v8 = 0x100000000LL;
        if ( !v26 )
        {
          v7 = 0LL;
          if ( !*(_BYTE *)(v2 + 103) )
            continue;
        }
        goto LABEL_70;
      }
      if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v29 = v7;
        v8 = v2;
        kernel_debug(
          0x52D2808u,
          v2,
          *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
          v18 | (signed int)v7,
          0x12uLL,
          0LL);
        goto LABEL_91;
      }
    }
LABEL_92:
    v21 = 0;
    if ( !(_DWORD)v7 )
    {
LABEL_115:
      v3 = off_1A080[0];
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v8 = v2;
        kernel_debug(
          0x52D2808u,
          v2,
          *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
          v21,
          0x15uLL,
          0LL);
      }
      IOLockUnlock(*(_QWORD *)(v2 + 368), v8);
      IOLockUnlock(*(_QWORD *)(v2 + 376), v8);
      *(_BYTE *)(v2 + 104) = 0;
      *(_DWORD *)(v2 + 408) = 0;
      if ( *(_BYTE *)(v2 + 108) )
      {
        v32 = *(IOUSBController **)(v2 + 40);
        if ( v32 )
        {
          v33 = IOUSBController::GetCommandGate(v32);
          if ( v33 )
          {
            if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
              kernel_debug(
                0x52D2808u,
                v2,
                *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
                0LL,
                0x16uLL,
                0LL);
            (*(void (__fastcall **)(__int64, char *, signed __int64))(*(_QWORD *)v33 + 488LL))(v33, v34, 1LL);
          }
        }
      }
      goto LABEL_125;
    }
LABEL_104:
    v30 = v7;
    v31 = off_1A080[0];
    if ( *(_BYTE *)(v2 + 116) )
    {
      v8 = 1431519814LL;
      KernelDebugLogInternal(1LL, 1431519814LL, "The IOUSBFamily was not able to enumerate a device.", v14, v7);
      if ( *(_BYTE *)v31 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v8 = v2;
        kernel_debug(
          0x52D2808u,
          v2,
          *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
          v30,
          0x13uLL,
          0LL);
      }
      *(_BYTE *)(v2 + 116) = 0;
    }
    if ( *(_BYTE *)(v2 + 100) )
    {
      if ( *(_BYTE *)v31 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v8 = v2;
        kernel_debug(
          0x52D2808u,
          v2,
          *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
          v30,
          0x14uLL,
          0LL);
      }
      AppleUSBHubPort::ReleaseDeviceZero(v2);
    }
    v21 = v30;
    goto LABEL_115;
  }
  if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D2808u,
      (uintptr_t)this,
      *((_DWORD *)this + 9) | ((unsigned __int64)*(_DWORD *)(*((_QWORD *)this + 6) + 296LL) << 32),
      0LL,
      1uLL,
      0LL);
  *((_BYTE *)this + 103) = 1;
LABEL_125:
  if ( *(_BYTE *)v3 & 2 )
  {
    if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D280Au,
        v2,
        *(_DWORD *)(v2 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v2 + 48) + 296LL) << 32),
        0LL,
        0LL,
        0LL);
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BA98: using guessed type int __fastcall IOLockLock(_QWORD, _QWORD);
// 2BAA0: using guessed type int __fastcall IOLockTryLock(_QWORD);
// 2BAA8: using guessed type int __fastcall IOLockUnlock(_QWORD, _QWORD);
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);
// 2BAC8: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000015BFE) ----------------------------------------------------
char __fastcall AppleUSBHubPort::StatusChanged(AppleUSBHubPort *this)
{
  __int64 v1; // rax@2
  char v2; // r14@2
  __int64 v3; // rax@3

  if ( *((_QWORD *)this + 42) )
  {
    (*(void (**)(void))(*(_QWORD *)this + 32LL))();
    LODWORD(v1) = thread_call_enter(*((_QWORD *)this + 42));
    v2 = 1;
    if ( (_DWORD)v1 == 1 )
    {
      v3 = AppleUSBHub::LowerPowerState(*((AppleUSBHub **)this + 6), v1);
      AppleUSBHub::DecrementOutstandingIO(*((AppleUSBHub **)this + 6), v3, 0);
      (*(void (__fastcall **)(AppleUSBHubPort *, _QWORD))(*(_QWORD *)this + 40LL))(this, 0LL);
    }
  }
  else
  {
    v2 = 0;
  }
  return v2;
}
// 2C7D0: using guessed type int __fastcall thread_call_enter(_QWORD);

//----- (0000000000015C5A) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::ReleaseDevZeroLock(uintptr_t arg1)
{
  uintptr_t v1; // rbx@1
  __int64 v2; // r14@1
  __int64 v3; // rdi@5
  int v4; // eax@6
  char v6; // [sp+8h] [bp-18h]@5

  v1 = arg1;
  v2 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1425u,
      arg1,
      *(_DWORD *)(arg1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL) << 32),
      *(_BYTE *)(arg1 + 100),
      0LL,
      0LL);
  if ( *(_BYTE *)(arg1 + 100) )
  {
    AppleUSBHub::GetPortStatus(*(AppleUSBHub **)(arg1 + 48), (__int64)&v6, *(_WORD *)(arg1 + 36));
    v3 = *(_QWORD *)(arg1 + 48);
    if ( !*(_BYTE *)(v3 + 426) )
    {
      v4 = AppleUSBHub::ClearPortFeature((AppleUSBHub *)v3, 1, *(_WORD *)(v1 + 36));
      if ( *(_BYTE *)v2 & 2 )
      {
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(
            0x52D1424u,
            v1,
            *(_DWORD *)(v1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL) << 32),
            v4,
            3uLL,
            0LL);
      }
    }
    if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      kernel_debug(
        0x52D1424u,
        v1,
        *(_DWORD *)(v1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL) << 32),
        *(_BYTE *)(v1 + 100),
        0LL,
        0LL);
    *(_DWORD *)(v1 + 364) = 0;
    AppleUSBHubPort::ReleaseDeviceZero(v1);
  }
  if ( *(_BYTE *)v2 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(
      0x52D1426u,
      v1,
      *(_DWORD *)(v1 + 36) | ((unsigned __int64)*(_DWORD *)(*(_QWORD *)(v1 + 48) + 296LL) << 32),
      *(_BYTE *)(v1 + 100),
      0LL,
      0LL);
  return 0LL;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000015DC8) ----------------------------------------------------
void __usercall AppleUSBHubPort::EnablePowerAfterOvercurrent(AppleUSBHubPort *this@<rdi>, uintptr_t a2@<rax>)
{
  AppleUSBHubPort *v2; // rbx@1
  IOService *v3; // rdi@3
  __int64 v4; // rdi@5
  signed int v5; // eax@5
  uintptr_t v6; // rsi@7
  int v7; // er14@7
  __int64 v8; // r15@7
  uintptr_t arg3; // [sp+0h] [bp-20h]@1

  arg3 = a2;
  v2 = this;
  if ( !*((_BYTE *)this + 418) && !(unsigned __int8)IOService::isInactive(*((IOService **)this + 6)) )
  {
    v3 = *(IOService **)(*((_QWORD *)this + 6) + 144LL);
    if ( v3 )
    {
      if ( !(unsigned __int8)IOService::isInactive(v3) )
      {
        v4 = *((_QWORD *)v2 + 6);
        v5 = *(_DWORD *)(v4 + 164);
        if ( v5 > 2 || v5 == -1 )
        {
          v6 = (uintptr_t)&arg3;
          v7 = AppleUSBHub::GetPortStatus((AppleUSBHub *)v4, (__int64)&arg3, *((_WORD *)v2 + 18));
          v8 = off_1A080[0];
          if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          {
            v6 = *(_DWORD *)(*((_QWORD *)v2 + 6) + 296LL);
            kernel_debug(0x52D143Cu, v6, *((_DWORD *)v2 + 9), arg3, 0LL, 0LL);
          }
          if ( v7 )
          {
            if ( *(_BYTE *)v8 & 2 )
            {
              if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                kernel_debug(0x52D143Cu, *(_DWORD *)(*((_QWORD *)v2 + 6) + 296LL), *((_DWORD *)v2 + 9), v7, 2uLL, 0LL);
            }
          }
          else if ( !(BYTE1(arg3) & 1) )
          {
            IOSleep(5000LL);
            if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
            {
              v6 = *(_DWORD *)(*((_QWORD *)v2 + 6) + 296LL);
              kernel_debug(0x52D143Cu, v6, *((_DWORD *)v2 + 9), *((_DWORD *)v2 + 24), 1uLL, 0LL);
            }
            (*(void (__fastcall **)(AppleUSBHubPort *, uintptr_t))(*(_QWORD *)v2 + 312LL))(v2, v6);
            *((_DWORD *)v2 + 24) = 3;
          }
        }
      }
    }
  }
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BAC0: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000015F2A) ----------------------------------------------------
char __fastcall AppleUSBHubPort::DetectExpressCardCantWake(AppleUSBHubPort *this)
{
  char v1; // r14@3
  __int64 v3; // r15@5

  if ( *((_QWORD *)this + 6) && !*((_BYTE *)this + 412) )
  {
    *((_BYTE *)this + 412) = 1;
    v3 = *((_QWORD *)this + 10);
    v1 = 1;
    if ( v3 )
    {
      (*(void (__fastcall **)(_QWORD))(*(_QWORD *)v3 + 32LL))(*((_QWORD *)this + 10));
      *((_WORD *)this + 207) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v3 + 2288LL))(v3);
      *((_WORD *)this + 208) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v3 + 2296LL))(v3);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v3 + 40LL))(v3);
    }
  }
  else
  {
    v1 = 0;
  }
  return v1;
}

//----- (0000000000015FA6) ----------------------------------------------------
uintptr_t __fastcall AppleUSBHubPort::FindSDCardReaderACPIPlatformDevice(uintptr_t arg1, char a2)
{
  char v2; // r12@1
  OSMetaClassBase *v3; // rax@1
  __int64 v4; // rsi@1
  const OSMetaClass *v5; // rdx@1
  __int64 v6; // rax@1
  uintptr_t v7; // r15@1
  __int64 v8; // rax@2
  OSMetaClassBase *v9; // rax@2
  uintptr_t v10; // rbx@2
  const char *v11; // rsi@3
  __int64 v12; // rax@7
  __int64 v13; // r12@7
  __int64 v14; // rax@8
  __int64 v15; // r13@8
  OSMetaClassBase *v16; // rax@9
  OSMetaClassBase *v17; // rbx@9
  __int64 v18; // rax@11
  __int64 v19; // rax@13
  const char *v20; // rax@14
  unsigned int v21; // er15@14
  bool v22; // zf@17
  uintptr_t v23; // rsi@19
  OSMetaClassBase *v24; // rax@21

  v2 = a2;
  LODWORD(v3) = (*(int (__fastcall **)(_QWORD, _QWORD, _QWORD, signed __int64))(**(_QWORD **)(*(_QWORD *)(arg1 + 48)
                                                                                            + 144LL)
                                                                              + 720LL))(
                  *(_QWORD *)(*(_QWORD *)(arg1 + 48) + 144LL),
                  "acpi-path",
                  *(_QWORD *)off_1A078[0],
                  3LL);
  v4 = *(_QWORD *)off_1A040[0];
  v6 = OSMetaClassBase::safeMetaCast(v3, *(const OSMetaClassBase **)off_1A040[0], v5);
  v7 = 0LL;
  if ( v6 )
  {
    LODWORD(v8) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v6 + 328LL))(v6, v4);
    v7 = 0LL;
    LODWORD(v9) = IORegistryEntry::fromPath(v8, 0LL, 0LL, 0LL, 0LL);
    v10 = (uintptr_t)v9;
    if ( v9 )
    {
      v11 = "IOACPIPlatformDevice";
      v7 = 0LL;
      if ( OSMetaClassBase::metaCast(v9, "IOACPIPlatformDevice") )
      {
        if ( v2
          || (v7 = v10, (*(int (__fastcall **)(uintptr_t, _QWORD))(*(_QWORD *)v10 + 2224LL))(v10, "SRST"))
          && (v11 = "SPWR", v7 = v10, (*(int (__fastcall **)(uintptr_t, _QWORD))(*(_QWORD *)v10 + 2224LL))(v10, "SPWR")) )
        {
          v12 = IORegistryEntry::getPlane("IOACPIPlane", v11);
          v13 = v12;
          v7 = 0LL;
          if ( v12 )
          {
            LODWORD(v14) = IORegistryIterator::iterateOver(v10, v12, 1LL);
            v15 = v14;
            v7 = 0LL;
            if ( v14 )
            {
              LODWORD(v16) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v14 + 296LL))(v14);
              v17 = v16;
              v7 = 0LL;
              if ( v16 )
              {
                v7 = 0LL;
                while ( 1 )
                {
                  LODWORD(v18) = (*(int (__fastcall **)(OSMetaClassBase *, __int64))(*(_QWORD *)v17 + 816LL))(v17, v13);
                  if ( !v18 && OSMetaClassBase::metaCast(v17, "IOACPIPlatformDevice") )
                  {
                    LODWORD(v19) = (*(int (__fastcall **)(OSMetaClassBase *, _QWORD))(*(_QWORD *)v17 + 952LL))(v17, 0LL);
                    if ( !v19 )
                      goto LABEL_27;
                    LODWORD(v20) = (*(int (__fastcall **)(OSMetaClassBase *, _QWORD))(*(_QWORD *)v17 + 952LL))(v17, 0LL);
                    v21 = strtoul(v20, 0LL, 16);
                    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                      kernel_debug(0x52D1448u, arg1, *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), v21, 5uLL, 0LL);
                    v22 = *(_DWORD *)(arg1 + 36) == v21;
                    v7 = 0LL;
                    if ( v22
                      || !(*(int (__fastcall **)(OSMetaClassBase *, _QWORD))(*(_QWORD *)v17 + 2224LL))(v17, "U3SD") )
                    {
                      v23 = (uintptr_t)"SRST";
                      if ( !(*(int (__fastcall **)(OSMetaClassBase *, _QWORD))(*(_QWORD *)v17 + 2224LL))(v17, "SRST") )
                        break;
                      v23 = (uintptr_t)"_GPE";
                      if ( !(*(int (__fastcall **)(OSMetaClassBase *, _QWORD))(*(_QWORD *)v17 + 2224LL))(v17, "_GPE") )
                        break;
                    }
                  }
                  LODWORD(v24) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v15 + 296LL))(v15);
                  v17 = v24;
                  if ( !v24 )
                    goto LABEL_27;
                }
                if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
                {
                  v23 = arg1;
                  kernel_debug(0x52D1448u, arg1, *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), 0LL, 6uLL, 0LL);
                }
                (*(void (__fastcall **)(OSMetaClassBase *, uintptr_t))(*(_QWORD *)v17 + 32LL))(v17, v23);
                v7 = (uintptr_t)v17;
              }
LABEL_27:
              (*(void (__fastcall **)(__int64))(*(_QWORD *)v15 + 40LL))(v15);
            }
          }
        }
      }
    }
  }
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1448u, arg1, *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), v7, 7uLL, 0LL);
  return v7;
}
// 1A040: using guessed type _QWORD off_1A040[12];
// 1A078: using guessed type __int64 off_1A078[5];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 2BE68: using guessed type int __fastcall IORegistryEntry::fromPath(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);
// 2BF40: using guessed type int __fastcall IORegistryIterator::iterateOver(_QWORD, _QWORD, _QWORD);

//----- (0000000000016298) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::SDControllerPower(uintptr_t arg1, unsigned __int8 a2)
{
  unsigned __int8 v2; // r12@1
  __int64 v3; // r13@1
  __int64 v4; // rax@4
  __int64 v5; // rbx@4
  signed int v6; // er14@4
  unsigned int v7; // edx@5
  uintptr_t v8; // rsi@6
  __int64 v9; // rax@6
  __int64 v10; // r12@6
  int v11; // eax@7
  __int64 result; // rax@18
  int v13; // [sp+4h] [bp-3Ch]@1
  __int64 v14; // [sp+8h] [bp-38h]@1
  __int64 v15; // [sp+10h] [bp-30h]@1

  v2 = a2;
  v15 = *(_QWORD *)off_1A070[0];
  v13 = 0;
  v14 = 0LL;
  v3 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1448u, arg1, *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), a2, 1uLL, 0LL);
  v4 = AppleUSBHubPort::FindSDCardReaderACPIPlatformDevice(arg1, 0);
  v5 = v4;
  v6 = -536870212;
  if ( v4 )
  {
    if ( AppleUSBHubPort::CheckForPowerOffSupport(arg1, v4) )
    {
      v13 = a2;
      v8 = 32LL;
      v9 = OSNumber::withNumber((OSNumber *)v2, 0x20uLL, v7);
      v10 = v9;
      v6 = -536870212;
      if ( v9 )
      {
        v14 = v9;
        v8 = (uintptr_t)"SPWR";
        v6 = 0;
        v11 = (*(int (__fastcall **)(__int64, _QWORD, int *, __int64 *, signed __int64, _QWORD))(*(_QWORD *)v5 + 2256LL))(
                v5,
                "SPWR",
                &v13,
                &v14,
                1LL,
                0LL);
        if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v8 = arg1;
          kernel_debug(0x52D1448u, arg1, *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), v11, 3uLL, 0LL);
        }
        (*(void (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v10 + 40LL))(v10, v8);
      }
      (*(void (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v5 + 40LL))(v5, v8);
    }
    else
    {
      v6 = -536870201;
      if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1448u, arg1, *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), 0LL, 2uLL, 0LL);
    }
  }
  if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1448u, arg1, *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), v6, 4uLL, 0LL);
  result = *(_QWORD *)off_1A070[0];
  if ( *(_QWORD *)off_1A070[0] == v15 )
    result = (unsigned int)v6;
  return result;
}
// 1A070: using guessed type __int64 off_1A070[6];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000016472) ----------------------------------------------------
bool __fastcall AppleUSBHubPort::CheckForPowerOffSupport(uintptr_t arg1, __int64 a2)
{
  bool v2; // bl@2

  if ( a2 )
    v2 = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)a2 + 2224LL))(a2, "SPWR") == 0;
  else
    v2 = 0;
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1448u, arg1, *(_DWORD *)(*(_QWORD *)(arg1 + 48) + 296LL), v2, 0LL, 0LL);
  return v2;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (00000000000164E2) ----------------------------------------------------
__int64 __fastcall AppleUSBHubPort::MetaClass::~MetaClass(AppleUSBHubPort::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (00000000000164F0) ----------------------------------------------------
__int64 `global constructor keyed to'_a_0()
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(&AppleUSBHubPort::gMetaClass, "AppleUSBHubPort", off_1A038[0], 432LL);
  result = (__int64)off_1AE10;
  AppleUSBHubPort::gMetaClass = off_1AE10;
  return result;
}
// 1A038: using guessed type _QWORD off_1A038[13];
// 1AE10: using guessed type __int64 (__fastcall *off_1AE10[2])(AppleUSBHubPort::MetaClass *__hidden this);
// 1BC88: using guessed type _QWORD AppleUSBHubPort::gMetaClass;
// 2BB40: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000016530) ----------------------------------------------------
__int64 `global destructor keyed to'_a_0()
{
  return OSMetaClass::~OSMetaClass((OSMetaClass *)&AppleUSBHubPort::gMetaClass);
}
// 1BC88: using guessed type _QWORD AppleUSBHubPort::gMetaClass;

//----- (0000000000016550) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::MetaClass::MetaClass(AppleUSBHSHubUserClient::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBHSHubUserClient", off_1A000[0], 256LL);
  result = (__int64)off_1B890;
  *(_QWORD *)this = off_1B890;
  return result;
}
// 1A000: using guessed type _QWORD off_1A000[20];
// 1B890: using guessed type __int64 (__fastcall *off_1B890[2])(AppleUSBHSHubUserClient::MetaClass *__hidden this);
// 2BB40: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000016582) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::MetaClass::~MetaClass(AppleUSBHSHubUserClient::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (000000000001658C) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::AppleUSBHSHubUserClient(__int64 a1)
{
  __int64 result; // rax@1

  IOUserClient::IOUserClient(a1);
  result = (__int64)off_1AF10;
  *(_QWORD *)a1 = off_1AF10;
  return result;
}
// 1AF10: using guessed type __int64 (__fastcall *off_1AF10[2])(AppleUSBHSHubUserClient *__hidden this);
// 2BC78: using guessed type int __cdecl IOUserClient::IOUserClient(_QWORD);

//----- (00000000000165AC) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::AppleUSBHSHubUserClient(__int64 a1)
{
  __int64 result; // rax@1

  IOUserClient::IOUserClient(a1);
  result = (__int64)off_1AF10;
  *(_QWORD *)a1 = off_1AF10;
  return result;
}
// 1AF10: using guessed type __int64 (__fastcall *off_1AF10[2])(AppleUSBHSHubUserClient *__hidden this);
// 2BC78: using guessed type int __cdecl IOUserClient::IOUserClient(_QWORD);

//----- (00000000000165CC) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::~AppleUSBHSHubUserClient(AppleUSBHSHubUserClient *this)
{
  return IOUserClient::~IOUserClient(this);
}

//----- (00000000000165D6) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::~AppleUSBHSHubUserClient(AppleUSBHSHubUserClient *this)
{
  return IOUserClient::~IOUserClient(this);
}

//----- (00000000000165E0) ----------------------------------------------------
void __fastcall AppleUSBHSHubUserClient::~AppleUSBHSHubUserClient(AppleUSBHSHubUserClient *this)
{
  IOUserClient::~IOUserClient(this);
  OSObject::operator delete((void *)this);
}

//----- (0000000000016602) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::getMetaClass(AppleUSBHSHubUserClient *this)
{
  return (__int64)&AppleUSBHSHubUserClient::gMetaClass;
}
// 1BCB0: using guessed type _QWORD AppleUSBHSHubUserClient::gMetaClass;

//----- (0000000000016610) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::MetaClass::MetaClass(AppleUSBHSHubUserClient::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBHSHubUserClient", off_1A000[0], 256LL);
  result = (__int64)off_1B890;
  *(_QWORD *)this = off_1B890;
  return result;
}
// 1A000: using guessed type _QWORD off_1A000[20];
// 1B890: using guessed type __int64 (__fastcall *off_1B890[2])(AppleUSBHSHubUserClient::MetaClass *__hidden this);
// 2BB40: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000016642) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::MetaClass::alloc(AppleUSBHSHubUserClient::MetaClass *this, unsigned __int64 a2)
{
  __int64 v2; // rbx@1

  v2 = OSObject::operator new((OSObject *)&stru_B8.reserved2, a2);
  IOUserClient::IOUserClient(v2);
  *(_QWORD *)v2 = off_1AF10;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBHSHubUserClient::gMetaClass);
  return v2;
}
// B8: using guessed type section_64;
// 1AF10: using guessed type __int64 (__fastcall *off_1AF10[2])(AppleUSBHSHubUserClient *__hidden this);
// 1BCB0: using guessed type _QWORD AppleUSBHSHubUserClient::gMetaClass;
// 2BC78: using guessed type int __cdecl IOUserClient::IOUserClient(_QWORD);

//----- (0000000000016682) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::AppleUSBHSHubUserClient(__int64 a1)
{
  IOUserClient::IOUserClient(a1);
  *(_QWORD *)a1 = off_1AF10;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBHSHubUserClient::gMetaClass);
}
// 1AF10: using guessed type __int64 (__fastcall *off_1AF10[2])(AppleUSBHSHubUserClient *__hidden this);
// 1BCB0: using guessed type _QWORD AppleUSBHSHubUserClient::gMetaClass;
// 2BC78: using guessed type int __cdecl IOUserClient::IOUserClient(_QWORD);

//----- (00000000000166B2) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::AppleUSBHSHubUserClient(__int64 a1)
{
  IOUserClient::IOUserClient(a1);
  *(_QWORD *)a1 = off_1AF10;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBHSHubUserClient::gMetaClass);
}
// 1AF10: using guessed type __int64 (__fastcall *off_1AF10[2])(AppleUSBHSHubUserClient *__hidden this);
// 1BCB0: using guessed type _QWORD AppleUSBHSHubUserClient::gMetaClass;
// 2BC78: using guessed type int __cdecl IOUserClient::IOUserClient(_QWORD);

//----- (00000000000166E2) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_open(__int64 a1, __int64 a2, __int64 a3)
{
  __int64 v3; // r15@1
  __int64 v4; // rbx@1
  __int64 v5; // rdi@1
  signed int v6; // er14@1

  v3 = a3;
  v4 = a1;
  (*(void (__cdecl **)(__int64))(*(_QWORD *)a1 + 32LL))(a1);
  v5 = *(_QWORD *)(a1 + 216);
  v6 = -536870183;
  if ( v5 )
  {
    v6 = -536870203;
    if ( (unsigned __int8)(*(int (__fastcall **)(__int64, __int64, _QWORD, _QWORD))(*(_QWORD *)v5 + 1488LL))(
                            v5,
                            v4,
                            **(_QWORD **)(v3 + 32) != 0LL,
                            0LL) )
      v6 = 0;
  }
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v4 + 40LL))(v4);
  return (unsigned int)v6;
}

//----- (000000000001674C) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_close(uintptr_t arg1)
{
  unsigned int v1; // er14@1

  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  v1 = AppleUSBHSHubUserClient::Close(arg1);
  (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
  return v1;
}

//----- (0000000000016778) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_IsEHCIRootHub(__int64 a1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1
  __int64 v4; // rbx@1
  AppleUSBHub *v5; // rdi@1
  signed int v6; // er15@1
  __int64 v7; // r14@2

  v3 = a3;
  v4 = a1;
  (*(void (__cdecl **)(__int64))(*(_QWORD *)a1 + 32LL))(a1);
  v5 = *(AppleUSBHub **)(a1 + 216);
  v6 = -536870183;
  if ( v5 )
  {
    v7 = *(_QWORD *)(v3 + 72);
    *(_QWORD *)v7 = (unsigned __int8)AppleUSBHub::IsHSRootHub(v5);
    v6 = 0;
  }
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v4 + 40LL))(v4);
  return (unsigned int)v6;
}

//----- (00000000000167CA) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_EnterTestMode(AppleUSBHSHubUserClient *this)
{
  int v1; // er14@1

  (*(void (**)(void))(*(_QWORD *)this + 32LL))();
  v1 = AppleUSBHSHubUserClient::EnterTestMode(this);
  (*(void (__fastcall **)(AppleUSBHSHubUserClient *))(*(_QWORD *)this + 40LL))(this);
  return (unsigned int)v1;
}

//----- (00000000000167F6) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_LeaveTestMode(__int64 a1)
{
  __int64 v1; // rbx@1
  __int64 v2; // rax@1
  const OSMetaClass *v3; // rdx@1
  AppleUSBHub *v4; // rdi@1
  int v5; // er14@1

  v1 = a1;
  LODWORD(v2) = (*(int (**)(void))(*(_QWORD *)a1 + 32LL))();
  v4 = *(AppleUSBHub **)(a1 + 216);
  v5 = -536870183;
  if ( v4 )
    v5 = AppleUSBHub::LeaveTestMode(v4, v2, v3);
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v1 + 40LL))(v1);
  return (unsigned int)v5;
}

//----- (0000000000016832) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_GetNumberOfPorts(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  LODWORD(v3) = AppleUSBHSHubUserClient::GetNumberOfPorts(arg1, *(unsigned __int64 **)(v3 + 72));
  (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
  return (unsigned int)v3;
}

//----- (0000000000016866) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_PutPortIntoTestMode(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1
  __int64 v4; // rax@1
  uintptr_t v5; // rsi@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  v4 = *(_QWORD *)(v3 + 32);
  v5 = *(_QWORD *)v4;
  LODWORD(v3) = AppleUSBHSHubUserClient::PutPortIntoTestMode(arg1, *(_QWORD *)v4, *(_QWORD *)(v4 + 8));
  (*(void (__fastcall **)(uintptr_t, uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1, v5);
  return (unsigned int)v3;
}

//----- (00000000000168A0) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_GetLocationID(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  LODWORD(v3) = AppleUSBHSHubUserClient::GetLocationID(arg1, *(unsigned __int64 **)(v3 + 72));
  (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
  return (unsigned int)v3;
}

//----- (00000000000168D4) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_SupportsIndicators(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  LODWORD(v3) = AppleUSBHSHubUserClient::SupportsIndicators(arg1, *(unsigned __int64 **)(v3 + 72));
  (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
  return (unsigned int)v3;
}

//----- (0000000000016908) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_SetIndicatorForPort(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1
  __int64 v4; // rax@1
  uintptr_t v5; // rsi@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  v4 = *(_QWORD *)(v3 + 32);
  v5 = *(_QWORD *)v4;
  LODWORD(v3) = AppleUSBHSHubUserClient::SetIndicatorForPort(arg1, *(_QWORD *)v4, *(_QWORD *)(v4 + 8));
  (*(void (__fastcall **)(uintptr_t, uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1, v5);
  return (unsigned int)v3;
}

//----- (0000000000016942) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_GetPortIndicatorControl(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  LODWORD(v3) = AppleUSBHSHubUserClient::GetPortIndicatorControl(
                  arg1,
                  **(_QWORD **)(v3 + 32),
                  *(unsigned __int64 **)(v3 + 72));
  (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
  return (unsigned int)v3;
}

//----- (000000000001697C) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_SetIndicatorsToAutomatic(uintptr_t arg1)
{
  unsigned int v1; // er14@1

  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  v1 = AppleUSBHSHubUserClient::SetIndicatorsToAutomatic(arg1);
  (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
  return v1;
}

//----- (00000000000169A8) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_GetPowerSwitchingMode(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  LODWORD(v3) = AppleUSBHSHubUserClient::GetPowerSwitchingMode(arg1, *(unsigned __int64 **)(v3 + 72));
  (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
  return (unsigned int)v3;
}

//----- (00000000000169DC) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_SetPortPower(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1
  __int64 v4; // rax@1
  uintptr_t v5; // rsi@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  v4 = *(_QWORD *)(v3 + 32);
  v5 = *(_QWORD *)v4;
  LODWORD(v3) = AppleUSBHSHubUserClient::SetPortPower(arg1, *(_QWORD *)v4, *(_QWORD *)(v4 + 8));
  (*(void (__fastcall **)(uintptr_t, uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1, v5);
  return (unsigned int)v3;
}

//----- (0000000000016A16) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_GetPortPower(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  LODWORD(v3) = AppleUSBHSHubUserClient::GetPortPower(arg1, **(_QWORD **)(v3 + 32), *(unsigned __int64 **)(v3 + 72));
  (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
  return (unsigned int)v3;
}

//----- (0000000000016A50) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_DisablePowerManagement(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  LODWORD(v3) = AppleUSBHSHubUserClient::DisablePowerManagement(arg1, **(_QWORD **)(v3 + 32));
  (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
  return (unsigned int)v3;
}

//----- (0000000000016A86) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_PortReset(AppleUSBHSHubUserClient *this, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)this + 32LL))();
  LODWORD(v3) = AppleUSBHSHubUserClient::PortReset(this, **(_QWORD **)(v3 + 32));
  (*(void (__fastcall **)(AppleUSBHSHubUserClient *))(*(_QWORD *)this + 40LL))(this);
  return (unsigned int)v3;
}

//----- (0000000000016ABC) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_PortWarmReset(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  LODWORD(v3) = AppleUSBHSHubUserClient::PortWarmReset(arg1, **(_QWORD **)(v3 + 32));
  (*(void (__fastcall **)(uintptr_t))(*(_QWORD *)arg1 + 40LL))(arg1);
  return (unsigned int)v3;
}

//----- (0000000000016AF2) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_PortLinkState(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1
  __int64 v4; // rax@1
  __int64 v5; // rsi@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  v4 = *(_QWORD *)(v3 + 32);
  v5 = *(_QWORD *)v4;
  LODWORD(v3) = AppleUSBHSHubUserClient::PortLinkState(arg1, *(_QWORD *)v4, *(_QWORD *)(v4 + 8));
  (*(void (__fastcall **)(uintptr_t, __int64))(*(_QWORD *)arg1 + 40LL))(arg1, v5);
  return (unsigned int)v3;
}

//----- (0000000000016B2C) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_PortU1Timeout(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1
  __int64 v4; // rax@1
  __int64 v5; // rsi@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  v4 = *(_QWORD *)(v3 + 32);
  v5 = *(_QWORD *)v4;
  LODWORD(v3) = AppleUSBHSHubUserClient::PortU1Timeout(arg1, *(_QWORD *)v4, *(_QWORD *)(v4 + 8));
  (*(void (__fastcall **)(uintptr_t, __int64))(*(_QWORD *)arg1 + 40LL))(arg1, v5);
  return (unsigned int)v3;
}

//----- (0000000000016B66) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_PortU2Timeout(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1
  __int64 v4; // rax@1
  __int64 v5; // rsi@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  v4 = *(_QWORD *)(v3 + 32);
  v5 = *(_QWORD *)v4;
  LODWORD(v3) = AppleUSBHSHubUserClient::PortU2Timeout(arg1, *(_QWORD *)v4, *(_QWORD *)(v4 + 8));
  (*(void (__fastcall **)(uintptr_t, __int64))(*(_QWORD *)arg1 + 40LL))(arg1, v5);
  return (unsigned int)v3;
}

//----- (0000000000016BA0) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_PortRemoteWakeMask(uintptr_t arg1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1
  __int64 v4; // rax@1
  __int64 v5; // rsi@1

  v3 = a3;
  (*(void (**)(void))(*(_QWORD *)arg1 + 32LL))();
  v4 = *(_QWORD *)(v3 + 32);
  v5 = *(_QWORD *)v4;
  LODWORD(v3) = AppleUSBHSHubUserClient::PortRemoteWakeMask(arg1, *(_QWORD *)v4, *(_QWORD *)(v4 + 8));
  (*(void (__fastcall **)(uintptr_t, __int64))(*(_QWORD *)arg1 + 40LL))(arg1, v5);
  return (unsigned int)v3;
}

//----- (0000000000016BDA) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::_GetPortPwrMgmtState(__int64 a1, __int64 a2, __int64 a3)
{
  __int64 v3; // r14@1
  __int64 v4; // rbx@1
  AppleUSBHub *v5; // rdi@1
  signed int v6; // er15@1
  unsigned __int64 *v7; // rdx@2
  unsigned int v8; // esi@2

  v3 = a3;
  v4 = a1;
  (*(void (__cdecl **)(__int64))(*(_QWORD *)a1 + 32LL))(a1);
  v5 = *(AppleUSBHub **)(a1 + 216);
  v6 = -536870183;
  if ( v5 )
  {
    v7 = *(unsigned __int64 **)(v3 + 72);
    v8 = **(_WORD **)(v3 + 32);
    *v7 = 0LL;
    v6 = AppleUSBHub::GetPortPowerMgmtState(v5, v8, v7);
  }
  (*(void (__fastcall **)(__int64))(*(_QWORD *)v4 + 40LL))(v4);
  return (unsigned int)v6;
}

//----- (0000000000016C34) ----------------------------------------------------
int AppleUSBHSHubUserClient::externalMethod()
{
  return (*(int (**)(void))(off_1A058[0] + 2144))();
}
// 1A058: using guessed type __int64 off_1A058[9];

//----- (0000000000016C64) ----------------------------------------------------
char __fastcall AppleUSBHSHubUserClient::initWithTask(uintptr_t arg1, uintptr_t arg2, IOUserClient *this, uintptr_t arg4, __int64 a5)
{
  __int64 v5; // r12@1
  unsigned int v6; // er13@1
  IOUserClient *v7; // r15@1
  const char *v8; // rdx@5
  char result; // al@8

  v5 = a5;
  v6 = arg4;
  v7 = this;
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1804u, arg1, arg2, (uintptr_t)this, (unsigned int)arg4, 0LL);
  if ( arg2
    && (unsigned __int8)(*(int (__fastcall **)(uintptr_t, uintptr_t, IOUserClient *, _QWORD, __int64))(off_1A058[0] + 2288))(
                          arg1,
                          arg2,
                          v7,
                          v6,
                          v5) )
  {
    if ( !(unsigned int)IOUserClient::clientHasPrivilege(v7, "root", v8) )
      *(_BYTE *)(arg1 + 249) = 1;
    *(_QWORD *)(arg1 + 224) = arg2;
    *(_QWORD *)(arg1 + 216) = 0LL;
    *(_QWORD *)(arg1 + 232) = 0LL;
    *(_BYTE *)(arg1 + 248) = 0;
    *(_BYTE *)(arg1 + 250) = 0;
    result = 1;
  }
  else
  {
    result = 0;
  }
  return result;
}
// 1A058: using guessed type __int64 off_1A058[9];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000016D34) ----------------------------------------------------
int __fastcall AppleUSBHSHubUserClient::start(uintptr_t arg1, IOService *a2, const OSMetaClass *a3)
{
  uintptr_t v3; // rax@1
  int result; // eax@5

  v3 = OSMetaClassBase::safeMetaCast(a2, (const OSMetaClassBase *)AppleUSBHub::metaClass, a3);
  *(_QWORD *)(arg1 + 216) = v3;
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
  {
    kernel_debug(0x52D1808u, arg1, v3, 0LL, 0LL, 0LL);
    v3 = *(_QWORD *)(arg1 + 216);
  }
  if ( v3 )
    result = (*(int (__fastcall **)(uintptr_t, IOService *))(off_1A058[0] + 1488))(arg1, a2);
  else
    result = 0;
  return result;
}
// 1A058: using guessed type __int64 off_1A058[9];
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;
// 1A0D0: using guessed type _QWORD AppleUSBHub::metaClass;
// 2BEE0: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (0000000000016DB6) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::Open(AppleUSBHSHubUserClient *this, unsigned __int8 a2)
{
  AppleUSBHSHubUserClient *v2; // r8@1
  __int64 v3; // rdi@1
  __int64 result; // rax@1
  bool v5; // zf@2

  v2 = this;
  v3 = *((_QWORD *)this + 27);
  result = 3758097113LL;
  if ( v3 )
  {
    v5 = (unsigned __int8)(*(int (__fastcall **)(__int64, AppleUSBHSHubUserClient *, _QWORD, _QWORD))(*(_QWORD *)v3 + 1488LL))(
                            v3,
                            v2,
                            a2,
                            0LL) == 0;
    result = 3758097093LL;
    if ( !v5 )
      result = 0LL;
  }
  return result;
}

//----- (0000000000016DF6) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::Close(uintptr_t arg1)
{
  uintptr_t v1; // r14@1
  __int64 v2; // rdi@4
  signed int v3; // ebx@4

  v1 = arg1;
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D180Cu, arg1, *(_QWORD *)(arg1 + 216), 0LL, 0LL, 0LL);
  v2 = *(_QWORD *)(arg1 + 216);
  v3 = -536870183;
  if ( v2 )
  {
    v3 = 0;
    if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v2 + 1504LL))(v2, v1) )
    {
      v3 = 0;
      (*(void (__fastcall **)(_QWORD, uintptr_t, _QWORD))(**(_QWORD **)(v1 + 216) + 1496LL))(
        *(_QWORD *)(v1 + 216),
        v1,
        0LL);
    }
  }
  return (unsigned int)v3;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000016E78) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::IsEHCIRootHub(AppleUSBHSHubUserClient *this, unsigned __int64 *a2)
{
  AppleUSBHub *v2; // rdi@1
  __int64 result; // rax@1

  v2 = (AppleUSBHub *)*((_QWORD *)this + 27);
  result = 3758097113LL;
  if ( v2 )
  {
    *a2 = (unsigned __int8)AppleUSBHub::IsHSRootHub(v2);
    result = 0LL;
  }
  return result;
}

//----- (0000000000016EA6) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::GetNumberOfPorts(uintptr_t arg1, unsigned __int64 *a2)
{
  uintptr_t v2; // rdx@1
  signed int v3; // ebx@1
  unsigned __int64 v4; // rcx@2

  v2 = *(_QWORD *)(arg1 + 216);
  v3 = -536870183;
  if ( v2 )
  {
    v4 = *(_BYTE *)(v2 + 218);
    *a2 = v4;
    v3 = 0;
    if ( *(_BYTE *)off_1A080[0] & 2 )
    {
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v3 = 0;
        kernel_debug(0x52D1810u, arg1, v2, v4, 0LL, 0LL);
      }
    }
  }
  return (unsigned int)v3;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000016F06) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::GetLocationID(uintptr_t arg1, unsigned __int64 *a2)
{
  uintptr_t v2; // rdx@1
  __int64 result; // rax@1

  v2 = *(_QWORD *)(arg1 + 216);
  result = 3758097113LL;
  if ( v2 )
  {
    if ( *(_BYTE *)off_1A080[0] & 2 )
    {
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        kernel_debug(0x52D1814u, arg1, v2, *(_DWORD *)(v2 + 296), 0LL, 0LL);
        v2 = *(_QWORD *)(arg1 + 216);
      }
    }
    *a2 = *(_DWORD *)(v2 + 296);
    result = 0LL;
  }
  return result;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000016F70) ----------------------------------------------------
int __fastcall AppleUSBHSHubUserClient::EnterTestMode(AppleUSBHSHubUserClient *this)
{
  AppleUSBHSHubUserClient *v1; // rbx@1
  __int64 v2; // rdi@1
  int result; // eax@1
  char v4; // cl@2

  v1 = this;
  v2 = *((_QWORD *)this + 27);
  result = -536870183;
  if ( v2 )
  {
    v4 = (*(int (__fastcall **)(__int64, AppleUSBHSHubUserClient *))(*(_QWORD *)v2 + 1504LL))(v2, v1);
    result = -536870206;
    if ( v4 )
      result = AppleUSBHub::EnterTestMode(*((AppleUSBHub **)v1 + 27));
  }
  return result;
}

//----- (0000000000016FBA) ----------------------------------------------------
int __usercall AppleUSBHSHubUserClient::LeaveTestMode@<eax>(AppleUSBHSHubUserClient *this@<rdi>, __int64 a2@<rax>, const OSMetaClass *a3@<rdx>)
{
  AppleUSBHub *v3; // rdi@1
  int result; // eax@2

  v3 = (AppleUSBHub *)*((_QWORD *)this + 27);
  if ( v3 )
    result = AppleUSBHub::LeaveTestMode(v3, a2, a3);
  else
    result = -536870183;
  return result;
}

//----- (0000000000016FD8) ----------------------------------------------------
int __fastcall AppleUSBHSHubUserClient::PutPortIntoTestMode(uintptr_t arg1, uintptr_t a2, uintptr_t a3)
{
  unsigned int v3; // er14@1
  uintptr_t v4; // rbx@1
  __int64 v5; // r13@1
  __int64 v6; // rdi@4
  signed int v7; // er12@4

  v3 = a3;
  v4 = arg1;
  v5 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1818u, arg1, *(_QWORD *)(arg1 + 216), a2, a3, 0LL);
  v6 = *(_QWORD *)(arg1 + 216);
  v7 = -536870183;
  if ( v6 )
  {
    if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v6 + 1504LL))(v6, v4) )
      return AppleUSBHub::PutPortIntoTestMode(*(AppleUSBHub **)(v4 + 216), a2, v3);
    v7 = -536870206;
    if ( *(_BYTE *)v5 & 2 )
    {
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        kernel_debug(0x52D1818u, v4, *(_QWORD *)(v4 + 216), 0xFFFFFFFFE00002C2LL, 0LL, 0LL);
    }
  }
  return v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (00000000000170BA) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::SupportsIndicators(uintptr_t arg1, unsigned __int64 *a2)
{
  uintptr_t v2; // rdx@1
  signed int v3; // ebx@1
  unsigned __int64 v4; // rcx@2

  v2 = *(_QWORD *)(arg1 + 216);
  v3 = -536870183;
  if ( v2 )
  {
    v4 = ((unsigned int)*(_WORD *)(v2 + 219) >> 7) & 1;
    *a2 = v4;
    v3 = 0;
    if ( *(_BYTE *)off_1A080[0] & 2 )
    {
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v3 = 0;
        kernel_debug(0x52D181Cu, arg1, v2, v4, 0LL, 0LL);
      }
    }
  }
  return (unsigned int)v3;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000017120) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::SetIndicatorForPort(uintptr_t arg1, uintptr_t arg3, uintptr_t arg4)
{
  __int16 v3; // r14@1
  uintptr_t v4; // rbx@1
  __int64 v5; // r13@1
  __int64 v6; // rdi@4
  signed int v7; // er12@4

  v3 = arg4;
  v4 = arg1;
  v5 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1820u, arg1, *(_QWORD *)(arg1 + 216), (unsigned int)arg3, (unsigned int)arg4, 0LL);
  v6 = *(_QWORD *)(arg1 + 216);
  v7 = -536870183;
  if ( v6 )
  {
    v7 = -536870207;
    if ( *(_BYTE *)(v4 + 249) )
    {
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v6 + 1504LL))(v6, v4) )
        return AppleUSBHub::SetIndicatorForPort(*(AppleUSBHub **)(v4 + 216), (unsigned __int16)arg3, v3);
      v7 = -536870206;
      if ( *(_BYTE *)v5 & 2 )
      {
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D1820u, v4, *(_QWORD *)(v4 + 216), 0xFFFFFFFFE00002C2LL, 0LL, 0LL);
      }
    }
  }
  return (unsigned int)v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000017214) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::GetPortIndicatorControl(uintptr_t arg1, unsigned int a2, unsigned __int64 *a3)
{
  unsigned __int64 *v3; // r12@1
  unsigned int v4; // er15@1
  uintptr_t v5; // rbx@1
  __int64 v6; // rdi@1
  signed int v7; // er14@1
  uintptr_t v8; // rcx@3
  uintptr_t v9; // rsi@5
  uintptr_t v10; // r8@5
  uintptr_t v11; // rdx@5
  unsigned int v13; // [sp+Ch] [bp-24h]@1

  v3 = a3;
  v4 = a2;
  v5 = arg1;
  v13 = 0;
  v6 = *(_QWORD *)(arg1 + 216);
  v7 = -536870183;
  if ( v6 )
  {
    if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v6 + 1504LL))(v6, v5) )
    {
      v7 = AppleUSBHub::GetPortIndicatorControl(*(AppleUSBHub **)(v5 + 216), (unsigned __int16)a2, &v13);
      v8 = v13;
      *v3 = v13;
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v9 = *(_QWORD *)(v5 + 216);
        v10 = v7;
        v11 = v4;
LABEL_9:
        kernel_debug(0x52D1824u, v9, v11, v8, v10, 0LL);
        return (unsigned int)v7;
      }
    }
    else
    {
      v7 = -536870206;
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v11 = *(_QWORD *)(v5 + 216);
        v8 = -536870206LL;
        v10 = 0LL;
        v9 = v5;
        goto LABEL_9;
      }
    }
  }
  return (unsigned int)v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (00000000000172FC) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::SetIndicatorsToAutomatic(uintptr_t arg1)
{
  uintptr_t v1; // rbx@1
  __int64 v2; // r15@1
  __int64 v3; // rdi@4
  signed int v4; // er14@4

  v1 = arg1;
  v2 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1828u, arg1, *(_QWORD *)(arg1 + 216), 0LL, 0LL, 0LL);
  v3 = *(_QWORD *)(arg1 + 216);
  v4 = -536870183;
  if ( v3 )
  {
    v4 = -536870207;
    if ( *(_BYTE *)(v1 + 249) )
    {
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v3 + 1504LL))(v3, v1) )
        return AppleUSBHub::SetIndicatorsToAutomatic(*(AppleUSBHub **)(v1 + 216));
      v4 = -536870206;
      if ( *(_BYTE *)v2 & 2 )
      {
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D1828u, v1, *(_QWORD *)(v1 + 216), 0xFFFFFFFFE00002C2LL, 0LL, 0LL);
      }
    }
  }
  return (unsigned int)v4;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (00000000000173D2) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::GetPowerSwitchingMode(uintptr_t arg1, unsigned __int64 *a2)
{
  uintptr_t v2; // rdx@1
  signed int v3; // ebx@1
  unsigned __int64 v4; // rcx@2

  v2 = *(_QWORD *)(arg1 + 216);
  v3 = -536870183;
  if ( v2 )
  {
    v4 = *(_WORD *)(v2 + 219) != 0;
    *a2 = v4;
    v3 = 0;
    if ( *(_BYTE *)off_1A080[0] & 2 )
    {
      if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v3 = 0;
        kernel_debug(0x52D182Cu, arg1, v2, v4, 0LL, 0LL);
      }
    }
  }
  return (unsigned int)v3;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000017438) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::GetPortPower(uintptr_t arg1, uintptr_t a2, unsigned __int64 *a3)
{
  unsigned __int64 *v3; // r12@1
  uintptr_t v4; // r15@1
  uintptr_t v5; // rbx@1
  __int64 v6; // rdi@1
  signed int v7; // er14@1
  uintptr_t v8; // rcx@3
  uintptr_t v9; // rsi@5
  uintptr_t v10; // r8@5
  uintptr_t v11; // rdx@5
  unsigned int v13; // [sp+Ch] [bp-24h]@1

  v3 = a3;
  v4 = a2;
  v5 = arg1;
  v13 = 0;
  v6 = *(_QWORD *)(arg1 + 216);
  v7 = -536870183;
  if ( v6 )
  {
    if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v6 + 1504LL))(v6, v5) )
    {
      v7 = AppleUSBHub::GetPortPower(*(AppleUSBHub **)(v5 + 216), (unsigned __int16)a2, &v13);
      v8 = v13;
      *v3 = v13;
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v9 = *(_QWORD *)(v5 + 216);
        v10 = v7;
        v11 = v4;
LABEL_9:
        kernel_debug(0x52D1830u, v9, v11, v8, v10, 0LL);
        return (unsigned int)v7;
      }
    }
    else
    {
      v7 = -536870206;
      if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
      {
        v11 = *(_QWORD *)(v5 + 216);
        v8 = -536870206LL;
        v10 = 0LL;
        v9 = v5;
        goto LABEL_9;
      }
    }
  }
  return (unsigned int)v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000017520) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::SetPortPower(uintptr_t arg1, uintptr_t arg2, uintptr_t a3)
{
  int v3; // er14@1
  uintptr_t v4; // rbx@1
  __int64 v5; // r13@1
  __int64 v6; // rdi@4
  signed int v7; // er12@4

  v3 = a3;
  v4 = arg1;
  v5 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1834u, *(_QWORD *)(arg1 + 216), arg2, a3, 0LL, 0LL);
  v6 = *(_QWORD *)(arg1 + 216);
  v7 = -536870183;
  if ( v6 )
  {
    v7 = -536870207;
    if ( *(_BYTE *)(v4 + 249) )
    {
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v6 + 1504LL))(v6, v4) )
        return AppleUSBHub::SetPortPower(*(AppleUSBHub **)(v4 + 216), (unsigned __int16)arg2, v3);
      v7 = -536870206;
      if ( *(_BYTE *)v5 & 2 )
      {
        if ( *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D1834u, v4, *(_QWORD *)(v4 + 216), 0xFFFFFFFFE00002C2LL, 0LL, 0LL);
      }
    }
  }
  return (unsigned int)v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000017612) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::DisablePowerManagement(uintptr_t arg1, uintptr_t a2)
{
  uintptr_t v2; // r15@1
  __int64 v3; // r12@1
  __int64 v4; // rdi@4
  signed int v5; // ebx@4

  v2 = arg1;
  v3 = off_1A080[0];
  if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    kernel_debug(0x52D1838u, *(_QWORD *)(arg1 + 216), a2, 0LL, 0LL, 0LL);
  v4 = *(_QWORD *)(arg1 + 216);
  v5 = -536870183;
  if ( v4 )
  {
    v5 = -536870207;
    if ( *(_BYTE *)(v2 + 249) )
    {
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v4 + 1504LL))(v4, v2) )
      {
        AppleUSBHub::DisablePowerManagement(*(AppleUSBHub **)(v2 + 216), a2);
        v5 = 0;
      }
      else
      {
        v5 = -536870206;
        if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
          kernel_debug(0x52D1838u, v2, *(_QWORD *)(v2 + 216), 0xFFFFFFFFE00002C2LL, 0LL, 0LL);
      }
    }
  }
  return (unsigned int)v5;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (00000000000176E6) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::PortReset(AppleUSBHSHubUserClient *this, __int64 a2)
{
  AppleUSBHSHubUserClient *v2; // rbx@1
  __int64 v3; // rdi@1
  signed int v4; // er14@1
  __int64 v5; // rcx@4
  int v6; // eax@5
  uintptr_t v7; // rdx@9
  uintptr_t v8; // rcx@9
  uintptr_t v9; // r8@9
  uintptr_t v10; // rsi@9
  unsigned __int64 v11; // r15@13

  v2 = this;
  v3 = *((_QWORD *)this + 27);
  v4 = -536870183;
  if ( !v3 )
    return (unsigned int)v4;
  v4 = -536870207;
  if ( !*((_BYTE *)v2 + 249) )
    return (unsigned int)v4;
  if ( (unsigned __int8)(*(int (__fastcall **)(__int64, AppleUSBHSHubUserClient *))(*(_QWORD *)v3 + 1504LL))(v3, v2) )
  {
    v5 = a2;
    if ( BYTE1(v5) & 1 )
    {
      v6 = (*(int (__cdecl **)(_QWORD))(**(_QWORD **)(*((_QWORD *)v2 + 27) + 136LL) + 2432LL))(*(_QWORD *)(*((_QWORD *)v2 + 27) + 136LL));
      v5 = a2;
      v4 = -536870203;
      if ( v6 )
        return (unsigned int)v4;
      *((_BYTE *)v2 + 250) = 1;
    }
    else if ( BYTE1(v5) & 2 )
    {
      v4 = 0;
      if ( *((_BYTE *)v2 + 250) )
      {
        (*(void (__cdecl **)(_QWORD))(**(_QWORD **)(*((_QWORD *)v2 + 27) + 136LL) + 2440LL))(*(_QWORD *)(*((_QWORD *)v2 + 27) + 136LL));
        *((_BYTE *)v2 + 250) = 0;
      }
      return (unsigned int)v4;
    }
    v11 = v5 & 0xFFFFFFFFFFFFFCFFLL;
    v4 = AppleUSBHub::SetPortFeature(*((AppleUSBHub **)v2 + 27), 4, v5 & 0xFCFF);
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v8 = v4;
      v10 = *(_DWORD *)(*((_QWORD *)v2 + 27) + 296LL);
      v9 = 1LL;
      v7 = v11;
      goto LABEL_16;
    }
  }
  else
  {
    v4 = -536870206;
    if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
    {
      v7 = *((_QWORD *)v2 + 27);
      v8 = -536870206LL;
      v9 = 0LL;
      v10 = (uintptr_t)v2;
LABEL_16:
      kernel_debug(0x52D183Cu, v10, v7, v8, v9, 0LL);
      return (unsigned int)v4;
    }
  }
  return (unsigned int)v4;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000001785A) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::PortWarmReset(uintptr_t arg1, uintptr_t a2)
{
  uintptr_t v2; // r15@1
  uintptr_t v3; // rbx@1
  __int64 v4; // rdi@1
  signed int v5; // er14@1
  uintptr_t v6; // rcx@6
  uintptr_t v7; // rsi@6
  uintptr_t v8; // r8@6
  uintptr_t v9; // rdx@6

  v2 = a2;
  v3 = arg1;
  v4 = *(_QWORD *)(arg1 + 216);
  v5 = -536870183;
  if ( v4 )
  {
    v5 = -536870207;
    if ( *(_BYTE *)(v3 + 249) )
    {
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v4 + 1504LL))(v4, v3) )
      {
        v5 = AppleUSBHub::SetPortFeature(*(AppleUSBHub **)(v3 + 216), 28, a2);
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v6 = v5;
          v7 = *(_DWORD *)(*(_QWORD *)(v3 + 216) + 296LL);
          v8 = 1LL;
          v9 = v2;
LABEL_10:
          kernel_debug(0x52D1840u, v7, v9, v6, v8, 0LL);
          return (unsigned int)v5;
        }
      }
      else
      {
        v5 = -536870206;
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v9 = *(_QWORD *)(v3 + 216);
          v6 = -536870206LL;
          v8 = 0LL;
          v7 = v3;
          goto LABEL_10;
        }
      }
    }
  }
  return (unsigned int)v5;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (000000000001794A) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::PortLinkState(uintptr_t arg1, int a2, __int64 a3)
{
  __int64 v3; // r12@1
  int v4; // er14@1
  uintptr_t v5; // rbx@1
  __int64 v6; // rdi@1
  signed int v7; // er15@1
  uintptr_t v8; // rcx@6
  uintptr_t v9; // rsi@6
  uintptr_t v10; // r8@6
  uintptr_t v11; // rdx@6

  v3 = a3;
  v4 = a2;
  v5 = arg1;
  v6 = *(_QWORD *)(arg1 + 216);
  v7 = -536870183;
  if ( v6 )
  {
    v7 = -536870207;
    if ( *(_BYTE *)(v5 + 249) )
    {
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v6 + 1504LL))(v6, v5) )
      {
        v7 = AppleUSBHub::SetPortLinkState(*(AppleUSBHub **)(v5 + 216), a2, (unsigned __int16)v3);
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v8 = v7;
          v9 = *(_DWORD *)(*(_QWORD *)(v5 + 216) + 296LL);
          v10 = 1LL;
          v11 = v3 + ((v4 << 16) & 0xFF0000);
LABEL_10:
          kernel_debug(0x52D1844u, v9, v11, v8, v10, 0LL);
          return (unsigned int)v7;
        }
      }
      else
      {
        v7 = -536870206;
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v11 = *(_QWORD *)(v5 + 216);
          v8 = -536870206LL;
          v10 = 0LL;
          v9 = v5;
          goto LABEL_10;
        }
      }
    }
  }
  return (unsigned int)v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000017A4C) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::PortU1Timeout(uintptr_t arg1, int a2, __int64 a3)
{
  __int64 v3; // r12@1
  int v4; // er14@1
  uintptr_t v5; // rbx@1
  __int64 v6; // rdi@1
  signed int v7; // er15@1
  uintptr_t v8; // rcx@6
  uintptr_t v9; // rsi@6
  uintptr_t v10; // r8@6
  uintptr_t v11; // rdx@6

  v3 = a3;
  v4 = a2;
  v5 = arg1;
  v6 = *(_QWORD *)(arg1 + 216);
  v7 = -536870183;
  if ( v6 )
  {
    v7 = -536870207;
    if ( *(_BYTE *)(v5 + 249) )
    {
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v6 + 1504LL))(v6, v5) )
      {
        v7 = AppleUSBHub::SetPortU1Timeout(*(AppleUSBHub **)(v5 + 216), a2, (unsigned __int16)v3);
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v8 = v7;
          v9 = *(_DWORD *)(*(_QWORD *)(v5 + 216) + 296LL);
          v10 = 1LL;
          v11 = v3 + ((v4 << 16) & 0xFF0000);
LABEL_10:
          kernel_debug(0x52D1848u, v9, v11, v8, v10, 0LL);
          return (unsigned int)v7;
        }
      }
      else
      {
        v7 = -536870206;
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v11 = *(_QWORD *)(v5 + 216);
          v8 = -536870206LL;
          v10 = 0LL;
          v9 = v5;
          goto LABEL_10;
        }
      }
    }
  }
  return (unsigned int)v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000017B4E) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::PortU2Timeout(uintptr_t arg1, int a2, __int64 a3)
{
  __int64 v3; // r12@1
  int v4; // er14@1
  uintptr_t v5; // rbx@1
  __int64 v6; // rdi@1
  signed int v7; // er15@1
  uintptr_t v8; // rcx@6
  uintptr_t v9; // rsi@6
  uintptr_t v10; // r8@6
  uintptr_t v11; // rdx@6

  v3 = a3;
  v4 = a2;
  v5 = arg1;
  v6 = *(_QWORD *)(arg1 + 216);
  v7 = -536870183;
  if ( v6 )
  {
    v7 = -536870207;
    if ( *(_BYTE *)(v5 + 249) )
    {
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v6 + 1504LL))(v6, v5) )
      {
        v7 = AppleUSBHub::SetPortU2Timeout(*(AppleUSBHub **)(v5 + 216), a2, (unsigned __int16)v3);
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v8 = v7;
          v9 = *(_DWORD *)(*(_QWORD *)(v5 + 216) + 296LL);
          v10 = 1LL;
          v11 = v3 + ((v4 << 16) & 0xFF0000);
LABEL_10:
          kernel_debug(0x52D184Cu, v9, v11, v8, v10, 0LL);
          return (unsigned int)v7;
        }
      }
      else
      {
        v7 = -536870206;
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v11 = *(_QWORD *)(v5 + 216);
          v8 = -536870206LL;
          v10 = 0LL;
          v9 = v5;
          goto LABEL_10;
        }
      }
    }
  }
  return (unsigned int)v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000017C50) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::PortRemoteWakeMask(uintptr_t arg1, int a2, __int64 a3)
{
  __int64 v3; // r12@1
  int v4; // er14@1
  uintptr_t v5; // rbx@1
  __int64 v6; // rdi@1
  signed int v7; // er15@1
  uintptr_t v8; // rcx@6
  uintptr_t v9; // rsi@6
  uintptr_t v10; // r8@6
  uintptr_t v11; // rdx@6

  v3 = a3;
  v4 = a2;
  v5 = arg1;
  v6 = *(_QWORD *)(arg1 + 216);
  v7 = -536870183;
  if ( v6 )
  {
    v7 = -536870207;
    if ( *(_BYTE *)(v5 + 249) )
    {
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v6 + 1504LL))(v6, v5) )
      {
        v7 = AppleUSBHub::SetPortRemoteWakeMask(*(AppleUSBHub **)(v5 + 216), a2, (unsigned __int16)v3);
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v8 = v7;
          v9 = *(_DWORD *)(*(_QWORD *)(v5 + 216) + 296LL);
          v10 = 1LL;
          v11 = v3 + ((v4 << 16) & 0xFF0000);
LABEL_10:
          kernel_debug(0x52D1848u, v9, v11, v8, v10, 0LL);
          return (unsigned int)v7;
        }
      }
      else
      {
        v7 = -536870206;
        if ( *(_BYTE *)off_1A080[0] & 2 && *(_DWORD *)off_1A098 & 0xFFFFFFF7 )
        {
          v11 = *(_QWORD *)(v5 + 216);
          v8 = -536870206LL;
          v10 = 0LL;
          v9 = v5;
          goto LABEL_10;
        }
      }
    }
  }
  return (unsigned int)v7;
}
// 1A080: using guessed type __int64 off_1A080[4];
// 1A098: using guessed type __int64 off_1A098;

//----- (0000000000017D52) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::GetPortPwrMgmtState(AppleUSBHSHubUserClient *this, unsigned __int16 a2, unsigned __int64 *a3)
{
  AppleUSBHub *v3; // rdi@1
  __int64 result; // rax@2

  v3 = (AppleUSBHub *)*((_QWORD *)this + 27);
  if ( v3 )
  {
    *a3 = 0LL;
    result = AppleUSBHub::GetPortPowerMgmtState(v3, a2, a3);
  }
  else
  {
    result = 3758097113LL;
  }
  return result;
}

//----- (0000000000017D7A) ----------------------------------------------------
__int64 __fastcall AppleUSBHSHubUserClient::MetaClass::~MetaClass(AppleUSBHSHubUserClient::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (0000000000017D90) ----------------------------------------------------
__int64 `global constructor keyed to'_a_1()
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(&AppleUSBHSHubUserClient::gMetaClass, "AppleUSBHSHubUserClient", off_1A000[0], 256LL);
  result = (__int64)off_1B890;
  AppleUSBHSHubUserClient::gMetaClass = off_1B890;
  return result;
}
// 1A000: using guessed type _QWORD off_1A000[20];
// 1B890: using guessed type __int64 (__fastcall *off_1B890[2])(AppleUSBHSHubUserClient::MetaClass *__hidden this);
// 1BCB0: using guessed type _QWORD AppleUSBHSHubUserClient::gMetaClass;
// 2BB40: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000017DD0) ----------------------------------------------------
__int64 `global destructor keyed to'_a_1()
{
  return OSMetaClass::~OSMetaClass((OSMetaClass *)&AppleUSBHSHubUserClient::gMetaClass);
}
// 1BCB0: using guessed type _QWORD AppleUSBHSHubUserClient::gMetaClass;

//----- (0000000000017DE1) ----------------------------------------------------
int _start()
{
  int result; // eax@2

  if ( _realmain )
    result = _realmain();
  else
    result = 0;
  return result;
}
// 1BCD8: using guessed type int (*_realmain)(void);

//----- (0000000000017DFB) ----------------------------------------------------
__int64 *OSKextGetCurrentIdentifier()
{
  return &kmod_info + 2;
}
// 1BB98: using guessed type __int64 kmod_info;

//----- (0000000000017E0C) ----------------------------------------------------
__int64 *OSKextGetCurrentVersionString()
{
  return &kmod_info + 10;
}
// 1BB98: using guessed type __int64 kmod_info;

//----- (0000000000017E1D) ----------------------------------------------------
__int64 OSKextGetCurrentLoadTag()
{
  return *((_DWORD *)&kmod_info + 3);
}
// 1BB98: using guessed type __int64 kmod_info;

//----- (0000000000017E2D) ----------------------------------------------------
int _stop()
{
  int result; // eax@2

  if ( _antimain )
    result = _antimain();
  else
    result = 0;
  return result;
}
// 1BCE0: using guessed type int (*_antimain)(void);

// ALL OK, 283 function(s) have been successfully decompiled
