/* This file has been generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2014 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

__int64 __fastcall AppleUSBOHCI::MetaClass::MetaClass(AppleUSBOHCI::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCI::MetaClass::~MetaClass(AppleUSBOHCI::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCI::AppleUSBOHCI(__int64 a1);
__int64 __fastcall AppleUSBOHCI::AppleUSBOHCI(__int64 a1);
__int64 __fastcall AppleUSBOHCI::~AppleUSBOHCI(AppleUSBOHCI *__hidden this); // idb
__int64 __fastcall AppleUSBOHCI::~AppleUSBOHCI(AppleUSBOHCI *__hidden this); // idb
void __fastcall AppleUSBOHCI::~AppleUSBOHCI(AppleUSBOHCI *this);
__int64 __fastcall AppleUSBOHCI::getMetaClass(AppleUSBOHCI *__hidden this); // idb
__int64 __fastcall AppleUSBOHCI::MetaClass::MetaClass(AppleUSBOHCI::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCI::MetaClass::alloc(AppleUSBOHCI::MetaClass *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCI::AppleUSBOHCI(__int64 a1);
__int64 __fastcall AppleUSBOHCI::AppleUSBOHCI(__int64 a1);
char __fastcall AppleUSBOHCI::init(__int64 a1);
char __fastcall AppleUSBOHCI::start(AppleUSBOHCI *this, IOService *a2);
__int16 __fastcall AppleUSBOHCI::SetVendorInfo(AppleUSBOHCI *this);
__int64 __fastcall AppleUSBOHCI::InitializeOperationalRegisters(AppleUSBOHCI *__hidden this); // idb
int __fastcall AppleUSBOHCI::stop(AppleUSBOHCI *this, IOService *a2);
int __fastcall AppleUSBOHCI::willTerminate(AppleUSBOHCI *this, IOService *a2);
int __fastcall AppleUSBOHCI::didTerminate(AppleUSBOHCI *this, IOService *a2, __int64 a3, bool *a4);
__int64 __fastcall AppleUSBOHCI::UIMInitialize(uintptr_t arg1, IOService *a2, const OSMetaClass *a3);
__int64 __fastcall AppleUSBOHCI::IsochronousInitialize(uintptr_t arg1, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCI::InterruptInitialize(uintptr_t arg1, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCI::BulkInitialize(uintptr_t arg1, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCI::ControlInitialize(uintptr_t arg1, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCI::UIMFinalize(AppleUSBOHCI *this); // idb
int __fastcall AppleUSBOHCI::doCallback(__int64 a1, __int64 a2, unsigned int a3, unsigned int a4);
__int64 __fastcall AppleUSBOHCI::findBufferRemaining(__int64 a1, __int64 a2);
__int64 __fastcall AppleUSBOHCI::DeallocateTD(__int64 a1, __int64 a2);
__int64 __fastcall AppleUSBOHCI::TranslateStatusToUSBError(AppleUSBOHCI *__hidden this, unsigned int); // idb
AppleUSBOHCIedMemoryBlock *__fastcall AppleUSBOHCI::AllocateED(uintptr_t arg1, unsigned __int64 a2);
AppleUSBOHCIitdMemoryBlock *__fastcall AppleUSBOHCI::AllocateITD(uintptr_t arg1, unsigned __int64 a2);
AppleUSBOHCIgtdMemoryBlock *__fastcall AppleUSBOHCI::AllocateTD(uintptr_t arg1, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCI::DeallocateITD(__int64 a1, __int64 a2);
__int64 __fastcall AppleUSBOHCI::DeallocateED(__int64 a1, __int64 a2);
__int64 __fastcall AppleUSBOHCI::RemoveAllTDs(uintptr_t a1, __int64 a2);
__int64 __fastcall AppleUSBOHCI::RemoveTDs(uintptr_t a1, __int64 a2, unsigned int a3);
void __fastcall AppleUSBOHCI::ProcessCompletedITD(uintptr_t a1, __int64 a2, signed int a3);
__int64 __fastcall AppleUSBOHCI::UIMProcessDoneQueue(AppleUSBOHCI *__hidden this, void (__cdecl *)(void *, void *, int, unsigned int)); // idb
__int64 __fastcall AppleUSBOHCI::DoDoneQueueProcessing(AppleUSBOHCI *this, AppleUSBOHCIgtdMemoryBlock *a2, unsigned int a3, void (__cdecl *a4)(void *, void *, int, unsigned int));
void __fastcall AppleUSBOHCI::finishPending(AppleUSBOHCI *this);
__int64 __fastcall AppleUSBOHCI::GetBandwidthAvailable(AppleUSBOHCI *__hidden this); // idb
__int64 __fastcall AppleUSBOHCI::GetFrameNumber(AppleUSBOHCI *__hidden this); // idb
__int64 __fastcall AppleUSBOHCI::GetFrameNumber32(AppleUSBOHCI *__hidden this); // idb
void __fastcall AppleUSBOHCI::ReturnTransactions(uintptr_t arg1, __int64 a2, unsigned int a3);
__int64 __fastcall AppleUSBOHCI::ReturnOneTransaction(__int64 a1, __int64 a2, __int64 a3, unsigned int a4);
__int64 __fastcall AppleUSBOHCI::message(AppleUSBOHCI *this, const char *a2, IOService *a3, void *a4);
int __fastcall AppleUSBOHCI::finalize(AppleUSBOHCI *this);
int __fastcall AppleUSBOHCI::free(AppleUSBOHCI *this);
int __fastcall AppleUSBOHCI::GetNewDMACommand(AppleUSBOHCI *this);
__int64 __fastcall AppleUSBOHCI::showRegisters(AppleUSBOHCI *this, __int64 a2, const char *a3);
__int64 __fastcall AppleUSBOHCI::MetaClass::~MetaClass(AppleUSBOHCI::MetaClass *__hidden this); // idb
__int64 `global constructor keyed to'_a();
__int64 `global destructor keyed to'_a();
void __fastcall AppleUSBOHCI::PollInterrupts(AppleUSBOHCI *this, void (__cdecl *a2)(void *, void *, int, unsigned int));
int __fastcall AppleUSBOHCI::InterruptHandler(AppleUSBOHCI *this);
__int64 __fastcall AppleUSBOHCI::PrimaryInterruptFilter(IOService *this, AppleUSBOHCI *a2);
__int64 __fastcall AppleUSBOHCI::FilterInterrupt(AppleUSBOHCI *this, AppleUSBOHCI *a2);
char __fastcall AppleUSBOHCI::IsValidPhysicalAddress(AppleUSBOHCI *this, __int64 a2);
AppleUSBOHCIgtdMemoryBlock *__fastcall AppleUSBOHCI::DoOptiFix(uintptr_t arg1, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCI::OptiLSHSFix(uintptr_t arg1); // idb
int __fastcall AppleUSBOHCI::CheckSleepCapability(AppleUSBOHCI *this);
signed __int64 __fastcall AppleUSBOHCI::callPlatformFunction(__int64 a1, __int64 a2, __int64 a3, __int64 a4);
int __fastcall AppleUSBOHCI::SuspendUSBBus(uintptr_t arg1, unsigned __int8 a2);
int __fastcall AppleUSBOHCI::ResumeUSBBus(uintptr_t arg1, uintptr_t a2);
__int64 __fastcall AppleUSBOHCI::AllocatePowerStateArray(AppleUSBOHCI *__hidden this); // idb
__int64 __fastcall AppleUSBOHCI::SaveControllerStateForSleep(uintptr_t arg1); // idb
__int64 __fastcall AppleUSBOHCI::RestoreControllerStateFromSleep(uintptr_t arg1); // idb
__int64 __fastcall AppleUSBOHCI::ResetControllerState(AppleUSBOHCI *this); // idb
__int64 __fastcall AppleUSBOHCI::RestartControllerFromReset(AppleUSBOHCI *this); // idb
__int64 __fastcall AppleUSBOHCI::EnableInterruptsFromController(uintptr_t arg1, unsigned __int8 a2);
__int64 __fastcall AppleUSBOHCI::DozeController(uintptr_t arg1); // idb
__int64 __fastcall AppleUSBOHCI::WakeControllerFromDoze(uintptr_t arg1); // idb
int __fastcall AppleUSBOHCI::powerChangeDone(AppleUSBOHCI *this, uintptr_t arg2);
signed __int64 __fastcall AppleUSBOHCI::GetRootHubDeviceDescriptor(__int64 a1, void *a2);
signed __int64 __fastcall AppleUSBOHCI::GetRootHubDescriptor(__int64 a1, void *a2);
__int64 __fastcall AppleUSBOHCI::GetRootHubConfDescriptor(__int64 a1, __int64 a2);
__int64 AppleUSBOHCI::SetRootHubDescriptor();
signed __int64 __fastcall AppleUSBOHCI::GetRootHubStatus(__int64 a1, __int64 a2);
__int64 __fastcall AppleUSBOHCI::SetRootHubFeature(AppleUSBOHCI *this);
__int64 __fastcall AppleUSBOHCI::ClearRootHubFeature(AppleUSBOHCI *this, int a2);
signed __int64 __fastcall AppleUSBOHCI::GetRootHubPortStatus(__int64 a1, __int64 a2, unsigned __int16 a3);
__int64 __fastcall AppleUSBOHCI::SetRootHubPortFeature(AppleUSBOHCI *this, int a2, __int16 a3);
__int64 __fastcall AppleUSBOHCI::OHCIRootHubPortSuspend(AppleUSBOHCI *this, unsigned int a2, unsigned __int8 a3);
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetPort(AppleUSBOHCI *this, unsigned int a2);
__int64 __fastcall AppleUSBOHCI::OHCIRootHubPortEnable(AppleUSBOHCI *this, unsigned int a2, unsigned __int8 a3);
__int64 __fastcall AppleUSBOHCI::OHCIRootHubPortPower(AppleUSBOHCI *this, unsigned int a2, char a3);
__int64 __fastcall AppleUSBOHCI::OHCIRootHubPower(AppleUSBOHCI *this, char a2);
__int64 __fastcall AppleUSBOHCI::ClearRootHubPortFeature(AppleUSBOHCI *this, int a2, __int16 a3);
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetChangeConnection(AppleUSBOHCI *this, unsigned int a2);
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetEnableChange(AppleUSBOHCI *this, unsigned int a2);
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetSuspendChange(AppleUSBOHCI *this, unsigned int a2);
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetOverCurrentChange(AppleUSBOHCI *this, unsigned int a2);
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetResetChange(AppleUSBOHCI *this, unsigned int a2);
__int64 __fastcall AppleUSBOHCI::GetRootHubPortState(AppleUSBOHCI *this, unsigned __int8 *a2);
__int64 __fastcall AppleUSBOHCI::SetHubAddress(AppleUSBOHCI *this, __int16 a2);
__int64 __fastcall AppleUSBOHCI::GetRootHubStringDescriptor(__int64 a1, char a2, __int64 a3);
void __fastcall AppleUSBOHCI::UIMRootHubStatusChange(AppleUSBOHCI *this);
// int __usercall AppleUSBOHCI::UIMRootHubStatusChange@<eax>(AppleUSBOHCI *this@<rdi>, __int64 a2@<rax>);
__int64 __fastcall AppleUSBOHCI::SimulateControlEDCreate(AppleUSBOHCI *this);
__int64 __fastcall AppleUSBOHCI::SimulateEDDelete(AppleUSBOHCI *__hidden this, __int16, __int16); // idb
__int64 __fastcall AppleUSBOHCI::SimulateEDAbort(AppleUSBOHCI *__hidden this, __int16, __int16); // idb
__int64 __fastcall AppleUSBOHCI::SimulateEDClearStall(AppleUSBOHCI *this);
uint64_t __fastcall AppleUSBOHCI::LastRootHubPortStatusChanged(AppleUSBOHCI *this, char a2);
__int64 __fastcall AppleUSBOHCI::CreateGeneralTransfer(uintptr_t arg1, unsigned __int64 a2, unsigned __int64 a3, __int64 a4, unsigned int a5, int a6, int a7, int a8);
// int __usercall AppleUSBOHCI::UIMCreateControlEndpoint@<eax>(AppleUSBOHCI *this@<rdi>, int a2);
__int64 __fastcall AppleUSBOHCI::UIMCreateControlEndpoint(AppleUSBOHCI *this, int a2, unsigned __int8 a3, unsigned __int16 a4, int a5);
AppleUSBOHCIedMemoryBlock *__fastcall AppleUSBOHCI::AddEmptyEndPoint(uintptr_t a1, unsigned __int64 a2, int a3, int a4, int a5, int a6, __int64 a7, unsigned __int8 a8);
signed __int64 AppleUSBOHCI::UIMCreateControlTransfer();
__int64 __fastcall AppleUSBOHCI::UIMCreateControlTransfer(__int64 a1, __int16 a2, __int16 a3, __int64 a4, __int64 a5, unsigned __int8 a6, unsigned int a7, __int16 a8);
__int64 __fastcall AppleUSBOHCI::FindControlEndpoint(__int64 a1, int a2, int a3, __int64 a4);
signed __int64 AppleUSBOHCI::UIMCreateControlTransfer();
__int64 __fastcall AppleUSBOHCI::UIMCreateControlTransfer(AppleUSBOHCI *this, __int64 a2, __int64 a3, IOUSBCommand *a4, void *a5);
int __fastcall AppleUSBOHCI::UIMCreateBulkEndpoint(AppleUSBOHCI *this, __int64 a2, __int64 a3, __int64 a4, __int64 a5, unsigned __int8 a6, unsigned __int16 a7, int a8);
__int64 __fastcall AppleUSBOHCI::UIMCreateBulkEndpoint(AppleUSBOHCI *this, unsigned __int8 a2, unsigned __int8 a3, char a4, unsigned __int8 a5, unsigned __int8 a6);
signed __int64 AppleUSBOHCI::UIMCreateBulkTransfer();
int __fastcall AppleUSBOHCI::UIMCreateBulkTransfer(AppleUSBOHCI *this, IOUSBCommand *a2);
__int64 __fastcall AppleUSBOHCI::FindBulkEndpoint(__int64 a1, int a2, int a3, int a4, __int64 a5);
// int __usercall AppleUSBOHCI::UIMCreateInterruptEndpoint@<eax>(AppleUSBOHCI *this@<rdi>, __int16 a2, unsigned __int16 a3, int a4);
int __fastcall AppleUSBOHCI::UIMCreateInterruptEndpoint(AppleUSBOHCI *this, int a2, __int16 a3, unsigned __int16 a4, __int16 a5, unsigned __int16 a6, __int16 a7);
__int64 __fastcall AppleUSBOHCI::FindInterruptEndpoint(__int64 a1, int a2, int a3, int a4, __int64 a5);
char __fastcall AppleUSBOHCI::DetermineInterruptOffset(AppleUSBOHCI *this, unsigned int a2, __int64 a3, int *a4);
signed __int64 AppleUSBOHCI::UIMCreateInterruptTransfer();
__int64 __fastcall AppleUSBOHCI::UIMCreateInterruptTransfer(AppleUSBOHCI *this, IOUSBCommand *a2);
// int __usercall AppleUSBOHCI::UIMCreateIsochEndpoint@<eax>(AppleUSBOHCI *this@<rdi>, int a2);
__int64 __fastcall AppleUSBOHCI::UIMCreateIsochEndpoint(AppleUSBOHCI *this, __int16 a2, __int16 a3, unsigned int a4, char a5);
__int64 __fastcall AppleUSBOHCI::FindIsochronousEndpoint(__int64 a1, int a2, int a3, int a4, __int64 a5);
signed __int64 AppleUSBOHCI::UIMCreateIsochTransfer();
__int64 __fastcall AppleUSBOHCI::UIMAbortEndpoint(AppleUSBOHCI *this, int a2, unsigned __int16 a3, __int16 a4);
__int64 __fastcall AppleUSBOHCI::FindEndpoint(__int64 a1, __int16 a2, int a3, __int16 a4, __int64 a5, __int64 a6);
__int64 __fastcall AppleUSBOHCI::UIMDeleteEndpoint(AppleUSBOHCI *this, int a2, unsigned __int16 a3, __int16 a4);
__int64 __fastcall AppleUSBOHCI::UIMClearEndpointStall(uintptr_t arg1, int a2, unsigned __int16 a3, __int16 a4);
void __fastcall AppleUSBOHCI::printTD(uintptr_t arg1, uintptr_t arg2);
void __fastcall AppleUSBOHCI::printED(uintptr_t arg1, uintptr_t arg2);
__int64 __fastcall AppleUSBOHCI::print_td(__int64 a1, __int64 a2);
__int64 __fastcall AppleUSBOHCI::print_itd(__int64 a1, __int64 a2);
void __fastcall AppleUSBOHCI::print_ed(uintptr_t arg1, __int64 a2, unsigned int a3);
int __fastcall AppleUSBOHCI::print_isoc_ed(__int64 a1, __int64 a2);
void __fastcall AppleUSBOHCI::print_list(uintptr_t arg1, uintptr_t arg2, uintptr_t a3, __int64 a4, char a5, char a6);
void __fastcall AppleUSBOHCI::print_control_list(AppleUSBOHCI *this, __int64 a2, char a3, __int64 a4);
void __fastcall AppleUSBOHCI::print_bulk_list(AppleUSBOHCI *this, __int64 a2, char a3, __int64 a4);
void __fastcall AppleUSBOHCI::print_int_list(uintptr_t arg1, __int64 a2, char a3, char a4);
int __fastcall AppleUSBOHCI::CheckEDListForTimeouts(__int64 a1, __int64 a2, __int64 a3);
// int __usercall AppleUSBOHCI::ReturnAllTransactionsInEndpoint@<eax>(__int64 a1@<rax>, __int64 a2@<rdx>, __int64 a3@<rdi>, __int64 a4@<rsi>);
__int64 __fastcall AppleUSBOHCI::UIMCheckForTimeouts(AppleUSBOHCI *__hidden this); // idb
signed __int64 AppleUSBOHCI::UIMCreateIsochTransfer();
// __int64 __usercall AppleUSBOHCI::UIMCreateIsochTransfer@<rax>(uintptr_t a1@<rdi>, __int64 a2@<rsi>, uintptr_t a3@<r14>);
int __fastcall AppleUSBOHCI::GetFrameNumberWithTime(AppleUSBOHCI *this, unsigned __int64 *a2, unsigned __int64 *a3);
__int64 __fastcall AppleUSBOHCI::GatedGetFrameNumberWithTime(AppleUSBOHCI *__hidden this, OSObject *, void *, void *, void *, void *); // idb
__int64 __fastcall AppleUSBOHCI::UIMEnableAddressEndpoints(AppleUSBOHCI *this, unsigned __int16 a2, char a3);
__int64 __fastcall AppleUSBOHCI::UIMEnableAllEndpoints(AppleUSBOHCI *this);
__int64 __fastcall AppleUSBOHCIedMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIedMemoryBlock::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIedMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIedMemoryBlock::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIedMemoryBlock::AppleUSBOHCIedMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIedMemoryBlock::AppleUSBOHCIedMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIedMemoryBlock::~AppleUSBOHCIedMemoryBlock(AppleUSBOHCIedMemoryBlock *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIedMemoryBlock::~AppleUSBOHCIedMemoryBlock(AppleUSBOHCIedMemoryBlock *__hidden this); // idb
void __fastcall AppleUSBOHCIedMemoryBlock::~AppleUSBOHCIedMemoryBlock(AppleUSBOHCIedMemoryBlock *this);
__int64 __fastcall AppleUSBOHCIedMemoryBlock::getMetaClass(AppleUSBOHCIedMemoryBlock *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIedMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIedMemoryBlock::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIedMemoryBlock::MetaClass::alloc(AppleUSBOHCIedMemoryBlock::MetaClass *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCIedMemoryBlock::AppleUSBOHCIedMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIedMemoryBlock::AppleUSBOHCIedMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIedMemoryBlock::NewMemoryBlock(AppleUSBOHCIedMemoryBlock *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCIedMemoryBlock::NumEDs(AppleUSBOHCIedMemoryBlock *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIedMemoryBlock::GetSharedPhysicalPtr(AppleUSBOHCIedMemoryBlock *__hidden this, unsigned int); // idb
__int64 __fastcall AppleUSBOHCIedMemoryBlock::GetSharedLogicalPtr(AppleUSBOHCIedMemoryBlock *__hidden this, unsigned int); // idb
AppleUSBOHCIedMemoryBlock *__fastcall AppleUSBOHCIedMemoryBlock::GetED(AppleUSBOHCIedMemoryBlock *this, unsigned int a2);
__int64 __fastcall AppleUSBOHCIedMemoryBlock::GetNextBlock(AppleUSBOHCIedMemoryBlock *__hidden this); // idb
void __fastcall AppleUSBOHCIedMemoryBlock::SetNextBlock(AppleUSBOHCIedMemoryBlock *this, AppleUSBOHCIedMemoryBlock *a2);
int __fastcall AppleUSBOHCIedMemoryBlock::free(AppleUSBOHCIedMemoryBlock *this);
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIgtdMemoryBlock::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIgtdMemoryBlock::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::AppleUSBOHCIgtdMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::AppleUSBOHCIgtdMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::~AppleUSBOHCIgtdMemoryBlock(AppleUSBOHCIgtdMemoryBlock *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::~AppleUSBOHCIgtdMemoryBlock(AppleUSBOHCIgtdMemoryBlock *__hidden this); // idb
void __fastcall AppleUSBOHCIgtdMemoryBlock::~AppleUSBOHCIgtdMemoryBlock(AppleUSBOHCIgtdMemoryBlock *this);
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::getMetaClass(AppleUSBOHCIgtdMemoryBlock *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIgtdMemoryBlock::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::MetaClass::alloc(AppleUSBOHCIgtdMemoryBlock::MetaClass *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::AppleUSBOHCIgtdMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::AppleUSBOHCIgtdMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::NewMemoryBlock(AppleUSBOHCIgtdMemoryBlock *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::NumGTDs(AppleUSBOHCIgtdMemoryBlock *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::GetSharedPhysicalPtr(AppleUSBOHCIgtdMemoryBlock *__hidden this, unsigned int); // idb
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::GetSharedLogicalPtr(AppleUSBOHCIgtdMemoryBlock *__hidden this, unsigned int); // idb
AppleUSBOHCIgtdMemoryBlock *__fastcall AppleUSBOHCIgtdMemoryBlock::GetGTD(AppleUSBOHCIgtdMemoryBlock *this, unsigned int a2);
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(AppleUSBOHCIgtdMemoryBlock *this, int a2, unsigned int a3);
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::GetITDFromPhysical(AppleUSBOHCIitdMemoryBlock *this, int a2, unsigned int a3);
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::GetNextBlock(AppleUSBOHCIgtdMemoryBlock *__hidden this); // idb
void __fastcall AppleUSBOHCIgtdMemoryBlock::SetNextBlock(AppleUSBOHCIgtdMemoryBlock *this, AppleUSBOHCIgtdMemoryBlock *a2);
int __fastcall AppleUSBOHCIgtdMemoryBlock::free(AppleUSBOHCIgtdMemoryBlock *this);
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIitdMemoryBlock::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIitdMemoryBlock::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::AppleUSBOHCIitdMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::AppleUSBOHCIitdMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::~AppleUSBOHCIitdMemoryBlock(AppleUSBOHCIitdMemoryBlock *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::~AppleUSBOHCIitdMemoryBlock(AppleUSBOHCIitdMemoryBlock *__hidden this); // idb
void __fastcall AppleUSBOHCIitdMemoryBlock::~AppleUSBOHCIitdMemoryBlock(AppleUSBOHCIitdMemoryBlock *this);
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::getMetaClass(AppleUSBOHCIitdMemoryBlock *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIitdMemoryBlock::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::MetaClass::alloc(AppleUSBOHCIitdMemoryBlock::MetaClass *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::AppleUSBOHCIitdMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::AppleUSBOHCIitdMemoryBlock(__int64 a1);
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::NewMemoryBlock(AppleUSBOHCIitdMemoryBlock *this, unsigned __int64 a2);
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::NumITDs(AppleUSBOHCIitdMemoryBlock *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::GetSharedPhysicalPtr(AppleUSBOHCIitdMemoryBlock *__hidden this, unsigned int); // idb
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::GetSharedLogicalPtr(AppleUSBOHCIitdMemoryBlock *__hidden this, unsigned int); // idb
AppleUSBOHCIitdMemoryBlock *__fastcall AppleUSBOHCIitdMemoryBlock::GetITD(AppleUSBOHCIitdMemoryBlock *this, unsigned int a2);
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::GetNextBlock(AppleUSBOHCIitdMemoryBlock *__hidden this); // idb
void __fastcall AppleUSBOHCIitdMemoryBlock::SetNextBlock(AppleUSBOHCIitdMemoryBlock *this, AppleUSBOHCIitdMemoryBlock *a2);
int __fastcall AppleUSBOHCIitdMemoryBlock::free(AppleUSBOHCIitdMemoryBlock *this);
__int64 __fastcall AppleUSBOHCIedMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIedMemoryBlock::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIgtdMemoryBlock::MetaClass *__hidden this); // idb
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIitdMemoryBlock::MetaClass *__hidden this); // idb
__int64 `global constructor keyed to'_a_0();
__int64 `global destructor keyed to'_a_0();
int _start();
__int64 *OSKextGetCurrentIdentifier();
__int64 *OSKextGetCurrentVersionString();
__int64 OSKextGetCurrentLoadTag();
int _stop();
// int __fastcall IODelay(_QWORD, _QWORD, _QWORD); weak
// int __fastcall IOLog(_QWORD, _QWORD, _QWORD); weak
// int __fastcall IOMappedRead64(_QWORD); weak
// int __cdecl IOSimpleLockAlloc(_QWORD); weak
// int __cdecl IOSimpleLockFree(_QWORD); weak
// int __fastcall IOSimpleLockLock(_QWORD, _QWORD); weak
// int __fastcall IOSimpleLockUnlock(_QWORD); weak
// int __fastcall IOSleep(_QWORD); weak
// int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD); weak
// _QWORD __cdecl IOPCIDevice::extendedConfigRead16(IOPCIDevice *__hidden this, unsigned __int64); idb
// _QWORD __cdecl IOPCIDevice::extendedConfigWrite16(IOPCIDevice *__hidden this, unsigned __int64, unsigned __int16); idb
// int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD); weak
// _QWORD __cdecl OSMetaClass::~OSMetaClass(OSMetaClass *__hidden this); idb
// int __fastcall IODMACommand::withSpecification(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD); weak
// _QWORD IOUSBCommand::GetAddress(IOUSBCommand *__hidden this); idb
// _QWORD IOUSBCommand::GetEndpoint(IOUSBCommand *__hidden this); idb
// _QWORD IOUSBCommand::GetReqCount(IOUSBCommand *__hidden this); idb
// _QWORD IOUSBCommand::GetDirection(IOUSBCommand *__hidden this); idb
// _QWORD __cdecl IOUSBCommand::SetTimeStamp(IOUSBCommand *__hidden this, unsigned __int64); idb
// _QWORD __cdecl IOUSBCommand::GetUIMScratch(IOUSBCommand *__hidden this, unsigned int); idb
// _QWORD __cdecl IOUSBCommand::SetUIMScratch(IOUSBCommand *__hidden this, unsigned int, unsigned int); idb
// _QWORD IOUSBCommand::GetNoDataTimeout(IOUSBCommand *__hidden this); idb
// _QWORD IOUSBCommand::GetUSLCompletion(IOUSBCommand *__hidden this); idb
// _QWORD IOUSBCommand::GetBufferRounding(IOUSBCommand *__hidden this); idb
// _QWORD IOUSBCommand::GetCompletionTimeout(IOUSBCommand *__hidden this); idb
// _QWORD IOUSBCommand::GetMultiTransferTransaction(IOUSBCommand *__hidden this); idb
// _QWORD IOUSBCommand::GetFinalTransferInTransaction(IOUSBCommand *__hidden this); idb
// _QWORD IOUSBCommand::GetBuffer(IOUSBCommand *__hidden this); idb
// _QWORD __cdecl IORegistryEntry::getPlane(IORegistryEntry *__hidden this, const char *); idb
// _QWORD __cdecl IOUSBController::ExpressCardPort(IOUSBController *__hidden this, IORegistryEntry *); idb
// int __fastcall IOUSBController::Complete(_QWORD, _QWORD, _QWORD); weak
// _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *); weak
// _QWORD IOUSBControllerV3::FixupNECControllerConfigRegisters(IOUSBControllerV3 *__hidden this); idb
// int __cdecl IOUSBControllerV3::IOUSBControllerV3(_QWORD); weak
// _QWORD __cdecl IOUSBControllerV3::~IOUSBControllerV3(IOUSBControllerV3 *__hidden this); idb
// _QWORD __cdecl IOBufferMemoryDescriptor::inTaskWithPhysicalMask(IOBufferMemoryDescriptor *__hidden this, task *, unsigned int, unsigned __int64, unsigned __int64); idb
// int __fastcall IOFilterInterruptEventSource::filterInterruptEventSource(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD); weak
// int __cdecl OSObject::OSObject(_QWORD); weak
// _QWORD __cdecl OSObject::~OSObject(OSObject *__hidden this); idb
// void __cdecl OSObject::operator delete(void *); idb
// _QWORD __cdecl OSObject::operator new(OSObject *__hidden this, unsigned __int64); idb
// _QWORD IOService::getPlatform(IOService *__hidden this); idb
// _QWORD IOService::getPowerState(IOService *__hidden this); idb
// _QWORD __cdecl IOService::requireMaxBusStall(IOService *__hidden this, unsigned int); idb
// _QWORD OSMetaClass::instanceConstructed(OSMetaClass *__hidden this); idb
// _QWORD __cdecl OSMetaClassBase::metaCast(OSMetaClassBase *__hidden this, const char *); idb
// _QWORD IOService::isInactive(IOService *__hidden this); idb
// int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD); weak
// void __cdecl bcopy(const void *, void *, size_t);
// void __cdecl bzero(void *, size_t);
// void __cdecl kernel_debug(uint32_t debugid, uintptr_t arg1, uintptr_t arg2, uintptr_t arg3, uintptr_t arg4, uintptr_t arg5);
// int __fastcall kprintf(_QWORD); weak
// uint64_t mach_absolute_time(void);
// int __fastcall ml_set_interrupts_enabled(_QWORD); weak

//-------------------------------------------------------------------------
// Data declarations

int dword_0 = 4277009103; // weak
int dword_C = 11; // weak
int dword_10 = 8; // weak
__int64 qword_468[403] =
{
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL,
  0LL
}; // weak
_UNKNOWN loc_23E6; // weak
_UNKNOWN loc_302E; // weak
_UNKNOWN loc_3FF0; // weak
__int64 AppleUSBOHCI::TranslateStatusToUSBError(unsigned int)::statusToErrorMap[8] =
{
  -2305772636174548992LL,
  -2305772623826501630LL,
  -2305839788525076401LL,
  -2305772606646632442LL,
  -2305839814294895896LL,
  -2305772589466763254LL,
  -2305772580876828660LL,
  -2305772572286894066LL
}; // weak
_QWORD off_B000[14] =
{
  111112LL,
  111200LL,
  111208LL,
  112152LL,
  112776LL,
  112800LL,
  112808LL,
  112816LL,
  114464LL,
  114472LL,
  114488LL,
  114520LL,
  114528LL,
  114544LL
}; // weak
__int64 off_B008[13] =
{
  111200LL,
  111208LL,
  112152LL,
  112776LL,
  112800LL,
  112808LL,
  112816LL,
  114464LL,
  114472LL,
  114488LL,
  114520LL,
  114528LL,
  114544LL
}; // weak
__int64 off_B010[12] =
{
  111208LL,
  112152LL,
  112776LL,
  112800LL,
  112808LL,
  112816LL,
  114464LL,
  114472LL,
  114488LL,
  114520LL,
  114528LL,
  114544LL
}; // weak
_QWORD off_B018[11] =
{
  112152LL,
  112776LL,
  112800LL,
  112808LL,
  112816LL,
  114464LL,
  114472LL,
  114488LL,
  114520LL,
  114528LL,
  114544LL
}; // weak
_QWORD off_B020[10] =
{
  112776LL,
  112800LL,
  112808LL,
  112816LL,
  114464LL,
  114472LL,
  114488LL,
  114520LL,
  114528LL,
  114544LL
}; // weak
_QWORD off_B028[9] =
{
  112800LL,
  112808LL,
  112816LL,
  114464LL,
  114472LL,
  114488LL,
  114520LL,
  114528LL,
  114544LL
}; // weak
_QWORD off_B030[8] =
{
  112808LL,
  112816LL,
  114464LL,
  114472LL,
  114488LL,
  114520LL,
  114528LL,
  114544LL
}; // weak
_QWORD off_B038[7] = { 112816LL, 114464LL, 114472LL, 114488LL, 114520LL, 114528LL, 114544LL }; // weak
__int64 off_B040[6] = { 114464LL, 114472LL, 114488LL, 114520LL, 114528LL, 114544LL }; // weak
__int64 off_B048[5] = { 114472LL, 114488LL, 114520LL, 114528LL, 114544LL }; // weak
__int64 off_B050[4] = { 114488LL, 114520LL, 114528LL, 114544LL }; // weak
__int64 off_B058[3] = { 114520LL, 114528LL, 114544LL }; // weak
__int64 off_B060[2] = { 114528LL, 114544LL }; // weak
__int64 off_B068 = 114544LL; // weak
__int64 (__fastcall *off_B0B0[2])(AppleUSBOHCI *__hidden this) = { &AppleUSBOHCI::~AppleUSBOHCI, &AppleUSBOHCI::~AppleUSBOHCI }; // weak
__int64 (__fastcall *off_BE30[2])(AppleUSBOHCI::MetaClass *__hidden this) = { &AppleUSBOHCI::MetaClass::~MetaClass, &AppleUSBOHCI::MetaClass::~MetaClass }; // weak
__int64 (__fastcall *off_BF30[2])(AppleUSBOHCIedMemoryBlock *__hidden this) =
{
  &AppleUSBOHCIedMemoryBlock::~AppleUSBOHCIedMemoryBlock,
  &AppleUSBOHCIedMemoryBlock::~AppleUSBOHCIedMemoryBlock
}; // weak
__int64 (__fastcall *off_C060[2])(AppleUSBOHCIedMemoryBlock::MetaClass *__hidden this) =
{
  &AppleUSBOHCIedMemoryBlock::MetaClass::~MetaClass,
  &AppleUSBOHCIedMemoryBlock::MetaClass::~MetaClass
}; // weak
__int64 (__fastcall *off_C160[2])(AppleUSBOHCIgtdMemoryBlock *__hidden this) =
{
  &AppleUSBOHCIgtdMemoryBlock::~AppleUSBOHCIgtdMemoryBlock,
  &AppleUSBOHCIgtdMemoryBlock::~AppleUSBOHCIgtdMemoryBlock
}; // weak
__int64 (__fastcall *off_C290[2])(AppleUSBOHCIgtdMemoryBlock::MetaClass *__hidden this) =
{
  &AppleUSBOHCIgtdMemoryBlock::MetaClass::~MetaClass,
  &AppleUSBOHCIgtdMemoryBlock::MetaClass::~MetaClass
}; // weak
__int64 (__fastcall *off_C390[2])(AppleUSBOHCIitdMemoryBlock *__hidden this) =
{
  &AppleUSBOHCIitdMemoryBlock::~AppleUSBOHCIitdMemoryBlock,
  &AppleUSBOHCIitdMemoryBlock::~AppleUSBOHCIitdMemoryBlock
}; // weak
__int64 (__fastcall *off_C4C0[2])(AppleUSBOHCIitdMemoryBlock::MetaClass *__hidden this) =
{
  &AppleUSBOHCIitdMemoryBlock::MetaClass::~MetaClass,
  &AppleUSBOHCIitdMemoryBlock::MetaClass::~MetaClass
}; // weak
__int64 kmod_info = 0LL; // weak
_QWORD AppleUSBOHCI::gMetaClass; // weak
_QWORD AppleUSBOHCIedMemoryBlock::gMetaClass; // weak
_QWORD AppleUSBOHCIgtdMemoryBlock::gMetaClass; // weak
_QWORD AppleUSBOHCIitdMemoryBlock::gMetaClass; // weak
int (*_realmain)(void); // weak
int (*_antimain)(void); // weak


//----- (0000000000001100) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::MetaClass::MetaClass(AppleUSBOHCI::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBOHCI", off_B018[0], 3176LL);
  result = (__int64)off_BE30;
  *(_QWORD *)this = off_BE30;
  return result;
}
// B018: using guessed type _QWORD off_B018[11];
// BE30: using guessed type __int64 (__fastcall *off_BE30[2])(AppleUSBOHCI::MetaClass *__hidden this);
// 1B250: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000001132) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::MetaClass::~MetaClass(AppleUSBOHCI::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (000000000000113C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::AppleUSBOHCI(__int64 a1)
{
  __int64 result; // rax@1

  IOUSBControllerV3::IOUSBControllerV3(a1);
  result = (__int64)off_B0B0;
  *(_QWORD *)a1 = off_B0B0;
  return result;
}
// B0B0: using guessed type __int64 (__fastcall *off_B0B0[2])(AppleUSBOHCI *__hidden this);
// 1B878: using guessed type int __cdecl IOUSBControllerV3::IOUSBControllerV3(_QWORD);

//----- (000000000000115C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::AppleUSBOHCI(__int64 a1)
{
  __int64 result; // rax@1

  IOUSBControllerV3::IOUSBControllerV3(a1);
  result = (__int64)off_B0B0;
  *(_QWORD *)a1 = off_B0B0;
  return result;
}
// B0B0: using guessed type __int64 (__fastcall *off_B0B0[2])(AppleUSBOHCI *__hidden this);
// 1B878: using guessed type int __cdecl IOUSBControllerV3::IOUSBControllerV3(_QWORD);

//----- (000000000000117C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::~AppleUSBOHCI(AppleUSBOHCI *this)
{
  return IOUSBControllerV3::~IOUSBControllerV3(this);
}

//----- (0000000000001186) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::~AppleUSBOHCI(AppleUSBOHCI *this)
{
  return IOUSBControllerV3::~IOUSBControllerV3(this);
}

//----- (0000000000001190) ----------------------------------------------------
void __fastcall AppleUSBOHCI::~AppleUSBOHCI(AppleUSBOHCI *this)
{
  IOUSBControllerV3::~IOUSBControllerV3(this);
  OSObject::operator delete((void *)this);
}

//----- (00000000000011B2) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::getMetaClass(AppleUSBOHCI *this)
{
  return (__int64)&AppleUSBOHCI::gMetaClass;
}
// C660: using guessed type _QWORD AppleUSBOHCI::gMetaClass;

//----- (00000000000011C0) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::MetaClass::MetaClass(AppleUSBOHCI::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBOHCI", off_B018[0], 3176LL);
  result = (__int64)off_BE30;
  *(_QWORD *)this = off_BE30;
  return result;
}
// B018: using guessed type _QWORD off_B018[11];
// BE30: using guessed type __int64 (__fastcall *off_BE30[2])(AppleUSBOHCI::MetaClass *__hidden this);
// 1B250: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (00000000000011F2) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::MetaClass::alloc(AppleUSBOHCI::MetaClass *this, unsigned __int64 a2)
{
  __int64 v2; // rbx@1

  v2 = OSObject::operator new((OSObject *)&qword_468[256], a2);
  IOUSBControllerV3::IOUSBControllerV3(v2);
  *(_QWORD *)v2 = off_B0B0;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCI::gMetaClass);
  return v2;
}
// 468: using guessed type __int64[403];
// B0B0: using guessed type __int64 (__fastcall *off_B0B0[2])(AppleUSBOHCI *__hidden this);
// C660: using guessed type _QWORD AppleUSBOHCI::gMetaClass;
// 1B878: using guessed type int __cdecl IOUSBControllerV3::IOUSBControllerV3(_QWORD);

//----- (0000000000001232) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::AppleUSBOHCI(__int64 a1)
{
  IOUSBControllerV3::IOUSBControllerV3(a1);
  *(_QWORD *)a1 = off_B0B0;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCI::gMetaClass);
}
// B0B0: using guessed type __int64 (__fastcall *off_B0B0[2])(AppleUSBOHCI *__hidden this);
// C660: using guessed type _QWORD AppleUSBOHCI::gMetaClass;
// 1B878: using guessed type int __cdecl IOUSBControllerV3::IOUSBControllerV3(_QWORD);

//----- (0000000000001262) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::AppleUSBOHCI(__int64 a1)
{
  IOUSBControllerV3::IOUSBControllerV3(a1);
  *(_QWORD *)a1 = off_B0B0;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCI::gMetaClass);
}
// B0B0: using guessed type __int64 (__fastcall *off_B0B0[2])(AppleUSBOHCI *__hidden this);
// C660: using guessed type _QWORD AppleUSBOHCI::gMetaClass;
// 1B878: using guessed type int __cdecl IOUSBControllerV3::IOUSBControllerV3(_QWORD);

//----- (0000000000001292) ----------------------------------------------------
char __fastcall AppleUSBOHCI::init(__int64 a1)
{
  __int64 v1; // rax@2
  char result; // al@3

  if ( (unsigned __int8)(*(int (__cdecl **)(__int64))(off_B040[0] + 600))(a1)
    && (LODWORD(v1) = IOSimpleLockAlloc(a1), (*(_QWORD *)(a1 + 3040) = v1) != 0LL) )
  {
    *(_BYTE *)(a1 + 2936) = 0;
    *(_BYTE *)(a1 + 440) = 0;
    *(_BYTE *)(*(_QWORD *)(a1 + 168) + 40LL) = 1;
    *(_DWORD *)(a1 + 3032) = 1;
    *(_DWORD *)(a1 + 3036) = 1;
    result = 1;
  }
  else
  {
    result = 0;
  }
  return result;
}
// B040: using guessed type __int64 off_B040[6];
// 1B1C8: using guessed type int __cdecl IOSimpleLockAlloc(_QWORD);

//----- (00000000000012F8) ----------------------------------------------------
char __fastcall AppleUSBOHCI::start(AppleUSBOHCI *this, IOService *a2)
{
  char result; // al@2

  if ( (unsigned __int8)(*(int (__fastcall **)(AppleUSBOHCI *, IOService *))(off_B040[0] + 1488))(this, a2) )
  {
    *((_QWORD *)this + 369) = mach_absolute_time();
    result = 1;
  }
  else
  {
    result = 0;
  }
  return result;
}
// B040: using guessed type __int64 off_B040[6];

//----- (000000000000132C) ----------------------------------------------------
__int16 __fastcall AppleUSBOHCI::SetVendorInfo(AppleUSBOHCI *this)
{
  OSMetaClassBase *v1; // rax@1
  const OSMetaClassBase *v2; // r14@1
  __int64 v3; // rsi@1
  const OSMetaClass *v4; // rdx@1
  __int64 v5; // rax@1
  __int64 v6; // rax@2
  OSMetaClassBase *v7; // rax@3
  const OSMetaClass *v8; // rdx@3
  __int64 v9; // rax@3
  __int64 v10; // rax@4
  OSMetaClassBase *v11; // rax@5
  const OSMetaClass *v12; // rdx@5
  __int64 v13; // rax@5

  LODWORD(v1) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 61) + 696LL))(
                  *((_QWORD *)this + 61),
                  "vendor-id");
  v2 = *(const OSMetaClassBase **)off_B028[0];
  v3 = *(_QWORD *)off_B028[0];
  v5 = OSMetaClassBase::safeMetaCast(v1, *(const OSMetaClassBase **)off_B028[0], v4);
  if ( v5 )
  {
    LODWORD(v6) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v5 + 376LL))(v5, v3);
    *((_WORD *)this + 352) = *(_WORD *)v6;
  }
  LODWORD(v7) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 61) + 696LL))(
                  *((_QWORD *)this + 61),
                  "device-id");
  v9 = OSMetaClassBase::safeMetaCast(v7, v2, v8);
  if ( v9 )
  {
    LODWORD(v10) = (*(int (__fastcall **)(__int64, const OSMetaClassBase *))(*(_QWORD *)v9 + 376LL))(v9, v2);
    *((_WORD *)this + 353) = *(_WORD *)v10;
  }
  LODWORD(v11) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 61) + 696LL))(
                   *((_QWORD *)this + 61),
                   "revision-id");
  v13 = OSMetaClassBase::safeMetaCast(v11, v2, v12);
  if ( v13 )
  {
    LODWORD(v13) = (*(int (__fastcall **)(__int64, const OSMetaClassBase *))(*(_QWORD *)v13 + 376LL))(v13, v2);
    LOWORD(v13) = *(_WORD *)v13;
    *((_WORD *)this + 354) = v13;
  }
  return v13;
}
// B028: using guessed type _QWORD off_B028[9];
// 1B518: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (00000000000013FC) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::InitializeOperationalRegisters(AppleUSBOHCI *this)
{
  int v1; // eax@3
  int v2; // ecx@3
  __int64 v3; // rcx@7
  int v4; // eax@7
  unsigned int v5; // er15@7
  int v6; // er13@7
  __int64 v7; // rax@7
  signed int v8; // ebx@9
  signed int v9; // ebx@13

  if ( *(_DWORD *)(*((_QWORD *)this + 89) + 48LL) )
  {
    KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCI::InitializeOperationalRegisters Non-NULL hcDoneHead: 0x%x");
    *(_DWORD *)(*((_QWORD *)this + 89) + 8LL) = 1;
    IOSleep(3LL);
  }
  *(_DWORD *)(*((_QWORD *)this + 89) + 36LL) = 0;
  v1 = 0;
  v2 = 0;
  if ( *((_QWORD *)this + 347) )
    v2 = *(_DWORD *)(*((_QWORD *)this + 347) + 16LL);
  *(_DWORD *)(*((_QWORD *)this + 89) + 32LL) = v2;
  if ( *((_QWORD *)this + 346) )
    v1 = *(_DWORD *)(*((_QWORD *)this + 346) + 16LL);
  *(_DWORD *)(*((_QWORD *)this + 89) + 40LL) = v1;
  _mm_mfence();
  *(_DWORD *)(*((_QWORD *)this + 89) + 24LL) = *((_DWORD *)this + 736);
  _mm_mfence();
  *(_DWORD *)(*((_QWORD *)this + 89) + 12LL) = 2;
  _mm_mfence();
  v3 = *((_QWORD *)this + 89);
  v4 = *(_DWORD *)(v3 + 52) & 0x3FFF;
  v5 = 9 * v4 / 0xAu;
  v6 = v4 | ((((613566757 * (unsigned __int64)(unsigned int)(6 * v4 - 1260) >> 32)
             + ((unsigned int)(6 * v4 - 1260 - (613566757 * (unsigned __int64)(unsigned int)(6 * v4 - 1260) >> 32)) >> 1)) & 0xFFFFFFFC) << 14);
  *(_DWORD *)(v3 + 52) = v6;
  *(_DWORD *)(*((_QWORD *)this + 89) + 64LL) = v5;
  _mm_mfence();
  v7 = *(_QWORD *)(*((_QWORD *)this + 84) + 208LL);
  if ( BYTE1(v7) & 4 )
  {
    if ( *(_DWORD *)(*((_QWORD *)this + 89) + 52LL) != v6 )
    {
      v8 = 1;
      do
      {
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "OHCI driver: InitializeOperationalRegisters - hcFmInterval not sticking. Retrying.");
        *(_DWORD *)(*((_QWORD *)this + 89) + 52LL) = v6;
        _mm_mfence();
        if ( (unsigned int)v8 > 9 )
          break;
        ++v8;
      }
      while ( *(_DWORD *)(*((_QWORD *)this + 89) + 52LL) != v6 );
    }
    if ( *(_DWORD *)(*((_QWORD *)this + 89) + 64LL) != v5 )
    {
      v9 = 1;
      do
      {
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "OHCI driver: InitializeOperationalRegisters - hcPeriodicStart not sticking. Retrying.");
        *(_DWORD *)(*((_QWORD *)this + 89) + 64LL) = v5;
        _mm_mfence();
        if ( (unsigned int)v9 > 9 )
          break;
        ++v9;
      }
      while ( *(_DWORD *)(*((_QWORD *)this + 89) + 64LL) != v5 );
    }
    v7 = *(_QWORD *)(*((_QWORD *)this + 84) + 208LL);
  }
  if ( v7 & 0x10 )
    *(_DWORD *)(*((_QWORD *)this + 89) + 72LL) |= 0x1000u;
  return 0LL;
}
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000001626) ----------------------------------------------------
int __fastcall AppleUSBOHCI::stop(AppleUSBOHCI *this, IOService *a2)
{
  return (*(int (__fastcall **)(AppleUSBOHCI *, IOService *))(off_B040[0] + 1496))(this, a2);
}
// B040: using guessed type __int64 off_B040[6];

//----- (0000000000001638) ----------------------------------------------------
int __fastcall AppleUSBOHCI::willTerminate(AppleUSBOHCI *this, IOService *a2)
{
  return (*(int (__fastcall **)(AppleUSBOHCI *, IOService *))(off_B040[0] + 1040))(this, a2);
}
// B040: using guessed type __int64 off_B040[6];

//----- (000000000000164A) ----------------------------------------------------
int __fastcall AppleUSBOHCI::didTerminate(AppleUSBOHCI *this, IOService *a2, __int64 a3, bool *a4)
{
  return (*(int (__fastcall **)(AppleUSBOHCI *, IOService *, __int64, bool *))(off_B040[0] + 1048))(this, a2, a3, a4);
}
// B040: using guessed type __int64 off_B040[6];

//----- (000000000000165C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMInitialize(uintptr_t arg1, IOService *a2, const OSMetaClass *a3)
{
  IOService *v3; // rbx@1
  uintptr_t v4; // r14@1
  signed __int64 v5; // rsi@2
  __int64 v6; // rax@2
  __int64 v7; // rax@3
  int v8; // er12@3
  char v9; // r15@3
  __int64 v10; // rax@5
  __int64 v11; // rax@6
  __int64 v12; // rdx@11
  __int64 v13; // rdi@13
  OSMetaClassBase *v14; // rax@19
  __int64 v15; // rsi@19
  const OSMetaClass *v16; // rdx@19
  __int64 v17; // rax@19
  __int64 v18; // rax@20
  __int64 v19; // rax@22
  __int64 v20; // rax@22
  unsigned __int64 v21; // r8@22
  __int64 v22; // r15@22
  __int64 v23; // rax@23
  int v24; // ebx@30
  __int64 v25; // rax@32
  __int64 v26; // rax@32
  int v28; // [sp+1Ch] [bp-34h]@1
  unsigned int v29; // [sp+20h] [bp-30h]@30
  int v30; // [sp+24h] [bp-2Ch]@30
  __int64 v31; // [sp+28h] [bp-28h]@1

  v3 = a2;
  v4 = arg1;
  v31 = 0LL;
  v28 = 1;
  if ( *(_BYTE *)(arg1 + 2936) )
  {
LABEL_43:
    *(_BYTE *)(arg1 + 2936) = 1;
    *(_BYTE *)(arg1 + 440) = 0;
    v8 = 0;
    return (unsigned int)v8;
  }
  v5 = *(_QWORD *)off_B000[0];
  v6 = OSMetaClassBase::safeMetaCast(v3, *(const OSMetaClassBase **)off_B000[0], a3);
  *(_QWORD *)(arg1 + 488) = v6;
  if ( !v6 )
  {
    v9 = 0;
    goto LABEL_10;
  }
  AppleUSBOHCI::SetVendorInfo((AppleUSBOHCI *)arg1);
  v5 = *(_WORD *)(arg1 + 704);
  LODWORD(v7) = (*(int (__fastcall **)(uintptr_t, signed __int64, _QWORD, _QWORD))(*(_QWORD *)arg1 + 3344LL))(
                  arg1,
                  v5,
                  *(_WORD *)(arg1 + 706),
                  *(_WORD *)(arg1 + 708));
  *(_QWORD *)(*(_QWORD *)(arg1 + 672) + 208LL) = v7;
  v8 = -536870201;
  v9 = 0;
  if ( !*(_BYTE *)(*(_QWORD *)(arg1 + 168) + 244LL) && !(v7 & 0x400000) )
  {
    LODWORD(v10) = (*(int (__fastcall **)(IOService *, _QWORD, _QWORD))(*(_QWORD *)v3 + 1760LL))(v3, 0LL, 0LL);
    *(_QWORD *)(arg1 + 680) = v10;
    if ( v10 )
    {
      LODWORD(v11) = IOFilterInterruptEventSource::filterInterruptEventSource(
                       arg1,
                       AppleUSBOHCI::InterruptHandler,
                       AppleUSBOHCI::PrimaryInterruptFilter,
                       v3,
                       0LL);
      *(_QWORD *)(arg1 + 2928) = v11;
      if ( !v11 )
      {
        v9 = 0;
        v5 = 1431519814LL;
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBOHCI::UIMInitialize unable to get filterInterruptEventSource");
        goto LABEL_10;
      }
      if ( (*(int (__fastcall **)(_QWORD, __int64))(**(_QWORD **)(arg1 + 136) + 320LL))(*(_QWORD *)(arg1 + 136), v11) )
      {
        v9 = 0;
        v5 = 1431519814LL;
        KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCI::UIMInitialize unable to add filter event source: 0x%x");
LABEL_10:
        v8 = -536870206;
        goto LABEL_13;
      }
      if ( *(_BYTE *)(*(_QWORD *)(arg1 + 672) + 208LL) & 0x20 )
      {
        LODWORD(v14) = (*(int (__fastcall **)(IOService *, _QWORD))(*(_QWORD *)v3 + 696LL))(v3, "AAPL,SuspendablePorts");
        v15 = *(_QWORD *)off_B028[0];
        v17 = OSMetaClassBase::safeMetaCast(v14, *(const OSMetaClassBase **)off_B028[0], v16);
        if ( v17 )
        {
          LODWORD(v18) = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v17 + 376LL))(v17, v15);
          *(_DWORD *)(arg1 + 2916) = ~*(_DWORD *)v18;
        }
        else
        {
          *(_DWORD *)(arg1 + 2916) = -1;
        }
      }
      LODWORD(v19) = (*(int (**)(void))(**(_QWORD **)(arg1 + 680) + 280LL))();
      *(_QWORD *)(arg1 + 712) = v19;
      IOPCIDevice::extendedConfigWrite16(*(IOPCIDevice **)(arg1 + 488), 4uLL, 2u);
      LODWORD(v20) = IODMACommand::withSpecification(off_B008[0], 32LL, 4096LL, 64LL, 0LL, 1LL);
      v22 = v20;
      if ( !v20 )
      {
        v9 = 0;
        v5 = 1431519814LL;
        KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCI::UIMInitialize - could not create IODMACommand");
        v8 = -536870199;
        goto LABEL_13;
      }
      v23 = IOBufferMemoryDescriptor::inTaskWithPhysicalMask(
              *(IOBufferMemoryDescriptor **)off_B068,
              (task *)((char *)&dword_10 + 3),
              0x100u,
              0xFFFFF000uLL,
              v21);
      *(_QWORD *)(arg1 + 728) = v23;
      if ( v23 )
      {
        v8 = (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v23 + 496LL))(v23, 0LL);
        if ( v8 )
        {
          v9 = 0;
          v5 = 1431519814LL;
          KernelDebugLogInternal(
            1LL,
            1431519814LL,
            "AppleUSBOHCI::UIMInitialize - _hccaBuffer->prepare failed with status(0x%x)");
          goto LABEL_13;
        }
        v8 = (*(int (__fastcall **)(__int64, _QWORD, signed __int64))(*(_QWORD *)v22 + 296LL))(
               v22,
               *(_QWORD *)(arg1 + 728),
               1LL);
        if ( v8 )
        {
          v5 = 1431519814LL;
          KernelDebugLogInternal(
            1LL,
            1431519814LL,
            "AppleUSBOHCI::UIMInitialize - setMemoryDescriptor returned err (0x%x)");
          v9 = 1;
          goto LABEL_13;
        }
        v31 = 0LL;
        v29 = 0;
        v30 = 0;
        v28 = 1;
        v24 = (*(int (__fastcall **)(__int64, __int64 *, int *, int *))(*(_QWORD *)v22 + 344LL))(v22, &v31, &v29, &v28);
        if ( v30 != 256 || v28 != 1 || v24 != 0 )
        {
          KernelDebugLogInternal(
            1LL,
            1431519814LL,
            "AppleUSBOHCI::UIMInitialize - could not generate segments err (0x%x) numSegments (%d) fLength (%d)");
          v5 = 1LL;
          (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v22 + 304LL))(v22, 1LL);
          v8 = -536870199;
          if ( v24 )
            v8 = v24;
          v9 = 1;
          goto LABEL_13;
        }
        LODWORD(v25) = (*(int (__cdecl **)(_QWORD, __int64 *))(**(_QWORD **)(arg1 + 728) + 736LL))(
                         *(_QWORD *)(arg1 + 728),
                         &v31);
        *(_QWORD *)(arg1 + 720) = v25;
        *(_QWORD *)(arg1 + 2944) = v29;
        v5 = 1LL;
        (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v22 + 304LL))(v22, 1LL);
        LODWORD(v26) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v22 + 312LL))(v22);
        if ( v26 )
        {
          (*(void (__fastcall **)(__int64))(*(_QWORD *)v22 + 312LL))(v22);
          KernelDebugLogInternal(
            1LL,
            1431519814LL,
            "AppleUSBOHCI::UIMInitialize - dmaCommand still has memory descriptor (%p)");
          v5 = 1LL;
          (*(void (__fastcall **)(_QWORD, signed __int64))(*(_QWORD *)v22 + 304LL))(v22, 1LL);
        }
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v22 + 40LL))(v22);
        *(_WORD *)(arg1 + 2904) = 1;
        v8 = AppleUSBOHCI::IsochronousInitialize(arg1, 1uLL);
        v9 = 1;
        if ( !v8 )
        {
          v8 = AppleUSBOHCI::InterruptInitialize(arg1, 1uLL);
          if ( !v8 )
          {
            v8 = AppleUSBOHCI::BulkInitialize(arg1, 1uLL);
            if ( !v8 )
            {
              v8 = AppleUSBOHCI::ControlInitialize(arg1, 1uLL);
              if ( !v8 )
              {
                if ( *(_BYTE *)(*(_QWORD *)(arg1 + 672) + 208LL) & 0x80 )
                {
                  KernelDebugLogInternal(
                    1LL,
                    1431519814LL,
                    "AppleUSBOHCI::UIMInitialize error, turning off power to ports to clear");
                  AppleUSBOHCI::OHCIRootHubPower((AppleUSBOHCI *)arg1, 0);
                }
                *(_DWORD *)(*(_QWORD *)(arg1 + 712) + 4LL) = 0;
                _mm_mfence();
                IOSleep(50LL);
                if ( *(_BYTE *)(*(_QWORD *)(arg1 + 672) + 208LL) & 8 )
                  AppleUSBOHCI::OptiLSHSFix(arg1);
                AppleUSBOHCI::CheckSleepCapability((AppleUSBOHCI *)arg1);
                goto LABEL_43;
              }
            }
          }
        }
        goto LABEL_13;
      }
      v12 = (__int64)"AppleUSBOHCI::UIMInitialize - could not get HCCA buffer";
    }
    else
    {
      v12 = (__int64)"AppleUSBOHCI::UIMInitialize unable to get device memory";
    }
    v9 = 0;
    v5 = 1431519814LL;
    KernelDebugLogInternal(1LL, 1431519814LL, v12);
    v8 = -536870211;
  }
LABEL_13:
  v13 = *(_QWORD *)(arg1 + 728);
  if ( v13 )
  {
    if ( v9 )
    {
      v5 = 0LL;
      (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v13 + 504LL))(v13, 0LL);
      v13 = *(_QWORD *)(v4 + 728);
    }
    (*(void (__cdecl **)(__int64, signed __int64))(*(_QWORD *)v13 + 40LL))(v13, v5);
    *(_QWORD *)(v4 + 728) = 0LL;
  }
  return (unsigned int)v8;
}
// 10: using guessed type int;
// B000: using guessed type _QWORD off_B000[14];
// B008: using guessed type __int64 off_B008[13];
// B028: using guessed type _QWORD off_B028[9];
// B068: using guessed type __int64 off_B068;
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);
// 1B270: using guessed type int __fastcall IODMACommand::withSpecification(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 1B518: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);
// 1B898: using guessed type int __fastcall IOFilterInterruptEventSource::filterInterruptEventSource(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000001BD2) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::IsochronousInitialize(uintptr_t arg1, unsigned __int64 a2)
{
  AppleUSBOHCIedMemoryBlock *v2; // rax@1
  AppleUSBOHCIedMemoryBlock *v3; // rbx@1
  signed int v4; // er15@1
  AppleUSBOHCIedMemoryBlock *v5; // rax@2

  v2 = AppleUSBOHCI::AllocateED(arg1, a2);
  v3 = v2;
  v4 = -536870211;
  if ( v2 )
  {
    **(_DWORD **)v2 = 0x4000;
    *(_DWORD *)(*(_QWORD *)v2 + 12LL) = 0;
    *(_QWORD *)(arg1 + 2760) = v2;
    v5 = AppleUSBOHCI::AllocateED(arg1, a2);
    if ( v5 )
    {
      **(_DWORD **)v5 = 0x4000;
      *(_QWORD *)(arg1 + 2752) = v5;
      *(_DWORD *)(*(_QWORD *)v5 + 12LL) = *((_DWORD *)v3 + 4);
      *((_QWORD *)v5 + 1) = v3;
      *(_DWORD *)(arg1 + 2912) = 1023;
      *(_DWORD *)(*(_QWORD *)(arg1 + 168) + 204LL) = 25000;
      v4 = 0;
    }
  }
  return (unsigned int)v4;
}

//----- (0000000000001C64) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::InterruptInitialize(uintptr_t arg1, unsigned __int64 a2)
{
  uintptr_t v2; // r15@1
  __int64 v3; // r14@1
  __int64 v4; // r12@1
  signed __int64 v5; // rbx@1
  AppleUSBOHCIedMemoryBlock *v6; // rax@2
  signed int v7; // ecx@2
  __int64 v8; // rax@3
  uintptr_t v9; // r9@6
  __int64 v10; // rcx@6
  signed int v11; // esi@6
  int v12; // edi@6
  int v13; // edx@7
  int v14; // ebx@7
  int v15; // er8@9
  int v16; // eax@9
  __int64 v17; // rax@13
  signed __int64 v18; // rsi@13
  __int64 v19; // rsi@13
  __int64 v20; // rax@14
  __int64 v21; // rcx@14

  v2 = arg1;
  v3 = *(_QWORD *)(arg1 + 2752);
  v4 = 0LL;
  v5 = 760LL;
  while ( 1 )
  {
    v6 = AppleUSBOHCI::AllocateED(arg1, a2);
    v7 = -536870211;
    if ( !v6 )
      break;
    **(_DWORD **)v6 = 0x4000;
    *(_DWORD *)(*(_QWORD *)v6 + 12LL) = 0;
    *(_QWORD *)(arg1 + v5 - 24) = v6;
    v8 = *((_QWORD *)v6 + 2);
    *(_QWORD *)(arg1 + v5 - 8) = v8;
    *(_DWORD *)(arg1 + v5) = 0;
    if ( (signed int)v4 <= 31 )
      *(_DWORD *)(*(_QWORD *)(arg1 + 720) + 4 * v4) = v8;
    ++v4;
    v5 += 32LL;
    if ( (signed int)v4 >= 63 )
    {
      v9 = arg1 + 744;
      v10 = 0LL;
      v11 = 32;
      v12 = 0;
      do
      {
        v13 = v11 / 2;
        v14 = v11 / 2;
        if ( (signed int)v10 < v11 / 2 + v12 )
          v14 = v11;
        v15 = v11 + v12;
        v16 = v11 + v12 - 1;
        if ( (_DWORD)v10 != v16 )
          v15 = v12;
        if ( (_DWORD)v10 != v16 )
          v13 = v11;
        v17 = *(_QWORD *)(v9 - 8);
        v18 = 32LL * ((signed int)v10 + v14);
        *(_DWORD *)(*(_QWORD *)v17 + 12LL) = *(_DWORD *)(v2 + v18 + 752);
        v19 = *(_QWORD *)(v2 + v18 + 736);
        *(_QWORD *)(v17 + 8) = v19;
        *(_QWORD *)v9 = v19;
        ++v10;
        v9 += 32LL;
        v11 = v13;
        v12 = v15;
      }
      while ( v10 != 62 );
      v20 = *(_QWORD *)(v2 + 2720);
      *(_DWORD *)(*(_QWORD *)v20 + 12LL) = *(_DWORD *)(v3 + 16);
      v21 = *(_QWORD *)(v2 + 2752);
      *(_QWORD *)(v20 + 8) = v21;
      *(_QWORD *)(v2 + 2728) = v21;
      v7 = 0;
      return (unsigned int)v7;
    }
  }
  return (unsigned int)v7;
}

//----- (0000000000001D7E) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::BulkInitialize(uintptr_t arg1, unsigned __int64 a2)
{
  AppleUSBOHCIedMemoryBlock *v2; // rax@1
  AppleUSBOHCIedMemoryBlock *v3; // rbx@1
  signed int v4; // er15@1
  AppleUSBOHCIedMemoryBlock *v5; // rax@2

  v2 = AppleUSBOHCI::AllocateED(arg1, a2);
  v3 = v2;
  v4 = -536870211;
  if ( v2 )
  {
    **(_DWORD **)v2 = 0x4000;
    *(_DWORD *)(*(_QWORD *)v2 + 12LL) = 0;
    *(_QWORD *)(arg1 + 2784) = v2;
    v5 = AppleUSBOHCI::AllocateED(arg1, a2);
    if ( v5 )
    {
      **(_DWORD **)v5 = 0x4000;
      *(_QWORD *)(arg1 + 2768) = v5;
      *(_DWORD *)(*(_QWORD *)(arg1 + 712) + 40LL) = *((_DWORD *)v5 + 4);
      *(_DWORD *)(*(_QWORD *)v5 + 12LL) = *((_DWORD *)v3 + 4);
      *((_QWORD *)v5 + 1) = v3;
      v4 = 0;
    }
  }
  return (unsigned int)v4;
}

//----- (0000000000001E00) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::ControlInitialize(uintptr_t arg1, unsigned __int64 a2)
{
  AppleUSBOHCIedMemoryBlock *v2; // rax@1
  AppleUSBOHCIedMemoryBlock *v3; // rbx@1
  signed int v4; // er15@1
  AppleUSBOHCIedMemoryBlock *v5; // rax@2

  v2 = AppleUSBOHCI::AllocateED(arg1, a2);
  v3 = v2;
  v4 = -536870211;
  if ( v2 )
  {
    **(_DWORD **)v2 = 0x4000;
    *(_DWORD *)(*(_QWORD *)v2 + 12LL) = 0;
    *(_QWORD *)(arg1 + 2792) = v2;
    v5 = AppleUSBOHCI::AllocateED(arg1, a2);
    if ( v5 )
    {
      **(_DWORD **)v5 = 0x4000;
      *(_QWORD *)(arg1 + 2776) = v5;
      *(_DWORD *)(*(_QWORD *)(arg1 + 712) + 32LL) = *((_DWORD *)v5 + 4);
      *(_DWORD *)(*(_QWORD *)v5 + 12LL) = *((_DWORD *)v3 + 4);
      *((_QWORD *)v5 + 1) = v3;
      v4 = 0;
    }
  }
  return (unsigned int)v4;
}

//----- (0000000000001E82) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMFinalize(AppleUSBOHCI *this)
{
  AppleUSBOHCI *v1; // r14@1
  AppleUSBOHCIitdMemoryBlock *v2; // rbx@3
  __int64 v3; // r15@5
  AppleUSBOHCIgtdMemoryBlock *v4; // rbx@6
  __int64 v5; // r15@8
  AppleUSBOHCIedMemoryBlock *v6; // rbx@9
  __int64 v7; // r15@11
  __int64 v8; // rdi@12

  v1 = this;
  if ( !(unsigned __int8)IOService::isInactive(this) )
  {
    *(_DWORD *)(*((_QWORD *)this + 89) + 20LL) = 2147483648;
    _mm_mfence();
    *(_DWORD *)(*((_QWORD *)this + 89) + 4LL) = 0;
    _mm_mfence();
    IOSleep(50LL);
    IOPCIDevice::extendedConfigWrite16(*((IOPCIDevice **)this + 61), 4uLL, 2u);
    *(_DWORD *)(*((_QWORD *)this + 89) + 24LL) = 0;
    *(_DWORD *)(*((_QWORD *)this + 89) + 32LL) = 0;
    *(_DWORD *)(*((_QWORD *)this + 89) + 36LL) = 0;
    *(_DWORD *)(*((_QWORD *)this + 89) + 40LL) = 0;
    *(_DWORD *)(*((_QWORD *)this + 89) + 44LL) = 0;
    _mm_mfence();
    AppleUSBOHCI::OHCIRootHubPower(this, 0);
    *(_DWORD *)(*((_QWORD *)this + 89) + 8LL) = 1;
    _mm_mfence();
    IOSleep(1LL);
  }
  *((_QWORD *)this + 351) = 0LL;
  *((_QWORD *)this + 354) = 0LL;
  v2 = (AppleUSBOHCIitdMemoryBlock *)*((_QWORD *)this + 359);
  if ( v2 )
  {
    *((_QWORD *)this + 359) = 0LL;
    do
    {
      v3 = AppleUSBOHCIitdMemoryBlock::GetNextBlock(v2);
      (*(void (__fastcall **)(AppleUSBOHCIitdMemoryBlock *))(*(_QWORD *)v2 + 40LL))(v2);
      v2 = (AppleUSBOHCIitdMemoryBlock *)v3;
    }
    while ( v3 );
  }
  *((_QWORD *)this + 350) = 0LL;
  *((_QWORD *)this + 353) = 0LL;
  v4 = (AppleUSBOHCIgtdMemoryBlock *)*((_QWORD *)this + 358);
  if ( v4 )
  {
    *((_QWORD *)this + 358) = 0LL;
    do
    {
      v5 = AppleUSBOHCIgtdMemoryBlock::GetNextBlock(v4);
      (*(void (__fastcall **)(AppleUSBOHCIgtdMemoryBlock *))(*(_QWORD *)v4 + 40LL))(v4);
      v4 = (AppleUSBOHCIgtdMemoryBlock *)v5;
    }
    while ( v5 );
  }
  *((_QWORD *)this + 352) = 0LL;
  *((_QWORD *)this + 355) = 0LL;
  v6 = (AppleUSBOHCIedMemoryBlock *)*((_QWORD *)this + 357);
  if ( v6 )
  {
    *((_QWORD *)this + 357) = 0LL;
    do
    {
      v7 = AppleUSBOHCIedMemoryBlock::GetNextBlock(v6);
      (*(void (__fastcall **)(AppleUSBOHCIedMemoryBlock *))(*(_QWORD *)v6 + 40LL))(v6);
      v6 = (AppleUSBOHCIedMemoryBlock *)v7;
    }
    while ( v7 );
  }
  v8 = *((_QWORD *)this + 91);
  if ( v8 )
  {
    (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v8 + 504LL))(v8, 0LL);
    (*(void (__cdecl **)(_QWORD))(**((_QWORD **)v1 + 91) + 40LL))(*((_QWORD *)v1 + 91));
    *((_QWORD *)v1 + 91) = 0LL;
  }
  if ( *((_QWORD *)v1 + 366) )
  {
    (*(void (__cdecl **)(_QWORD))(**((_QWORD **)v1 + 17) + 328LL))(*((_QWORD *)v1 + 17));
    (*(void (__cdecl **)(_QWORD))(**((_QWORD **)v1 + 366) + 40LL))(*((_QWORD *)v1 + 366));
    *((_QWORD *)v1 + 366) = 0LL;
  }
  *((_BYTE *)v1 + 2936) = 0;
  return 0LL;
}
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);

//----- (00000000000020A0) ----------------------------------------------------
int __fastcall AppleUSBOHCI::doCallback(__int64 a1, __int64 a2, unsigned int a3, unsigned int a4)
{
  unsigned int v4; // er12@1
  __int64 v5; // r14@1
  __int64 v6; // r13@1
  __int64 v7; // rdi@1
  __int64 v8; // rax@1
  __int64 v9; // rbx@1
  signed __int64 v10; // rcx@4
  unsigned int v11; // er15@9
  __int64 v12; // rsi@11
  signed __int64 v13; // rax@11
  signed __int64 v14; // rsi@14
  unsigned int v16; // [sp+1Ch] [bp-74h]@1
  __int64 v17; // [sp+38h] [bp-58h]@11
  __int64 v18; // [sp+40h] [bp-50h]@11
  __int64 v19; // [sp+48h] [bp-48h]@11
  __int64 v20; // [sp+50h] [bp-40h]@11
  __int64 v21; // [sp+58h] [bp-38h]@11
  __int64 v22; // [sp+60h] [bp-30h]@11

  v4 = a4;
  v16 = a3;
  v5 = a1;
  v6 = *(_QWORD *)(a2 + 48);
  **(_DWORD **)v6 |= 0x4000u;
  v7 = *(_DWORD *)(*(_QWORD *)v6 + 8LL) & 0xFFFFFFF0;
  v8 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical((AppleUSBOHCIgtdMemoryBlock *)v7, 0, a3);
  v9 = v8;
  if ( v8 && v8 != *(_QWORD *)(v6 + 24) )
  {
    while ( 1 )
    {
      *(_DWORD *)(*(_QWORD *)v6 + 8LL) = *(_DWORD *)(*(_QWORD *)(v9 + 24) + 8LL) | *(_DWORD *)(*(_QWORD *)v6 + 8LL) & 0xF;
      v4 += AppleUSBOHCI::findBufferRemaining(v7, v9);
      *(_DWORD *)(*(_QWORD *)(v9 + 24) + 4LL) = 0;
      if ( *(_BYTE *)(v9 + 2) & 1 )
        break;
      v8 = *(_QWORD *)(v9 + 16);
      v10 = *(_QWORD *)(v9 + 8) & 0xFFFFFFFFLL;
      *(_QWORD *)(v9 + 16) = 0LL;
      *(_QWORD *)(v9 + 8) = v10;
      if ( *(_QWORD *)(v5 + 2800) )
      {
        *(_QWORD *)(*(_QWORD *)(v5 + 2824) + 16LL) = v9;
        *(_QWORD *)(v5 + 2824) = v9;
      }
      else
      {
        *(_QWORD *)(v5 + 2824) = v9;
        *(_QWORD *)(v5 + 2800) = v9;
      }
      v9 = v8;
      if ( v8 == *(_QWORD *)(v6 + 24) )
        return v8;
    }
    v11 = v16;
    if ( v16 == 9 )
    {
      *(_DWORD *)(*(_QWORD *)v6 + 8LL) &= 0xFFFFFFFE;
      v11 = 0;
    }
    v12 = *(_QWORD *)(v9 + 32);
    IOUSBCommand::GetUSLCompletion((IOUSBCommand *)&v17);
    v22 = v19;
    v21 = v18;
    v20 = v17;
    *(_BYTE *)(v9 + 2) &= 0xFEu;
    v13 = *(_QWORD *)(v9 + 8) & 0xFFFFFFFFLL;
    *(_QWORD *)(v9 + 16) = 0LL;
    *(_QWORD *)(v9 + 8) = v13;
    if ( *(_QWORD *)(v5 + 2800) )
    {
      *(_QWORD *)(*(_QWORD *)(v5 + 2824) + 16LL) = v9;
      *(_QWORD *)(v5 + 2824) = v9;
    }
    else
    {
      *(_QWORD *)(v5 + 2824) = v9;
      *(_QWORD *)(v5 + 2800) = v9;
    }
    **(_DWORD **)v6 &= 0xFFFFBFFF;
    v14 = 3758097097LL;
    if ( v11 <= 0xF )
      v14 = *((_DWORD *)AppleUSBOHCI::TranslateStatusToUSBError(unsigned int)::statusToErrorMap + v11);
    LODWORD(v8) = IOUSBController::Complete(v5, v14, v4);
  }
  return v8;
}
// AF30: using guessed type __int64 AppleUSBOHCI::TranslateStatusToUSBError(unsigned int)::statusToErrorMap[8];
// 1B510: using guessed type int __fastcall IOUSBController::Complete(_QWORD, _QWORD, _QWORD);

//----- (0000000000002278) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::findBufferRemaining(__int64 a1, __int64 a2)
{
  __int64 v2; // rdx@1
  __int64 result; // rax@1
  int v4; // eax@2
  int v5; // eax@3

  v2 = *(_QWORD *)(a2 + 24);
  result = 0LL;
  if ( *(_DWORD *)(v2 + 4) )
  {
    v4 = *(_DWORD *)(v2 + 12) & 0xFFF;
    if ( (unsigned int)(*(_DWORD *)(v2 + 4) ^ *(_DWORD *)(v2 + 12)) > 0xFFF )
      v5 = v4 + 4097;
    else
      v5 = v4 + 1;
    result = v5 - (*(_DWORD *)(v2 + 4) & 0xFFFu);
  }
  return result;
}

//----- (00000000000022B0) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::DeallocateTD(__int64 a1, __int64 a2)
{
  __int64 v2; // rax@1

  v2 = *(_DWORD *)(a2 + 8);
  *(_QWORD *)(a2 + 16) = 0LL;
  *(_QWORD *)(a2 + 8) = v2;
  if ( *(_QWORD *)(a1 + 2800) )
  {
    *(_QWORD *)(*(_QWORD *)(a1 + 2824) + 16LL) = a2;
    *(_QWORD *)(a1 + 2824) = a2;
  }
  else
  {
    *(_QWORD *)(a1 + 2824) = a2;
    *(_QWORD *)(a1 + 2800) = a2;
  }
  return 0LL;
}

//----- (00000000000022F4) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::TranslateStatusToUSBError(AppleUSBOHCI *this, unsigned int a2)
{
  __int64 result; // rax@1

  result = 3758097097LL;
  if ( a2 <= 0xF )
    result = *((_DWORD *)AppleUSBOHCI::TranslateStatusToUSBError(unsigned int)::statusToErrorMap + a2);
  return result;
}
// AF30: using guessed type __int64 AppleUSBOHCI::TranslateStatusToUSBError(unsigned int)::statusToErrorMap[8];

//----- (0000000000002310) ----------------------------------------------------
AppleUSBOHCIedMemoryBlock *__fastcall AppleUSBOHCI::AllocateED(uintptr_t arg1, unsigned __int64 a2)
{
  AppleUSBOHCIedMemoryBlock *v2; // r15@1
  __int64 v3; // rax@2
  AppleUSBOHCIedMemoryBlock *v4; // r13@2
  unsigned int v5; // er15@3
  __int64 v6; // rbx@3
  unsigned int v7; // er12@3
  unsigned int v8; // ebx@4

  v2 = *(AppleUSBOHCIedMemoryBlock **)(arg1 + 2816);
  if ( v2 )
  {
LABEL_15:
    *(_QWORD *)(arg1 + 2816) = *((_QWORD *)v2 + 1);
    *((_QWORD *)v2 + 1) = 0LL;
    return v2;
  }
  v3 = AppleUSBOHCIedMemoryBlock::NewMemoryBlock((AppleUSBOHCIedMemoryBlock *)arg1, a2);
  v4 = (AppleUSBOHCIedMemoryBlock *)v3;
  if ( v3 )
  {
    AppleUSBOHCIedMemoryBlock::SetNextBlock(
      (AppleUSBOHCIedMemoryBlock *)v3,
      *(AppleUSBOHCIedMemoryBlock **)(arg1 + 2856));
    *(_QWORD *)(arg1 + 2856) = v4;
    v5 = AppleUSBOHCIedMemoryBlock::NumEDs(v4);
    v6 = 0LL;
    *(_QWORD *)(arg1 + 2840) = AppleUSBOHCIedMemoryBlock::GetED(v4, 0);
    *(_QWORD *)(arg1 + 2816) = *(_QWORD *)(arg1 + 2840);
    *(_QWORD *)(*(_QWORD *)(arg1 + 2816) + 16LL) = AppleUSBOHCIedMemoryBlock::GetSharedPhysicalPtr(v4, 0);
    **(_QWORD **)(arg1 + 2816) = AppleUSBOHCIedMemoryBlock::GetSharedLogicalPtr(v4, 0);
    v7 = v5;
    if ( v5 >= 2 )
    {
      v8 = 1;
      while ( 1 )
      {
        v2 = AppleUSBOHCIedMemoryBlock::GetED(v4, v8);
        if ( !v2 )
          break;
        *((_QWORD *)v2 + 1) = *(_QWORD *)(arg1 + 2816);
        *((_QWORD *)v2 + 2) = AppleUSBOHCIedMemoryBlock::GetSharedPhysicalPtr(v4, v8);
        *(_QWORD *)v2 = AppleUSBOHCIedMemoryBlock::GetSharedLogicalPtr(v4, v8);
        *(_QWORD *)(arg1 + 2816) = v2;
        ++v8;
        if ( v8 >= v7 )
          goto LABEL_15;
      }
      if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D3824u, arg1, 0LL, 0LL, 2uLL, 0LL);
      v2 = *(AppleUSBOHCIedMemoryBlock **)(arg1 + 2816);
      v6 = 0LL;
      if ( v2 )
        goto LABEL_15;
    }
  }
  else
  {
    v6 = 0LL;
    if ( *(_BYTE *)off_B058[0] & 2 )
    {
      v6 = 0LL;
      if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      {
        v6 = 0LL;
        kernel_debug(0x52D3824u, arg1, 0LL, 0LL, 1uLL, 0LL);
      }
    }
  }
  return (AppleUSBOHCIedMemoryBlock *)v6;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];

//----- (00000000000024B6) ----------------------------------------------------
AppleUSBOHCIitdMemoryBlock *__fastcall AppleUSBOHCI::AllocateITD(uintptr_t arg1, unsigned __int64 a2)
{
  AppleUSBOHCIitdMemoryBlock *v2; // rbx@1
  __int64 v3; // rax@2
  AppleUSBOHCIitdMemoryBlock *v4; // r15@2
  unsigned int v5; // er12@3
  signed __int64 v6; // r13@3
  __int64 v7; // rax@14

  v2 = *(AppleUSBOHCIitdMemoryBlock **)(arg1 + 2808);
  if ( v2 )
  {
LABEL_14:
    v7 = 0LL;
    do
    {
      if ( v2 )
        *(_WORD *)(*((_QWORD *)v2 + 3) + 2 * v7 + 16) = 0;
      ++v7;
    }
    while ( v7 != 8 );
    *(_QWORD *)(arg1 + 2808) = *((_QWORD *)v2 + 2);
    *((_QWORD *)v2 + 2) = 0LL;
    *((_WORD *)v2 + 1) = 0;
    return v2;
  }
  v3 = AppleUSBOHCIitdMemoryBlock::NewMemoryBlock((AppleUSBOHCIitdMemoryBlock *)arg1, a2);
  v4 = (AppleUSBOHCIitdMemoryBlock *)v3;
  if ( v3 )
  {
    AppleUSBOHCIitdMemoryBlock::SetNextBlock(
      (AppleUSBOHCIitdMemoryBlock *)v3,
      *(AppleUSBOHCIitdMemoryBlock **)(arg1 + 2872));
    *(_QWORD *)(arg1 + 2872) = v4;
    v5 = AppleUSBOHCIitdMemoryBlock::NumITDs(v4);
    v2 = 0LL;
    *(_QWORD *)(arg1 + 2832) = AppleUSBOHCIitdMemoryBlock::GetITD(v4, 0);
    *(_QWORD *)(arg1 + 2808) = *(_QWORD *)(arg1 + 2832);
    *(_QWORD *)(*(_QWORD *)(arg1 + 2808) + 8LL) = AppleUSBOHCIitdMemoryBlock::GetSharedPhysicalPtr(v4, 0);
    *(_QWORD *)(*(_QWORD *)(arg1 + 2808) + 24LL) = AppleUSBOHCIitdMemoryBlock::GetSharedLogicalPtr(v4, 0);
    v6 = 1LL;
    if ( v5 >= 2 )
    {
      while ( 1 )
      {
        v2 = AppleUSBOHCIitdMemoryBlock::GetITD(v4, v6);
        if ( !v2 )
          break;
        *((_QWORD *)v2 + 2) = *(_QWORD *)(arg1 + 2808);
        *((_QWORD *)v2 + 1) = AppleUSBOHCIitdMemoryBlock::GetSharedPhysicalPtr(v4, v6);
        *((_QWORD *)v2 + 3) = AppleUSBOHCIitdMemoryBlock::GetSharedLogicalPtr(v4, v6);
        *(_QWORD *)(arg1 + 2808) = v2;
        ++v6;
        if ( (unsigned int)v6 >= v5 )
          goto LABEL_14;
      }
      if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D3820u, arg1, v6, v5, 2uLL, 0LL);
      v2 = *(AppleUSBOHCIitdMemoryBlock **)(arg1 + 2808);
    }
    goto LABEL_14;
  }
  v2 = 0LL;
  if ( *(_BYTE *)off_B058[0] & 2 )
  {
    v2 = 0LL;
    if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    {
      v2 = 0LL;
      kernel_debug(0x52D3820u, arg1, 0LL, 0LL, 1uLL, 0LL);
    }
  }
  return v2;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];

//----- (0000000000002682) ----------------------------------------------------
AppleUSBOHCIgtdMemoryBlock *__fastcall AppleUSBOHCI::AllocateTD(uintptr_t arg1, unsigned __int64 a2)
{
  AppleUSBOHCIgtdMemoryBlock *v2; // r15@1
  __int64 v3; // rax@2
  AppleUSBOHCIgtdMemoryBlock *v4; // r13@2
  unsigned int v5; // er15@3
  __int64 v6; // rbx@3
  unsigned int v7; // er12@3
  unsigned int v8; // ebx@4

  v2 = *(AppleUSBOHCIgtdMemoryBlock **)(arg1 + 2800);
  if ( v2 )
  {
LABEL_15:
    *(_QWORD *)(arg1 + 2800) = *((_QWORD *)v2 + 2);
    *((_QWORD *)v2 + 2) = 0LL;
    *((_WORD *)v2 + 1) = 0;
    *((_QWORD *)v2 + 5) = 0LL;
    return v2;
  }
  v3 = AppleUSBOHCIgtdMemoryBlock::NewMemoryBlock((AppleUSBOHCIgtdMemoryBlock *)arg1, a2);
  v4 = (AppleUSBOHCIgtdMemoryBlock *)v3;
  if ( v3 )
  {
    AppleUSBOHCIgtdMemoryBlock::SetNextBlock(
      (AppleUSBOHCIgtdMemoryBlock *)v3,
      *(AppleUSBOHCIgtdMemoryBlock **)(arg1 + 2864));
    *(_QWORD *)(arg1 + 2864) = v4;
    v5 = AppleUSBOHCIgtdMemoryBlock::NumGTDs(v4);
    v6 = 0LL;
    *(_QWORD *)(arg1 + 2824) = AppleUSBOHCIgtdMemoryBlock::GetGTD(v4, 0);
    *(_QWORD *)(arg1 + 2800) = *(_QWORD *)(arg1 + 2824);
    *(_QWORD *)(*(_QWORD *)(arg1 + 2800) + 8LL) = AppleUSBOHCIgtdMemoryBlock::GetSharedPhysicalPtr(v4, 0);
    *(_QWORD *)(*(_QWORD *)(arg1 + 2800) + 24LL) = AppleUSBOHCIgtdMemoryBlock::GetSharedLogicalPtr(v4, 0);
    v7 = v5;
    if ( v5 >= 2 )
    {
      v8 = 1;
      while ( 1 )
      {
        v2 = AppleUSBOHCIgtdMemoryBlock::GetGTD(v4, v8);
        if ( !v2 )
          break;
        *((_QWORD *)v2 + 2) = *(_QWORD *)(arg1 + 2800);
        *((_QWORD *)v2 + 1) = AppleUSBOHCIgtdMemoryBlock::GetSharedPhysicalPtr(v4, v8);
        *((_QWORD *)v2 + 3) = AppleUSBOHCIgtdMemoryBlock::GetSharedLogicalPtr(v4, v8);
        *(_QWORD *)(arg1 + 2800) = v2;
        ++v8;
        if ( v8 >= v7 )
          goto LABEL_15;
      }
      if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D381Cu, arg1, 0LL, 0LL, 2uLL, 0LL);
      v2 = *(AppleUSBOHCIgtdMemoryBlock **)(arg1 + 2800);
      v6 = 0LL;
      if ( v2 )
        goto LABEL_15;
    }
  }
  else
  {
    v6 = 0LL;
    if ( *(_BYTE *)off_B058[0] & 2 )
    {
      v6 = 0LL;
      if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      {
        v6 = 0LL;
        kernel_debug(0x52D381Cu, arg1, 0LL, 0LL, 1uLL, 0LL);
      }
    }
  }
  return (AppleUSBOHCIgtdMemoryBlock *)v6;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];

//----- (000000000000283E) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::DeallocateITD(__int64 a1, __int64 a2)
{
  __int64 v2; // rax@1

  v2 = *(_DWORD *)(a2 + 8);
  *(_QWORD *)(a2 + 16) = 0LL;
  *(_QWORD *)(a2 + 8) = v2;
  if ( *(_QWORD *)(a1 + 2808) )
  {
    *(_QWORD *)(*(_QWORD *)(a1 + 2832) + 16LL) = a2;
    *(_QWORD *)(a1 + 2832) = a2;
  }
  else
  {
    *(_QWORD *)(a1 + 2832) = a2;
    *(_QWORD *)(a1 + 2808) = a2;
  }
  return 0LL;
}

//----- (0000000000002882) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::DeallocateED(__int64 a1, __int64 a2)
{
  *(_DWORD *)(a2 + 20) = 0;
  *(_QWORD *)(a2 + 8) = 0LL;
  if ( *(_QWORD *)(a1 + 2816) )
  {
    *(_QWORD *)(*(_QWORD *)(a1 + 2840) + 8LL) = a2;
    *(_QWORD *)(a1 + 2840) = a2;
  }
  else
  {
    *(_QWORD *)(a1 + 2840) = a2;
    *(_QWORD *)(a1 + 2816) = a2;
  }
  return 0LL;
}

//----- (00000000000028C6) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::RemoveAllTDs(uintptr_t a1, __int64 a2)
{
  int v2; // ecx@1
  __int64 v3; // rax@1
  signed __int64 v4; // rbx@2
  signed __int64 v5; // rbx@4

  AppleUSBOHCI::RemoveTDs(a1, a2, 1u);
  v2 = **(_DWORD **)a2;
  v3 = *(_QWORD *)(a2 + 24);
  if ( BYTE1(v2) & 0x80 )
  {
    v4 = *(_QWORD *)(v3 + 8) & 0xFFFFFFFFLL;
    *(_QWORD *)(v3 + 16) = 0LL;
    *(_QWORD *)(v3 + 8) = v4;
    if ( *(_QWORD *)(a1 + 2808) )
    {
      *(_QWORD *)(*(_QWORD *)(a1 + 2832) + 16LL) = v3;
      *(_QWORD *)(a1 + 2832) = v3;
    }
    else
    {
      *(_QWORD *)(a1 + 2832) = v3;
      *(_QWORD *)(a1 + 2808) = v3;
    }
  }
  else
  {
    v5 = *(_QWORD *)(v3 + 8) & 0xFFFFFFFFLL;
    *(_QWORD *)(v3 + 16) = 0LL;
    *(_QWORD *)(v3 + 8) = v5;
    if ( *(_QWORD *)(a1 + 2800) )
    {
      *(_QWORD *)(*(_QWORD *)(a1 + 2824) + 16LL) = v3;
      *(_QWORD *)(a1 + 2824) = v3;
    }
    else
    {
      *(_QWORD *)(a1 + 2824) = v3;
      *(_QWORD *)(a1 + 2800) = v3;
    }
  }
  *(_QWORD *)(a2 + 24) = 0LL;
  return 0LL;
}

//----- (0000000000002982) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::RemoveTDs(uintptr_t a1, __int64 a2, unsigned int a3)
{
  __int64 v3; // r14@1
  uintptr_t v4; // r12@1
  int v5; // eax@1
  __int64 v6; // rdi@1
  __int64 v7; // rbx@2
  __int64 v8; // r13@2
  signed int v9; // er15@3
  __int64 v10; // rax@5
  signed __int64 v11; // rcx@5
  __int64 v12; // rbx@10
  unsigned int v13; // er13@11
  __int64 v14; // rsi@17
  signed __int64 v15; // rax@18
  __int64 v17; // [sp+18h] [bp-68h]@10
  char v18; // [sp+24h] [bp-5Ch]@10
  __int64 v19; // [sp+40h] [bp-40h]@17

  v3 = a2;
  v4 = a1;
  v5 = **(_DWORD **)a2;
  v6 = *(_DWORD *)(*(_QWORD *)a2 + 8LL) & 0xFFFFFFF0;
  if ( BYTE1(v5) & 0x80 )
  {
    v7 = AppleUSBOHCIitdMemoryBlock::GetITDFromPhysical((AppleUSBOHCIitdMemoryBlock *)v6, 0, a3);
    v8 = *(_QWORD *)(a2 + 24);
    if ( v7 == v8 )
    {
LABEL_9:
      v9 = 0;
    }
    else
    {
      v9 = -1;
      while ( v7 )
      {
        *(_DWORD *)(*(_QWORD *)a2 + 8LL) = *(_DWORD *)(*(_QWORD *)(v7 + 24) + 8LL);
        *(_QWORD *)(a2 + 32) = *(_QWORD *)(v7 + 16);
        AppleUSBOHCI::ProcessCompletedITD(v4, v7, -536870165);
        v10 = *(_QWORD *)(v7 + 16);
        v11 = *(_QWORD *)(v7 + 8) & 0xFFFFFFFFLL;
        *(_QWORD *)(v7 + 16) = 0LL;
        *(_QWORD *)(v7 + 8) = v11;
        if ( *(_QWORD *)(v4 + 2808) )
        {
          *(_QWORD *)(*(_QWORD *)(v4 + 2832) + 16LL) = v7;
          *(_QWORD *)(v4 + 2832) = v7;
        }
        else
        {
          *(_QWORD *)(v4 + 2832) = v7;
          *(_QWORD *)(v4 + 2808) = v7;
        }
        v7 = v10;
        if ( v10 == v8 )
          goto LABEL_9;
      }
    }
  }
  else
  {
    v18 = a3;
    v9 = 0;
    v12 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical((AppleUSBOHCIgtdMemoryBlock *)v6, 0, a3);
    v17 = *(_QWORD *)(a2 + 24);
    *(_QWORD *)(a2 + 32) = v17;
    if ( v12 != v17 )
    {
      v13 = 0;
      do
      {
        v9 = -1;
        if ( !v12 )
          break;
        if ( v18 )
          *(_DWORD *)(*(_QWORD *)v3 + 8LL) = *(_DWORD *)(*(_QWORD *)(v12 + 24) + 8LL);
        else
          *(_DWORD *)(*(_QWORD *)v3 + 8LL) = *(_DWORD *)(*(_QWORD *)(v12 + 24) + 8LL) | *(_DWORD *)(*(_QWORD *)v3 + 8LL) & 2;
        *(_QWORD *)(v3 + 32) = *(_QWORD *)(v12 + 16);
        v13 += AppleUSBOHCI::findBufferRemaining(v6, v12);
        if ( *(_BYTE *)(v12 + 2) & 1 )
        {
          v14 = *(_QWORD *)(v12 + 32);
          IOUSBCommand::GetUSLCompletion((IOUSBCommand *)&v19);
          *(_BYTE *)(v12 + 2) &= 0xFEu;
          v6 = v4;
          IOUSBController::Complete(v4, 3758097131LL, v13);
          v13 = 0;
        }
        v15 = *(_QWORD *)(v12 + 8) & 0xFFFFFFFFLL;
        *(_QWORD *)(v12 + 16) = 0LL;
        *(_QWORD *)(v12 + 8) = v15;
        if ( *(_QWORD *)(v4 + 2800) )
        {
          *(_QWORD *)(*(_QWORD *)(v4 + 2824) + 16LL) = v12;
          *(_QWORD *)(v4 + 2824) = v12;
        }
        else
        {
          *(_QWORD *)(v4 + 2824) = v12;
          *(_QWORD *)(v4 + 2800) = v12;
        }
        v12 = *(_QWORD *)(v3 + 32);
        v9 = 0;
      }
      while ( v12 != v17 );
    }
  }
  return (unsigned int)v9;
}
// 1B510: using guessed type int __fastcall IOUSBController::Complete(_QWORD, _QWORD, _QWORD);

//----- (0000000000002B94) ----------------------------------------------------
void __fastcall AppleUSBOHCI::ProcessCompletedITD(uintptr_t a1, __int64 a2, signed int a3)
{
  __int64 v3; // r15@1
  __int64 v4; // rbx@1
  unsigned int v5; // er13@1
  signed int v6; // er12@1
  uint64_t v7; // rax@5
  __int16 v8; // r9@6
  int v9; // er13@6
  __int64 v10; // rsi@6
  signed int v11; // er11@6
  char v12; // r10@6
  unsigned int v13; // er8@8
  int v14; // ecx@9
  __int64 v15; // rax@9
  __int64 v16; // rax@10
  __int64 v17; // rcx@15
  __int64 v18; // rax@15
  unsigned int v19; // edx@15
  char v20; // al@18
  __int16 v21; // t0@24
  __int16 v22; // t0@24
  void (__fastcall *v23)(_QWORD, _QWORD, _QWORD, _QWORD); // r8@26
  char v24; // r10@28
  __int64 v25; // rcx@32
  int v26; // edx@32
  char v27; // [sp+10h] [bp-30h]@5

  v3 = a2;
  v4 = *(_QWORD *)(a2 + 56);
  v5 = **(_DWORD **)(a2 + 24);
  v6 = -536870164;
  if ( (v5 & 0xF0000000) != 0x80000000 )
    v6 = a3;
  if ( *(_DWORD *)(a1 + 2988) && (unsigned __int16)(*(_WORD *)a2 - 11) <= 1u )
  {
    v7 = mach_absolute_time();
    absolutetime_to_nanoseconds(v7 - *(_QWORD *)(v4 + 16LL * *(_DWORD *)(a2 + 64) + 8), &v27);
    *(_DWORD *)(a1 + 2984) = 0;
    *(_DWORD *)(a1 + 2992) = 0;
    *(_DWORD *)(a1 + 2996) = 0;
  }
  v8 = *(_WORD *)a2;
  v9 = ((v5 >> 24) & 7) + 1;
  v10 = 0LL;
  v11 = 0;
  v12 = 0;
  do
  {
    if ( (unsigned __int16)(v8 - 9) <= 1u )
    {
      v13 = *(_WORD *)(*(_QWORD *)(v3 + 24) + 2 * v10 + 16);
      if ( (unsigned __int16)(*(_WORD *)(*(_QWORD *)(v3 + 24) + 2 * v10 + 16) & 0xE000) == 57344 )
      {
        v14 = *(_DWORD *)(v3 + 64);
        v15 = (unsigned int)(v10 + v14);
        *(_WORD *)(v4 + 8 * v15 + 6) = 0;
        *(_DWORD *)(v4 + 8 * v15) = 15;
      }
      else
      {
        v14 = *(_DWORD *)(v3 + 64);
        v16 = (unsigned int)(v10 + v14);
        *(_DWORD *)(v4 + 8 * v16) = v13 >> 12;
        if ( v13 >> 12 || v8 != 10 && v8 != 12 )
          *(_WORD *)(v4 + 8 * v16 + 6) = v13 & 0x7FF;
        else
          *(_WORD *)(v4 + 8 * v16 + 6) = *(_WORD *)(v4 + 8 * v16 + 4);
      }
      v17 = (unsigned int)(v10 + v14);
      v18 = *(_DWORD *)(v4 + 8 * v17);
      v19 = 0;
      if ( *(_DWORD *)(v4 + 8 * v17) )
      {
        v19 = -536870199;
        if ( (unsigned int)v18 <= 0xF )
          v19 = *((_DWORD *)AppleUSBOHCI::TranslateStatusToUSBError(unsigned int)::statusToErrorMap + v18);
        *(_DWORD *)(v4 + 8 * v17) = v19;
        v20 = 1;
        if ( v19 != -536870169 )
          v20 = v12;
        if ( v19 != -536870169 )
          v11 = v19;
        v12 = v20;
      }
      if ( *(_BYTE *)(v3 + 68) )
      {
        v21 = __ROL2__(*(_WORD *)(v4 + 8 * v17 + 4), 8);
        *(_WORD *)(v4 + 8 * v17 + 4) = v21;
        v22 = __ROL2__(*(_WORD *)(v4 + 8 * v17 + 6), 8);
        *(_WORD *)(v4 + 8 * v17 + 6) = v22;
        *(_DWORD *)(v4 + 8 * v17) = _byteswap_ulong(v19);
      }
    }
    ++v10;
  }
  while ( v9 != (_DWORD)v10 );
  v23 = *(void (__fastcall **)(_QWORD, _QWORD, _QWORD, _QWORD))(v3 + 40);
  if ( v23 )
  {
    if ( !v6 )
    {
      v24 = v12 & 1;
      if ( v11 || (v6 = 0, v24) )
      {
        v6 = -536870169;
        if ( v24 == 0 || v11 != 0 )
          v6 = v11;
      }
    }
    *(_QWORD *)(v3 + 40) = 0LL;
    v23(*(_QWORD *)(v3 + 32), *(_QWORD *)(v3 + 48), (unsigned int)v6, v4);
    v25 = *(_QWORD *)(a1 + 168);
    v26 = *(_DWORD *)(v25 + 188);
    *(_DWORD *)(v25 + 188) = v26 - 1;
    if ( v26 <= 0 )
    {
      if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D3828u, a1, (unsigned int)(v26 - 1), 0LL, 0LL, 0LL);
    }
    else if ( v26 == 1 )
    {
      if ( *(_DWORD *)(v25 + 204) )
        IOService::requireMaxBusStall((IOService *)a1, 0);
    }
  }
}
// AF30: using guessed type __int64 AppleUSBOHCI::TranslateStatusToUSBError(unsigned int)::statusToErrorMap[8];
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1BF40: using guessed type int __fastcall absolutetime_to_nanoseconds(_QWORD, _QWORD);

//----- (0000000000002DE4) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMProcessDoneQueue(AppleUSBOHCI *this, void (__cdecl *a2)(void *, void *, int, unsigned int))
{
  __int64 v2; // r15@1
  int v3; // er12@1
  AppleUSBOHCIgtdMemoryBlock *v4; // r15@1
  unsigned int v5; // er13@1

  v2 = *((_QWORD *)this + 380);
  v3 = ml_set_interrupts_enabled(0LL);
  IOSimpleLockLock(v2, a2);
  v4 = (AppleUSBOHCIgtdMemoryBlock *)*((_QWORD *)this + 378);
  v5 = *((_DWORD *)this + 758);
  IOSimpleLockUnlock(*((_QWORD *)this + 380));
  ml_set_interrupts_enabled((unsigned int)v3);
  return AppleUSBOHCI::DoDoneQueueProcessing(this, v4, v5, a2);
}
// 1B1D8: using guessed type int __fastcall IOSimpleLockLock(_QWORD, _QWORD);
// 1B1E0: using guessed type int __fastcall IOSimpleLockUnlock(_QWORD);
// 1BF88: using guessed type int __fastcall ml_set_interrupts_enabled(_QWORD);

//----- (0000000000002E52) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::DoDoneQueueProcessing(AppleUSBOHCI *this, AppleUSBOHCIgtdMemoryBlock *a2, unsigned int a3, void (__cdecl *a4)(void *, void *, int, unsigned int))
{
  unsigned int v4; // er15@1
  uintptr_t v5; // r12@1
  __int64 v6; // rbx@3
  __int64 v7; // rdi@3
  __int64 v8; // rax@3
  __int64 v9; // rdx@3
  __int64 v10; // r14@4
  __int64 v11; // rbx@9
  __int64 v12; // rax@9
  __int64 v13; // r15@9
  __int64 v14; // rcx@11
  signed int v16; // er13@13
  __int16 v17; // ax@13
  __int64 v18; // r15@16
  signed __int64 v19; // rax@18
  unsigned int v20; // eax@20
  unsigned int v21; // er15@21
  __int64 v22; // rsi@21
  signed __int64 v23; // rax@28
  void (__cdecl *v24)(void *, void *, int, unsigned int); // [sp+18h] [bp-68h]@1
  __int64 v25; // [sp+38h] [bp-48h]@21
  void (__cdecl *v26)(void *, void *, int, unsigned int); // [sp+40h] [bp-40h]@22
  int v27; // [sp+54h] [bp-2Ch]@2

  v24 = a4;
  v4 = a3;
  v5 = (uintptr_t)this;
  if ( a2 )
  {
    v27 = *((_DWORD *)this + 759);
    if ( v27 != a3 )
    {
      v6 = 0LL;
      v7 = (__int64)a2;
      v8 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(a2, 0, a3);
      if ( v8 )
      {
        do
        {
          v10 = v8;
          *(_QWORD *)(v8 + 16) = v6;
          ++v27;
          if ( v27 == v4 )
          {
            *(_DWORD *)(v5 + 3036) = v27;
            goto LABEL_9;
          }
          v7 = *(_DWORD *)(*(_QWORD *)(v8 + 24) + 8LL) & 0xFFFFFFF0;
          v8 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical((AppleUSBOHCIgtdMemoryBlock *)v7, 0, v9);
          v6 = v10;
        }
        while ( v8 );
        *(_DWORD *)(v5 + 3036) = v27;
        while ( 1 )
        {
          while ( 1 )
          {
            if ( !v10 )
              return 0LL;
LABEL_9:
            v11 = v10;
            v10 = *(_QWORD *)(v10 + 16);
            v12 = *(_QWORD *)(v11 + 24);
            v13 = *(_DWORD *)v12 >> 28;
            if ( !*(_DWORD *)(v5 + 2908) || *(_WORD *)v11 != 8 )
              break;
            v14 = *(_QWORD *)(v11 + 48);
            *(_DWORD *)v12 &= 0x3FFFFFFu;
            *(_DWORD *)(*(_QWORD *)v14 + 8LL) &= 0xFFFFFFF0;
            v9 = *(_QWORD *)(v11 + 24);
            *(_DWORD *)(v9 + 8) = *(_DWORD *)(*(_QWORD *)v14 + 4LL) & 0xFFFFFFF0;
            *(_DWORD *)(*(_QWORD *)v14 + 4LL) = *(_DWORD *)(v11 + 8);
            *(_DWORD *)(*(_QWORD *)(v5 + 712) + 8LL) = 2;
          }
          v16 = *((_DWORD *)AppleUSBOHCI::TranslateStatusToUSBError(unsigned int)::statusToErrorMap + v13);
          v17 = *(_WORD *)v11;
          if ( (_DWORD)v13 != 13 || v17 != 1 )
          {
            if ( (unsigned __int16)(v17 - 9) > 3u )
              goto LABEL_20;
            v7 = v5;
            AppleUSBOHCI::ProcessCompletedITD(v5, v11, v16);
            v19 = *(_QWORD *)(v11 + 8) & 0xFFFFFFFFLL;
            *(_QWORD *)(v11 + 16) = 0LL;
            *(_QWORD *)(v11 + 8) = v19;
            if ( *(_QWORD *)(v5 + 2808) )
            {
              *(_QWORD *)(*(_QWORD *)(v5 + 2832) + 16LL) = v11;
              *(_QWORD *)(v5 + 2832) = v11;
            }
            else
            {
              *(_QWORD *)(v5 + 2832) = v11;
              *(_QWORD *)(v5 + 2808) = v11;
            }
          }
          else if ( *(_BYTE *)(*(_QWORD *)(v5 + 672) + 208LL) & 4 )
          {
            v18 = *(_QWORD *)(v11 + 48);
            **(_DWORD **)(v11 + 24) &= 0x3FFFFFFu;
            *(_DWORD *)(*(_QWORD *)(v11 + 24) + 8LL) = *(_DWORD *)(*(_QWORD *)v18 + 8LL) & 0xFFFFFFF0;
            v7 = *(_DWORD *)(*(_QWORD *)v18 + 8LL) & 0xFFFFFFF0;
            *(_QWORD *)(v11 + 16) = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(
                                      (AppleUSBOHCIgtdMemoryBlock *)v7,
                                      0,
                                      v9);
            *(_DWORD *)(*(_QWORD *)v18 + 8LL) = *(_DWORD *)(v11 + 8) | *(_DWORD *)(*(_QWORD *)v18 + 8LL) & 2;
            *(_DWORD *)(*(_QWORD *)(v5 + 712) + 8LL) = 4;
          }
          else
          {
LABEL_20:
            v20 = AppleUSBOHCI::findBufferRemaining(v7, v11);
            if ( *(_BYTE *)(v11 + 2) & 1 )
            {
              v21 = v20;
              v22 = *(_QWORD *)(v11 + 32);
              v7 = (__int64)&v25;
              IOUSBCommand::GetUSLCompletion((IOUSBCommand *)&v25);
              if ( !v24 || v26 == v24 )
              {
                *(_BYTE *)(v11 + 2) &= 0xFEu;
                v7 = v5;
                IOUSBController::Complete(v5, (unsigned int)v16, v21);
                goto LABEL_28;
              }
              if ( *(_QWORD *)(v5 + 688) )
                *(_QWORD *)(*(_QWORD *)(v5 + 696) + 16LL) = v11;
              else
                *(_QWORD *)(v5 + 688) = v11;
              *(_QWORD *)(v5 + 696) = v11;
            }
            else
            {
              if ( (_DWORD)v13 )
              {
                v7 = v5;
                AppleUSBOHCI::doCallback(v5, v11, v13, v20);
              }
LABEL_28:
              v23 = *(_QWORD *)(v11 + 8) & 0xFFFFFFFFLL;
              *(_QWORD *)(v11 + 16) = 0LL;
              *(_QWORD *)(v11 + 8) = v23;
              if ( *(_QWORD *)(v5 + 2800) )
              {
                *(_QWORD *)(*(_QWORD *)(v5 + 2824) + 16LL) = v11;
                *(_QWORD *)(v5 + 2824) = v11;
              }
              else
              {
                *(_QWORD *)(v5 + 2824) = v11;
                *(_QWORD *)(v5 + 2800) = v11;
              }
            }
          }
        }
      }
    }
  }
  return 0LL;
}
// AF30: using guessed type __int64 AppleUSBOHCI::TranslateStatusToUSBError(unsigned int)::statusToErrorMap[8];
// 1B510: using guessed type int __fastcall IOUSBController::Complete(_QWORD, _QWORD, _QWORD);

//----- (0000000000003162) ----------------------------------------------------
void __fastcall AppleUSBOHCI::finishPending(AppleUSBOHCI *this)
{
  AppleUSBOHCI *v1; // rbx@1
  __int64 i; // r12@1
  __int64 v3; // rsi@2
  unsigned int v4; // er15@2
  __int64 v5; // rax@2
  unsigned int v6; // er14@2
  __int64 v7; // rsi@3
  __int64 v8; // rax@4
  __int64 v9; // rcx@4
  __int64 v10; // [sp+30h] [bp-40h]@3

  v1 = this;
  for ( i = *((_QWORD *)this + 86); i; *((_QWORD *)v1 + 86) = i )
  {
    v3 = i;
    i = *(_QWORD *)(i + 16);
    v4 = AppleUSBOHCI::findBufferRemaining((__int64)this, v3);
    v5 = *((_QWORD *)v1 + 86);
    v6 = **(_DWORD **)(v5 + 24);
    if ( *(_BYTE *)(v5 + 2) & 1 )
    {
      v7 = *(_QWORD *)(v5 + 32);
      IOUSBCommand::GetUSLCompletion((IOUSBCommand *)&v10);
      *(_WORD *)(*((_QWORD *)v1 + 86) + 2LL) &= 0xFFFEu;
      this = v1;
      IOUSBController::Complete(
        v1,
        *((_DWORD *)AppleUSBOHCI::TranslateStatusToUSBError(unsigned int)::statusToErrorMap + (v6 >> 28)),
        v4);
    }
    v8 = *((_QWORD *)v1 + 86);
    v9 = *(_DWORD *)(v8 + 8);
    *(_QWORD *)(v8 + 16) = 0LL;
    *(_QWORD *)(v8 + 8) = v9;
    if ( *((_QWORD *)v1 + 350) )
    {
      *(_QWORD *)(*((_QWORD *)v1 + 353) + 16LL) = v8;
      *((_QWORD *)v1 + 353) = v8;
    }
    else
    {
      *((_QWORD *)v1 + 353) = v8;
      *((_QWORD *)v1 + 350) = v8;
    }
  }
}
// AF30: using guessed type __int64 AppleUSBOHCI::TranslateStatusToUSBError(unsigned int)::statusToErrorMap[8];
// 1B510: using guessed type int __fastcall IOUSBController::Complete(_QWORD, _QWORD, _QWORD);

//----- (0000000000003270) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::GetBandwidthAvailable(AppleUSBOHCI *this)
{
  return *((_DWORD *)this + 728);
}

//----- (000000000000327C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::GetFrameNumber(AppleUSBOHCI *this)
{
  __int64 result; // rax@1
  __int64 v2; // rcx@2
  int v3; // edx@4
  __int64 v4; // rcx@5

  result = 0LL;
  if ( !*((_BYTE *)this + 444) )
    return result;
  v2 = *(_WORD *)(*((_QWORD *)this + 90) + 128LL);
  if ( v2 == 0xFFFF )
  {
    if ( *(_DWORD *)(*((_QWORD *)this + 89) + 8LL) != -1 )
      return *((_QWORD *)this + 362) + 0xFFFFLL;
    goto LABEL_10;
  }
  result = v2 + *((_QWORD *)this + 362);
  if ( (unsigned int)v2 > 0xC7 )
    return result;
  v3 = *(_DWORD *)(*((_QWORD *)this + 89) + 12LL);
  if ( v3 == -1 )
  {
LABEL_10:
    *((_BYTE *)this + 444) = 0;
    return 0LL;
  }
  v4 = result + 0x10000;
  if ( !(v3 & 0x20) )
    v4 = result;
  return v4;
}

//----- (00000000000032FE) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::GetFrameNumber32(AppleUSBOHCI *this)
{
  __int64 result; // rax@1
  unsigned int v2; // ecx@2
  unsigned int v3; // edx@3
  int v4; // ecx@4

  result = 0LL;
  if ( *((_BYTE *)this + 444) )
  {
    v2 = *(_WORD *)(*((_QWORD *)this + 90) + 128LL);
    if ( v2 == 0xFFFF )
    {
      if ( *(_DWORD *)(*((_QWORD *)this + 89) + 8LL) != -1 )
        return (unsigned int)*((_QWORD *)this + 362) + 0xFFFF;
    }
    else
    {
      v3 = v2 + *((_QWORD *)this + 362);
      if ( v2 > 0xC7 )
        return v3;
      v4 = *(_DWORD *)(*((_QWORD *)this + 89) + 12LL);
      if ( v4 != -1 )
      {
        result = v3 + 0x10000;
        if ( !(v4 & 0x20) )
          result = v3;
        return result;
      }
    }
    *((_BYTE *)this + 444) = 0;
  }
  return result;
}

//----- (0000000000003378) ----------------------------------------------------
void __fastcall AppleUSBOHCI::ReturnTransactions(uintptr_t arg1, __int64 a2, unsigned int a3)
{
  __int64 v3; // rbx@1
  __int64 v4; // r15@2
  __int64 v5; // rax@6
  signed __int64 v6; // rcx@6
  uintptr_t v7; // r8@12
  __int64 v8; // r13@13
  __int64 v9; // rsi@16
  __int64 v10; // rax@17
  signed __int64 v11; // rcx@17
  __int64 v12; // [sp+30h] [bp-40h]@16

  v3 = a2;
  if ( (unsigned __int16)(*(_WORD *)a2 - 9) >= 4u )
  {
    v8 = a3;
    while ( *(_QWORD *)(v3 + 8) != v8 )
    {
      if ( *(_BYTE *)(v3 + 2) & 1 )
      {
        v9 = *(_QWORD *)(v3 + 32);
        IOUSBCommand::GetUSLCompletion((IOUSBCommand *)&v12);
        *(_BYTE *)(v3 + 2) &= 0xFEu;
        IOUSBController::Complete(arg1, 3758112848LL, 0LL);
      }
      v10 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(
              (AppleUSBOHCIgtdMemoryBlock *)(*(_DWORD *)(*(_QWORD *)(v3 + 24) + 8LL) & 0xFFFFFFF0),
              0,
              a3);
      v11 = *(_QWORD *)(v3 + 8) & 0xFFFFFFFFLL;
      *(_QWORD *)(v3 + 16) = 0LL;
      *(_QWORD *)(v3 + 8) = v11;
      if ( *(_QWORD *)(arg1 + 2800) )
      {
        *(_QWORD *)(*(_QWORD *)(arg1 + 2824) + 16LL) = v3;
        *(_QWORD *)(arg1 + 2824) = v3;
      }
      else
      {
        *(_QWORD *)(arg1 + 2824) = v3;
        *(_QWORD *)(arg1 + 2800) = v3;
      }
      v3 = v10;
      if ( !v10 )
      {
        if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        {
          v7 = 2LL;
LABEL_24:
          kernel_debug(0x52D382Cu, arg1, 0LL, 0LL, v7, 0LL);
        }
        return;
      }
    }
  }
  else
  {
    v4 = a3;
    while ( *(_QWORD *)(v3 + 8) != v4 )
    {
      if ( *(_QWORD *)(v3 + 40) )
        AppleUSBOHCI::ProcessCompletedITD(arg1, v3, -536854448);
      v5 = AppleUSBOHCIitdMemoryBlock::GetITDFromPhysical(
             (AppleUSBOHCIitdMemoryBlock *)(*(_DWORD *)(*(_QWORD *)(v3 + 24) + 8LL) & 0xFFFFFFF0),
             0,
             a3);
      v6 = *(_QWORD *)(v3 + 8) & 0xFFFFFFFFLL;
      *(_QWORD *)(v3 + 16) = 0LL;
      *(_QWORD *)(v3 + 8) = v6;
      if ( *(_QWORD *)(arg1 + 2808) )
      {
        *(_QWORD *)(*(_QWORD *)(arg1 + 2832) + 16LL) = v3;
        *(_QWORD *)(arg1 + 2832) = v3;
      }
      else
      {
        *(_QWORD *)(arg1 + 2832) = v3;
        *(_QWORD *)(arg1 + 2808) = v3;
      }
      v3 = v5;
      if ( !v5 )
      {
        if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        {
          v7 = 1LL;
          goto LABEL_24;
        }
        return;
      }
    }
  }
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B510: using guessed type int __fastcall IOUSBController::Complete(_QWORD, _QWORD, _QWORD);

//----- (0000000000003562) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::ReturnOneTransaction(__int64 a1, __int64 a2, __int64 a3, unsigned int a4)
{
  __int64 v4; // r14@1
  __int64 v5; // rbx@1
  __int64 v6; // r12@1
  unsigned int v7; // edx@1
  unsigned int v8; // er15@2
  __int64 v9; // r14@3
  __int64 v10; // rdi@4
  __int64 v11; // rsi@5
  __int16 v12; // cx@5
  __int16 v13; // ax@5
  int v14; // eax@6
  signed __int64 v15; // rcx@6
  signed __int64 v16; // rax@8
  signed __int64 v17; // rax@16
  __int64 result; // rax@21
  unsigned int v19; // [sp+24h] [bp-9Ch]@1
  __int64 v20; // [sp+28h] [bp-98h]@2
  __int64 v21; // [sp+30h] [bp-90h]@1
  __int64 v22; // [sp+80h] [bp-40h]@5

  v19 = a4;
  v4 = a3;
  v21 = a3;
  v5 = a2;
  v6 = a1;
  **(_DWORD **)a3 |= 0x4000u;
  IOSleep(1LL);
  if ( *(_QWORD *)(a2 + 8) == (*(_DWORD *)(*(_QWORD *)v4 + 8LL) & 0xFFFFFFF0) )
  {
    v20 = *(_DWORD *)(*(_QWORD *)v4 + 4LL);
    v8 = 0;
    while ( 1 )
    {
      v9 = v5;
      if ( *(_QWORD *)(v5 + 8) == v20 )
        break;
      v10 = *(_DWORD *)(*(_QWORD *)(v5 + 24) + 8LL) & 0xFFFFFFF0;
      v5 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical((AppleUSBOHCIgtdMemoryBlock *)v10, 0, v7);
      *(_DWORD *)(*(_QWORD *)v21 + 8LL) = *(_DWORD *)(*(_QWORD *)(v9 + 24) + 8LL);
      *(_QWORD *)(v21 + 32) = v5;
      v8 += AppleUSBOHCI::findBufferRemaining(v10, v9);
      if ( *(_BYTE *)(v9 + 2) & 1 )
      {
        v11 = *(_QWORD *)(v9 + 32);
        IOUSBCommand::GetUSLCompletion((IOUSBCommand *)&v22);
        v12 = *(_WORD *)(v9 + 2);
        v13 = *(_WORD *)(v9 + 2) & 0xFFFE;
        *(_WORD *)(v9 + 2) = v13;
        if ( !(v12 & 2) )
        {
          v17 = *(_QWORD *)(v9 + 8) & 0xFFFFFFFFLL;
          *(_QWORD *)(v9 + 16) = 0LL;
          *(_QWORD *)(v9 + 8) = v17;
          if ( *(_QWORD *)(v6 + 2800) )
          {
            *(_QWORD *)(*(_QWORD *)(v6 + 2824) + 16LL) = v9;
            *(_QWORD *)(v6 + 2824) = v9;
          }
          else
          {
            *(_QWORD *)(v6 + 2824) = v9;
            *(_QWORD *)(v6 + 2800) = v9;
          }
LABEL_20:
          IOUSBController::Complete(v6, v19, v8);
          break;
        }
        v14 = v13 & 4;
        v15 = *(_QWORD *)(v9 + 8) & 0xFFFFFFFFLL;
        *(_QWORD *)(v9 + 16) = 0LL;
        *(_QWORD *)(v9 + 8) = v15;
        if ( *(_QWORD *)(v6 + 2800) )
        {
          *(_QWORD *)(*(_QWORD *)(v6 + 2824) + 16LL) = v9;
          *(_QWORD *)(v6 + 2824) = v9;
        }
        else
        {
          *(_QWORD *)(v6 + 2824) = v9;
          *(_QWORD *)(v6 + 2800) = v9;
        }
        if ( v14 )
          goto LABEL_20;
        IOUSBController::Complete(v6, v19, v8);
      }
      else
      {
        v16 = *(_QWORD *)(v9 + 8) & 0xFFFFFFFFLL;
        *(_QWORD *)(v9 + 16) = 0LL;
        *(_QWORD *)(v9 + 8) = v16;
        if ( *(_QWORD *)(v6 + 2800) )
        {
          *(_QWORD *)(*(_QWORD *)(v6 + 2824) + 16LL) = v9;
          *(_QWORD *)(v6 + 2824) = v9;
        }
        else
        {
          *(_QWORD *)(v6 + 2824) = v9;
          *(_QWORD *)(v6 + 2800) = v9;
        }
      }
      if ( !v5 )
      {
        KernelDebugLogInternal(1LL, 1431519814LL, "ReturnOneTransaction: Return queue broken");
        break;
      }
    }
  }
  result = *(_QWORD *)v21;
  *(_DWORD *)result &= 0xFFFFBFFF;
  return result;
}
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);
// 1B510: using guessed type int __fastcall IOUSBController::Complete(_QWORD, _QWORD, _QWORD);

//----- (0000000000003822) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::message(AppleUSBOHCI *this, const char *a2, IOService *a3, void *a4)
{
  void *v4; // r13@1
  IOService *v5; // rbx@1
  uintptr_t v6; // r14@1
  int v7; // er12@1
  __int64 v8; // r15@5
  __int64 v9; // rbx@8
  __int64 v10; // r12@8
  unsigned int v11; // edx@14
  AppleUSBOHCIgtdMemoryBlock *v12; // rdi@18
  __int64 v13; // rax@21
  OSMetaClassBase *v14; // rax@21
  AppleUSBOHCI *v15; // rsi@21
  const OSMetaClass *v16; // rdx@21
  __int64 v17; // r15@21
  __int64 v18; // rax@28
  __int64 v19; // rbx@28

  v4 = a4;
  v5 = a3;
  v6 = (uintptr_t)this;
  v7 = (*(int (__cdecl **)(AppleUSBOHCI *))(off_B040[0] + 1856))(this);
  if ( (_DWORD)a2 == -536854507 )
  {
    if ( v5 && OSMetaClassBase::metaCast(v5, "IOUSBControllerUserClient") && (unsigned __int16)v4 == 3 )
    {
      v8 = off_B058[0];
      if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D3858u, (uintptr_t)this, 0LL, 0LL, 1uLL, 0LL);
      v9 = (unsigned int)v4 & 0x20000;
      v10 = (unsigned int)v4 & 0x10000;
      AppleUSBOHCI::print_control_list(this, 5LL, v10 != 0, v9 != 0);
      IOSleep(10LL);
      if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D3858u, (uintptr_t)this, 0LL, 0LL, 2uLL, 0LL);
      AppleUSBOHCI::print_bulk_list(this, 5LL, v10 != 0, v9 != 0);
      IOSleep(10LL);
      if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D3858u, (uintptr_t)this, 0LL, 0LL, 3uLL, 0LL);
      AppleUSBOHCI::print_int_list((uintptr_t)this, 5LL, v10 != 0, v9 != 0);
      v7 = 0;
      if ( (unsigned __int64)v4 & 0x40000 )
      {
        if ( *(_BYTE *)v8 & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
          kernel_debug(0x52D3858u, (uintptr_t)this, 0LL, 0LL, 5uLL, 0LL);
        v12 = (AppleUSBOHCIgtdMemoryBlock *)(*(_DWORD *)(*((_QWORD *)this + 90) + 132LL) & 0xFFFFFFF0);
        if ( v12 )
        {
          while ( 1 )
          {
            v18 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(v12, 0, v11);
            v19 = v18;
            if ( !v18 )
              break;
            AppleUSBOHCI::printTD(v6, v18);
            if ( !(*(_DWORD *)(*(_QWORD *)(v19 + 24) + 8LL) & 0xFFFFFFF0) )
              break;
            v12 = (AppleUSBOHCIgtdMemoryBlock *)(*(_DWORD *)(*(_QWORD *)(v19 + 24) + 8LL) & 0xFFFFFFF0);
          }
        }
        *(_DWORD *)(v6 + 3012) = 2;
      }
    }
  }
  else if ( (_DWORD)a2 == -536854512 )
  {
    v13 = IORegistryEntry::getPlane("IOUSB", a2);
    LODWORD(v14) = (*(int (__fastcall **)(void *, __int64))(*(_QWORD *)v4 + 792LL))(v4, v13);
    v15 = *(AppleUSBOHCI **)off_B020[0];
    v17 = OSMetaClassBase::safeMetaCast(v14, *(const OSMetaClassBase **)off_B020[0], v16);
    (*(void (__fastcall **)(void *, AppleUSBOHCI *))(*(_QWORD *)v4 + 32LL))(v4, v15);
    if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    {
      v15 = this;
      kernel_debug(0x52D3830u, (uintptr_t)this, 0xE0004010uLL, 0LL, 0LL, 0LL);
    }
    if ( v17 == *((_QWORD *)this + 19) )
      *((_BYTE *)this + 3092) = 1;
    (*(void (__fastcall **)(void *, AppleUSBOHCI *))(*(_QWORD *)v4 + 40LL))(v4, v15);
    v7 = 0;
  }
  return (unsigned int)v7;
}
// B020: using guessed type _QWORD off_B020[10];
// B040: using guessed type __int64 off_B040[6];
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);
// 1B518: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (0000000000003AEE) ----------------------------------------------------
int __fastcall AppleUSBOHCI::finalize(AppleUSBOHCI *this)
{
  return (*(int (__fastcall **)(AppleUSBOHCI *))(off_B040[0] + 1560))(this);
}
// B040: using guessed type __int64 off_B040[6];

//----- (0000000000003B00) ----------------------------------------------------
int __fastcall AppleUSBOHCI::free(AppleUSBOHCI *this)
{
  AppleUSBOHCI *v1; // rbx@1
  __int64 v2; // rdi@1

  v1 = this;
  v2 = *((_QWORD *)this + 380);
  if ( v2 )
    IOSimpleLockFree(v2);
  return (*(int (__fastcall **)(AppleUSBOHCI *))(off_B040[0] + 160))(v1);
}
// B040: using guessed type __int64 off_B040[6];
// 1B1D0: using guessed type int __cdecl IOSimpleLockFree(_QWORD);

//----- (0000000000003B30) ----------------------------------------------------
int __fastcall AppleUSBOHCI::GetNewDMACommand(AppleUSBOHCI *this)
{
  return IODMACommand::withSpecification(off_B010[0], 32LL, 4096LL, 0LL, 0LL, 1LL);
}
// B010: using guessed type __int64 off_B010[12];
// 1B270: using guessed type int __fastcall IODMACommand::withSpecification(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000003B70) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::showRegisters(AppleUSBOHCI *this, __int64 a2, const char *a3)
{
  __int64 result; // rax@2

  if ( *((_BYTE *)this + 444) )
  {
    result = *(_DWORD *)(*((_QWORD *)this + 89) + 72LL);
    if ( (_DWORD)result == -1 )
      *((_BYTE *)this + 444) = 0;
  }
  return result;
}

//----- (0000000000003B96) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::MetaClass::~MetaClass(AppleUSBOHCI::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (0000000000003BA0) ----------------------------------------------------
__int64 `global constructor keyed to'_a()
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(&AppleUSBOHCI::gMetaClass, "AppleUSBOHCI", off_B018[0], 3176LL);
  result = (__int64)off_BE30;
  AppleUSBOHCI::gMetaClass = off_BE30;
  return result;
}
// B018: using guessed type _QWORD off_B018[11];
// BE30: using guessed type __int64 (__fastcall *off_BE30[2])(AppleUSBOHCI::MetaClass *__hidden this);
// C660: using guessed type _QWORD AppleUSBOHCI::gMetaClass;
// 1B250: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000003BE0) ----------------------------------------------------
__int64 `global destructor keyed to'_a()
{
  return OSMetaClass::~OSMetaClass((OSMetaClass *)&AppleUSBOHCI::gMetaClass);
}
// C660: using guessed type _QWORD AppleUSBOHCI::gMetaClass;

//----- (0000000000003BF2) ----------------------------------------------------
void __fastcall AppleUSBOHCI::PollInterrupts(AppleUSBOHCI *this, void (__cdecl *a2)(void *, void *, int, unsigned int))
{
  void (__cdecl *v2)(void *, void *, int, unsigned int); // r14@1
  __int64 v3; // r15@1
  __int64 v4; // r14@15
  uintptr_t v5; // rdx@15
  __int64 v6; // rcx@27

  v2 = a2;
  v3 = off_B058[0];
  if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
  {
    a2 = (void (__cdecl *)(void *, void *, int, unsigned int))this;
    kernel_debug(0x52D3C05u, (uintptr_t)this, 0LL, 0LL, 0LL, 0LL);
  }
  if ( *((_BYTE *)this + 3012) & 2 )
  {
    *((_DWORD *)this + 753) = 0;
    if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      kernel_debug(0x52D3C04u, (uintptr_t)this, 0LL, 0LL, 1uLL, 0LL);
    a2 = v2;
    AppleUSBOHCI::UIMProcessDoneQueue(this, v2);
  }
  if ( *((_BYTE *)this + 3000) & 8 )
  {
    *((_DWORD *)this + 750) = 0;
    if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    {
      a2 = (void (__cdecl *)(void *, void *, int, unsigned int))this;
      kernel_debug(0x52D3C04u, (uintptr_t)this, 0LL, 0LL, 2uLL, 0LL);
    }
    *((_BYTE *)this + 3168) = 1;
    (*(void (__fastcall **)(AppleUSBOHCI *, void (__cdecl *)(void *, void *, int, unsigned int)))(*(_QWORD *)this
                                                                                                + 2976LL))(
      this,
      a2);
  }
  if ( *((_BYTE *)this + 3004) & 0x10 )
  {
    v4 = *(_DWORD *)(*((_QWORD *)this + 21) + 28LL);
    IOService::isInactive(this);
    a2 = (void (__cdecl *)(void *, void *, int, unsigned int))1431519814;
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "USB Controller on bus %d received an unrecoverable error interrupt.  Attempting to fix (%d)");
    *((_DWORD *)this + 751) = 0;
    ++*((_DWORD *)this + 721);
    if ( *(_BYTE *)v3 & 2 )
    {
      v5 = *((_DWORD *)this + 721);
      if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      {
        a2 = (void (__cdecl *)(void *, void *, int, unsigned int))this;
        kernel_debug(0x52D3C04u, (uintptr_t)this, v5, 0LL, 3uLL, 0LL);
      }
    }
    if ( !(*(_BYTE *)(*((_QWORD *)this + 84) + 209LL) & 2) )
    {
      *(_DWORD *)(*((_QWORD *)this + 89) + 8LL) = 1;
      IODelay(10LL, a2, v5);
      *(_DWORD *)(*((_QWORD *)this + 89) + 4LL) = 132;
    }
  }
  if ( *((_BYTE *)this + 3008) & 0x40 )
  {
    *((_DWORD *)this + 752) = 0;
    *((_BYTE *)this + 3168) = 1;
    if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    {
      a2 = (void (__cdecl *)(void *, void *, int, unsigned int))this;
      kernel_debug(0x52D3C04u, (uintptr_t)this, 0LL, 0LL, 4uLL, 0LL);
    }
    if ( *((_QWORD *)this + 57) == 3LL )
      *((_BYTE *)this + 3094) = 1;
    (*(void (__fastcall **)(AppleUSBOHCI *, void (__cdecl *)(void *, void *, int, unsigned int)))(*(_QWORD *)this
                                                                                                + 2976LL))(
      this,
      a2);
    *((_BYTE *)this + 3093) = 0;
    if ( *((_BYTE *)this + 505) )
    {
      v6 = 0LL;
      do
      {
        if ( *(_DWORD *)(*((_QWORD *)this + 89) + 4 * v6 + 84) & 0x1F0000 )
        {
          *((_BYTE *)this + 3093) = 1;
          goto LABEL_33;
        }
        ++v6;
      }
      while ( (signed int)v6 < *((_BYTE *)this + 505) );
      if ( *((_BYTE *)this + 3093) )
        goto LABEL_33;
    }
    *(_DWORD *)(*((_QWORD *)this + 89) + 16LL) = -2147483584;
    _mm_mfence();
  }
LABEL_33:
  if ( *((_BYTE *)this + 3016) & 0x20 )
  {
    *((_DWORD *)this + 754) = 0;
    *((_QWORD *)this + 383) = *((_QWORD *)this + 382);
    *((_QWORD *)this + 385) = *((_QWORD *)this + 384);
    if ( *(_BYTE *)v3 & 2 )
    {
      if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D3C04u, (uintptr_t)this, 0LL, 0LL, 5uLL, 0LL);
    }
  }
  if ( *(_BYTE *)v3 & 2 )
  {
    if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      kernel_debug(0x52D3C06u, (uintptr_t)this, 0LL, 0LL, 0LL, 0LL);
  }
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1B0: using guessed type int __fastcall IODelay(_QWORD, _QWORD, _QWORD);
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000003EEC) ----------------------------------------------------
int __fastcall AppleUSBOHCI::InterruptHandler(AppleUSBOHCI *this)
{
  int result; // eax@2

  if ( this )
  {
    result = IOService::isInactive(this);
    if ( !(_BYTE)result )
    {
      if ( *((_BYTE *)this + 444) )
      {
        AppleUSBOHCI::finishPending(this);
        result = (*(int (__fastcall **)(AppleUSBOHCI *, _QWORD))(*(_QWORD *)this + 2472LL))(this, 0LL);
        *((_DWORD *)this + 747) = 0;
      }
    }
  }
  return result;
}

//----- (0000000000003F36) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::PrimaryInterruptFilter(IOService *this, AppleUSBOHCI *a2)
{
  if ( this && !(unsigned __int8)IOService::isInactive(this) && *((_BYTE *)this + 444) )
    AppleUSBOHCI::FilterInterrupt(this, a2);
  return 0LL;
}

//----- (0000000000003F6A) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::FilterInterrupt(AppleUSBOHCI *this, AppleUSBOHCI *a2)
{
  __int64 v2; // rax@1
  uintptr_t v3; // rdx@1
  AppleUSBOHCI *v4; // rbx@2
  int v5; // er14@2
  unsigned int v6; // er14@4
  __int64 v7; // rax@9
  uint64_t v8; // rax@11
  AppleUSBOHCI *v9; // rdx@11
  char v10; // al@11
  __int64 v11; // rcx@12
  signed __int64 v12; // rcx@13
  signed int v13; // edx@13
  __int64 v14; // rcx@14
  __int64 v15; // rcx@27
  signed __int64 v16; // rcx@28
  signed int v17; // edx@28
  __int64 v18; // rcx@30
  __int64 v19; // rcx@37
  signed __int64 v20; // rcx@38
  signed int v21; // edx@38
  __int64 v22; // rcx@40
  AppleUSBOHCI *v23; // rbx@43
  AppleUSBOHCI *v24; // rdx@44
  int v25; // ecx@44
  __int64 v26; // rax@44
  __int64 v27; // r15@44
  __int64 v28; // r14@44
  int v29; // ebx@47
  __int64 v30; // r12@48
  bool v31; // zf@48
  unsigned int v32; // ecx@48
  __int64 v33; // rax@48
  AppleUSBOHCI *v34; // r14@49
  __int64 v35; // r14@51
  AppleUSBOHCI *v36; // rbx@51
  __int64 v37; // r15@51
  signed __int64 v38; // rax@52
  unsigned int v39; // ebx@54
  AppleUSBOHCI *v40; // r13@55
  unsigned int v41; // eax@55
  unsigned __int16 v42; // bx@55
  __int64 v43; // rdx@60
  signed __int64 v44; // rdx@61
  __int16 v45; // t0@61
  __int16 v46; // bx@61
  signed __int64 v47; // rdx@62
  AppleUSBOHCI *v48; // rbx@68
  signed __int64 v49; // r14@70
  int v50; // ebx@70
  AppleUSBOHCI *v51; // r12@77
  int v53; // [sp+8h] [bp-58h]@47
  __int64 v54; // [sp+10h] [bp-50h]@47
  __int64 v55; // [sp+18h] [bp-48h]@50
  int v56; // [sp+20h] [bp-40h]@50
  int v57; // [sp+28h] [bp-38h]@51
  unsigned __int64 arg4; // [sp+30h] [bp-30h]@44

  v2 = *((_QWORD *)this + 89);
  v3 = *(_DWORD *)(v2 + 16);
  if ( v3 == 0xFFFFFFFF )
  {
    *((_BYTE *)this + 444) = 0;
  }
  else
  {
    v4 = this;
    v5 = *(_DWORD *)(v2 + 12);
    if ( v5 == -1 )
    {
LABEL_73:
      *((_BYTE *)v4 + 444) = 0;
      return 0LL;
    }
    if ( (v3 & 0x80000000) != 0LL )
    {
      v6 = v3 & v5;
      if ( v6 )
      {
        if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        {
          a2 = this;
          kernel_debug(0x52D3C08u, (uintptr_t)this, v3, v6, 0LL, 0LL);
        }
        if ( v6 & 0x20 )
        {
          v7 = *(_WORD *)(*((_QWORD *)this + 90) + 128LL);
          ++*((_DWORD *)this + 722);
          if ( *(_WORD *)(*((_QWORD *)this + 90) + 128LL) >= 0 )
            *((_QWORD *)this + 362) += 0x10000LL;
          *((_QWORD *)this + 384) = *((_QWORD *)this + 362) + v7;
          v8 = mach_absolute_time();
          v9 = this;
          *((_QWORD *)this + 382) = v8;
          *((_DWORD *)this + 754) = 32;
          *(_DWORD *)(*((_QWORD *)this + 89) + 12LL) = 32;
          _mm_mfence();
          v10 = 1;
          if ( *(_BYTE *)(*((_QWORD *)this + 84) + 209LL) & 4 )
          {
            v11 = *((_QWORD *)this + 89);
            if ( *(_DWORD *)(v11 + 12) & 0x20 )
            {
              v12 = v11 + 12;
              v13 = 1;
              do
              {
                *(_DWORD *)v12 = 32;
                _mm_mfence();
                v14 = *((_QWORD *)this + 89);
                a2 = (AppleUSBOHCI *)*(_DWORD *)(v14 + 12);
                if ( (unsigned int)v13 > 9 )
                  break;
                v12 = v14 + 12;
                a2 = (AppleUSBOHCI *)((unsigned __int8)a2 & 0x20);
                ++v13;
              }
              while ( (_DWORD)a2 );
            }
            v9 = this;
          }
        }
        else
        {
          v10 = 0;
          v9 = this;
        }
        if ( v6 & 1 )
        {
          ++*((_DWORD *)v9 + 720);
          *(_DWORD *)(*((_QWORD *)v9 + 89) + 12LL) = 1;
          _mm_mfence();
        }
        if ( v6 & 4 )
        {
          *(_DWORD *)(*((_QWORD *)v9 + 89) + 12LL) = 4;
          _mm_mfence();
          *(_DWORD *)(*((_QWORD *)v9 + 89) + 20LL) = 4;
          _mm_mfence();
        }
        if ( v6 & 0x40000000 )
        {
          ++*((_DWORD *)v9 + 723);
          *(_DWORD *)(*((_QWORD *)v9 + 89) + 12LL) = 0x40000000;
          _mm_mfence();
        }
        if ( v6 & 0x40 )
        {
          *((_DWORD *)v9 + 752) = 64;
          *(_DWORD *)(*((_QWORD *)v9 + 89) + 20LL) = 64;
          _mm_mfence();
          *(_DWORD *)(*((_QWORD *)v9 + 89) + 12LL) = 64;
          _mm_mfence();
          v10 = 1;
          if ( *(_BYTE *)(*((_QWORD *)v9 + 84) + 209LL) & 4 )
          {
            v15 = *((_QWORD *)v9 + 89);
            a2 = (AppleUSBOHCI *)*(_DWORD *)(v15 + 12);
            if ( (unsigned __int8)a2 & 0x40 )
            {
              v4 = v9;
              v16 = v15 + 12;
              v17 = 1;
              while ( (_DWORD)a2 != -1 )
              {
                *(_DWORD *)v16 = 64;
                _mm_mfence();
                v18 = *((_QWORD *)v4 + 89);
                a2 = (AppleUSBOHCI *)*(_DWORD *)(v18 + 12);
                if ( (unsigned int)v17 <= 9 )
                {
                  v16 = v18 + 12;
                  ++v17;
                  if ( (unsigned __int8)a2 & 0x40 )
                    continue;
                }
                v9 = v4;
                goto LABEL_33;
              }
              goto LABEL_73;
            }
          }
        }
LABEL_33:
        if ( v6 & 0x10 )
        {
          ++*((_DWORD *)v9 + 721);
          *((_DWORD *)v9 + 751) = 16;
          *(_DWORD *)(*((_QWORD *)v9 + 89) + 12LL) = 16;
          _mm_mfence();
          v10 = 1;
        }
        if ( v6 & 8 )
        {
          *((_DWORD *)v9 + 750) = 8;
          *(_DWORD *)(*((_QWORD *)v9 + 89) + 12LL) = 8;
          _mm_mfence();
          v10 = 1;
          if ( *(_BYTE *)(*((_QWORD *)v9 + 84) + 209LL) & 4 )
          {
            v19 = *((_QWORD *)v9 + 89);
            a2 = (AppleUSBOHCI *)*(_DWORD *)(v19 + 12);
            if ( (unsigned __int8)a2 & 8 )
            {
              v4 = v9;
              v20 = v19 + 12;
              v21 = 1;
              while ( (_DWORD)a2 != -1 )
              {
                *(_DWORD *)v20 = 8;
                _mm_mfence();
                v22 = *((_QWORD *)v4 + 89);
                a2 = (AppleUSBOHCI *)*(_DWORD *)(v22 + 12);
                if ( (unsigned int)v21 <= 9 )
                {
                  v20 = v22 + 12;
                  ++v21;
                  if ( (unsigned __int8)a2 & 8 )
                    continue;
                }
                v9 = v4;
                goto LABEL_43;
              }
              goto LABEL_73;
            }
          }
        }
LABEL_43:
        v23 = v9;
        if ( v6 & 2 )
        {
          arg4 = mach_absolute_time();
          v24 = v23;
          v25 = *(_DWORD *)(*((_QWORD *)v23 + 90) + 132LL);
          v26 = 0LL;
          v27 = v25 & 0xFFFFFFF0;
          v28 = *((_QWORD *)v23 + 378);
          if ( *(_DWORD *)(*((_QWORD *)v23 + 90) + 132LL) & 0xFFFFFFF0 )
          {
            a2 = 0LL;
            v26 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(
                    (AppleUSBOHCIgtdMemoryBlock *)(v25 & 0xFFFFFFF0),
                    0,
                    (unsigned int)v23);
            v24 = v23;
          }
          *(_DWORD *)(*((_QWORD *)v24 + 90) + 132LL) = 0;
          *(_DWORD *)(*((_QWORD *)v24 + 89) + 12LL) = 2;
          _mm_mfence();
          if ( v26 )
          {
            v53 = v28;
            v54 = v27;
            v29 = 0;
            do
            {
              v30 = v26;
              v31 = (*(_DWORD *)(*(_QWORD *)(v26 + 24) + 8LL) & 0xFFFFFFF0) == 0;
              v32 = *(_DWORD *)(*(_QWORD *)(v26 + 24) + 8LL) & 0xFFFFFFF0;
              v33 = 0LL;
              if ( !v31 )
              {
                a2 = 0LL;
                v34 = v24;
                v33 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(
                        (AppleUSBOHCIgtdMemoryBlock *)v32,
                        0,
                        (unsigned int)v24);
                v24 = v34;
              }
              v55 = v33;
              v56 = v29 + 1;
              if ( (unsigned __int16)(*(_WORD *)v30 - 11) >= 2u )
              {
                if ( (unsigned __int16)(*(_WORD *)v30 - 9) > 1u )
                {
                  a2 = (AppleUSBOHCI *)arg4;
                  v48 = v24;
                  IOUSBCommand::SetTimeStamp(*(IOUSBCommand **)(v30 + 32), arg4);
                  v24 = v48;
                }
              }
              else
              {
                ++*((_DWORD *)v24 + 746);
                v35 = *(_QWORD *)(v30 + 56);
                v36 = v24;
                AppleUSBOHCI::TranslateStatusToUSBError(v24, **(_DWORD **)(v30 + 24) >> 28);
                v24 = v36;
                v57 = ((**(_DWORD **)(v30 + 24) >> 24) & 7) + 1;
                v37 = 0LL;
                do
                {
                  ++*((_DWORD *)v24 + 748);
                  v38 = 16LL * (unsigned int)(v37 + *(_DWORD *)(v30 + 64));
                  if ( *(_DWORD *)(v35 + v38) != 1819044212 )
                    ++*((_DWORD *)v24 + 749);
                  *(_QWORD *)(v35 + v38 + 8) = arg4;
                  v39 = *(_WORD *)(*(_QWORD *)(v30 + 24) + 2 * v37 + 16);
                  if ( (unsigned __int16)(*(_WORD *)(*(_QWORD *)(v30 + 24) + 2 * v37 + 16) & 0xE000) == 57344 )
                  {
                    a2 = (AppleUSBOHCI *)(&dword_C + 3);
                    v40 = v24;
                    v41 = AppleUSBOHCI::TranslateStatusToUSBError(v24, 0xFu);
                    v42 = 0;
                  }
                  else
                  {
                    a2 = (AppleUSBOHCI *)(v39 >> 12);
                    v40 = v24;
                    v41 = AppleUSBOHCI::TranslateStatusToUSBError(v24, (unsigned int)a2);
                    if ( v41 || *(_WORD *)v30 != 12 )
                    {
                      v42 = v39 & 0x7FF;
                    }
                    else
                    {
                      v42 = *(_WORD *)(v35 + 16LL * (unsigned int)(v37 + *(_DWORD *)(v30 + 64)) + 4);
                      v41 = 0;
                    }
                  }
                  v43 = (unsigned int)(v37 + *(_DWORD *)(v30 + 64));
                  if ( *(_BYTE *)(v30 + 68) )
                  {
                    v44 = 16 * v43;
                    v45 = __ROL2__(*(_WORD *)(v35 + v44 + 4), 8);
                    *(_WORD *)(v35 + v44 + 4) = v45;
                    v46 = __ROL2__(v42, 8);
                    *(_WORD *)(v35 + v44 + 6) = v46;
                    *(_DWORD *)(v35 + v44) = _byteswap_ulong(v41);
                  }
                  else
                  {
                    v47 = 16 * v43;
                    *(_WORD *)(v35 + v47 + 6) = v42;
                    *(_DWORD *)(v35 + v47) = v41;
                    if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
                    {
                      a2 = 0LL;
                      kernel_debug(0x52D3C0Cu, 0LL, v35 + v47, v42, arg4, 0LL);
                    }
                  }
                  ++v37;
                  v24 = v40;
                }
                while ( v57 != (_DWORD)v37 );
              }
              v26 = v55;
              v29 = v56;
            }
            while ( v55 );
            v49 = (signed __int64)((char *)v24 + 3032);
            v50 = *((_DWORD *)v24 + 758) + v56;
            if ( v30 )
              *(_DWORD *)(*(_QWORD *)(v30 + 24) + 8LL) = v53;
            v27 = v54;
          }
          else
          {
            v49 = (signed __int64)((char *)v24 + 3032);
            v50 = *((_DWORD *)v24 + 758);
          }
          v51 = v24;
          IOSimpleLockLock(*((_QWORD *)v24 + 380), a2);
          *((_QWORD *)v51 + 378) = v27;
          *(_DWORD *)v49 = v50;
          IOSimpleLockUnlock(*((_QWORD *)v51 + 380));
          *((_DWORD *)v51 + 753) = 2;
          v23 = v51;
        }
        else if ( !v10 )
        {
          return 0LL;
        }
        (*(void (**)(void))(**((_QWORD **)v23 + 366) + 568LL))();
      }
    }
  }
  return 0LL;
}
// C: using guessed type int;
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1D8: using guessed type int __fastcall IOSimpleLockLock(_QWORD, _QWORD);
// 1B1E0: using guessed type int __fastcall IOSimpleLockUnlock(_QWORD);

//----- (000000000000453A) ----------------------------------------------------
char __fastcall AppleUSBOHCI::IsValidPhysicalAddress(AppleUSBOHCI *this, __int64 a2)
{
  AppleUSBOHCIgtdMemoryBlock *v2; // rbx@1
  AppleUSBOHCIitdMemoryBlock *v3; // r15@1
  __int64 v4; // rcx@4
  char result; // al@4
  __int64 v6; // rcx@8

  v2 = (AppleUSBOHCIgtdMemoryBlock *)*((_QWORD *)this + 358);
  v3 = (AppleUSBOHCIitdMemoryBlock *)*((_QWORD *)this + 359);
  while ( v2 )
  {
    v4 = AppleUSBOHCIgtdMemoryBlock::GetSharedPhysicalPtr(v2, 0) & 0xFFFFF000LL;
    result = 1;
    if ( v4 == a2 )
      return result;
    v2 = (AppleUSBOHCIgtdMemoryBlock *)AppleUSBOHCIgtdMemoryBlock::GetNextBlock(v2);
  }
  while ( v3 )
  {
    v6 = AppleUSBOHCIitdMemoryBlock::GetSharedPhysicalPtr(v3, 0) & 0xFFFFF000LL;
    result = 1;
    if ( v6 == a2 )
      return result;
    v3 = (AppleUSBOHCIitdMemoryBlock *)AppleUSBOHCIitdMemoryBlock::GetNextBlock(v3);
  }
  return 0;
}

//----- (00000000000045BC) ----------------------------------------------------
AppleUSBOHCIgtdMemoryBlock *__fastcall AppleUSBOHCI::DoOptiFix(uintptr_t arg1, unsigned __int64 a2)
{
  unsigned __int64 v2; // r15@1
  signed int v3; // er12@1
  AppleUSBOHCIedMemoryBlock *v4; // rax@2
  AppleUSBOHCIedMemoryBlock *v5; // rbx@2
  AppleUSBOHCIgtdMemoryBlock *result; // rax@2

  v2 = a2;
  v3 = 0;
  do
  {
    v4 = AppleUSBOHCI::AllocateED(arg1, a2);
    v5 = v4;
    *((_QWORD *)v4 + 1) = 0LL;
    **(_DWORD **)v4 = 0;
    result = AppleUSBOHCI::AllocateTD(arg1, a2);
    if ( !result )
      break;
    *(_DWORD *)(*(_QWORD *)v5 + 8LL) = *((_DWORD *)result + 2);
    *(_DWORD *)(*((_QWORD *)result + 3) + 8LL) = *(_DWORD *)(*(_QWORD *)v5 + 4LL);
    *((_QWORD *)result + 6) = v5;
    *(_WORD *)result = 8;
    *(_DWORD *)(*(_QWORD *)v5 + 4LL) = *((_DWORD *)result + 2);
    *(_DWORD *)(*(_QWORD *)v5 + 12LL) = *(_DWORD *)(*(_QWORD *)v2 + 12LL);
    result = (AppleUSBOHCIgtdMemoryBlock *)*((_DWORD *)v5 + 4);
    *(_DWORD *)(*(_QWORD *)v2 + 12LL) = (_DWORD)result;
    ++v3;
    v2 = (unsigned __int64)v5;
  }
  while ( v3 < 27 );
  return result;
}

//----- (000000000000464C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::OptiLSHSFix(uintptr_t arg1)
{
  __int64 v1; // rax@1
  int v2; // er14@1
  signed __int64 v3; // rbx@1
  __int64 result; // rax@3

  *(_DWORD *)(arg1 + 2908) = 1;
  v1 = *(_QWORD *)(arg1 + 712);
  v2 = *(_DWORD *)(v1 + 4);
  *(_DWORD *)(v1 + 4) = 128;
  IOSleep(2LL);
  v3 = 2272LL;
  do
  {
    AppleUSBOHCI::DoOptiFix(arg1, *(_QWORD *)(arg1 + v3));
    v3 += 32LL;
  }
  while ( v3 != 2528 );
  *(_DWORD *)(**(_QWORD **)(arg1 + 2792) + 12LL) = *(_DWORD *)(*(_QWORD *)(arg1 + 712) + 40LL);
  AppleUSBOHCI::DoOptiFix(arg1, *(_QWORD *)(arg1 + 2792));
  result = *(_QWORD *)(arg1 + 712);
  *(_DWORD *)(result + 4) = v2 & 0xFFFFFFDF;
  return result;
}
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);

//----- (00000000000046DE) ----------------------------------------------------
int __fastcall AppleUSBOHCI::CheckSleepCapability(AppleUSBOHCI *this)
{
  AppleUSBOHCI *v1; // rbx@1
  IOService *v2; // rdi@1
  __int64 v3; // rax@1
  IOService *v4; // rax@2
  IOService *v5; // rdi@2
  __int64 v6; // rax@2
  __int64 v7; // rax@3
  __int64 v8; // rax@3
  __int64 v9; // rax@4
  __int64 v10; // rsi@4
  __int64 v11; // rdx@4
  __int64 v12; // rax@6
  __int64 v13; // rdi@10
  __int64 v14; // rax@10
  signed __int64 v15; // rsi@10

  v1 = this;
  *(_BYTE *)(*((_QWORD *)this + 21) + 200LL) = 1;
  *(_BYTE *)(*((_QWORD *)this + 84) + 249LL) = 0;
  v2 = (IOService *)*((_QWORD *)this + 61);
  LODWORD(v3) = (*(int (__fastcall **)(IOService *, _QWORD))(*(_QWORD *)v2 + 696LL))(v2, "AAPL,clock-id");
  if ( v3
    || (v4 = (IOService *)IOService::getPlatform(v2),
        v5 = v4,
        LODWORD(v6) = (*(int (__fastcall **)(IOService *))(*(_QWORD *)v4 + 2216LL))(v4),
        v6 == 2)
    && (v7 = IOService::getPlatform(v5),
        LODWORD(v8) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v7 + 2224LL))(v7),
        v8 == 5) )
  {
    v9 = *(_QWORD *)v1;
    v10 = (__int64)"Card Type";
    v11 = (__int64)"Built-in";
    goto LABEL_5;
  }
  LODWORD(v12) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)v1 + 61) + 696LL))(
                   *((_QWORD *)v1 + 61),
                   "built-in");
  if ( v12 )
  {
    if ( *(_BYTE *)(*((_QWORD *)v1 + 84) + 209LL) & 4 )
      IOUSBControllerV3::FixupNECControllerConfigRegisters(v1);
    if ( !(unsigned __int8)(*(int (__fastcall **)(_QWORD, signed __int64))(**((_QWORD **)v1 + 61) + 2376LL))(
                             *((_QWORD *)v1 + 61),
                             0x8000LL) )
      goto LABEL_15;
    v13 = *((_QWORD *)v1 + 61);
    v14 = *(_QWORD *)v13;
    v15 = 3LL;
    goto LABEL_13;
  }
  if ( (unsigned __int8)(*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)v1 + 61) + 2376LL))(
                          *((_QWORD *)v1 + 61),
                          0LL) )
  {
    v13 = *((_QWORD *)v1 + 61);
    v14 = *(_QWORD *)v13;
    v15 = 0xFFFFFFFFLL;
LABEL_13:
    if ( !(*(int (__fastcall **)(__int64, signed __int64))(v14 + 2384))(v13, v15) )
    {
      *(_BYTE *)(*((_QWORD *)v1 + 84) + 249LL) = 1;
      (*(void (__fastcall **)(AppleUSBOHCI *, _QWORD, _QWORD))(*(_QWORD *)v1 + 624LL))(v1, "Card Type", "Built-in");
    }
  }
LABEL_15:
  if ( *(_BYTE *)(*((_QWORD *)v1 + 84) + 249LL) )
    goto LABEL_16;
  KernelDebugLogInternal(
    1LL,
    1431519814LL,
    "AppleUSBOHCI::CheckSleepCapability - controller will be unloaded across sleep");
  *(_BYTE *)(*((_QWORD *)v1 + 21) + 200LL) = 0;
  v9 = *(_QWORD *)v1;
  v10 = (__int64)"Card Type";
  v11 = (__int64)"PCI";
LABEL_5:
  (*(void (__fastcall **)(AppleUSBOHCI *, __int64, __int64))(v9 + 624))(v1, v10, v11);
LABEL_16:
  *((_DWORD *)v1 + 772) = IOUSBController::ExpressCardPort(v1, *((IORegistryEntry **)v1 + 61));
  *((_BYTE *)v1 + 3092) = 0;
  return (*(int (__fastcall **)(AppleUSBOHCI *, _QWORD))(*(_QWORD *)v1 + 1456LL))(v1, 0LL);
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (00000000000048A0) ----------------------------------------------------
signed __int64 __fastcall AppleUSBOHCI::callPlatformFunction(__int64 a1, __int64 a2, __int64 a3, __int64 a4)
{
  signed __int64 result; // rax@1

  result = 3758097090LL;
  if ( *(_QWORD *)(a1 + 3160) == a2 )
  {
    *(_BYTE *)a4 = *(_BYTE *)(a1 + 3168);
    result = 0LL;
  }
  return result;
}

//----- (00000000000048BE) ----------------------------------------------------
int __fastcall AppleUSBOHCI::SuspendUSBBus(uintptr_t arg1, unsigned __int8 a2)
{
  int result; // eax@4
  __int64 v3; // rcx@7
  signed int v4; // eax@7
  unsigned int v5; // ecx@9
  int v6; // edx@12

  if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    kernel_debug(0x52D3834u, arg1, a2, 0LL, 0LL, 0LL);
  *(_DWORD *)(*(_QWORD *)(arg1 + 712) + 4LL) &= 0xFFFFFFC3;
  result = IOSleep(1LL);
  if ( *(_DWORD *)(arg1 + 3012) )
  {
    KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCI::SuspendUSBBus Processing WDH before suspending");
    result = (*(int (__fastcall **)(uintptr_t, _QWORD))(*(_QWORD *)arg1 + 2472LL))(arg1, 0LL);
  }
  if ( a2 )
  {
    v3 = *(_QWORD *)(arg1 + 672);
    v4 = 192;
    if ( *(_BYTE *)(v3 + 210) & 2 )
    {
      v4 = 128;
      if ( *(_BYTE *)(arg1 + 505) )
      {
        v5 = 0;
        do
        {
          *(_DWORD *)(arg1 + 4LL * v5 + 3096) = *(_DWORD *)(*(_QWORD *)(arg1 + 712) + 4LL * v5 + 84);
          ++v5;
        }
        while ( v5 < *(_BYTE *)(arg1 + 505) );
        v3 = *(_QWORD *)(arg1 + 672);
      }
    }
    v6 = v4 + 1536;
    if ( !*(_BYTE *)(v3 + 249) )
      v6 = v4;
    *(_DWORD *)(*(_QWORD *)(arg1 + 712) + 4LL) = v6;
    result = IOSleep(3LL);
  }
  return result;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (00000000000049C2) ----------------------------------------------------
int __fastcall AppleUSBOHCI::ResumeUSBBus(uintptr_t arg1, uintptr_t a2)
{
  char v2; // r14@1
  uintptr_t v3; // r13@1
  uintptr_t v4; // rdx@3
  __int64 v5; // rax@4
  int v6; // ecx@4
  signed __int64 v7; // rdi@9
  __int64 v8; // rax@12
  int v9; // ecx@12
  int v10; // eax@14
  signed int v11; // ebx@15
  signed int v12; // ecx@18
  signed int v13; // edx@21
  __int64 v14; // rbx@27
  int v15; // er9@27
  __int64 v16; // r8@29
  __int64 v17; // rax@30
  __int64 v18; // rdi@32
  __int64 v19; // rax@33
  __int64 v20; // rax@34
  __int64 v21; // r8@40

  v2 = a2;
  v3 = arg1;
  if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
  {
    v4 = (unsigned __int8)a2;
    a2 = arg1;
    kernel_debug(0x52D3838u, arg1, v4, 0LL, 0LL, 0LL);
  }
  v5 = *(_QWORD *)(arg1 + 712);
  v6 = (*(_DWORD *)(v5 + 4) >> 6) & 3;
  if ( !v6 )
    goto LABEL_12;
  if ( v6 == 1 )
  {
LABEL_8:
    if ( *(_BYTE *)(*(_QWORD *)(arg1 + 672) + 208LL) & 0x20 )
      v7 = 35LL;
    else
      v7 = 20LL;
    IOSleep(v7);
LABEL_12:
    *(_DWORD *)(*(_QWORD *)(v3 + 712) + 4LL) = 128;
    _mm_mfence();
    IOSleep(3LL);
    v8 = *(_QWORD *)(v3 + 712);
    v9 = *(_DWORD *)(v8 + 80);
    if ( !(BYTE1(v9) & 0x80) )
    {
      *(_DWORD *)(v8 + 80) = 163840;
      _mm_mfence();
      if ( *(_BYTE *)(*(_QWORD *)(v3 + 672) + 209LL) & 4 )
      {
        v10 = *(_DWORD *)(*(_QWORD *)(v3 + 712) + 80LL);
        if ( !(BYTE1(v10) & 0x80) )
        {
          v11 = 1;
          do
          {
            a2 = 1431519814LL;
            KernelDebugLogInternal(1LL, 1431519814LL, "OHCI driver::ResumeUSBBus - DRWE bit not sticking. Retrying.");
            *(_DWORD *)(*(_QWORD *)(v3 + 712) + 80LL) = 163840;
            _mm_mfence();
            if ( (unsigned int)v11 > 9 )
              break;
            ++v11;
          }
          while ( !(*(_DWORD *)(*(_QWORD *)(v3 + 712) + 80LL) & 0x8000) );
        }
      }
    }
    v12 = 188;
    if ( *(_DWORD *)(v3 + 2908) )
      v12 = 156;
    v5 = *(_QWORD *)(v3 + 712);
    *(_DWORD *)(v5 + 4) = v12;
    _mm_mfence();
    goto LABEL_24;
  }
  if ( v6 == 3 )
  {
    *(_DWORD *)(v5 + 4) = 64;
    goto LABEL_8;
  }
  v13 = 188;
  if ( *(_DWORD *)(arg1 + 2908) )
    v13 = 156;
  *(_DWORD *)(v5 + 4) = v13;
  _mm_mfence();
LABEL_24:
  if ( v2 )
  {
    LODWORD(v5) = IOSleep(1LL);
    if ( *(_BYTE *)(v3 + 505) )
    {
      LODWORD(v5) = 0;
      do
      {
        v14 = (unsigned int)v5;
        v15 = *(_DWORD *)(*(_QWORD *)(v3 + 712) + 4LL * (unsigned int)v5 + 84);
        if ( v15 & 0x10000 )
        {
          if ( v15 & 2 )
          {
            v16 = *(_DWORD *)(*(_QWORD *)(v3 + 168) + 28LL);
            a2 = 1431519814LL;
            KernelDebugLogInternal(
              1LL,
              1431519814LL,
              "USB (OHCI):Port %d on bus 0x%x has connect status change but is still enabled. setting clear port enable. hcRhPortStatus(0x%x)");
            *(_DWORD *)(*(_QWORD *)(v3 + 712) + 4 * v14 + 84) = 1;
LABEL_30:
            IOSleep(1LL);
            v17 = *(_DWORD *)(*(_QWORD *)(v3 + 712) + 4 * v14 + 84);
            goto LABEL_41;
          }
        }
        else
        {
          if ( v15 & 0x40000 )
          {
            v18 = *(_QWORD *)(v3 + 152);
            if ( v18
              && (LODWORD(v19) = (*(int (__fastcall **)(__int64, uintptr_t))(*(_QWORD *)v18 + 2608LL))(v18, a2), v19) )
            {
              LODWORD(v20) = (*(int (__cdecl **)(_QWORD))(**(_QWORD **)(v3 + 152) + 2608LL))(*(_QWORD *)(v3 + 152));
              a2 = 3758112790LL;
              (*(void (__fastcall **)(__int64, signed __int64, uintptr_t, __int64))(*(_QWORD *)v20 + 1840LL))(
                v20,
                3758112790LL,
                v3,
                v14);
            }
            else
            {
              a2 = (unsigned int)(v14 + 1);
              IOLog(
                "USB (OHCI):Port %d on bus 0x%x has remote wakeup from some device\n",
                a2,
                *(_DWORD *)(*(_QWORD *)(v3 + 168) + 28LL));
            }
            goto LABEL_41;
          }
          if ( v15 & 1
            && *(_QWORD *)(*(_QWORD *)(v3 + 672) + 208LL) & 0x20000LL
            && !(v15 & 2)
            && *(_DWORD *)(v3 + 4LL * (unsigned int)v5 + 3096) & 2 )
          {
            v21 = *(_DWORD *)(*(_QWORD *)(v3 + 168) + 28LL);
            a2 = 1431519814LL;
            KernelDebugLogInternal(
              1LL,
              1431519814LL,
              "USB (OHCI):Port %d on bus 0x%x is connected but not enabled. trying to set port enable. hcRhPortStatus(0x%x) _savedHcRhPortStatus(0x%x)");
            *(_DWORD *)(*(_QWORD *)(v3 + 712) + 4 * v14 + 84) = 2;
            goto LABEL_30;
          }
        }
LABEL_41:
        *(_DWORD *)(v3 + 4 * v14 + 3096) = 0;
        LODWORD(v5) = v14 + 1;
      }
      while ( (signed int)v14 + 1 < (unsigned int)*(_BYTE *)(v3 + 505) );
    }
  }
  return v5;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1B8: using guessed type int __fastcall IOLog(_QWORD, _QWORD, _QWORD);
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000004CD8) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::AllocatePowerStateArray(AppleUSBOHCI *this)
{
  int v1; // ebx@1
  __int64 v2; // rax@2
  __int64 v3; // rax@3

  v1 = (*(int (**)(void))(off_B040[0] + 2952))();
  if ( !v1 )
  {
    LODWORD(v2) = (*(int (__fastcall **)(_QWORD, _QWORD))(**((_QWORD **)this + 61) + 696LL))(
                    *((_QWORD *)this + 61),
                    "AAPL,clock-id");
    if ( v2 )
    {
      v3 = *((_QWORD *)this + 60);
      *(_QWORD *)(v3 + 312) |= 4uLL;
      *(_BYTE *)(v3 + 408) |= 4u;
    }
  }
  return (unsigned int)v1;
}
// B040: using guessed type __int64 off_B040[6];

//----- (0000000000004D2E) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::SaveControllerStateForSleep(uintptr_t arg1)
{
  unsigned __int64 v1; // r14@2
  unsigned __int16 v2; // ax@2
  unsigned __int8 v4; // [sp+Fh] [bp-11h]@1

  v4 = 0;
  (*(void (__fastcall **)(_QWORD, signed __int64, char *))(**(_QWORD **)(arg1 + 488) + 2272LL))(
    *(_QWORD *)(arg1 + 488),
    1LL,
    &v4);
  if ( v4 >= 0x40uLL )
  {
    v1 = v4 + 4LL;
    v2 = IOPCIDevice::extendedConfigRead16(*(IOPCIDevice **)(arg1 + 488), v1);
    if ( (v2 & 0x8000u) != 0 )
    {
      IOPCIDevice::extendedConfigWrite16(*(IOPCIDevice **)(arg1 + 488), v1, v2);
      IOSleep(2LL);
    }
  }
  *(_BYTE *)(arg1 + 3168) = 0;
  AppleUSBOHCI::SuspendUSBBus(arg1, 1u);
  *(_BYTE *)(arg1 + 440) = 1;
  if ( *(_BYTE *)(*(_QWORD *)(arg1 + 672) + 249LL) )
    *(_DWORD *)(*(_QWORD *)(arg1 + 712) + 20LL) = 2147483648;
  return 0LL;
}
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000004DDC) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::RestoreControllerStateFromSleep(uintptr_t arg1)
{
  if ( *(_DWORD *)(*(_QWORD *)(arg1 + 712) + 8LL) == -1 )
  {
    *(_BYTE *)(arg1 + 444) = 0;
  }
  else
  {
    *(_BYTE *)(arg1 + 3168) = 1;
    AppleUSBOHCI::InitializeOperationalRegisters((AppleUSBOHCI *)arg1);
    if ( *(_BYTE *)(*(_QWORD *)(arg1 + 672) + 209LL) & 4 )
      IOUSBControllerV3::FixupNECControllerConfigRegisters((IOUSBControllerV3 *)arg1);
    AppleUSBOHCI::ResumeUSBBus(arg1, 1uLL);
    *(_BYTE *)(arg1 + 440) = 2;
    AppleUSBOHCI::LastRootHubPortStatusChanged((AppleUSBOHCI *)arg1, 1);
  }
  return 0LL;
}

//----- (0000000000004E4E) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::ResetControllerState(AppleUSBOHCI *this)
{
  if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    kernel_debug(0x52D383Cu, (uintptr_t)this, 0LL, 0LL, 0LL, 0LL);
  *(_DWORD *)(*((_QWORD *)this + 89) + 20LL) = 2147483648;
  _mm_mfence();
  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL) = 0;
  _mm_mfence();
  IOSleep(50LL);
  *(_DWORD *)(*((_QWORD *)this + 89) + 24LL) = 0;
  *(_DWORD *)(*((_QWORD *)this + 89) + 32LL) = 0;
  *(_DWORD *)(*((_QWORD *)this + 89) + 36LL) = 0;
  *(_DWORD *)(*((_QWORD *)this + 89) + 40LL) = 0;
  *(_DWORD *)(*((_QWORD *)this + 89) + 44LL) = 0;
  _mm_mfence();
  AppleUSBOHCI::OHCIRootHubPower(this, 0);
  *(_DWORD *)(*((_QWORD *)this + 89) + 8LL) = 1;
  _mm_mfence();
  IOSleep(1LL);
  return 0LL;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);

//----- (0000000000004F2C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::RestartControllerFromReset(AppleUSBOHCI *this)
{
  __int64 v1; // rax@4
  int v2; // ecx@4
  int v3; // eax@6
  signed int v4; // ebx@7
  signed int v5; // ecx@10

  if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    kernel_debug(0x52D3840u, (uintptr_t)this, *((_BYTE *)this + 2936), 0LL, 0LL, 0LL);
  AppleUSBOHCI::InitializeOperationalRegisters(this);
  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL) = 128;
  _mm_mfence();
  IOSleep(3LL);
  v1 = *((_QWORD *)this + 89);
  v2 = *(_DWORD *)(v1 + 80);
  if ( !(BYTE1(v2) & 0x80) )
  {
    *(_DWORD *)(v1 + 80) = 163840;
    _mm_mfence();
    if ( *(_BYTE *)(*((_QWORD *)this + 84) + 209LL) & 4 )
    {
      v3 = *(_DWORD *)(*((_QWORD *)this + 89) + 80LL);
      if ( !(BYTE1(v3) & 0x80) )
      {
        v4 = 1;
        do
        {
          KernelDebugLogInternal(
            1LL,
            1431519814LL,
            "OHCI driver::RestartControllerFromReset - DRWE bit not sticking. Retrying.");
          *(_DWORD *)(*((_QWORD *)this + 89) + 80LL) = 163840;
          _mm_mfence();
          if ( (unsigned int)v4 > 9 )
            break;
          ++v4;
        }
        while ( !(*(_DWORD *)(*((_QWORD *)this + 89) + 80LL) & 0x8000) );
      }
    }
  }
  v5 = 188;
  if ( *((_DWORD *)this + 727) )
    v5 = 156;
  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL) = v5;
  _mm_mfence();
  AppleUSBOHCI::OHCIRootHubPower(this, 1);
  AppleUSBOHCI::CheckSleepCapability(this);
  *((_BYTE *)this + 440) = 2;
  return 0LL;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000005066) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::EnableInterruptsFromController(uintptr_t arg1, unsigned __int8 a2)
{
  __int64 v2; // rax@4

  if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    kernel_debug(0x52D3844u, arg1, a2, 0LL, 0LL, 0LL);
  v2 = *(_QWORD *)(arg1 + 712);
  if ( a2 )
  {
    *(_DWORD *)(v2 + 16) = -2147483525;
    _mm_mfence();
  }
  else
  {
    *(_DWORD *)(v2 + 20) = 2147483648;
    _mm_mfence();
  }
  return 0LL;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];

//----- (00000000000050D0) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::DozeController(uintptr_t arg1)
{
  __int64 v1; // rax@4

  if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    kernel_debug(0x52D3848u, arg1, 0LL, 0LL, 0LL, 0LL);
  v1 = *(_QWORD *)(arg1 + 712);
  if ( !(*(_DWORD *)(v1 + 16) & 0x40) )
  {
    *(_DWORD *)(v1 + 16) |= 0x40u;
    _mm_mfence();
  }
  AppleUSBOHCI::SuspendUSBBus(arg1, 0);
  return 0LL;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];

//----- (0000000000005134) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::WakeControllerFromDoze(uintptr_t arg1)
{
  if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    kernel_debug(0x52D384Cu, arg1, 0LL, 0LL, 0LL, 0LL);
  AppleUSBOHCI::ResumeUSBBus(arg1, 0LL);
  if ( *(_BYTE *)(arg1 + 3094) )
  {
    *(_BYTE *)(arg1 + 3094) = 0;
    IOSleep(21LL);
  }
  return 0LL;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);

//----- (000000000000519C) ----------------------------------------------------
int __fastcall AppleUSBOHCI::powerChangeDone(AppleUSBOHCI *this, uintptr_t arg2)
{
  unsigned int v2; // eax@1

  v2 = IOService::getPowerState(this);
  if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    kernel_debug(0x52D3850u, (uintptr_t)this, arg2, v2, 0LL, 0LL);
  if ( *((_BYTE *)this + 444) )
    AppleUSBOHCI::showRegisters(this, 7LL, "powerChangeDone");
  return (*(int (__fastcall **)(AppleUSBOHCI *, uintptr_t))(off_B040[0] + 2136))(this, arg2);
}
// B040: using guessed type __int64 off_B040[6];
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];

//----- (0000000000005218) ----------------------------------------------------
signed __int64 __fastcall AppleUSBOHCI::GetRootHubDeviceDescriptor(__int64 a1, void *a2)
{
  signed __int64 result; // rax@1
  __int64 v3; // [sp+8h] [bp-18h]@1
  __int64 v4; // [sp+10h] [bp-10h]@1
  __int16 v5; // [sp+18h] [bp-8h]@1

  v5 = 256;
  v4 = 72622745162417580LL;
  v3 = 576460790991683858LL;
  result = 3758097085LL;
  if ( a2 )
  {
    bcopy(&v3, a2, 0x12uLL);
    result = 0LL;
  }
  return result;
}

//----- (0000000000005262) ----------------------------------------------------
signed __int64 __fastcall AppleUSBOHCI::GetRootHubDescriptor(__int64 a1, void *a2)
{
  void *v2; // r15@1
  __int64 v3; // r14@1
  __int64 v4; // rax@1
  unsigned int v5; // er12@1
  unsigned int v6; // ebx@2
  __int64 v7; // r13@3
  char *v8; // r14@3
  OSMetaClassBase *v9; // rax@3
  __int64 v10; // rsi@3
  const OSMetaClass *v11; // rdx@3
  __int64 v12; // rax@3
  unsigned int v13; // eax@4
  signed __int64 result; // rax@5
  signed __int64 v15; // r13@7
  __int64 v16; // rcx@7
  char *v17; // rax@9
  unsigned int v18; // ebx@9
  __int64 v19; // rcx@9
  unsigned __int8 v20; // cl@11
  __int64 v21; // rcx@13
  char v22; // [sp+Ch] [bp-54h]@3
  char v23; // [sp+10h] [bp-50h]@3
  char v24; // [sp+11h] [bp-4Fh]@3
  char v25; // [sp+12h] [bp-4Eh]@3
  __int16 v26; // [sp+13h] [bp-4Dh]@3
  char v27; // [sp+15h] [bp-4Bh]@3
  char v28; // [sp+16h] [bp-4Ah]@3
  char v29; // [sp+17h] [bp-49h]@3
  __int64 v30; // [sp+30h] [bp-30h]@1

  v2 = a2;
  v3 = off_B050[0];
  v30 = *(_QWORD *)off_B050[0];
  v4 = *(_QWORD *)(a1 + 712);
  v5 = *(_DWORD *)(v4 + 72);
  if ( v5 == -1 || (v6 = *(_DWORD *)(v4 + 76), v6 == -1) )
  {
    *(_BYTE *)(a1 + 444) = 0;
    result = 3758097133LL;
  }
  else
  {
    v23 = 25;
    v24 = 41;
    v25 = v5;
    *(_BYTE *)(a1 + 505) = v5;
    v26 = (v5 >> 8) & 0x1F;
    v27 = BYTE3(v5);
    v28 = 0;
    v7 = (unsigned __int8)v5 >> 3;
    v22 = v7 + 1;
    v8 = &v29;
    LODWORD(v9) = (*(int (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(a1 + 488) + 696LL))(
                    *(_QWORD *)(a1 + 488),
                    "AAPL,device-internal");
    v10 = *(_QWORD *)off_B030[0];
    v12 = OSMetaClassBase::safeMetaCast(v9, *(const OSMetaClassBase **)off_B030[0], v11);
    if ( v12 )
      v13 = (*(int (__fastcall **)(__int64, __int64))(*(_QWORD *)v12 + 328LL))(v12, v10);
    else
      v13 = (unsigned __int16)v6;
    v15 = v7 + 8;
    v16 = (unsigned int)((unsigned __int8)v5 >> 3) + 1;
    do
    {
      *v8++ = v13;
      v13 >>= 8;
      --v16;
    }
    while ( v16 );
    v17 = &v23 + v15;
    v18 = v6 >> 16;
    v19 = (unsigned int)((unsigned __int8)v5 >> 3) + 1;
    do
    {
      *v17++ = v18;
      v18 >>= 8;
      --v19;
    }
    while ( v19 );
    v20 = v23 - 2 * (9 - v22);
    v23 -= 2 * (9 - v22);
    result = 3758097085LL;
    v3 = off_B050[0];
    if ( v2 )
    {
      bcopy(&v23, v2, v20);
      result = 0LL;
    }
  }
  v21 = *(_QWORD *)v3;
  return result;
}
// B030: using guessed type _QWORD off_B030[8];
// B050: using guessed type __int64 off_B050[4];
// 1B518: using guessed type _QWORD __cdecl OSMetaClassBase::safeMetaCast(OSMetaClassBase *__hidden this, const OSMetaClassBase *, const OSMetaClass *);

//----- (00000000000053BC) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::GetRootHubConfDescriptor(__int64 a1, __int64 a2)
{
  signed int v2; // er14@1
  __int64 v4; // [sp+8h] [bp-38h]@1
  __int64 v5; // [sp+10h] [bp-30h]@1
  char v6; // [sp+18h] [bp-28h]@1
  __int64 v7; // [sp+20h] [bp-20h]@1
  __int16 v8; // [sp+28h] [bp-18h]@1

  v8 = 0;
  v7 = 6917530131449446922LL;
  v6 = 0;
  v5 = 9899899618313LL;
  v4 = 9007233673266440LL;
  v2 = -536870211;
  if ( a2 )
  {
    if ( (unsigned __int8)(*(int (__fastcall **)(_QWORD, __int64 *, signed __int64))(*(_QWORD *)a2 + 360LL))(
                            a2,
                            &v7,
                            10LL) )
    {
      if ( (unsigned __int8)(*(int (__fastcall **)(__int64, __int64 *, signed __int64))(*(_QWORD *)a2 + 360LL))(
                              a2,
                              &v5,
                              9LL) )
      {
        v2 = -536870211;
        if ( (unsigned __int8)(*(int (__fastcall **)(__int64, __int64 *, signed __int64))(*(_QWORD *)a2 + 360LL))(
                                a2,
                                &v4,
                                8LL) )
          v2 = 0;
      }
    }
  }
  return (unsigned int)v2;
}

//----- (000000000000546E) ----------------------------------------------------
__int64 AppleUSBOHCI::SetRootHubDescriptor()
{
  return 0LL;
}

//----- (0000000000005476) ----------------------------------------------------
signed __int64 __fastcall AppleUSBOHCI::GetRootHubStatus(__int64 a1, __int64 a2)
{
  signed __int64 result; // rax@1
  int v3; // ecx@1

  result = 3758097133LL;
  v3 = 0;
  if ( *(_BYTE *)(a1 + 444) )
  {
    v3 = *(_DWORD *)(*(_QWORD *)(a1 + 712) + 80LL);
    result = 0LL;
    if ( v3 == -1 )
    {
      *(_BYTE *)(a1 + 444) = 0;
      v3 = 0;
      result = 3758097133LL;
    }
  }
  *(_DWORD *)a2 = v3;
  return result;
}

//----- (00000000000054AE) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::SetRootHubFeature(AppleUSBOHCI *this)
{
  return 0LL;
}

//----- (00000000000054B6) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::ClearRootHubFeature(AppleUSBOHCI *this, int a2)
{
  if ( a2 == 1 )
  {
    *(_DWORD *)(*((_QWORD *)this + 89) + 80LL) = 0x20000;
    _mm_mfence();
  }
  return 0LL;
}

//----- (00000000000054D4) ----------------------------------------------------
signed __int64 __fastcall AppleUSBOHCI::GetRootHubPortStatus(__int64 a1, __int64 a2, unsigned __int16 a3)
{
  signed __int64 result; // rax@1

  result = 3758097133LL;
  if ( *(_BYTE *)(a1 + 440) != 1 )
  {
    result = 3758097090LL;
    if ( (unsigned __int16)(a3 - 1) <= 0xEu )
    {
      *(_DWORD *)a2 = *(_DWORD *)(*(_QWORD *)(a1 + 712) + 4LL * a3 + 80);
      result = 0LL;
    }
  }
  return result;
}

//----- (000000000000550E) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::SetRootHubPortFeature(AppleUSBOHCI *this, int a2, __int16 a3)
{
  __int64 result; // rax@1
  int v4; // esi@4

  result = 0LL;
  switch ( a2 )
  {
    case 1:
      AppleUSBOHCI::OHCIRootHubPortEnable(this, (unsigned __int16)(a3 - 1), 1u);
      goto LABEL_8;
    case 2:
      if ( *(_BYTE *)(*((_QWORD *)this + 84) + 208LL) & 0x20 )
      {
        v4 = *((_DWORD *)this + 729);
        result = 3758112847LL;
        if ( _bittest((const unsigned int *)&v4, a3) )
          return result;
      }
      AppleUSBOHCI::OHCIRootHubPortSuspend(this, (unsigned __int16)(a3 - 1), 1u);
      goto LABEL_8;
    case 4:
      AppleUSBOHCI::OHCIRootHubResetPort(this, (unsigned __int16)(a3 - 1));
      goto LABEL_8;
    case 8:
      AppleUSBOHCI::OHCIRootHubPortPower(this, (unsigned __int16)(a3 - 1), 1);
      *(_DWORD *)(*((_QWORD *)this + 89) + 80LL) = 0x10000;
      _mm_mfence();
      AppleUSBOHCI::showRegisters(this, 7LL, "SetRootHubPortFeature");
LABEL_8:
      result = 0LL;
      break;
    default:
      return result;
  }
  return result;
}

//----- (00000000000055E8) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::OHCIRootHubPortSuspend(AppleUSBOHCI *this, unsigned int a2, unsigned __int8 a3)
{
  int v3; // er13@1
  __int64 result; // rax@1
  signed int v5; // ebx@3

  v3 = 4 * (a3 == 0) + 4;
  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = v3;
  _mm_mfence();
  result = *((_QWORD *)this + 84);
  if ( *(_BYTE *)(result + 209) & 4 )
  {
    if ( !(a3 ^ 1) )
    {
      v5 = 1;
      IOSleep(1LL);
      result = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84);
      if ( !(result & 4) )
      {
        do
        {
          KernelDebugLogInternal(
            1LL,
            1431519814LL,
            "OHCI driver: OHCIRootHubPortSuspend bit not sticking (on). Retrying.");
          *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = v3;
          _mm_mfence();
          IOSleep((unsigned int)v5);
          result = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84);
          if ( (unsigned int)v5 > 9 )
            break;
          ++v5;
          result &= 4u;
        }
        while ( !(_DWORD)result );
      }
    }
  }
  return result;
}
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (00000000000056A8) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetPort(AppleUSBOHCI *this, unsigned int a2)
{
  __int64 result; // rax@1
  signed int v3; // ebx@3

  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 16;
  _mm_mfence();
  result = *((_QWORD *)this + 84);
  if ( *(_BYTE *)(result + 209) & 4 )
  {
    result = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84);
    if ( !(result & 0x10) )
    {
      v3 = 1;
      do
      {
        KernelDebugLogInternal(1LL, 1431519814LL, "OHCI driver: SetPortReset bit not sticking. Retrying.");
        *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 16;
        _mm_mfence();
        result = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84);
        if ( (unsigned int)v3 > 9 )
          break;
        result &= 0x10u;
        ++v3;
      }
      while ( !(_DWORD)result );
    }
  }
  return result;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000005748) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::OHCIRootHubPortEnable(AppleUSBOHCI *this, unsigned int a2, unsigned __int8 a3)
{
  int v3; // er13@1
  __int64 result; // rax@1
  unsigned int v5; // er14@2
  unsigned __int8 v6; // [sp+0h] [bp-2Ch]@1

  v6 = a3;
  v3 = a3 + 1;
  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = v3;
  _mm_mfence();
  result = *((_QWORD *)this + 84);
  if ( *(_BYTE *)(result + 209) & 4 )
  {
    LODWORD(result) = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84);
    v5 = 0;
    do
    {
      result &= 2u;
      if ( v6 )
        result = ((unsigned int)result >> 1) ^ 1;
      if ( !(_DWORD)result )
        break;
      KernelDebugLogInternal(1LL, 1431519814LL, "OHCI driver: OHCIRootHubPortEnable bit not sticking (%d). Retrying.");
      *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = v3;
      _mm_mfence();
      result = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84);
      ++v5;
    }
    while ( v5 < 0xA );
  }
  return result;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (00000000000057F8) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::OHCIRootHubPortPower(AppleUSBOHCI *this, unsigned int a2, char a3)
{
  signed int v3; // er13@1
  __int64 result; // rax@3
  unsigned int v5; // er14@4
  char v6; // [sp+0h] [bp-2Ch]@1

  v6 = a3;
  v3 = 512;
  if ( a3 )
    v3 = 256;
  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = v3;
  _mm_mfence();
  result = *((_QWORD *)this + 84);
  if ( *(_BYTE *)(result + 209) & 4 )
  {
    LODWORD(result) = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84);
    v5 = 0;
    do
    {
      result &= 0x100u;
      if ( v6 )
        result = ((unsigned int)result >> 8) ^ 1;
      if ( !(_DWORD)result )
        break;
      KernelDebugLogInternal(1LL, 1431519814LL, "OHCI driver: OHCIRootHubPortPower bit not sticking (%d). Retrying.");
      *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = v3;
      _mm_mfence();
      result = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84);
      ++v5;
    }
    while ( v5 < 0xA );
  }
  return result;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (00000000000058BA) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::OHCIRootHubPower(AppleUSBOHCI *this, char a2)
{
  __int64 result; // rax@1

  result = *((_QWORD *)this + 89);
  if ( a2 )
    *(_DWORD *)(result + 80) = 0x10000;
  else
    *(_DWORD *)(result + 80) = 1;
  _mm_mfence();
  return result;
}

//----- (00000000000058E0) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::ClearRootHubPortFeature(AppleUSBOHCI *this, int a2, __int16 a3)
{
  signed int v3; // er14@1
  unsigned __int16 v4; // dx@1

  v3 = 0;
  v4 = a3 - 1;
  switch ( a2 )
  {
    case 1:
      v3 = 0;
      AppleUSBOHCI::OHCIRootHubPortEnable(this, v4, 0);
      return (unsigned int)v3;
    case 2:
      *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * v4 + 84) = 8;
      _mm_mfence();
      return (unsigned int)v3;
    case 8:
      v3 = -536870201;
      if ( !(*(_BYTE *)(*((_QWORD *)this + 84) + 210LL) & 0x80) )
      {
        v3 = 0;
        AppleUSBOHCI::OHCIRootHubPortPower(this, v4, 0);
      }
      return (unsigned int)v3;
    case 16:
      AppleUSBOHCI::OHCIRootHubResetChangeConnection(this, v4);
      goto LABEL_11;
    case 17:
      AppleUSBOHCI::OHCIRootHubResetEnableChange(this, v4);
      goto LABEL_11;
    case 18:
      AppleUSBOHCI::OHCIRootHubResetSuspendChange(this, v4);
      goto LABEL_11;
    case 19:
      AppleUSBOHCI::OHCIRootHubResetOverCurrentChange(this, v4);
      goto LABEL_11;
    case 20:
      AppleUSBOHCI::OHCIRootHubResetResetChange(this, v4);
LABEL_11:
      if ( *((_BYTE *)this + 3093) )
      {
        *((_BYTE *)this + 3093) = 0;
        *(_DWORD *)(*((_QWORD *)this + 89) + 16LL) = -2147483584;
        _mm_mfence();
      }
      break;
    default:
      return (unsigned int)v3;
  }
  return (unsigned int)v3;
}

//----- (0000000000005A1C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetChangeConnection(AppleUSBOHCI *this, unsigned int a2)
{
  __int64 result; // rax@1
  signed int v3; // ebx@3

  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 0x10000;
  _mm_mfence();
  result = *((_QWORD *)this + 84);
  if ( *(_BYTE *)(result + 209) & 4 )
  {
    result = *((_QWORD *)this + 89);
    if ( *(_DWORD *)(result + 4LL * a2 + 84) & 0x10000 )
    {
      v3 = 1;
      do
      {
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "OHCI driver: OHCIRootHubResetChangeConnection bit not sticking. Retrying.");
        *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 0x10000;
        _mm_mfence();
        result = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) & 0x10000;
        if ( (unsigned int)v3 > 9 )
          break;
        ++v3;
      }
      while ( (_DWORD)result );
    }
  }
  return result;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000005ACC) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetEnableChange(AppleUSBOHCI *this, unsigned int a2)
{
  __int64 result; // rax@1
  signed int v3; // ebx@3

  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 0x20000;
  _mm_mfence();
  result = *((_QWORD *)this + 84);
  if ( *(_BYTE *)(result + 209) & 4 )
  {
    result = *((_QWORD *)this + 89);
    if ( *(_DWORD *)(result + 4LL * a2 + 84) & 0x20000 )
    {
      v3 = 1;
      do
      {
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "OHCI driver: OHCIRootHubResetEnableChange bit not sticking. Retrying.");
        *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 0x20000;
        _mm_mfence();
        result = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) & 0x20000;
        if ( (unsigned int)v3 > 9 )
          break;
        ++v3;
      }
      while ( (_DWORD)result );
    }
  }
  return result;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000005B7C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetSuspendChange(AppleUSBOHCI *this, unsigned int a2)
{
  __int64 result; // rax@1
  signed int v3; // ebx@3

  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 0x40000;
  _mm_mfence();
  result = *((_QWORD *)this + 84);
  if ( *(_BYTE *)(result + 209) & 4 )
  {
    result = *((_QWORD *)this + 89);
    if ( *(_DWORD *)(result + 4LL * a2 + 84) & 0x40000 )
    {
      v3 = 1;
      do
      {
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "OHCI driver: OHCIRootHubResetSuspendChange bit not sticking. Retrying.");
        *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 0x40000;
        _mm_mfence();
        result = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) & 0x40000;
        if ( (unsigned int)v3 > 9 )
          break;
        ++v3;
      }
      while ( (_DWORD)result );
    }
  }
  return result;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000005C2C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetOverCurrentChange(AppleUSBOHCI *this, unsigned int a2)
{
  __int64 result; // rax@1
  signed int v3; // ebx@3

  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 0x80000;
  _mm_mfence();
  result = *((_QWORD *)this + 84);
  if ( *(_BYTE *)(result + 209) & 4 )
  {
    result = *((_QWORD *)this + 89);
    if ( *(_DWORD *)(result + 4LL * a2 + 84) & 0x80000 )
    {
      v3 = 1;
      do
      {
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "OHCI driver: OHCIRootHubResetOverCurrentChange bit not sticking. Retrying.");
        *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 0x80000;
        _mm_mfence();
        result = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) & 0x80000;
        if ( (unsigned int)v3 > 9 )
          break;
        ++v3;
      }
      while ( (_DWORD)result );
    }
  }
  return result;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000005CDC) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::OHCIRootHubResetResetChange(AppleUSBOHCI *this, unsigned int a2)
{
  __int64 result; // rax@1
  signed int v3; // ebx@3

  *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 0x100000;
  _mm_mfence();
  result = *((_QWORD *)this + 84);
  if ( *(_BYTE *)(result + 209) & 4 )
  {
    result = *((_QWORD *)this + 89);
    if ( *(_DWORD *)(result + 4LL * a2 + 84) & 0x100000 )
    {
      v3 = 1;
      do
      {
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "OHCI driver: OHCIRootHubResetResetChange bit not sticking. Retrying.");
        *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) = 0x100000;
        _mm_mfence();
        result = *(_DWORD *)(*((_QWORD *)this + 89) + 4LL * a2 + 84) & 0x100000;
        if ( (unsigned int)v3 > 9 )
          break;
        ++v3;
      }
      while ( (_DWORD)result );
    }
  }
  return result;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000005D8C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::GetRootHubPortState(AppleUSBOHCI *this, unsigned __int8 *a2)
{
  return 0LL;
}

//----- (0000000000005D94) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::SetHubAddress(AppleUSBOHCI *this, __int16 a2)
{
  *((_WORD *)this + 1452) = a2;
  return 0LL;
}

//----- (0000000000005DA4) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::GetRootHubStringDescriptor(__int64 a1, char a2, __int64 a3)
{
  __int64 v3; // rax@1
  __int64 v4; // r14@1
  signed int v5; // ebx@1
  __int64 v6; // rcx@4
  signed __int64 v7; // rdx@4
  __int64 *v8; // rsi@4
  __int64 result; // rax@10
  __int64 v10; // [sp+0h] [bp-70h]@1
  __int64 v11; // [sp+8h] [bp-68h]@1
  int v12; // [sp+10h] [bp-60h]@1
  __int16 v13; // [sp+14h] [bp-5Ch]@1
  __int64 v14; // [sp+20h] [bp-50h]@1
  __int64 v15; // [sp+28h] [bp-48h]@1
  __int64 v16; // [sp+30h] [bp-40h]@1
  __int64 v17; // [sp+38h] [bp-38h]@1
  __int64 v18; // [sp+40h] [bp-30h]@1
  __int64 v19; // [sp+48h] [bp-28h]@1
  __int16 v20; // [sp+50h] [bp-20h]@1
  __int64 v21; // [sp+58h] [bp-18h]@1

  v3 = a3;
  v4 = off_B050[0];
  v21 = *(_QWORD *)off_B050[0];
  v19 = 31244173394051169LL;
  v18 = 30399800003068009LL;
  v17 = 23362560512360565LL;
  v16 = 20266335769722991LL;
  v15 = 31244074604298313LL;
  v14 = 18859132682437376LL;
  v20 = 110;
  v11 = 20547810745450604LL;
  v10 = 31525678432191232LL;
  v13 = 46;
  v12 = 6488174;
  v5 = -536870206;
  if ( (unsigned __int8)(a2 - 1) > 1u )
    goto LABEL_10;
  LOBYTE(v10) = 22;
  LOBYTE(v14) = 50;
  if ( a2 == 2 )
  {
    v5 = -536870211;
    if ( !a3 )
      goto LABEL_10;
    v6 = *(_QWORD *)a3;
    v7 = (unsigned __int8)v10;
    v8 = &v10;
    goto LABEL_8;
  }
  if ( a2 == 1 )
  {
    v5 = -536870211;
    if ( !a3 )
      goto LABEL_10;
    v6 = *(_QWORD *)a3;
    v8 = &v14;
    v7 = 50LL;
LABEL_8:
    if ( !(unsigned __int8)(*(int (__fastcall **)(__int64, __int64 *, signed __int64))(v6 + 360))(v3, v8, v7) )
      goto LABEL_10;
  }
  v5 = 0;
LABEL_10:
  result = *(_QWORD *)v4;
  if ( *(_QWORD *)v4 == v21 )
    result = (unsigned int)v5;
  return result;
}
// B050: using guessed type __int64 off_B050[4];

//----- (0000000000005EC0) ----------------------------------------------------
void __fastcall AppleUSBOHCI::UIMRootHubStatusChange(AppleUSBOHCI *this)
{
  ;
}

//----- (0000000000005EC6) ----------------------------------------------------
int __usercall AppleUSBOHCI::UIMRootHubStatusChange@<eax>(AppleUSBOHCI *this@<rdi>, __int64 a2@<rax>)
{
  __int16 v2; // r15@4
  signed __int16 v3; // r13@7
  unsigned int v4; // ebx@7
  __int64 v6; // [sp-4h] [bp-30h]@1

  v6 = a2;
  HIDWORD(v6) = 0xFFFF;
  if ( !*((_BYTE *)this + 444)
    || *((_BYTE *)this + 441)
    || (LODWORD(a2) = (*(int (__fastcall **)(AppleUSBOHCI *, char *))(*(_QWORD *)this + 2288LL))(this, (char *)&v6 + 4),
        (_DWORD)a2) )
  {
    v2 = 0;
  }
  else
  {
    LODWORD(a2) = (BYTE6(v6) & 3) != 0;
    v2 = (BYTE6(v6) & 3) != 0;
    if ( *((_BYTE *)this + 505) )
    {
      v3 = 2;
      v4 = 1;
      do
      {
        (*(void (__fastcall **)(AppleUSBOHCI *, char *, _QWORD))(*(_QWORD *)this + 2312LL))(
          this,
          (char *)&v6 + 4,
          (unsigned __int16)v4);
        if ( BYTE6(v6) & 0x1F )
          v2 |= v3;
        ++v4;
        v3 *= 2;
        LODWORD(a2) = *((_BYTE *)this + 505);
      }
      while ( v4 <= (unsigned int)a2 );
    }
  }
  *((_WORD *)this + 253) = v2;
  return a2;
}

//----- (0000000000005F7A) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::SimulateControlEDCreate(AppleUSBOHCI *this)
{
  return 0LL;
}

//----- (0000000000005F82) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::SimulateEDDelete(AppleUSBOHCI *this, __int16 a2, __int16 a3)
{
  __int64 result; // rax@1

  result = 0LL;
  if ( a2 == 1 )
  {
    result = 3758097097LL;
    if ( a3 == 1 )
    {
      (*(void (**)(void))(*(_QWORD *)this + 3000LL))();
      result = 0LL;
    }
  }
  return result;
}

//----- (0000000000005FAA) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::SimulateEDAbort(AppleUSBOHCI *this, __int16 a2, __int16 a3)
{
  __int64 result; // rax@1

  result = 0LL;
  if ( a2 == 1 )
  {
    result = 3758097097LL;
    if ( a3 == 1 )
    {
      (*(void (**)(void))(*(_QWORD *)this + 3000LL))();
      result = 0LL;
    }
  }
  return result;
}

//----- (0000000000005FD2) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::SimulateEDClearStall(AppleUSBOHCI *this)
{
  return 0LL;
}

//----- (0000000000005FDA) ----------------------------------------------------
uint64_t __fastcall AppleUSBOHCI::LastRootHubPortStatusChanged(AppleUSBOHCI *this, char a2)
{
  uint64_t result; // rax@2

  if ( a2 )
  {
    result = mach_absolute_time();
    *((_QWORD *)this + 370) = result;
  }
  else
  {
    result = *((_QWORD *)this + 370);
  }
  return result;
}

//----- (0000000000006004) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::CreateGeneralTransfer(uintptr_t arg1, unsigned __int64 a2, unsigned __int64 a3, __int64 a4, unsigned int a5, int a6, int a7, int a8)
{
  int v8; // er13@1
  __int64 v9; // r15@1
  unsigned __int64 v10; // r14@1
  unsigned __int64 v11; // rbx@1
  uintptr_t v12; // r12@1
  unsigned __int64 v13; // rsi@1
  signed __int64 v14; // r14@1
  unsigned int v15; // er13@7
  __int64 v16; // rax@10
  AppleUSBOHCIgtdMemoryBlock *v17; // rax@13
  AppleUSBOHCIgtdMemoryBlock *v18; // r15@13
  __int64 v19; // rdx@19
  unsigned __int64 v21; // rsi@27
  __int64 *v22; // rdx@27
  int *v23; // rcx@27
  uintptr_t v24; // r15@28
  int v25; // eax@28
  __int64 v26; // rdx@28
  __int64 *v27; // rax@31
  __int64 v28; // rcx@31
  unsigned __int64 v29; // rdx@32
  AppleUSBOHCIgtdMemoryBlock *v30; // rsi@35
  unsigned __int64 v31; // r8@36
  unsigned __int64 v32; // r9@36
  __int64 v33; // r13@43
  unsigned __int64 v34; // rax@43
  __int16 v35; // di@44
  __int64 v36; // rax@50
  char v37; // al@52
  char v38; // al@53
  unsigned __int64 v39; // [sp+30h] [bp-C0h]@27
  signed __int64 v40; // [sp+38h] [bp-B8h]@27
  unsigned __int64 v41; // [sp+40h] [bp-B0h]@28
  unsigned int v42; // [sp+4Ch] [bp-A4h]@0
  IOUSBCommand *v43; // [sp+50h] [bp-A0h]@1
  uintptr_t arg1a; // [sp+58h] [bp-98h]@6
  uintptr_t arg1b; // [sp+58h] [bp-98h]@27
  unsigned int v46; // [sp+60h] [bp-90h]@1
  unsigned __int64 v47; // [sp+68h] [bp-88h]@27
  char v48; // [sp+70h] [bp-80h]@1
  int v49; // [sp+8Ch] [bp-64h]@27
  __int64 v50; // [sp+90h] [bp-60h]@27
  __int64 v51; // [sp+98h] [bp-58h]@31
  int v52; // [sp+B0h] [bp-40h]@34
  unsigned int v53; // [sp+B4h] [bp-3Ch]@34
  int v54; // [sp+B8h] [bp-38h]@39
  unsigned int v55; // [sp+BCh] [bp-34h]@44
  __int64 v56; // [sp+C0h] [bp-30h]@1

  v8 = a6;
  v46 = a5;
  v9 = a4;
  v10 = a3;
  v43 = (IOUSBCommand *)a3;
  v11 = a2;
  v12 = arg1;
  v56 = *(_QWORD *)off_B050[0];
  v13 = a3;
  IOUSBCommand::GetUSLCompletion((IOUSBCommand *)&v48);
  v14 = *(_QWORD *)(*(_QWORD *)(v10 + 216) + 48LL);
  if ( *(_DWORD *)(*(_QWORD *)v11 + 8LL) & 1 && (a7 != 3 || **(_DWORD **)v11 & 0x780) )
  {
    v14 = 3758112847LL;
    if ( *(_BYTE *)off_B058[0] & 2 )
    {
      if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      {
        arg1a = arg1;
        kernel_debug(0x52D3808u, arg1, 3uLL, 0xFFFFFFFFE000404FLL, 0LL, 0LL);
      }
      else
      {
        arg1a = arg1;
      }
    }
    else
    {
      arg1a = arg1;
    }
    goto LABEL_22;
  }
  v15 = v8 | 0xF0000000;
  if ( v46 )
  {
    if ( v9 )
    {
      v42 = v15;
      if ( v14 )
      {
        LODWORD(v16) = (*(int (__fastcall **)(signed __int64, unsigned __int64))(*(_QWORD *)v14 + 312LL))(v14, v13);
        if ( v16 == v9 )
          goto LABEL_27;
        arg1a = arg1;
        (*(void (__fastcall **)(signed __int64))(*(_QWORD *)v14 + 312LL))(v14);
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBOHCI::CreateGeneralTransfer - mismatched CBP (%p) and dmaCommand memory descriptor (%p)");
        v14 = 3758097097LL;
        goto LABEL_22;
      }
      arg1a = arg1;
      v19 = (__int64)"AppleUSBOHCI::CreateGeneralTransfer - no dmaCommand";
    }
    else
    {
      arg1a = arg1;
      v19 = (__int64)"AppleUSBOHCI::CreateGeneralTransfer - nonZero bufferSize and no CBP";
    }
    KernelDebugLogInternal(1LL, 1431519814LL, v19);
    v14 = 3758097097LL;
LABEL_22:
    if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      kernel_debug(0x52D3808u, arg1a, (signed int)v14, 0LL, 0LL, 0LL);
    goto LABEL_25;
  }
  arg1a = arg1;
  v17 = AppleUSBOHCI::AllocateTD(arg1, v13);
  v18 = v17;
  v14 = 3758097085LL;
  if ( !v17 )
    goto LABEL_22;
  v12 = v11;
  v11 = *(_QWORD *)(v11 + 24);
  **(_DWORD **)(v11 + 24) = v15;
  *(_DWORD *)(*(_QWORD *)(v11 + 24) + 8LL) = *((_DWORD *)v17 + 2);
  *(_QWORD *)(v11 + 16) = v17;
  *(_QWORD *)(v11 + 48) = v12;
  *(_WORD *)v11 = a7;
  *(_DWORD *)(*(_QWORD *)(v11 + 24) + 4LL) = 0;
  *(_DWORD *)(*(_QWORD *)(v11 + 24) + 12LL) = 0;
  *(_QWORD *)(v11 + 32) = v43;
  *(_BYTE *)(v11 + 2) |= 1u;
  if ( (unsigned __int8)IOUSBCommand::GetMultiTransferTransaction(v43) )
  {
    *(_BYTE *)(v11 + 2) |= 2u;
    if ( (unsigned __int8)IOUSBCommand::GetFinalTransferInTransaction(v43) )
      *(_BYTE *)(v11 + 2) |= 4u;
  }
  *(_DWORD *)(*(_QWORD *)v12 + 4LL) = *(_DWORD *)(*(_QWORD *)(v11 + 24) + 8LL);
  *(_QWORD *)(v12 + 24) = v18;
  *(_DWORD *)(*(_QWORD *)(arg1 + 712) + 8LL) = a8;
  v14 = 0LL;
LABEL_25:
  while ( *(_QWORD *)off_B050[0] != v56 )
  {
LABEL_27:
    v40 = v14;
    v39 = v11;
    v11 = 0LL;
    v21 = (unsigned __int64)&v47;
    v22 = &v50;
    v23 = &v49;
    arg1b = v12;
    while ( 1 )
    {
      v41 = v11;
      v47 = v11;
      v24 = v12;
      v49 = 2 - ((*(_DWORD *)(*(_QWORD *)(v12 + 672) + 208LL) >> 1) & 1);
      v25 = (*(int (__fastcall **)(signed __int64, unsigned __int64, __int64 *, int *))(*(_QWORD *)v40 + 344LL))(
              v40,
              v21,
              v22,
              v23);
      v14 = (unsigned int)v25;
      v11 = (unsigned int)v49;
      v12 = (unsigned int)v25;
      if ( v25 )
        goto LABEL_59;
      if ( (unsigned int)(v49 - 1) > 1 )
      {
        v14 = 3758097097LL;
        v12 = 0LL;
LABEL_59:
        (*(void (__cdecl **)(signed __int64, unsigned __int64, __int64))(*(_QWORD *)v40 + 312LL))(v40, v21, v26);
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBOHCI::CreateGeneralTransfer - could not generate segments - err (0x%x) pageCount (%d) offset (%qd) transferOffset (%d) bufferSize (%d) getMemoryDescriptor (%p)");
        goto LABEL_25;
      }
      if ( v49 )
        break;
LABEL_35:
      v11 = v24;
      v30 = AppleUSBOHCI::AllocateTD(v24, v21);
      v14 = 3758097085LL;
      if ( !v30 )
      {
        arg1a = v24;
        goto LABEL_22;
      }
      v31 = v41;
      v32 = v46;
      if ( v49 == 2 )
      {
        if ( v41 + v53 >= v46 )
        {
          v49 = 1;
        }
        else if ( ((_WORD)v53 + (_WORD)v52) & 0xFFF || v54 & 0xFFF )
        {
          v49 = 1;
          if ( v53 % ((**(_DWORD **)v39 >> 16) & 0x7FFu) )
          {
            arg1a = v24;
            KernelDebugLogInternal(
              1LL,
              1431519814LL,
              "AppleUSBOHCI::CreateGeneralTransfer: non-multiple MPS transfer required -- giving up!");
            goto LABEL_22;
          }
        }
      }
      v33 = *(_QWORD *)(v39 + 24);
      *(_DWORD *)(*(_QWORD *)(v33 + 24) + 4LL) = v52;
      *(_DWORD *)(*(_QWORD *)(v33 + 24) + 8LL) = *((_DWORD *)v30 + 2);
      v34 = v41 + v53;
      if ( v49 == 2 )
      {
        v35 = a7;
        if ( v34 + v55 > v46 )
          v55 = v46 - v34;
        *(_DWORD *)(*(_QWORD *)(v33 + 24) + 12LL) = v54 + v55 - 1;
        v31 = v55 + v41;
      }
      else
      {
        v35 = a7;
        if ( v46 < v34 )
          v53 = v46 - v41;
        *(_DWORD *)(*(_QWORD *)(v33 + 24) + 12LL) = v52 + v53 - 1;
      }
      *(_QWORD *)(v33 + 16) = v30;
      *(_QWORD *)(v33 + 48) = v39;
      *(_WORD *)v33 = v35;
      *(_QWORD *)(v33 + 32) = v43;
      v11 = v31 + v53;
      v36 = *(_QWORD *)(v33 + 24);
      if ( v11 >= v46 )
      {
        *(_DWORD *)v36 = v42;
        *(_BYTE *)(v33 + 2) |= 1u;
        v37 = IOUSBCommand::GetMultiTransferTransaction(v43);
        v32 = v46;
        if ( v37 )
        {
          *(_BYTE *)(v33 + 2) |= 2u;
          v38 = IOUSBCommand::GetFinalTransferInTransaction(v43);
          v32 = v46;
          if ( v38 )
            *(_BYTE *)(v33 + 2) |= 4u;
        }
      }
      else
      {
        *(_DWORD *)v36 = v42 & 0xFF1BFFFF | 0xE00000;
        *(_BYTE *)(v33 + 2) &= 0xFEu;
      }
      v14 = 0LL;
      *(_DWORD *)(*(_QWORD *)v39 + 4LL) = *(_DWORD *)(*(_QWORD *)(v33 + 24) + 8LL);
      *(_QWORD *)(v39 + 24) = v30;
      v12 = arg1b;
      *(_DWORD *)(*(_QWORD *)(arg1b + 712) + 8LL) = a8;
      v21 = (unsigned __int64)&v47;
      v22 = &v50;
      v23 = &v49;
      if ( v11 >= v32 )
        goto LABEL_25;
    }
    v27 = &v51;
    v28 = 0LL;
    while ( 1 )
    {
      v29 = *(v27 - 1);
      if ( v29 > 0xFFFFFFFF )
        break;
      v21 = *v27;
      if ( (unsigned __int64)*v27 > 0xFFFFFFFF )
        break;
      *(&v52 + 2 * v28) = v29;
      *(&v53 + 2 * v28++) = v21;
      v27 += 2;
      if ( (unsigned int)v28 >= (unsigned int)v11 )
        goto LABEL_35;
    }
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "AppleUSBOHCI::CreateGeneralTransfer - generated segments (%d) not 32 bit -  offset (0x%qx) length (0x%qx) ");
    v14 = 3758097097LL;
  }
  return (unsigned int)v14;
}
// B050: using guessed type __int64 off_B050[4];
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (000000000000660E) ----------------------------------------------------
int __usercall AppleUSBOHCI::UIMCreateControlEndpoint@<eax>(AppleUSBOHCI *this@<rdi>, int a2)
{
  return (*(int (**)(void))(*(_QWORD *)this + 2152LL))();
}

//----- (0000000000006620) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMCreateControlEndpoint(AppleUSBOHCI *this, int a2, unsigned __int8 a3, unsigned __int16 a4, int a5)
{
  __int64 result; // rax@3
  __int64 v6; // rax@5
  bool v7; // zf@8

  if ( *((_WORD *)this + 1452) == a2 )
  {
    if ( !a3 || (result = 3758097090LL, (_BYTE)a5) )
      result = AppleUSBOHCI::SimulateControlEDCreate(this);
  }
  else
  {
    v6 = *((_QWORD *)this + 347);
    a5 = (unsigned __int8)a5;
    if ( (unsigned __int8)a5 == 1 && *((_DWORD *)this + 727) )
      v6 = *((_QWORD *)this + 346);
    v7 = AppleUSBOHCI::AddEmptyEndPoint((uintptr_t)this, (unsigned __int8)a2, a3, a4, a5, 0, v6, 0) == 0LL;
    result = 3758097085LL;
    if ( !v7 )
      result = 0LL;
  }
  return result;
}

//----- (00000000000066A4) ----------------------------------------------------
AppleUSBOHCIedMemoryBlock *__fastcall AppleUSBOHCI::AddEmptyEndPoint(uintptr_t a1, unsigned __int64 a2, int a3, int a4, int a5, int a6, __int64 a7, unsigned __int8 a8)
{
  int v8; // er12@1
  int v9; // er13@1
  int v10; // er14@1
  int v11; // ebx@1
  AppleUSBOHCIedMemoryBlock *v12; // r15@1
  AppleUSBOHCIitdMemoryBlock *v13; // rax@2
  AppleUSBOHCIedMemoryBlock *v14; // rcx@4

  v8 = a6;
  v9 = a5;
  v10 = a4;
  v11 = a3;
  v12 = AppleUSBOHCI::AllocateED(a1, a2);
  **(_DWORD **)v12 = (a8 << 15) | (v8 << 11) | ((v9 != 1) << 13) | (v10 << 16) | a2 | (v11 << 7);
  if ( a8 )
    v13 = AppleUSBOHCI::AllocateITD(a1, a2);
  else
    v13 = AppleUSBOHCI::AllocateTD(a1, a2);
  v14 = 0LL;
  if ( v13 )
  {
    *(_DWORD *)(*(_QWORD *)v12 + 4LL) = *((_DWORD *)v13 + 2);
    *(_DWORD *)(*(_QWORD *)v12 + 8LL) = *((_DWORD *)v13 + 2);
    *((_QWORD *)v12 + 3) = v13;
    *((_QWORD *)v12 + 4) = v13;
    *(_DWORD *)(*(_QWORD *)v12 + 12LL) = *(_DWORD *)(*(_QWORD *)a7 + 12LL);
    *((_QWORD *)v12 + 1) = *(_QWORD *)(a7 + 8);
    *(_QWORD *)(a7 + 8) = v12;
    *(_DWORD *)(*(_QWORD *)a7 + 12LL) = *((_DWORD *)v12 + 4);
    v14 = v12;
  }
  return v14;
}

//----- (000000000000677A) ----------------------------------------------------
signed __int64 AppleUSBOHCI::UIMCreateControlTransfer()
{
  return 3758097087LL;
}

//----- (0000000000006786) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMCreateControlTransfer(__int64 a1, __int16 a2, __int16 a3, __int64 a4, __int64 a5, unsigned __int8 a6, unsigned int a7, __int16 a8)
{
  __int16 v8; // r13@1
  signed int v9; // er12@1
  __int64 v10; // rax@5
  int v11; // ecx@5
  signed int v12; // esi@6
  unsigned __int8 v14; // [sp+14h] [bp-5Ch]@1
  __int64 v15; // [sp+18h] [bp-58h]@1
  __int64 v16; // [sp+20h] [bp-50h]@1
  char v17; // [sp+28h] [bp-48h]@1
  char v18; // [sp+40h] [bp-30h]@5

  v14 = a6;
  v16 = a5;
  v15 = a4;
  v8 = a3;
  IOUSBCommand::GetUSLCompletion((IOUSBCommand *)&v17);
  v9 = 1;
  if ( a8 )
  {
    if ( a8 == 1 )
      v9 = 2;
    else
      v9 = 0;
  }
  v10 = AppleUSBOHCI::FindControlEndpoint(a1, a2, v8, (__int64)&v18);
  v11 = -536854441;
  if ( v10 )
  {
    v12 = 50331648;
    if ( !v9 )
      v12 = 0x2000000;
    v11 = (*(int (__fastcall **)(__int64, __int64, __int64, __int64, _QWORD, _QWORD))(*(_QWORD *)a1 + 3416LL))(
            a1,
            v10,
            v15,
            v16,
            a7,
            v12 | (v14 << 18) | (unsigned int)(v9 << 19));
  }
  return (unsigned int)v11;
}

//----- (0000000000006860) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::FindControlEndpoint(__int64 a1, int a2, int a3, __int64 a4)
{
  int v4; // edx@1
  __int64 result; // rax@1
  __int64 v6; // r10@2
  __int64 v7; // r8@7

  v4 = a2 | (a3 << 7);
  result = *(_QWORD *)(a1 + 2776);
  while ( 1 )
  {
    v6 = result;
    result = *(_QWORD *)(result + 8);
    if ( result == *(_QWORD *)(a1 + 2792) )
      break;
    if ( (**(_DWORD **)result & 0x7FF) == v4 )
    {
      *(_QWORD *)a4 = v6;
      return result;
    }
  }
  result = 0LL;
  if ( *(_DWORD *)(a1 + 2908) )
  {
    result = *(_QWORD *)(a1 + 2768);
    while ( 1 )
    {
      v7 = result;
      result = *(_QWORD *)(result + 8);
      if ( result == *(_QWORD *)(a1 + 2784) )
        break;
      if ( (**(_DWORD **)result & 0x1FFF) == v4 )
        goto LABEL_11;
    }
    v7 = v6;
    result = 0LL;
LABEL_11:
    *(_QWORD *)a4 = v7;
  }
  return result;
}

//----- (00000000000068D8) ----------------------------------------------------
signed __int64 AppleUSBOHCI::UIMCreateControlTransfer()
{
  return 3758097087LL;
}

//----- (00000000000068E4) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMCreateControlTransfer(AppleUSBOHCI *this, __int64 a2, __int64 a3, IOUSBCommand *a4, void *a5)
{
  char v6; // [sp+8h] [bp-18h]@1

  IOUSBCommand::GetUSLCompletion((IOUSBCommand *)&v6);
  return 3758097087LL;
}

//----- (0000000000006904) ----------------------------------------------------
int __fastcall AppleUSBOHCI::UIMCreateBulkEndpoint(AppleUSBOHCI *this, __int64 a2, __int64 a3, __int64 a4, __int64 a5, unsigned __int8 a6, unsigned __int16 a7, int a8)
{
  return (*(int (__fastcall **)(AppleUSBOHCI *, __int64, __int64, __int64, __int64, _QWORD))(*(_QWORD *)this + 2176LL))(
           this,
           a2,
           a3,
           a4,
           a5,
           a6);
}

//----- (000000000000691A) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMCreateBulkEndpoint(AppleUSBOHCI *this, unsigned __int8 a2, unsigned __int8 a3, char a4, unsigned __int8 a5, unsigned __int8 a6)
{
  char v6; // al@1
  bool v7; // zf@5
  __int64 result; // rax@5

  v6 = 1;
  if ( a4 )
  {
    if ( a4 == 1 )
      v6 = 2;
    else
      v6 = 0;
  }
  v7 = AppleUSBOHCI::AddEmptyEndPoint((uintptr_t)this, a2, a3, a6, a5, (unsigned __int8)v6, *((_QWORD *)this + 346), 0) == 0LL;
  result = 3758097085LL;
  if ( !v7 )
    result = 0LL;
  return result;
}

//----- (0000000000006974) ----------------------------------------------------
signed __int64 AppleUSBOHCI::UIMCreateBulkTransfer()
{
  return 3758097087LL;
}

//----- (0000000000006980) ----------------------------------------------------
int __fastcall AppleUSBOHCI::UIMCreateBulkTransfer(AppleUSBOHCI *this, IOUSBCommand *a2)
{
  char v2; // bl@1
  __int64 v3; // r15@1
  signed int v4; // er12@1
  __int16 v5; // bx@5
  int v6; // ecx@5
  __int64 v7; // rbx@5
  int result; // eax@6
  int v9; // er15@9
  int v10; // ST1C_4@9
  int (__fastcall *v11)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD); // ST20_8@9
  unsigned int v12; // eax@9
  __int64 v13; // [sp+28h] [bp-48h]@8
  char v14; // [sp+30h] [bp-40h]@1

  IOUSBCommand::GetUSLCompletion((IOUSBCommand *)&v14);
  v2 = IOUSBCommand::GetDirection(a2);
  v3 = IOUSBCommand::GetBuffer(a2);
  v4 = 1;
  if ( v2 )
  {
    if ( v2 == 1 )
      v4 = 2;
    else
      v4 = 0;
  }
  v5 = IOUSBCommand::GetAddress(a2);
  v6 = ((unsigned __int8)IOUSBCommand::GetEndpoint(a2) << 7) | (v4 << 11) | v5;
  v7 = *((_QWORD *)this + 346);
  while ( 1 )
  {
    v7 = *(_QWORD *)(v7 + 8);
    result = -536854441;
    if ( v7 == *((_QWORD *)this + 348) )
      break;
    if ( (**(_DWORD **)v7 & 0x1FFF) == v6 )
    {
      v13 = v3;
      if ( v7 )
      {
        v9 = (unsigned __int8)IOUSBCommand::GetBufferRounding(a2) << 18;
        v10 = 2 * (*((_DWORD *)this + 727) != 0) + 4;
        v11 = *(int (__fastcall **)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)this + 3416LL);
        v12 = IOUSBCommand::GetReqCount(a2);
        result = v11(this, v7, a2, v13, v12, v9 | (unsigned int)(v4 << 19));
      }
      return result;
    }
  }
  return result;
}

//----- (0000000000006AA0) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::FindBulkEndpoint(__int64 a1, int a2, int a3, int a4, __int64 a5)
{
  int v5; // edx@1
  __int64 v6; // rcx@1
  __int64 result; // rax@1
  __int64 v8; // r10@2

  v5 = (a4 << 11) | a2 | (a3 << 7);
  v6 = *(_QWORD *)(a1 + 2768);
  result = 0LL;
  while ( 1 )
  {
    v8 = v6;
    v6 = *(_QWORD *)(v6 + 8);
    if ( v6 == *(_QWORD *)(a1 + 2784) )
      break;
    if ( (**(_DWORD **)v6 & 0x1FFF) == v5 )
    {
      *(_QWORD *)a5 = v8;
      return v6;
    }
  }
  return result;
}

//----- (0000000000006AE2) ----------------------------------------------------
int __usercall AppleUSBOHCI::UIMCreateInterruptEndpoint@<eax>(AppleUSBOHCI *this@<rdi>, __int16 a2, unsigned __int16 a3, int a4)
{
  return (*(int (**)(void))(*(_QWORD *)this + 2192LL))();
}

//----- (0000000000006AF4) ----------------------------------------------------
int __fastcall AppleUSBOHCI::UIMCreateInterruptEndpoint(AppleUSBOHCI *this, int a2, __int16 a3, unsigned __int16 a4, __int16 a5, unsigned __int16 a6, __int16 a7)
{
  unsigned __int16 v7; // r13@1
  unsigned __int8 v8; // r12@1
  int result; // eax@2
  char v10; // al@6
  unsigned int v11; // er15@10
  __int64 v12; // rax@10
  __int64 v13; // rdx@10
  int v14; // ecx@10
  unsigned int v15; // esi@13
  char v16; // cl@15
  signed __int64 v17; // r14@16
  AppleUSBOHCIedMemoryBlock *v18; // rcx@16
  int v19; // [sp+14h] [bp-4Ch]@10
  unsigned __int16 v20; // [sp+18h] [bp-48h]@6
  unsigned __int8 v21; // [sp+1Ch] [bp-44h]@10
  __int16 v22; // [sp+24h] [bp-3Ch]@6
  int v23; // [sp+28h] [bp-38h]@11
  int v24; // [sp+28h] [bp-38h]@13
  int v25; // [sp+2Ch] [bp-34h]@15
  char v26; // [sp+30h] [bp-30h]@10

  v7 = a4;
  v8 = a2;
  if ( *((_WORD *)this + 1452) == a2 )
  {
    result = -536870206;
    if ( a3 == 1 && a5 == 1 && (unsigned __int8)a4 == 1 )
      result = (*(int (__fastcall **)(AppleUSBOHCI *, _QWORD))(*(_QWORD *)this + 3176LL))(this, (unsigned int)a7);
  }
  else
  {
    v20 = a6;
    v22 = a5;
    v10 = 1;
    if ( (_BYTE)a4 )
    {
      if ( (unsigned __int8)a4 == 1 )
        v10 = 2;
      else
        v10 = 0;
    }
    v11 = a3;
    v21 = a3;
    v19 = (unsigned __int8)v10;
    v12 = AppleUSBOHCI::FindInterruptEndpoint(
            (__int64)this,
            (signed __int16)a2,
            a3,
            (unsigned __int8)v10,
            (__int64)&v26);
    v14 = 0;
    if ( v12 )
    {
      v23 = *(_DWORD *)(*(_QWORD *)v12 + 8LL);
      result = (*(int (__fastcall **)(AppleUSBOHCI *, _QWORD, _QWORD, _QWORD))(*(_QWORD *)this + 2232LL))(
                 this,
                 (unsigned int)(signed __int16)a2,
                 v11,
                 v7);
      if ( result )
        return result;
      v14 = v23 & 2;
    }
    v24 = v14;
    LOBYTE(v13) = a7 > 7;
    v15 = 7;
    if ( !((*((_DWORD *)this + 727) != 0 && v22 == 1) & (unsigned __int8)v13) )
      v15 = a7;
    v16 = AppleUSBOHCI::DetermineInterruptOffset(this, v15, v13, &v25);
    result = -536870164;
    if ( v16 )
    {
      v17 = 32LL * v25;
      v18 = AppleUSBOHCI::AddEmptyEndPoint(
              (uintptr_t)this,
              v8,
              v21,
              v20,
              (unsigned __int8)v22,
              v19,
              *(_QWORD *)((char *)this + v17 + 736),
              0);
      result = -1;
      if ( v18 )
      {
        *(_DWORD *)((char *)this + v17 + 760) += v20;
        *(_DWORD *)(*(_QWORD *)v18 + 8LL) |= v24;
        result = 0;
      }
    }
  }
  return result;
}

//----- (0000000000006C98) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::FindInterruptEndpoint(__int64 a1, int a2, int a3, int a4, __int64 a5)
{
  int v5; // edx@1
  __int64 v6; // r9@1
  __int64 v7; // rcx@2
  __int64 result; // rax@4

  v5 = (a4 << 11) | a2 | (a3 << 7);
  v6 = 0LL;
  do
  {
    v7 = *(_QWORD *)(a1 + 32 * v6 + 736);
    while ( 1 )
    {
      *(_QWORD *)a5 = v7;
      v7 = *(_QWORD *)(v7 + 8);
      if ( v7 == *(_QWORD *)(a1 + 32 * v6 + 744) )
        break;
      result = 0LL;
      if ( v7 )
      {
        result = v7;
        if ( (**(_DWORD **)v7 & 0x1FFF) != v5 )
          continue;
      }
      return result;
    }
    ++v6;
    result = 0LL;
  }
  while ( (signed int)v6 < 63 );
  return result;
}

//----- (0000000000006CFE) ----------------------------------------------------
char __fastcall AppleUSBOHCI::DetermineInterruptOffset(AppleUSBOHCI *this, unsigned int a2, __int64 a3, int *a4)
{
  int v4; // eax@1
  char v5; // bl@4
  int v6; // eax@6

  v4 = *(_DWORD *)(*((_QWORD *)this + 89) + 60LL);
  if ( a2 )
  {
    if ( a2 > 1 )
    {
      if ( a2 > 3 )
      {
        if ( a2 > 7 )
        {
          if ( a2 > 0xF )
          {
            if ( a2 > 0x1F )
              v6 = v4 & 0x1F;
            else
              v6 = v4 & 0xF | 0x20;
          }
          else
          {
            v6 = v4 & 7 | 0x30;
          }
        }
        else
        {
          v6 = v4 & 3 | 0x38;
        }
      }
      else
      {
        v6 = v4 & 1 | 0x3C;
      }
      *a4 = v6;
    }
    else
    {
      *a4 = 62;
    }
    v5 = 1;
  }
  else
  {
    v5 = 0;
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "AppleUSBOHCI::DetermineInterruptOffset pollingRate of 0 -- that's illegal!");
  }
  return v5;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000006D80) ----------------------------------------------------
signed __int64 AppleUSBOHCI::UIMCreateInterruptTransfer()
{
  return 3758097087LL;
}

//----- (0000000000006D8C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMCreateInterruptTransfer(AppleUSBOHCI *this, IOUSBCommand *a2)
{
  __int64 v2; // r12@1
  char v3; // r14@1
  int v4; // ebx@1
  __int64 v5; // rbx@2
  __int64 v6; // rax@3
  int (__fastcall *v7)(_QWORD, _QWORD, _QWORD); // rbx@6
  unsigned int v8; // eax@6
  int v9; // eax@6
  unsigned int v10; // eax@10
  signed int v11; // er14@10
  __int16 v12; // bx@12
  unsigned __int8 v13; // al@12
  __int64 v14; // r13@12
  int v15; // ebx@14
  int (__fastcall *v16)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD); // ST20_8@14
  unsigned int v17; // eax@14
  __int64 v19; // [sp+28h] [bp-88h]@7
  __int64 v20; // [sp+68h] [bp-48h]@1
  char v21; // [sp+80h] [bp-30h]@12

  IOUSBCommand::GetUSLCompletion((IOUSBCommand *)&v20);
  v2 = IOUSBCommand::GetBuffer(a2);
  v3 = IOUSBCommand::GetDirection(a2);
  v4 = *((_WORD *)this + 1452);
  if ( v4 == (unsigned __int16)IOUSBCommand::GetAddress(a2) )
  {
    v5 = *(_QWORD *)(*((_QWORD *)a2 + 27) + 48LL);
    if ( v5 )
    {
      LODWORD(v6) = (*(int (__fastcall **)(__int64))(*(_QWORD *)v5 + 312LL))(v5);
      if ( v6 )
        (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v5 + 304LL))(v5, 1LL);
    }
    if ( (unsigned __int8)IOUSBCommand::GetEndpoint(a2) == 1 )
    {
      v7 = *(int (__fastcall **)(_QWORD, _QWORD, _QWORD))(*(_QWORD *)this + 2992LL);
      v8 = IOUSBCommand::GetReqCount(a2);
      v9 = v7(this, v2, v8);
LABEL_15:
      v11 = v9;
      return (unsigned int)v11;
    }
    v10 = IOUSBCommand::GetReqCount(a2);
    v11 = -536854441;
    IOUSBController::Complete(this, 3758112855LL, v10);
  }
  else
  {
    v19 = v2;
    LOWORD(v2) = 1;
    if ( v3 )
    {
      if ( v3 == 1 )
        LOWORD(v2) = 2;
      else
        LODWORD(v2) = 0;
    }
    v12 = IOUSBCommand::GetAddress(a2);
    v13 = IOUSBCommand::GetEndpoint(a2);
    v14 = AppleUSBOHCI::FindInterruptEndpoint((__int64)this, v12, v13, (signed __int16)v2, (__int64)&v21);
    v11 = -536854441;
    if ( v14 )
    {
      v11 = -536870164;
      if ( **(_DWORD **)v14 & 0x7FF0000 )
      {
        v15 = (unsigned __int8)IOUSBCommand::GetBufferRounding(a2) << 18;
        v16 = *(int (__fastcall **)(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD))(*(_QWORD *)this + 3416LL);
        v17 = IOUSBCommand::GetReqCount(a2);
        v9 = v16(this, v14, a2, v19, v17, (unsigned int)v15 | ((_DWORD)v2 << 19));
        goto LABEL_15;
      }
    }
  }
  return (unsigned int)v11;
}
// 1B510: using guessed type int __fastcall IOUSBController::Complete(_QWORD, _QWORD, _QWORD);

//----- (0000000000006FB0) ----------------------------------------------------
int __usercall AppleUSBOHCI::UIMCreateIsochEndpoint@<eax>(AppleUSBOHCI *this@<rdi>, int a2)
{
  return (*(int (**)(void))(*(_QWORD *)this + 2208LL))();
}

//----- (0000000000006FC2) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMCreateIsochEndpoint(AppleUSBOHCI *this, __int16 a2, __int16 a3, unsigned int a4, char a5)
{
  unsigned int v5; // er14@1
  AppleUSBOHCI *v6; // r15@1
  char v7; // al@1
  int v8; // er9@5
  int v9; // eax@5
  __int64 v10; // rcx@5
  int v11; // edx@9
  __int64 result; // rax@9
  int v13; // edi@9
  bool v14; // cf@9
  int v15; // edi@9
  int v16; // edi@11
  unsigned int v17; // esi@11
  int v18; // esi@11
  unsigned int v19; // ecx@13
  int v20; // ecx@13
  AppleUSBOHCIedMemoryBlock *v21; // rcx@14

  v5 = a4;
  v6 = this;
  v7 = 1;
  if ( a5 )
  {
    if ( a5 == 1 )
      v7 = 2;
    else
      v7 = 0;
  }
  v8 = (unsigned __int8)v7;
  v9 = ((unsigned __int8)v7 << 11) | (a3 << 7) | a2;
  v10 = *((_QWORD *)this + 344);
  do
  {
    v10 = *(_QWORD *)(v10 + 8);
    if ( v10 == *((_QWORD *)this + 345) )
      goto LABEL_13;
  }
  while ( (**(_DWORD **)v10 & 0x1FFF) != v9 );
  if ( !v10 )
  {
LABEL_13:
    v19 = *((_DWORD *)this + 728);
    result = 3758097132LL;
    v14 = v19 < v5;
    v20 = v19 - v5;
    if ( !v14 )
    {
      *((_DWORD *)this + 728) = v20;
      v21 = AppleUSBOHCI::AddEmptyEndPoint(
              (uintptr_t)this,
              (unsigned __int8)a2,
              (unsigned __int8)a3,
              (unsigned __int16)v5,
              1,
              v8,
              *((_QWORD *)this + 344),
              1u);
      result = 0LL;
      if ( !v21 )
      {
        *((_DWORD *)this + 728) += v5;
        result = 3758097085LL;
      }
    }
    return result;
  }
  v11 = **(_DWORD **)v10;
  result = 0LL;
  v13 = (**(_DWORD **)v10 >> 16) & 0x7FF;
  v14 = v13 < v5;
  v15 = v13 - v5;
  if ( !v15 )
    return result;
  if ( v14 )
  {
    v16 = v5 - ((**(_DWORD **)v10 >> 16) & 0x7FF);
    v17 = *((_DWORD *)v6 + 728);
    result = 3758097132LL;
    v14 = v17 < v16;
    v18 = v17 - v16;
    if ( v14 )
      return result;
    *((_DWORD *)v6 + 728) = v18;
  }
  else
  {
    *((_DWORD *)v6 + 728) += v15;
  }
  **(_DWORD **)v10 = v11 & 0xF800FFFF | (v5 << 16);
  return 0LL;
}

//----- (00000000000070F0) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::FindIsochronousEndpoint(__int64 a1, int a2, int a3, int a4, __int64 a5)
{
  int v5; // edx@1
  __int64 v6; // rcx@1
  __int64 result; // rax@1
  __int64 v8; // r10@2

  v5 = (a4 << 11) | a2 | (a3 << 7);
  v6 = *(_QWORD *)(a1 + 2752);
  result = 0LL;
  while ( 1 )
  {
    v8 = v6;
    v6 = *(_QWORD *)(v6 + 8);
    if ( v6 == *(_QWORD *)(a1 + 2760) )
      break;
    if ( (**(_DWORD **)v6 & 0x1FFF) == v5 )
    {
      if ( a5 )
        *(_QWORD *)a5 = v8;
      return v6;
    }
  }
  return result;
}

//----- (0000000000007136) ----------------------------------------------------
signed __int64 AppleUSBOHCI::UIMCreateIsochTransfer()
{
  KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCI::UIMCreateIsochTransfer - old method");
  return 3758097087LL;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (000000000000715A) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMAbortEndpoint(AppleUSBOHCI *this, int a2, unsigned __int16 a3, __int16 a4)
{
  __int16 v5; // ax@4
  signed int v6; // er14@7
  __int64 v7; // rax@11
  __int64 v8; // rbx@11
  char v9; // [sp+Ch] [bp-24h]@11
  char v10; // [sp+10h] [bp-20h]@11

  if ( a2 == *((_WORD *)this + 1452) )
  {
    if ( a3 < 2u )
      return AppleUSBOHCI::SimulateEDAbort(this, a3, a4);
    v6 = -536870206;
    if ( *(_BYTE *)off_B058[0] & 2 )
    {
      if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D380Cu, (uintptr_t)this, (signed __int16)a2, (signed __int16)a3, 0xFFFFFFFFE00002C2LL, 0LL);
    }
  }
  else
  {
    v5 = 1;
    if ( a4 )
    {
      if ( a4 == 1 )
        v5 = 2;
      else
        v5 = 0;
    }
    v7 = AppleUSBOHCI::FindEndpoint((__int64)this, a2, (signed __int16)a3, v5, (__int64)&v10, (__int64)&v9);
    v8 = v7;
    v6 = -536854441;
    if ( v7 )
    {
      **(_DWORD **)v7 |= 0x4000u;
      IOSleep(2LL);
      if ( *((_BYTE *)this + 3012) & 2 )
      {
        *((_DWORD *)this + 753) = 0;
        AppleUSBOHCI::UIMProcessDoneQueue(this, 0LL);
      }
      v6 = 0;
      AppleUSBOHCI::RemoveTDs((uintptr_t)this, v8, 0);
      **(_DWORD **)v8 &= 0xFFFFBFFF;
      _mm_mfence();
    }
  }
  return (unsigned int)v6;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);

//----- (000000000000727C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::FindEndpoint(__int64 a1, __int16 a2, int a3, __int16 a4, __int64 a5, __int64 a6)
{
  __int64 v6; // rbx@1
  __int64 v7; // r14@1
  __int16 v8; // r13@1
  __int64 v9; // r15@1
  __int64 result; // rax@1
  int v11; // er14@3
  __int64 v12; // rdi@4
  signed int v13; // edx@7
  __int64 v14; // rcx@13
  __int64 v15; // [sp+8h] [bp-48h]@3
  __int16 v16; // [sp+1Ch] [bp-34h]@1
  __int64 v17; // [sp+20h] [bp-30h]@1

  v6 = a6;
  v7 = a5;
  v16 = a4;
  v8 = a3;
  v9 = a1;
  result = AppleUSBOHCI::FindControlEndpoint(a1, a2, a3, (__int64)&v17);
  if ( result )
  {
    *(_QWORD *)v7 = v17;
    *(_DWORD *)v6 = 16;
  }
  else
  {
    v15 = v7;
    v11 = (v16 << 11) | a2 | (v8 << 7);
    result = *(_QWORD *)(a1 + 2768);
    while ( 1 )
    {
      v12 = result;
      result = *(_QWORD *)(result + 8);
      if ( result == *(_QWORD *)(v9 + 2784) )
        break;
      if ( (**(_DWORD **)result & 0x1FFF) == v11 )
      {
        v17 = v12;
        if ( result )
        {
          *(_QWORD *)v15 = v12;
          *(_DWORD *)v6 = 32;
          v13 = 16;
          if ( !*(_DWORD *)(v9 + 2908) )
            v13 = 32;
          *(_DWORD *)v6 = v13;
          return result;
        }
        break;
      }
    }
    result = AppleUSBOHCI::FindInterruptEndpoint(v9, a2, v8, v16, (__int64)&v17);
    if ( result )
    {
      *(_QWORD *)v15 = v17;
      *(_DWORD *)v6 = 0;
    }
    else
    {
      result = *(_QWORD *)(v9 + 2752);
      while ( 1 )
      {
        v14 = result;
        result = *(_QWORD *)(result + 8);
        if ( result == *(_QWORD *)(v9 + 2760) )
          break;
        if ( (**(_DWORD **)result & 0x1FFF) == v11 )
        {
          v17 = v14;
          goto LABEL_17;
        }
      }
      v14 = v17;
      result = 0LL;
LABEL_17:
      *(_QWORD *)v15 = v14;
      *(_DWORD *)v6 = 0;
    }
  }
  return result;
}

//----- (00000000000073C0) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMDeleteEndpoint(AppleUSBOHCI *this, int a2, unsigned __int16 a3, __int16 a4)
{
  __int16 v5; // ax@4
  signed int v6; // er15@7
  __int64 v7; // rax@11
  __int64 v8; // r12@11
  __int64 v9; // rax@12
  int v10; // ebx@12
  int v11; // ecx@14
  int v12; // [sp+4h] [bp-2Ch]@11
  __int64 v13; // [sp+8h] [bp-28h]@11

  if ( a2 == *((_WORD *)this + 1452) )
  {
    if ( a3 < 2u )
      return AppleUSBOHCI::SimulateEDDelete(this, a3, a4);
    v6 = -536870206;
    if ( *(_BYTE *)off_B058[0] & 2 )
    {
      if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D3810u, (uintptr_t)this, (signed __int16)a2, (signed __int16)a3, 0xFFFFFFFFE00002C2LL, 0LL);
    }
  }
  else
  {
    v5 = 1;
    if ( a4 )
    {
      if ( a4 == 1 )
        v5 = 2;
      else
        v5 = 0;
    }
    v7 = AppleUSBOHCI::FindEndpoint((__int64)this, a2, (signed __int16)a3, v5, (__int64)&v13, (__int64)&v12);
    v8 = v7;
    v6 = -536854441;
    if ( v7 )
    {
      **(_DWORD **)v7 |= 0x4000u;
      *(_DWORD *)(*(_QWORD *)v13 + 12LL) = *(_DWORD *)(*(_QWORD *)v7 + 12LL);
      *(_QWORD *)(v13 + 8) = *(_QWORD *)(v7 + 8);
      v9 = *((_QWORD *)this + 89);
      v10 = (unsigned __int16)*(_DWORD *)(v9 + 4) & (unsigned __int16)~(_WORD)v12 & 0x7FF;
      *(_DWORD *)(v9 + 4) = v10;
      IOSleep(2LL);
      if ( *((_BYTE *)this + 3012) & 2 )
      {
        *((_DWORD *)this + 753) = 0;
        AppleUSBOHCI::UIMProcessDoneQueue(this, 0LL);
      }
      *(_DWORD *)(*((_QWORD *)this + 89) + 4LL) = v12 | v10;
      v11 = **(_DWORD **)v8;
      if ( BYTE1(v11) & 0x80 )
        *((_DWORD *)this + 728) += (**(_DWORD **)v8 >> 16) & 0x7FF;
      AppleUSBOHCI::RemoveAllTDs((uintptr_t)this, v8);
      *(_DWORD *)(*(_QWORD *)v8 + 12LL) = 0;
      AppleUSBOHCI::DeallocateED((__int64)this, v8);
      v6 = 0;
    }
  }
  return (unsigned int)v6;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);

//----- (000000000000755A) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMClearEndpointStall(uintptr_t arg1, int a2, unsigned __int16 a3, __int16 a4)
{
  __int16 v5; // ax@4
  signed int v6; // er14@7
  __int64 v7; // rax@11
  unsigned int v8; // edx@11
  __int64 v9; // rbx@11
  unsigned int v10; // er12@13
  __int64 v11; // rax@13
  char v12; // [sp+4h] [bp-2Ch]@11
  char v13; // [sp+8h] [bp-28h]@11

  if ( *(_WORD *)(arg1 + 2904) == a2 )
  {
    if ( a3 < 2u )
      return AppleUSBOHCI::SimulateEDClearStall((AppleUSBOHCI *)arg1);
    v6 = -536870206;
    if ( *(_BYTE *)off_B058[0] & 2 )
    {
      if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D3814u, arg1, (signed __int16)a2, (signed __int16)a3, 0xFFFFFFFFE00002C2LL, 0LL);
    }
  }
  else
  {
    v5 = 1;
    if ( a4 )
    {
      if ( a4 == 1 )
        v5 = 2;
      else
        v5 = 0;
    }
    v7 = AppleUSBOHCI::FindEndpoint(arg1, a2, (signed __int16)a3, v5, (__int64)&v13, (__int64)&v12);
    v9 = v7;
    v6 = -536854441;
    if ( v7 )
    {
      v6 = -536854456;
      if ( !*(_BYTE *)(v7 + 40) )
      {
        *(_BYTE *)(v7 + 40) = 1;
        v10 = *(_DWORD *)(*(_QWORD *)v7 + 4LL);
        v6 = 0;
        v11 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(
                (AppleUSBOHCIgtdMemoryBlock *)(*(_DWORD *)(*(_QWORD *)v7 + 8LL) & 0xFFFFFFF0),
                0,
                v8);
        *(_DWORD *)(*(_QWORD *)v9 + 8LL) = *(_DWORD *)(*(_QWORD *)v9 + 4LL);
        *(_QWORD *)(v9 + 32) = *(_QWORD *)(v9 + 24);
        if ( v11 )
          AppleUSBOHCI::ReturnTransactions(arg1, v11, v10);
        *(_BYTE *)(v9 + 40) = 0;
      }
    }
  }
  return (unsigned int)v6;
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];

//----- (0000000000007684) ----------------------------------------------------
void __fastcall AppleUSBOHCI::printTD(uintptr_t arg1, uintptr_t arg2)
{
  uintptr_t *v2; // rax@2
  uintptr_t v3; // rcx@2
  __int64 v4; // r15@2
  int v5; // eax@14

  if ( arg2 )
  {
    v2 = *(uintptr_t **)(arg2 + 24);
    v3 = *(_DWORD *)v2;
    v4 = off_B058[0];
    if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      kernel_debug(0x52D4010u, arg1, arg2, *(_QWORD *)(arg2 + 48), *(_DWORD *)v2, 0LL);
    if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      kernel_debug(0x52D4024u, arg1, *(_QWORD *)(arg2 + 48), ***(_DWORD ***)(arg2 + 48), 0LL, 0LL);
    if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      kernel_debug(
        0x52D4014u,
        arg1,
        *(_DWORD *)(*(_QWORD *)(arg2 + 24) + 4LL),
        *(_DWORD *)(*(_QWORD *)(arg2 + 24) + 8LL),
        *(_DWORD *)(*(_QWORD *)(arg2 + 24) + 8LL),
        0LL);
    if ( *(_BYTE *)v4 & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      kernel_debug(
        0x52D4018u,
        arg1,
        *(_DWORD *)(*(_QWORD *)(arg2 + 24) + 12LL),
        *(_WORD *)arg2,
        *(_WORD *)(arg2 + 2),
        0LL);
    v5 = *(_DWORD *)v4;
    if ( *(_DWORD *)v4 & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    {
      kernel_debug(0x52D401Cu, arg1, *(_DWORD *)(arg2 + 8), *(_QWORD *)(arg2 + 16), *(_DWORD *)(arg2 + 40), 0LL);
      v5 = *(_DWORD *)v4;
    }
    if ( v5 & 2 )
    {
      if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D4020u, arg1, *(_DWORD *)(arg2 + 44), *(_DWORD *)(arg2 + 56), 0LL, 0LL);
    }
  }
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];

//----- (00000000000077E6) ----------------------------------------------------
void __fastcall AppleUSBOHCI::printED(uintptr_t arg1, uintptr_t arg2)
{
  __int64 v2; // rcx@2
  __int64 v3; // r15@2

  if ( arg2 )
  {
    v2 = **(_DWORD **)arg2;
    v3 = off_B058[0];
    if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      kernel_debug(0x52D4004u, arg1, arg2, **(_DWORD **)arg2, *(_DWORD *)(*(_QWORD *)arg2 + 4LL), 0LL);
    if ( *(_BYTE *)v3 & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
      kernel_debug(
        0x52D4008u,
        arg1,
        *(_DWORD *)(*(_QWORD *)arg2 + 8LL),
        *(_DWORD *)(*(_QWORD *)arg2 + 12LL),
        *(_DWORD *)(arg2 + 16),
        0LL);
    if ( *(_BYTE *)v3 & 2 )
    {
      if ( *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
        kernel_debug(0x52D400Cu, arg1, *(_QWORD *)(arg2 + 8), *(_QWORD *)(arg2 + 24), *(_QWORD *)(arg2 + 32), 0LL);
    }
  }
}
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];

//----- (00000000000078B2) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::print_td(__int64 a1, __int64 a2)
{
  __int64 result; // rax@2

  if ( a2 )
    result = **(_DWORD **)(a2 + 24);
  return result;
}

//----- (00000000000078C4) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::print_itd(__int64 a1, __int64 a2)
{
  __int64 result; // rax@2

  if ( a2 )
    result = **(_DWORD **)(a2 + 24);
  return result;
}

//----- (00000000000078D6) ----------------------------------------------------
void __fastcall AppleUSBOHCI::print_ed(uintptr_t arg1, __int64 a2, unsigned int a3)
{
  int v3; // ecx@2
  __int64 i; // rbx@3

  if ( a2 )
  {
    v3 = **(_DWORD **)a2;
    if ( !(BYTE1(v3) & 0x40) )
    {
      for ( i = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(
                  (AppleUSBOHCIgtdMemoryBlock *)(*(_DWORD *)(*(_QWORD *)a2 + 8LL) & 0xFFFFFFF0),
                  0,
                  a3); i; i = *(_QWORD *)(i + 16) )
        AppleUSBOHCI::printTD(arg1, i);
    }
  }
}

//----- (000000000000791A) ----------------------------------------------------
int __fastcall AppleUSBOHCI::print_isoc_ed(__int64 a1, __int64 a2)
{
  __int64 i; // rax@2
  __int64 v3; // rcx@4

  if ( a2 )
  {
    LODWORD(i) = **(_DWORD **)a2;
    if ( !(BYTE1(i) & 0x40) )
    {
      for ( i = *(_QWORD *)(a2 + 32); i; i = *(_QWORD *)(i + 16) )
        v3 = **(_DWORD **)(i + 24);
    }
  }
  else
  {
    LODWORD(i) = kprintf("Null ED\n");
  }
  return i;
}
// 1BF78: using guessed type int __fastcall kprintf(_QWORD);

//----- (0000000000007954) ----------------------------------------------------
void __fastcall AppleUSBOHCI::print_list(uintptr_t arg1, uintptr_t arg2, uintptr_t a3, __int64 a4, char a5, char a6)
{
  char v6; // r12@1
  uintptr_t v7; // r14@1
  uintptr_t i; // rbx@1
  int v9; // eax@3
  char v10; // al@3
  __int64 v11; // rax@7
  __int64 v12; // r15@7
  uintptr_t v13; // rsi@10
  char v14; // [sp+0h] [bp-2Ch]@1

  v14 = a6;
  v6 = a5;
  v7 = a3;
  for ( i = arg2; ; i = *(_QWORD *)(i + 8) )
  {
    v9 = **(_DWORD **)i;
    v10 = v6 | ((BYTE1(v9) & 0x40) == 0);
    if ( i == v7 )
      break;
    if ( v10 & 1 )
      AppleUSBOHCI::printED(arg1, i);
    if ( v14 )
    {
      v11 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(
              (AppleUSBOHCIgtdMemoryBlock *)(*(_DWORD *)(*(_QWORD *)i + 8LL) & 0xFFFFFFF0),
              0,
              a3);
      v12 = v11;
      if ( v11 )
      {
        if ( v11 != *(_QWORD *)(i + 24) )
        {
          AppleUSBOHCI::printTD(arg1, v11);
          do
          {
            v13 = *(_QWORD *)(v12 + 16);
            if ( !v13 )
              break;
            AppleUSBOHCI::printTD(arg1, v13);
            v12 = *(_QWORD *)(v12 + 16);
          }
          while ( v12 );
        }
      }
    }
  }
  if ( v10 )
    AppleUSBOHCI::printED(arg1, v7);
}

//----- (0000000000007A12) ----------------------------------------------------
void __fastcall AppleUSBOHCI::print_control_list(AppleUSBOHCI *this, __int64 a2, char a3, __int64 a4)
{
  AppleUSBOHCI::print_list((uintptr_t)this, *((_QWORD *)this + 347), *((_QWORD *)this + 349), a4, a3, a4);
}

//----- (0000000000007A36) ----------------------------------------------------
void __fastcall AppleUSBOHCI::print_bulk_list(AppleUSBOHCI *this, __int64 a2, char a3, __int64 a4)
{
  AppleUSBOHCI::print_list((uintptr_t)this, *((_QWORD *)this + 346), *((_QWORD *)this + 348), a4, a3, a4);
}

//----- (0000000000007A5A) ----------------------------------------------------
void __fastcall AppleUSBOHCI::print_int_list(uintptr_t arg1, __int64 a2, char a3, char a4)
{
  char v4; // r15@1
  __int64 v5; // r14@1
  __int64 v6; // r13@2
  __int64 v7; // rcx@2
  int v8; // eax@2
  unsigned int v9; // edx@4
  __int64 v10; // rax@5
  __int64 v11; // rbx@5
  uintptr_t v12; // rsi@8
  char v13; // [sp+0h] [bp-2Ch]@1

  v13 = a4;
  v4 = a3;
  v5 = 0LL;
  do
  {
    v6 = *(_QWORD *)(*(_QWORD *)(arg1 + 32 * v5 + 736) + 8LL);
    v7 = **(_DWORD **)v6;
    v8 = **(_DWORD **)v6;
    if ( !(BYTE1(v8) & 0x40) || v4 )
    {
      AppleUSBOHCI::printED(arg1, *(_QWORD *)(*(_QWORD *)(arg1 + 32 * v5 + 736) + 8LL));
      if ( v13 )
      {
        v10 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(
                (AppleUSBOHCIgtdMemoryBlock *)(*(_DWORD *)(*(_QWORD *)v6 + 8LL) & 0xFFFFFFF0),
                0,
                v9);
        v11 = v10;
        if ( v10 )
        {
          if ( v10 != *(_QWORD *)(v6 + 24) )
          {
            AppleUSBOHCI::printTD(arg1, v10);
            do
            {
              v12 = *(_QWORD *)(v11 + 16);
              if ( !v12 )
                break;
              AppleUSBOHCI::printTD(arg1, v12);
              v11 = *(_QWORD *)(v11 + 16);
            }
            while ( v11 );
          }
        }
      }
    }
    ++v5;
  }
  while ( v5 != 64 );
}

//----- (0000000000007B0C) ----------------------------------------------------
int __fastcall AppleUSBOHCI::CheckEDListForTimeouts(__int64 a1, __int64 a2, __int64 a3)
{
  __int64 v3; // r12@1
  __int64 v4; // rbx@1
  __int64 v5; // rax@1
  unsigned int v6; // edx@1
  __int64 v7; // r13@5
  IOUSBCommand *v8; // rdi@7
  unsigned int v9; // er14@8
  unsigned int v10; // er15@8
  __int64 v11; // r14@15
  __int64 v12; // rcx@15
  __int64 v13; // r8@15
  __int64 v14; // rdx@15
  __int64 v15; // rcx@17
  __int64 v16; // r8@17
  __int64 v18; // [sp+8h] [bp-38h]@1
  unsigned int v19; // [sp+14h] [bp-2Ch]@1

  v3 = a3;
  v4 = a2;
  v18 = a1;
  LODWORD(v5) = (*(int (**)(void))(*(_QWORD *)a1 + 2464LL))();
  v19 = v5;
  if ( (_DWORD)v5 )
  {
    while ( 1 )
    {
      while ( 1 )
      {
        v4 = *(_QWORD *)(v4 + 8);
        if ( v4 == v3 )
          return v5;
        v5 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(
               (AppleUSBOHCIgtdMemoryBlock *)(*(_DWORD *)(*(_QWORD *)v4 + 8LL) & 0xFFFFFFF0),
               0,
               v6);
        v7 = v5;
        if ( v5 )
        {
          if ( v5 != *(_QWORD *)(v4 + 24) )
          {
            v8 = *(IOUSBCommand **)(v5 + 32);
            if ( v8 )
              break;
          }
        }
      }
      v9 = IOUSBCommand::GetNoDataTimeout(v8);
      LODWORD(v5) = IOUSBCommand::GetCompletionTimeout(*(IOUSBCommand **)(v7 + 32));
      v10 = v5;
      if ( !(_DWORD)v5 )
        goto LABEL_11;
      LODWORD(v5) = IOUSBCommand::GetUIMScratch(*(IOUSBCommand **)(v7 + 32), 0);
      if ( (_DWORD)v5 )
      {
        if ( v19 - (unsigned int)v5 >= v10 )
        {
          v11 = v18;
          v15 = *(_DWORD *)(*(_QWORD *)(v18 + 168) + 28LL);
          v16 = **(_DWORD **)v4 & 0x7F;
          v14 = (__int64)"AppleUSBOHCI::Found a transaction past the completion deadline on bus 0x%x, timing out! (Addr: %d, EP: %d)";
LABEL_18:
          KernelDebugLogInternal(1LL, 1431519814LL, v14);
          LODWORD(v5) = AppleUSBOHCI::ReturnOneTransaction(v11, v7, v4, 0xE0004051);
        }
        else
        {
LABEL_11:
          if ( v9 )
          {
            if ( *(_DWORD *)(v7 + 40) - 1 >= v19 )
            {
              *(_DWORD *)(v7 + 40) = v19;
              LODWORD(v5) = AppleUSBOHCI::findBufferRemaining(v18, v7);
LABEL_3:
              *(_DWORD *)(v7 + 44) = v5;
            }
            else
            {
              LODWORD(v5) = AppleUSBOHCI::findBufferRemaining(v18, v7);
              if ( *(_DWORD *)(v7 + 44) != (_DWORD)v5 )
                goto LABEL_3;
              LODWORD(v5) = v19 - *(_DWORD *)(v7 + 40);
              if ( (unsigned int)v5 >= v9 )
              {
                v11 = v18;
                v12 = *(_DWORD *)(*(_QWORD *)(v18 + 168) + 28LL);
                v13 = **(_DWORD **)v4 & 0x7F;
                v14 = (__int64)"AppleUSBOHCI::Found a transaction which hasn't moved in 5 seconds on bus 0x%x, timing out! (Addr: %d, EP: %d)";
                goto LABEL_18;
              }
            }
          }
        }
      }
      else
      {
        LODWORD(v5) = IOUSBCommand::SetUIMScratch(*(IOUSBCommand **)(v7 + 32), 0, v19);
      }
    }
  }
  return v5;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000007CAE) ----------------------------------------------------
int __usercall AppleUSBOHCI::ReturnAllTransactionsInEndpoint@<eax>(__int64 a1@<rax>, __int64 a2@<rdx>, __int64 a3@<rdi>, __int64 a4@<rsi>)
{
  __int64 v4; // r15@1
  __int64 i; // rbx@2

  v4 = a2;
  if ( a4 )
  {
    for ( i = *(_QWORD *)(a4 + 8); i != v4; i = *(_QWORD *)(i + 8) )
    {
      a1 = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(
             (AppleUSBOHCIgtdMemoryBlock *)(*(_DWORD *)(*(_QWORD *)i + 8LL) & 0xFFFFFFF0),
             0,
             a2);
      if ( a1 && a1 != *(_QWORD *)(i + 24) )
      {
        if ( *(_QWORD *)(a1 + 32) )
          LODWORD(a1) = AppleUSBOHCI::ReturnOneTransaction(a3, a1, i, 0xE00002ED);
      }
    }
  }
  return a1;
}

//----- (0000000000007D14) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMCheckForTimeouts(AppleUSBOHCI *this)
{
  AppleUSBOHCI *v1; // rbx@1
  __int64 result; // rax@1
  int v3; // er8@5
  __int64 v4; // rax@7
  int v5; // ST14_4@7
  int v6; // ST10_4@7
  int v7; // er12@7
  int v8; // ST0C_4@7
  int v9; // er14@7
  int v10; // er15@7
  int v11; // er13@7
  signed __int64 v12; // rdi@8
  signed int v13; // ecx@10

  v1 = this;
  result = IOService::isInactive(this);
  if ( !(_BYTE)result )
  {
    if ( *((_BYTE *)this + 444) )
    {
      result = *((_BYTE *)this + 440);
      if ( (_DWORD)result == 2 )
      {
        AppleUSBOHCI::CheckEDListForTimeouts((__int64)this, *((_QWORD *)this + 347), *((_QWORD *)this + 349));
        AppleUSBOHCI::CheckEDListForTimeouts((__int64)this, *((_QWORD *)this + 346), *((_QWORD *)this + 348));
        result = *((_QWORD *)this + 84);
        if ( *(_BYTE *)(result + 208) & 0x40 )
        {
          result = *((_QWORD *)this + 89);
          v3 = *(_DWORD *)(result + 60) & 0xFFFF;
          if ( (unsigned int)v3 >= 6 )
          {
            result = (unsigned int)*(_WORD *)(*((_QWORD *)this + 90) + 128LL) + 5;
            if ( v3 > (unsigned int)result )
            {
              KernelDebugLogInternal(
                1LL,
                1431519814LL,
                "AppleUSBOHCI::UIMCheckForTimeouts  Watchdog detected dead controller (hcca #: %d, hc #: %d)");
              v4 = *((_QWORD *)this + 89);
              v5 = *(_DWORD *)(v4 + 52);
              v6 = *(_DWORD *)(v4 + 24);
              v7 = *(_DWORD *)(v4 + 40);
              v8 = *(_DWORD *)(v4 + 32);
              v9 = *(_DWORD *)(v4 + 64);
              v10 = *(_DWORD *)(v4 + 16);
              v11 = *(_DWORD *)(v4 + 60);
              *(_DWORD *)(v4 + 8) = 1;
              IOSleep(3LL);
              *(_DWORD *)(*((_QWORD *)this + 89) + 60LL) = v11;
              *(_DWORD *)(*((_QWORD *)this + 89) + 16LL) = v10;
              *(_DWORD *)(*((_QWORD *)this + 89) + 64LL) = v9;
              *(_DWORD *)(*((_QWORD *)this + 89) + 40LL) = v7;
              *(_DWORD *)(*((_QWORD *)this + 89) + 32LL) = v8;
              *(_DWORD *)(*((_QWORD *)this + 89) + 24LL) = v6;
              *(_DWORD *)(*((_QWORD *)this + 89) + 52LL) = v5;
              _mm_mfence();
              *(_DWORD *)(*((_QWORD *)this + 89) + 4LL) = 64;
              if ( *(_BYTE *)(*((_QWORD *)this + 84) + 208LL) & 0x20 )
                v12 = 35LL;
              else
                v12 = 20LL;
              IOSleep(v12);
              *(_DWORD *)(*((_QWORD *)v1 + 89) + 4LL) = 128;
              IOSleep(3LL);
              v13 = 188;
              if ( *((_DWORD *)v1 + 727) )
                v13 = 156;
              result = *((_QWORD *)v1 + 89);
              *(_DWORD *)(result + 4) = v13;
            }
          }
        }
      }
    }
  }
  return result;
}
// 1B1E8: using guessed type int __fastcall IOSleep(_QWORD);
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000007EE4) ----------------------------------------------------
signed __int64 AppleUSBOHCI::UIMCreateIsochTransfer()
{
  KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCI::UIMCreateIsochTransfer(LL) - old method");
  return 3758097087LL;
}
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000007F08) ----------------------------------------------------
__int64 __usercall AppleUSBOHCI::UIMCreateIsochTransfer@<rax>(uintptr_t a1@<rdi>, __int64 a2@<rsi>, uintptr_t a3@<r14>)
{
  int v3; // er12@1
  __int64 v4; // rax@1
  __int64 v5; // rcx@1
  __int64 v6; // r13@1
  int v7; // ebx@1
  __int64 v8; // r15@1
  unsigned __int64 v9; // rax@1
  signed int v10; // edx@2
  signed __int16 v11; // cx@4
  __int64 v12; // rbx@6
  __int64 v13; // rax@12
  int v14; // er12@15
  unsigned __int64 v15; // rsi@15
  __int64 v16; // rbx@15
  __int16 v17; // r12@18
  int v18; // eax@19
  signed int v19; // er8@24
  signed __int64 v20; // rdx@26
  __int64 v21; // rdi@26
  signed __int64 v22; // rcx@28
  unsigned __int16 v23; // cx@32
  AppleUSBOHCIitdMemoryBlock *v24; // rax@35
  unsigned __int64 v25; // rsi@35
  uintptr_t v26; // rdx@38
  uintptr_t v27; // rcx@38
  int v28; // eax@38
  signed __int64 v29; // rax@39
  __int64 v30; // r10@39
  __int64 v31; // rdi@39
  __int64 v32; // r8@39
  signed __int64 v33; // rax@44
  unsigned int v34; // eax@46
  __int64 v35; // r12@47
  int v36; // er15@47
  unsigned int v37; // edx@48
  signed int v38; // eax@48
  __int64 *v39; // rax@49
  __int64 v40; // rcx@49
  unsigned __int64 v41; // rsi@50
  __int64 v42; // rdi@51
  __int64 v43; // r15@55
  unsigned __int64 v44; // r15@60
  __int64 v45; // rcx@61
  int v46; // eax@66
  int v47; // er12@80
  int v49; // er8@91
  __int64 v50; // rax@92
  __int64 v51; // rax@94
  __int64 v52; // rsi@94
  __int64 v53; // rbx@95
  unsigned int v54; // [sp+8h] [bp-148h]@39
  int v55; // [sp+10h] [bp-140h]@47
  __int16 v56; // [sp+18h] [bp-138h]@39
  __int64 v57; // [sp+18h] [bp-138h]@47
  bool v58; // [sp+20h] [bp-130h]@39
  uintptr_t v59; // [sp+20h] [bp-130h]@47
  int v60[3]; // [sp+28h] [bp-128h]@39
  unsigned int v61; // [sp+28h] [bp-128h]@47
  unsigned int v62; // [sp+34h] [bp-11Ch]@40
  signed __int64 v63; // [sp+38h] [bp-118h]@40
  signed __int64 v64; // [sp+48h] [bp-108h]@40
  signed __int64 v65; // [sp+50h] [bp-100h]@40
  __int64 v66; // [sp+58h] [bp-F8h]@39
  signed int v67; // [sp+60h] [bp-F0h]@39
  int v68; // [sp+68h] [bp-E8h]@39
  __int64 v69; // [sp+70h] [bp-E0h]@15
  signed __int16 v70; // [sp+7Eh] [bp-D2h]@12
  unsigned __int64 v71; // [sp+80h] [bp-D0h]@4
  int v72; // [sp+80h] [bp-D0h]@39
  uintptr_t arg2; // [sp+88h] [bp-C8h]@1
  __int64 v74; // [sp+90h] [bp-C0h]@1
  char v75; // [sp+9Fh] [bp-B1h]@1
  uintptr_t arg3; // [sp+A0h] [bp-B0h]@1
  unsigned __int64 v77; // [sp+A8h] [bp-A8h]@1
  int v78; // [sp+B0h] [bp-A0h]@1
  unsigned int v79; // [sp+B0h] [bp-A0h]@39
  uintptr_t arg1; // [sp+B8h] [bp-98h]@1
  char v81; // [sp+C7h] [bp-89h]@1
  __int64 v82; // [sp+C8h] [bp-88h]@47
  unsigned int v83; // [sp+D4h] [bp-7Ch]@1
  __int64 v84; // [sp+D8h] [bp-78h]@1
  __int64 v85; // [sp+E0h] [bp-70h]@1
  __int64 v86; // [sp+E8h] [bp-68h]@1
  unsigned __int64 v87; // [sp+F0h] [bp-60h]@37
  int v88; // [sp+F8h] [bp-58h]@62
  unsigned int v89; // [sp+FCh] [bp-54h]@56
  __int64 v90; // [sp+100h] [bp-50h]@47
  __int64 v91; // [sp+108h] [bp-48h]@49
  __int64 v92; // [sp+120h] [bp-30h]@1

  arg1 = a1;
  v92 = *(_QWORD *)off_B050[0];
  LOBYTE(a3) = *(_BYTE *)(a2 + 39);
  v78 = *(_WORD *)(a2 + 36);
  v3 = *(_BYTE *)(a2 + 38);
  v4 = *(_QWORD *)(a2 + 104);
  v86 = *(_QWORD *)(v4 + 48);
  v5 = *(_QWORD *)(v4 + 32);
  v85 = *(_QWORD *)(v4 + 40);
  v84 = v5;
  v6 = *(_QWORD *)(a2 + 40);
  v77 = *(_QWORD *)(a2 + 72);
  v7 = *(_DWORD *)(a2 + 80);
  arg2 = *(_DWORD *)(a2 + 80);
  v74 = *(_QWORD *)(a2 + 88);
  arg3 = *(_DWORD *)v4;
  v75 = *(_BYTE *)(v4 + 17);
  v81 = *(_BYTE *)(v4 + 56);
  v8 = *(_QWORD *)(v4 + 24);
  LODWORD(v9) = (*(int (**)(void))(*(_QWORD *)a1 + 2456LL))();
  v83 = 0;
  if ( (unsigned int)(v7 - 1) > 0x3E7 )
    goto LABEL_85;
  v10 = -536870199;
  if ( !v9 )
    goto LABEL_86;
  if ( (unsigned __int8)a3 == 1 )
  {
    v71 = v9;
    v11 = 9;
    if ( v81 )
      v11 = 11;
    a3 = 4096LL;
    v12 = v8;
  }
  else
  {
    v12 = v8;
    if ( (_BYTE)a3 )
      goto LABEL_86;
    v71 = v9;
    v11 = 10;
    if ( v81 )
      v11 = 12;
    a3 = 2048LL;
  }
  if ( !v12 )
  {
    KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCI::UIMCreateIsochTransfer no dmaCommand");
    v10 = -536870199;
    goto LABEL_86;
  }
  v70 = v11;
  LODWORD(v13) = (*(int (__fastcall **)(__int64, __int64, signed __int64))(*(_QWORD *)v12 + 312LL))(
                   v12,
                   a2,
                   3758097097LL);
  if ( v13 != v6 )
  {
    (*(void (__fastcall **)(__int64))(*(_QWORD *)v12 + 312LL))(v12);
    KernelDebugLogInternal(
      1LL,
      1431519814LL,
      "AppleUSBOHCI::UIMCreateIsochTransfer - memory desc in dmaCommand (%p) different than IOMD (%p)");
    v10 = -536870199;
    goto LABEL_86;
  }
  v69 = v12;
  v14 = a3 | v78 | (v3 << 7);
  v15 = a1;
  v16 = *(_QWORD *)(a1 + 2752);
  do
  {
    v16 = *(_QWORD *)(v16 + 8);
    v10 = -536854441;
    if ( v16 == *(_QWORD *)(a1 + 2760) )
      goto LABEL_86;
  }
  while ( (**(_DWORD **)v16 & 0x1FFF) != v14 );
  v17 = v77;
  if ( v16 )
  {
    v18 = (**(_DWORD **)v16 >> 16) & 0x7FF;
    if ( v77 <= v71 )
    {
      v10 = -536870162;
      if ( v77 < v71 - 32752 )
        goto LABEL_86;
    }
    else
    {
      v10 = -536870161;
      if ( v77 > v71 + 32752 )
        goto LABEL_86;
    }
    LODWORD(v6) = 0;
    a3 = arg2;
    if ( (_DWORD)arg2 )
    {
      v19 = 1819044212;
      if ( v75 )
        v19 = 1953066092;
      v20 = v74 + 4;
      v15 = 0LL;
      v21 = 0LL;
      LODWORD(v6) = 0;
      while ( 1 )
      {
        v22 = v81 ? v74 + 16 * v21 + 4 : v20 + v15;
        if ( *(_WORD *)v22 > (unsigned int)v18 )
          break;
        if ( v81 )
        {
          v23 = *(_WORD *)(v20 + 2 * v15);
          *(_DWORD *)(v20 + 2 * v15 - 4) = v19;
        }
        else
        {
          v23 = *(_WORD *)(v20 + v15);
          *(_DWORD *)(v20 + v15 - 4) = v19;
        }
        LODWORD(v6) = v23 + (_DWORD)v6;
        ++v21;
        v15 += 8LL;
        if ( (unsigned int)v21 >= (unsigned int)arg2 )
          goto LABEL_35;
      }
LABEL_85:
      v10 = -536870206;
      goto LABEL_86;
    }
LABEL_35:
    v24 = AppleUSBOHCI::AllocateITD(arg1, v15);
    v25 = (unsigned __int64)v24;
    if ( !v24 )
      goto LABEL_88;
    if ( !(_DWORD)v6 )
    {
      v83 = 1;
      v87 = 0LL;
    }
    v26 = *(_QWORD *)(v16 + 24);
    *(_DWORD *)(*(_QWORD *)(v26 + 24) + 8LL) = *((_DWORD *)v24 + 2);
    *(_QWORD *)(v26 + 16) = v24;
    v27 = v26;
    v28 = -16777216;
    v10 = 0;
    if ( (_DWORD)arg2 )
    {
      v29 = 0LL;
      v66 = 0LL;
      v58 = 0;
      v30 = 0LL;
      v67 = 0;
      v54 = 0;
      v79 = 0;
      v72 = 0;
      v31 = 0LL;
      LODWORD(v32) = 0;
      v68 = 0;
      v60[0] = 0;
      v56 = 0;
      a3 = v27;
LABEL_40:
      v63 = v29;
      v65 = v74 + 16 * v29 + 4;
      v62 = (unsigned __int16)(v29 + v17);
      v64 = v74 + 8 * v29 + 4;
      while ( 1 )
      {
        if ( !(v30 & 1) && (_DWORD)v6 )
        {
          v33 = v64;
          if ( v81 )
            v33 = v65;
          v34 = *(_WORD *)v33;
          if ( v34 )
          {
            v61 = v34;
            v35 = v30;
            v55 = v32;
            v57 = v31;
            v59 = a3;
            a3 = v25;
            v83 = 2;
            v82 = v66;
            v36 = (*(int (__fastcall **)(__int64, __int64 *, __int64 *, int *))(*(_QWORD *)v69 + 344LL))(
                    v69,
                    &v82,
                    &v90,
                    &v83);
            if ( v36 )
            {
              KernelDebugLogInternal(
                1LL,
                1431519814LL,
                "AppleUSBOHCI::UIMCreateIsochTransfer - curFrameInRequest[%d] frameCount[%d] - got status (0x%x) from gen64IOVMSegments");
              v10 = v36;
              goto LABEL_86;
            }
            v37 = v83;
            v38 = 0;
            v30 = v35;
            if ( v83 )
            {
              v39 = &v91;
              v40 = 0LL;
              while ( 1 )
              {
                v41 = *(v39 - 1);
                if ( v41 > 0xFFFFFFFF )
                  break;
                v42 = *v39;
                if ( (unsigned __int64)*v39 > 0xFFFFFFFF )
                  break;
                *((_DWORD *)&v87 + 2 * v40) = v41;
                *((_DWORD *)&v87 + 2 * v40++ + 1) = v42;
                v39 += 2;
                if ( (unsigned int)v40 >= v37 )
                {
                  v38 = v37;
                  goto LABEL_54;
                }
              }
              KernelDebugLogInternal(
                1LL,
                1431519814LL,
                "AppleUSBOHCI::UIMCreateIsochTransfer - generated segments (%d) not 32 bit -  offset (0x%qx) length (0x%qx) ");
              v10 = -536870199;
              goto LABEL_86;
            }
LABEL_54:
            if ( v61 <= HIDWORD(v87) )
            {
              HIDWORD(v87) = v61;
              v83 = 1;
              v38 = 1;
              v25 = a3;
              a3 = v59;
              v31 = v57;
              LODWORD(v32) = v55;
              v43 = v66;
            }
            else
            {
              v25 = a3;
              v31 = v57;
              LODWORD(v32) = v55;
              v43 = v66;
              if ( v38 == 2 )
              {
                a3 = v59;
                if ( v61 - HIDWORD(v87) < v89 )
                  v89 = v61 - HIDWORD(v87);
              }
              else
              {
                a3 = v59;
              }
            }
            v44 = (v87 >> 32) + v43;
            if ( v38 == 2 )
            {
              v45 = v44 + v89;
              v38 = 2;
              if ( *(_BYTE *)(*(_QWORD *)(arg1 + 672) + 209LL) & 2 && ((unsigned int)v87 ^ v88) <= 0xFFF )
              {
                v83 = 1;
                v38 = 1;
              }
            }
            else
            {
              v45 = v44;
            }
            v56 = v87 & 0xFFF;
            v60[0] = ((_WORD)v87 + (unsigned __int16)(v87 >> 32)) & 0xFFF;
            v58 = (*((_DWORD *)&v87 + 2 * (unsigned int)(v38 - 1)) ^ (unsigned int)(*((_DWORD *)&v87
                                                                                    + 2 * (unsigned int)(v38 - 1))
                                                                                  + *((_DWORD *)&v87
                                                                                    + 2 * (unsigned int)(v38 - 1)
                                                                                    + 1))) > 0xFFF;
            v66 = v45;
          }
        }
        v46 = v87 & 0xFFFFF000;
        if ( (_DWORD)v32 )
        {
          if ( v46 != v72 )
          {
            if ( v67 && (v83 == 2 || v46 != v54 || v58) || v79 != v46 && v60[0] )
            {
              LOBYTE(v30) = 1;
            }
            else
            {
              v54 = (*((_DWORD *)&v87 + 2 * (v83 - 1)) + *((_DWORD *)&v87 + 2 * (v83 - 1) + 1)) & 0xFFFFF000;
              v67 = 4096;
            }
          }
        }
        else
        {
          *(_QWORD *)(a3 + 56) = v74;
          *(_DWORD *)(a3 + 64) = v63;
          *(_WORD *)a3 = v70;
          *(_DWORD *)(*(_QWORD *)(a3 + 24) + 4LL) = v46;
          v67 = 0;
          v31 = v62;
          v72 = v46;
          v30 = 0LL;
        }
        v79 = (*((_DWORD *)&v87 + 2 * (v83 - 1)) + *((_DWORD *)&v87 + 2 * (v83 - 1) + 1)) & 0xFFFFF000;
        if ( (unsigned int)v32 <= 7
          && !(v30 & 1)
          && (v81 == 0 || v81 != 0 && (_DWORD)arg3 == 0 || (unsigned int)v32 < (unsigned int)arg3) )
        {
          v32 = (unsigned int)v32;
          *(_WORD *)(*(_QWORD *)(a3 + 24) + 2 * v32 + 16) = v67 | v56 | 0xE000;
          LODWORD(v32) = v32 + 1;
          v68 = *((_DWORD *)&v87 + 2 * (v83 - 1)) + *((_DWORD *)&v87 + 2 * (v83 - 1) + 1) - 1;
          v29 = v63 + 1;
          v10 = 0;
          v17 = v77;
          if ( (signed int)v63 + 1 < (unsigned int)arg2 )
            goto LABEL_40;
          v28 = ((_DWORD)v32 << 24) - 0x1000000;
          goto LABEL_97;
        }
        v47 = v32;
        *(_DWORD *)(*(_QWORD *)(a3 + 24) + 12LL) = v68;
        v25 = (unsigned __int64)AppleUSBOHCI::AllocateITD(arg1, v25);
        if ( !v25 )
        {
          a3 = *(_QWORD *)(a3 + 16);
          v51 = *(_QWORD *)(v16 + 24);
          v52 = *(_QWORD *)(v51 + 16);
          *(_QWORD *)(v51 + 16) = 0LL;
          *(_DWORD *)(*(_QWORD *)(v51 + 24) + 8LL) = 0;
          v10 = -536870211;
          if ( v52 != a3 )
          {
            do
            {
              v53 = *(_QWORD *)(v52 + 16);
              AppleUSBOHCI::DeallocateITD(arg1, v52);
              v52 = v53;
            }
            while ( v53 != a3 );
            goto LABEL_96;
          }
          goto LABEL_86;
        }
        v31 = ((v47 << 24) + 251658240) | (unsigned int)v31 | 0xF0000000;
        **(_DWORD **)(a3 + 24) = v31;
        *(_QWORD *)(a3 + 40) = 0LL;
        *(_BYTE *)(a3 + 68) = v75;
        a3 = *(_QWORD *)(a3 + 16);
        if ( !a3 )
        {
          a3 = 0LL;
          v10 = 0;
          v28 = -16777216;
LABEL_97:
          v49 = v68;
          goto LABEL_92;
        }
        *(_DWORD *)(*(_QWORD *)(a3 + 24) + 8LL) = *(_DWORD *)(v25 + 8);
        *(_QWORD *)(a3 + 16) = v25;
        LODWORD(v32) = 0;
        LOBYTE(v30) = 1;
      }
    }
    v49 = 0;
    LODWORD(v31) = 0;
    a3 = v27;
LABEL_92:
    **(_DWORD **)(a3 + 24) = v31 | v28;
    *(_DWORD *)(*(_QWORD *)(a3 + 24) + 12LL) = v49;
    *(_QWORD *)(a3 + 48) = v86;
    v50 = v84;
    *(_QWORD *)(a3 + 40) = v85;
    *(_QWORD *)(a3 + 32) = v50;
    *(_BYTE *)(a3 + 68) = v75;
    *(_QWORD *)(v16 + 24) = v25;
    *(_DWORD *)(*(_QWORD *)v16 + 4LL) = *(_DWORD *)(v25 + 8);
  }
LABEL_86:
  while ( *(_QWORD *)off_B050[0] != v92 )
  {
LABEL_88:
    v10 = -536870211;
    if ( *(_BYTE *)off_B058[0] & 2 && *(_DWORD *)off_B060[0] & 0xFFFFFFF7 )
    {
      kernel_debug(0x52D3818u, (unsigned int)v6, a3, arg3, 0xFFFFFFFFE00002BDLL, 0LL);
LABEL_96:
      v10 = -536870211;
    }
  }
  return (unsigned int)v10;
}
// B050: using guessed type __int64 off_B050[4];
// B058: using guessed type __int64 off_B058[3];
// B060: using guessed type __int64 off_B060[2];
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);

//----- (0000000000008882) ----------------------------------------------------
int __fastcall AppleUSBOHCI::GetFrameNumberWithTime(AppleUSBOHCI *this, unsigned __int64 *a2, unsigned __int64 *a3)
{
  __int64 v3; // rdi@1
  int result; // eax@2

  v3 = *((_QWORD *)this + 18);
  if ( v3 )
    result = (*(int (__fastcall **)(__int64, __int64 (__fastcall *)(AppleUSBOHCI *__hidden, OSObject *, void *, void *, void *, void *), unsigned __int64 *, unsigned __int64 *, _QWORD, _QWORD))(*(_QWORD *)v3 + 456LL))(
               v3,
               AppleUSBOHCI::GatedGetFrameNumberWithTime,
               a2,
               a3,
               0LL,
               0LL);
  else
    result = -536870201;
  return result;
}

//----- (00000000000088C0) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::GatedGetFrameNumberWithTime(AppleUSBOHCI *this, OSObject *a2, void *a3, void *a4, void *a5, void *a6)
{
  *(_QWORD *)a2 = *((_QWORD *)this + 385);
  *(_QWORD *)a3 = *((_QWORD *)this + 383);
  return 0LL;
}

//----- (00000000000088DC) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMEnableAddressEndpoints(AppleUSBOHCI *this, unsigned __int16 a2, char a3)
{
  __int64 i; // rax@1
  int v4; // er10@2
  unsigned int v5; // ecx@3
  int v6; // er10@3
  __int64 v7; // rax@7
  __int64 v8; // r8@7
  int v9; // er9@7
  int v10; // esi@9
  unsigned int v11; // ecx@10
  int v12; // esi@10
  __int64 j; // rax@14
  int v14; // ecx@15
  unsigned int v15; // esi@16
  int v16; // ecx@16

  for ( i = *((_QWORD *)this + 347); i != *((_QWORD *)this + 349); i = *(_QWORD *)(i + 8) )
  {
    v4 = **(_DWORD **)i;
    if ( (**(_DWORD **)i & 0x7F) == a2 )
    {
      v5 = v4 & 0xFFFFBFFF;
      v6 = v4 | 0x4000;
      if ( a3 )
        v6 = v5;
      **(_DWORD **)i = v6;
      _mm_mfence();
    }
  }
  v7 = *((_QWORD *)this + 346);
  v8 = 0LL;
  v9 = a2;
  if ( v7 != *((_QWORD *)this + 348) )
  {
    v8 = 0LL;
    do
    {
      v10 = **(_DWORD **)v7;
      if ( (**(_DWORD **)v7 & 0x7F) == v9 )
      {
        v11 = v10 & 0xFFFFBFFF;
        v12 = v10 | 0x4000;
        if ( a3 )
          v12 = v11;
        **(_DWORD **)v7 = v12;
        _mm_mfence();
      }
      v7 = *(_QWORD *)(v7 + 8);
    }
    while ( v7 != *((_QWORD *)this + 348) );
  }
  do
  {
    for ( j = *((_QWORD *)this + 4 * v8 + 92); j != *((_QWORD *)this + 4 * v8 + 93); j = *(_QWORD *)(j + 8) )
    {
      v14 = **(_DWORD **)j;
      if ( (**(_DWORD **)j & 0x7F) == v9 )
      {
        v15 = v14 & 0xFFFFBFFF;
        v16 = v14 | 0x4000;
        if ( a3 )
          v16 = v15;
        **(_DWORD **)j = v16;
        _mm_mfence();
      }
    }
    ++v8;
  }
  while ( v8 != 63 );
  return 0LL;
}

//----- (00000000000089DE) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCI::UIMEnableAllEndpoints(AppleUSBOHCI *this)
{
  __int64 i; // rax@1
  int v2; // edx@4
  __int64 v3; // rcx@7
  __int64 v4; // r8@7
  int v5; // ebx@9
  __int64 j; // rcx@13
  int v7; // eax@14

  for ( i = *((_QWORD *)this + 347); i != *((_QWORD *)this + 349); i = *(_QWORD *)(i + 8) )
  {
    v2 = **(_DWORD **)i;
    if ( BYTE1(v2) & 0x40 )
    {
      if ( v2 & 0x7F )
      {
        **(_DWORD **)i = v2 & 0xFFFFBFFF;
        _mm_mfence();
      }
    }
  }
  v3 = *((_QWORD *)this + 346);
  v4 = 0LL;
  if ( v3 != *((_QWORD *)this + 348) )
  {
    v4 = 0LL;
    do
    {
      v5 = **(_DWORD **)v3;
      if ( BYTE1(v5) & 0x40 && v5 & 0x7F )
      {
        **(_DWORD **)v3 = v5 & 0xFFFFBFFF;
        _mm_mfence();
      }
      v3 = *(_QWORD *)(v3 + 8);
    }
    while ( v3 != *((_QWORD *)this + 348) );
  }
  do
  {
    for ( j = *((_QWORD *)this + 4 * v4 + 92); j != *((_QWORD *)this + 4 * v4 + 93); j = *(_QWORD *)(j + 8) )
    {
      v7 = **(_DWORD **)j;
      if ( BYTE1(v7) & 0x40 && v7 & 0x7F )
      {
        **(_DWORD **)j = v7 & 0xFFFFBFFF;
        _mm_mfence();
      }
    }
    ++v4;
  }
  while ( v4 != 63 );
  return 0LL;
}

//----- (0000000000008AB0) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIedMemoryBlock::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBOHCIedMemoryBlock", off_B038[0], 12336LL);
  result = (__int64)off_C060;
  *(_QWORD *)this = off_C060;
  return result;
}
// B038: using guessed type _QWORD off_B038[7];
// C060: using guessed type __int64 (__fastcall *off_C060[2])(AppleUSBOHCIedMemoryBlock::MetaClass *__hidden this);
// 1B250: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000008AE2) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIedMemoryBlock::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (0000000000008AEC) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::AppleUSBOHCIedMemoryBlock(__int64 a1)
{
  __int64 result; // rax@1

  OSObject::OSObject(a1);
  result = (__int64)off_BF30;
  *(_QWORD *)a1 = off_BF30;
  return result;
}
// BF30: using guessed type __int64 (__fastcall *off_BF30[2])(AppleUSBOHCIedMemoryBlock *__hidden this);
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000008B0C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::AppleUSBOHCIedMemoryBlock(__int64 a1)
{
  __int64 result; // rax@1

  OSObject::OSObject(a1);
  result = (__int64)off_BF30;
  *(_QWORD *)a1 = off_BF30;
  return result;
}
// BF30: using guessed type __int64 (__fastcall *off_BF30[2])(AppleUSBOHCIedMemoryBlock *__hidden this);
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000008B2C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::~AppleUSBOHCIedMemoryBlock(AppleUSBOHCIedMemoryBlock *this)
{
  return OSObject::~OSObject(this);
}

//----- (0000000000008B36) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::~AppleUSBOHCIedMemoryBlock(AppleUSBOHCIedMemoryBlock *this)
{
  return OSObject::~OSObject(this);
}

//----- (0000000000008B40) ----------------------------------------------------
void __fastcall AppleUSBOHCIedMemoryBlock::~AppleUSBOHCIedMemoryBlock(AppleUSBOHCIedMemoryBlock *this)
{
  OSObject::~OSObject(this);
  OSObject::operator delete((void *)this);
}

//----- (0000000000008B62) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::getMetaClass(AppleUSBOHCIedMemoryBlock *this)
{
  return (__int64)&AppleUSBOHCIedMemoryBlock::gMetaClass;
}
// C688: using guessed type _QWORD AppleUSBOHCIedMemoryBlock::gMetaClass;

//----- (0000000000008B70) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIedMemoryBlock::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBOHCIedMemoryBlock", off_B038[0], 12336LL);
  result = (__int64)off_C060;
  *(_QWORD *)this = off_C060;
  return result;
}
// B038: using guessed type _QWORD off_B038[7];
// C060: using guessed type __int64 (__fastcall *off_C060[2])(AppleUSBOHCIedMemoryBlock::MetaClass *__hidden this);
// 1B250: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000008BA2) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::MetaClass::alloc(AppleUSBOHCIedMemoryBlock::MetaClass *this, unsigned __int64 a2)
{
  __int64 v2; // rbx@1

  v2 = OSObject::operator new((OSObject *)((char *)&loc_302E + 2), a2);
  OSObject::OSObject(v2);
  *(_QWORD *)v2 = off_BF30;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIedMemoryBlock::gMetaClass);
  return v2;
}
// BF30: using guessed type __int64 (__fastcall *off_BF30[2])(AppleUSBOHCIedMemoryBlock *__hidden this);
// C688: using guessed type _QWORD AppleUSBOHCIedMemoryBlock::gMetaClass;
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000008BE2) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::AppleUSBOHCIedMemoryBlock(__int64 a1)
{
  OSObject::OSObject(a1);
  *(_QWORD *)a1 = off_BF30;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIedMemoryBlock::gMetaClass);
}
// BF30: using guessed type __int64 (__fastcall *off_BF30[2])(AppleUSBOHCIedMemoryBlock *__hidden this);
// C688: using guessed type _QWORD AppleUSBOHCIedMemoryBlock::gMetaClass;
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000008C12) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::AppleUSBOHCIedMemoryBlock(__int64 a1)
{
  OSObject::OSObject(a1);
  *(_QWORD *)a1 = off_BF30;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIedMemoryBlock::gMetaClass);
}
// BF30: using guessed type __int64 (__fastcall *off_BF30[2])(AppleUSBOHCIedMemoryBlock *__hidden this);
// C688: using guessed type _QWORD AppleUSBOHCIedMemoryBlock::gMetaClass;
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000008C42) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::NewMemoryBlock(AppleUSBOHCIedMemoryBlock *this, unsigned __int64 a2)
{
  __int64 v2; // r12@1
  __int64 v3; // rax@2
  unsigned __int64 v4; // r8@2
  __int64 v5; // r14@2
  __int64 v6; // rax@3
  __int64 v7; // r15@5
  signed __int64 v8; // rsi@5
  signed __int64 v9; // rsi@9
  void *v10; // rax@11
  int v12; // ebx@15
  int v13; // [sp+1Ch] [bp-34h]@1
  unsigned int v14; // [sp+20h] [bp-30h]@15
  int v15; // [sp+24h] [bp-2Ch]@17
  __int64 v16; // [sp+28h] [bp-28h]@1

  v2 = OSObject::operator new((OSObject *)((char *)&loc_302E + 2), a2);
  OSObject::OSObject(v2);
  *(_QWORD *)v2 = off_BF30;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIedMemoryBlock::gMetaClass);
  v16 = 0LL;
  v13 = 1;
  if ( v2 )
  {
    LODWORD(v3) = IODMACommand::withSpecification(off_B008[0], 32LL, 4096LL, 64LL, 0LL, 1LL);
    v5 = v3;
    if ( !v3 )
    {
      v7 = 0LL;
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "AppleUSBOHCIedMemoryBlock::NewMemoryBlock - could not create IODMACommand");
      return v7;
    }
    v6 = IOBufferMemoryDescriptor::inTaskWithPhysicalMask(
           *(IOBufferMemoryDescriptor **)off_B068,
           (task *)((char *)&dword_0 + 3),
           0x1000u,
           0xFFFFF000uLL,
           v4);
    *(_QWORD *)(v2 + 12328) = v6;
    if ( v6 )
    {
      if ( (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v6 + 496LL))(v6, 0LL) )
      {
        v7 = 0LL;
        v8 = 1431519814LL;
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBOHCIedMemoryBlock::NewMemoryBlock - could not prepare buffer");
LABEL_13:
        (*(void (__fastcall **)(_QWORD, signed __int64))(**(_QWORD **)(v2 + 12328) + 40LL))(*(_QWORD *)(v2 + 12328), v8);
        *(_QWORD *)(v2 + 12328) = 0LL;
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v2 + 40LL))(v2);
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v5 + 40LL))(v5);
        return v7;
      }
      LODWORD(v10) = (*(int (__cdecl **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 12328) + 736LL))(
                       *(_QWORD *)(v2 + 12328),
                       0LL);
      *(_QWORD *)(v2 + 24) = v10;
      bzero(v10, 0x1000uLL);
      if ( (*(int (__fastcall **)(__int64, _QWORD, signed __int64))(*(_QWORD *)v5 + 296LL))(
             v5,
             *(_QWORD *)(v2 + 12328),
             1LL) )
      {
        v7 = 0LL;
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBOHCIedMemoryBlock::NewMemoryBlock - could not set memory descriptor");
        v8 = 0LL;
        (*(void (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 12328) + 504LL))(*(_QWORD *)(v2 + 12328), 0LL);
        goto LABEL_13;
      }
      v12 = (*(int (__fastcall **)(__int64, __int64 *, int *, int *))(*(_QWORD *)v5 + 344LL))(v5, &v16, &v14, &v13);
      (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v5 + 304LL))(v5, 1LL);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v5 + 40LL))(v5);
      if ( !v12 && v13 == 1 && v15 == 4096 )
      {
        *(_QWORD *)(v2 + 16) = v14;
        return v2;
      }
      v7 = 0LL;
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "AppleUSBOHCIedMemoryBlock::NewMemoryBlock - could not get physical segment");
      v9 = 0LL;
      (*(void (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 12328) + 504LL))(*(_QWORD *)(v2 + 12328), 0LL);
      (*(void (__cdecl **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 12328) + 40LL))(*(_QWORD *)(v2 + 12328), 0LL);
      *(_QWORD *)(v2 + 12328) = 0LL;
    }
    else
    {
      v7 = 0LL;
      v9 = 1431519814LL;
      KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCIedMemoryBlock::NewMemoryBlock, could not allocate buffer!");
    }
    (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v2 + 40LL))(v2, v9);
    return v7;
  }
  KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCIedMemoryBlock::NewMemoryBlock, constructor failed!");
  return v2;
}
// 0: using guessed type int;
// B008: using guessed type __int64 off_B008[13];
// B068: using guessed type __int64 off_B068;
// BF30: using guessed type __int64 (__fastcall *off_BF30[2])(AppleUSBOHCIedMemoryBlock *__hidden this);
// C688: using guessed type _QWORD AppleUSBOHCIedMemoryBlock::gMetaClass;
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);
// 1B270: using guessed type int __fastcall IODMACommand::withSpecification(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000008EF4) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::NumEDs(AppleUSBOHCIedMemoryBlock *this)
{
  return 256LL;
}

//----- (0000000000008F00) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::GetSharedPhysicalPtr(AppleUSBOHCIedMemoryBlock *this, unsigned int a2)
{
  __int64 result; // rax@1

  result = 0LL;
  if ( a2 <= 0xFF )
    result = *((_QWORD *)this + 2) + 16LL * a2;
  return result;
}

//----- (0000000000008F1A) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::GetSharedLogicalPtr(AppleUSBOHCIedMemoryBlock *this, unsigned int a2)
{
  __int64 result; // rax@1

  result = 0LL;
  if ( a2 <= 0xFF )
    result = *((_QWORD *)this + 3) + 16LL * a2;
  return result;
}

//----- (0000000000008F34) ----------------------------------------------------
AppleUSBOHCIedMemoryBlock *__fastcall AppleUSBOHCIedMemoryBlock::GetED(AppleUSBOHCIedMemoryBlock *this, unsigned int a2)
{
  AppleUSBOHCIedMemoryBlock *result; // rax@1

  result = 0LL;
  if ( a2 <= 0xFF )
    result = (AppleUSBOHCIedMemoryBlock *)((char *)this + 48 * a2 + 40);
  return result;
}

//----- (0000000000008F54) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::GetNextBlock(AppleUSBOHCIedMemoryBlock *this)
{
  return *((_QWORD *)this + 4);
}

//----- (0000000000008F5E) ----------------------------------------------------
void __fastcall AppleUSBOHCIedMemoryBlock::SetNextBlock(AppleUSBOHCIedMemoryBlock *this, AppleUSBOHCIedMemoryBlock *a2)
{
  *((_QWORD *)this + 4) = a2;
}

//----- (0000000000008F68) ----------------------------------------------------
int __fastcall AppleUSBOHCIedMemoryBlock::free(AppleUSBOHCIedMemoryBlock *this)
{
  AppleUSBOHCIedMemoryBlock *v1; // rbx@1
  __int64 v2; // rdi@1

  v1 = this;
  v2 = *((_QWORD *)this + 1541);
  if ( v2 )
  {
    (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v2 + 504LL))(v2, 0LL);
    (*(void (__cdecl **)(_QWORD))(**((_QWORD **)v1 + 1541) + 40LL))(*((_QWORD *)v1 + 1541));
  }
  return (*(int (__fastcall **)(AppleUSBOHCIedMemoryBlock *))(off_B048[0] + 160))(v1);
}
// B048: using guessed type __int64 off_B048[5];

//----- (0000000000008FAC) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIgtdMemoryBlock::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBOHCIgtdMemoryBlock", off_B038[0], 16368LL);
  result = (__int64)off_C290;
  *(_QWORD *)this = off_C290;
  return result;
}
// B038: using guessed type _QWORD off_B038[7];
// C290: using guessed type __int64 (__fastcall *off_C290[2])(AppleUSBOHCIgtdMemoryBlock::MetaClass *__hidden this);
// 1B250: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000008FDE) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIgtdMemoryBlock::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (0000000000008FE8) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::AppleUSBOHCIgtdMemoryBlock(__int64 a1)
{
  __int64 result; // rax@1

  OSObject::OSObject(a1);
  result = (__int64)off_C160;
  *(_QWORD *)a1 = off_C160;
  return result;
}
// C160: using guessed type __int64 (__fastcall *off_C160[2])(AppleUSBOHCIgtdMemoryBlock *__hidden this);
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000009008) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::AppleUSBOHCIgtdMemoryBlock(__int64 a1)
{
  __int64 result; // rax@1

  OSObject::OSObject(a1);
  result = (__int64)off_C160;
  *(_QWORD *)a1 = off_C160;
  return result;
}
// C160: using guessed type __int64 (__fastcall *off_C160[2])(AppleUSBOHCIgtdMemoryBlock *__hidden this);
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000009028) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::~AppleUSBOHCIgtdMemoryBlock(AppleUSBOHCIgtdMemoryBlock *this)
{
  return OSObject::~OSObject(this);
}

//----- (0000000000009032) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::~AppleUSBOHCIgtdMemoryBlock(AppleUSBOHCIgtdMemoryBlock *this)
{
  return OSObject::~OSObject(this);
}

//----- (000000000000903C) ----------------------------------------------------
void __fastcall AppleUSBOHCIgtdMemoryBlock::~AppleUSBOHCIgtdMemoryBlock(AppleUSBOHCIgtdMemoryBlock *this)
{
  OSObject::~OSObject(this);
  OSObject::operator delete((void *)this);
}

//----- (000000000000905E) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::getMetaClass(AppleUSBOHCIgtdMemoryBlock *this)
{
  return (__int64)&AppleUSBOHCIgtdMemoryBlock::gMetaClass;
}
// C6B0: using guessed type _QWORD AppleUSBOHCIgtdMemoryBlock::gMetaClass;

//----- (000000000000906C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIgtdMemoryBlock::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBOHCIgtdMemoryBlock", off_B038[0], 16368LL);
  result = (__int64)off_C290;
  *(_QWORD *)this = off_C290;
  return result;
}
// B038: using guessed type _QWORD off_B038[7];
// C290: using guessed type __int64 (__fastcall *off_C290[2])(AppleUSBOHCIgtdMemoryBlock::MetaClass *__hidden this);
// 1B250: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (000000000000909E) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::MetaClass::alloc(AppleUSBOHCIgtdMemoryBlock::MetaClass *this, unsigned __int64 a2)
{
  __int64 v2; // rbx@1

  v2 = OSObject::operator new((OSObject *)&loc_3FF0, a2);
  OSObject::OSObject(v2);
  *(_QWORD *)v2 = off_C160;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIgtdMemoryBlock::gMetaClass);
  return v2;
}
// C160: using guessed type __int64 (__fastcall *off_C160[2])(AppleUSBOHCIgtdMemoryBlock *__hidden this);
// C6B0: using guessed type _QWORD AppleUSBOHCIgtdMemoryBlock::gMetaClass;
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (00000000000090DE) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::AppleUSBOHCIgtdMemoryBlock(__int64 a1)
{
  OSObject::OSObject(a1);
  *(_QWORD *)a1 = off_C160;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIgtdMemoryBlock::gMetaClass);
}
// C160: using guessed type __int64 (__fastcall *off_C160[2])(AppleUSBOHCIgtdMemoryBlock *__hidden this);
// C6B0: using guessed type _QWORD AppleUSBOHCIgtdMemoryBlock::gMetaClass;
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (000000000000910E) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::AppleUSBOHCIgtdMemoryBlock(__int64 a1)
{
  OSObject::OSObject(a1);
  *(_QWORD *)a1 = off_C160;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIgtdMemoryBlock::gMetaClass);
}
// C160: using guessed type __int64 (__fastcall *off_C160[2])(AppleUSBOHCIgtdMemoryBlock *__hidden this);
// C6B0: using guessed type _QWORD AppleUSBOHCIgtdMemoryBlock::gMetaClass;
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (000000000000913E) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::NewMemoryBlock(AppleUSBOHCIgtdMemoryBlock *this, unsigned __int64 a2)
{
  __int64 v2; // r12@1
  __int64 v3; // rax@2
  unsigned __int64 v4; // r8@2
  __int64 v5; // r14@2
  __int64 v6; // rax@3
  __int64 v7; // r15@5
  signed __int64 v8; // rsi@5
  signed __int64 v9; // rsi@9
  void *v10; // rax@11
  int v12; // ebx@15
  __int64 v13; // rax@18
  int v14; // [sp+1Ch] [bp-34h]@1
  unsigned int v15; // [sp+20h] [bp-30h]@15
  int v16; // [sp+24h] [bp-2Ch]@17
  __int64 v17; // [sp+28h] [bp-28h]@1

  v2 = OSObject::operator new((OSObject *)&loc_3FF0, a2);
  OSObject::OSObject(v2);
  *(_QWORD *)v2 = off_C160;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIgtdMemoryBlock::gMetaClass);
  v17 = 0LL;
  v14 = 1;
  if ( v2 )
  {
    LODWORD(v3) = IODMACommand::withSpecification(off_B008[0], 32LL, 4096LL, 64LL, 0LL, 1LL);
    v5 = v3;
    if ( !v3 )
    {
      v7 = 0LL;
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "AppleUSBOHCIedMemoryBlock::NewMemoryBlock - could not create IODMACommand");
      return v7;
    }
    v6 = IOBufferMemoryDescriptor::inTaskWithPhysicalMask(
           *(IOBufferMemoryDescriptor **)off_B068,
           (task *)((char *)&dword_0 + 3),
           0x1000u,
           0xFFFFF000uLL,
           v4);
    *(_QWORD *)(v2 + 16360) = v6;
    if ( v6 )
    {
      if ( (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v6 + 496LL))(v6, 0LL) )
      {
        v7 = 0LL;
        v8 = 1431519814LL;
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBOHCIedMemoryBlock::NewMemoryBlock - could not prepare buffer");
LABEL_13:
        (*(void (__fastcall **)(_QWORD, signed __int64))(**(_QWORD **)(v2 + 16360) + 40LL))(*(_QWORD *)(v2 + 16360), v8);
        *(_QWORD *)(v2 + 16360) = 0LL;
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v2 + 40LL))(v2);
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v5 + 40LL))(v5);
        return v7;
      }
      LODWORD(v10) = (*(int (__cdecl **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 16360) + 736LL))(
                       *(_QWORD *)(v2 + 16360),
                       0LL);
      *(_QWORD *)(v2 + 24) = v10;
      bzero(v10, 0x1000uLL);
      if ( (*(int (__fastcall **)(__int64, _QWORD, signed __int64))(*(_QWORD *)v5 + 296LL))(
             v5,
             *(_QWORD *)(v2 + 16360),
             1LL) )
      {
        v7 = 0LL;
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBOHCIedMemoryBlock::NewMemoryBlock - could not set memory descriptor");
        v8 = 0LL;
        (*(void (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 16360) + 504LL))(*(_QWORD *)(v2 + 16360), 0LL);
        goto LABEL_13;
      }
      v12 = (*(int (__fastcall **)(__int64, __int64 *, int *, int *))(*(_QWORD *)v5 + 344LL))(v5, &v17, &v15, &v14);
      (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v5 + 304LL))(v5, 1LL);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v5 + 40LL))(v5);
      if ( !v12 && v14 == 1 && v16 == 4096 )
      {
        *(_QWORD *)(v2 + 16) = v15;
        v13 = *(_QWORD *)(v2 + 24);
        *(_QWORD *)v13 = v2;
        *(_QWORD *)(v13 + 8) = 543650916LL;
        return v2;
      }
      v7 = 0LL;
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "AppleUSBOHCIedMemoryBlock::NewMemoryBlock - could not get physical segment");
      v9 = 0LL;
      (*(void (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 16360) + 504LL))(*(_QWORD *)(v2 + 16360), 0LL);
      (*(void (__cdecl **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 16360) + 40LL))(*(_QWORD *)(v2 + 16360), 0LL);
      *(_QWORD *)(v2 + 16360) = 0LL;
    }
    else
    {
      v7 = 0LL;
      v9 = 1431519814LL;
      KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCIedMemoryBlock::NewMemoryBlock, could not allocate buffer!");
    }
    (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v2 + 40LL))(v2, v9);
    return v7;
  }
  KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCIedMemoryBlock::NewMemoryBlock, constructor failed!");
  return v2;
}
// 0: using guessed type int dword_0;
// B008: using guessed type __int64 off_B008[13];
// B068: using guessed type __int64 off_B068;
// C160: using guessed type __int64 (__fastcall *off_C160[2])(AppleUSBOHCIgtdMemoryBlock *__hidden this);
// C6B0: using guessed type _QWORD AppleUSBOHCIgtdMemoryBlock::gMetaClass;
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);
// 1B270: using guessed type int __fastcall IODMACommand::withSpecification(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000009400) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::NumGTDs(AppleUSBOHCIgtdMemoryBlock *this)
{
  return 255LL;
}

//----- (000000000000940C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::GetSharedPhysicalPtr(AppleUSBOHCIgtdMemoryBlock *this, unsigned int a2)
{
  __int64 result; // rax@1

  result = 0LL;
  if ( a2 <= 0xFE )
    result = *((_QWORD *)this + 2) + 16LL * (a2 + 1);
  return result;
}

//----- (000000000000942A) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::GetSharedLogicalPtr(AppleUSBOHCIgtdMemoryBlock *this, unsigned int a2)
{
  __int64 result; // rax@1

  result = 0LL;
  if ( a2 <= 0xFE )
    result = *((_QWORD *)this + 3) + 16LL * (a2 + 1);
  return result;
}

//----- (0000000000009448) ----------------------------------------------------
AppleUSBOHCIgtdMemoryBlock *__fastcall AppleUSBOHCIgtdMemoryBlock::GetGTD(AppleUSBOHCIgtdMemoryBlock *this, unsigned int a2)
{
  AppleUSBOHCIgtdMemoryBlock *result; // rax@1

  result = 0LL;
  if ( a2 <= 0xFE )
    result = (AppleUSBOHCIgtdMemoryBlock *)((char *)this + 64 * (unsigned __int64)a2 + 40);
  return result;
}

//----- (0000000000009464) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(AppleUSBOHCIgtdMemoryBlock *this, int a2, unsigned int a3)
{
  __int64 result; // rax@1
  __int64 v4; // rax@7

  result = 0LL;
  if ( this )
  {
    if ( !a2 )
      a2 = IOMappedRead64((unsigned int)this & 0xFFFFF000 | 8LL);
    result = 0LL;
    if ( a2 == 543781988 )
    {
      result = AppleUSBOHCIitdMemoryBlock::GetITDFromPhysical(this, 543781988, a3);
    }
    else if ( a2 == 543650916 )
    {
      LODWORD(v4) = IOMappedRead64((unsigned int)this & 0xFFFFF000);
      result = v4 + ((unsigned __int64)(((unsigned __int8)((unsigned int)this >> 4) - 1) & 0xFFFFFFFF) << 6) + 40;
    }
  }
  return result;
}
// 1B1C0: using guessed type int __fastcall IOMappedRead64(_QWORD);

//----- (00000000000094E8) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::GetITDFromPhysical(AppleUSBOHCIitdMemoryBlock *this, int a2, unsigned int a3)
{
  __int64 result; // rax@1
  __int64 v4; // rax@7

  result = 0LL;
  if ( this )
  {
    if ( !a2 )
      a2 = IOMappedRead64((unsigned int)this & 0xFFFFF000 | 8LL);
    result = 0LL;
    if ( a2 == 543650916 )
    {
      result = AppleUSBOHCIgtdMemoryBlock::GetGTDFromPhysical(this, 543650916, a3);
    }
    else if ( a2 == 543781988 )
    {
      LODWORD(v4) = IOMappedRead64((unsigned int)this & 0xFFFFF000);
      result = v4 + 72LL * ((((unsigned int)this >> 5) & 0x7F) - 1) + 40;
    }
  }
  return result;
}
// 1B1C0: using guessed type int __fastcall IOMappedRead64(_QWORD);

//----- (000000000000956C) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::GetNextBlock(AppleUSBOHCIgtdMemoryBlock *this)
{
  return *((_QWORD *)this + 4);
}

//----- (0000000000009576) ----------------------------------------------------
void __fastcall AppleUSBOHCIgtdMemoryBlock::SetNextBlock(AppleUSBOHCIgtdMemoryBlock *this, AppleUSBOHCIgtdMemoryBlock *a2)
{
  *((_QWORD *)this + 4) = a2;
}

//----- (0000000000009580) ----------------------------------------------------
int __fastcall AppleUSBOHCIgtdMemoryBlock::free(AppleUSBOHCIgtdMemoryBlock *this)
{
  AppleUSBOHCIgtdMemoryBlock *v1; // rbx@1
  __int64 v2; // rdi@1

  v1 = this;
  v2 = *((_QWORD *)this + 2045);
  if ( v2 )
  {
    (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v2 + 504LL))(v2, 0LL);
    (*(void (__cdecl **)(_QWORD))(**((_QWORD **)v1 + 2045) + 40LL))(*((_QWORD *)v1 + 2045));
  }
  return (*(int (__fastcall **)(AppleUSBOHCIgtdMemoryBlock *))(off_B048[0] + 160))(v1);
}
// B048: using guessed type __int64 off_B048[5];

//----- (00000000000095C4) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIitdMemoryBlock::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBOHCIitdMemoryBlock", off_B038[0], 9192LL);
  result = (__int64)off_C4C0;
  *(_QWORD *)this = off_C4C0;
  return result;
}
// B038: using guessed type _QWORD off_B038[7];
// C4C0: using guessed type __int64 (__fastcall *off_C4C0[2])(AppleUSBOHCIitdMemoryBlock::MetaClass *__hidden this);
// 1B250: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (00000000000095F6) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIitdMemoryBlock::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (0000000000009600) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::AppleUSBOHCIitdMemoryBlock(__int64 a1)
{
  __int64 result; // rax@1

  OSObject::OSObject(a1);
  result = (__int64)off_C390;
  *(_QWORD *)a1 = off_C390;
  return result;
}
// C390: using guessed type __int64 (__fastcall *off_C390[2])(AppleUSBOHCIitdMemoryBlock *__hidden this);
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000009620) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::AppleUSBOHCIitdMemoryBlock(__int64 a1)
{
  __int64 result; // rax@1

  OSObject::OSObject(a1);
  result = (__int64)off_C390;
  *(_QWORD *)a1 = off_C390;
  return result;
}
// C390: using guessed type __int64 (__fastcall *off_C390[2])(AppleUSBOHCIitdMemoryBlock *__hidden this);
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000009640) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::~AppleUSBOHCIitdMemoryBlock(AppleUSBOHCIitdMemoryBlock *this)
{
  return OSObject::~OSObject(this);
}

//----- (000000000000964A) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::~AppleUSBOHCIitdMemoryBlock(AppleUSBOHCIitdMemoryBlock *this)
{
  return OSObject::~OSObject(this);
}

//----- (0000000000009654) ----------------------------------------------------
void __fastcall AppleUSBOHCIitdMemoryBlock::~AppleUSBOHCIitdMemoryBlock(AppleUSBOHCIitdMemoryBlock *this)
{
  OSObject::~OSObject(this);
  OSObject::operator delete((void *)this);
}

//----- (0000000000009676) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::getMetaClass(AppleUSBOHCIitdMemoryBlock *this)
{
  return (__int64)&AppleUSBOHCIitdMemoryBlock::gMetaClass;
}
// C6D8: using guessed type _QWORD AppleUSBOHCIitdMemoryBlock::gMetaClass;

//----- (0000000000009684) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::MetaClass::MetaClass(AppleUSBOHCIitdMemoryBlock::MetaClass *this)
{
  __int64 result; // rax@1

  OSMetaClass::OSMetaClass(this, "AppleUSBOHCIitdMemoryBlock", off_B038[0], 9192LL);
  result = (__int64)off_C4C0;
  *(_QWORD *)this = off_C4C0;
  return result;
}
// B038: using guessed type _QWORD off_B038[7];
// C4C0: using guessed type __int64 (__fastcall *off_C4C0[2])(AppleUSBOHCIitdMemoryBlock::MetaClass *__hidden this);
// 1B250: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (00000000000096B6) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::MetaClass::alloc(AppleUSBOHCIitdMemoryBlock::MetaClass *this, unsigned __int64 a2)
{
  __int64 v2; // rbx@1

  v2 = OSObject::operator new((OSObject *)((char *)&loc_23E6 + 2), a2);
  OSObject::OSObject(v2);
  *(_QWORD *)v2 = off_C390;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIitdMemoryBlock::gMetaClass);
  return v2;
}
// C390: using guessed type __int64 (__fastcall *off_C390[2])(AppleUSBOHCIitdMemoryBlock *__hidden this);
// C6D8: using guessed type _QWORD AppleUSBOHCIitdMemoryBlock::gMetaClass;
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (00000000000096F6) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::AppleUSBOHCIitdMemoryBlock(__int64 a1)
{
  OSObject::OSObject(a1);
  *(_QWORD *)a1 = off_C390;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIitdMemoryBlock::gMetaClass);
}
// C390: using guessed type __int64 (__fastcall *off_C390[2])(AppleUSBOHCIitdMemoryBlock *__hidden this);
// C6D8: using guessed type _QWORD AppleUSBOHCIitdMemoryBlock::gMetaClass;
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000009726) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::AppleUSBOHCIitdMemoryBlock(__int64 a1)
{
  OSObject::OSObject(a1);
  *(_QWORD *)a1 = off_C390;
  return OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIitdMemoryBlock::gMetaClass);
}
// C390: using guessed type __int64 (__fastcall *off_C390[2])(AppleUSBOHCIitdMemoryBlock *__hidden this);
// C6D8: using guessed type _QWORD AppleUSBOHCIitdMemoryBlock::gMetaClass;
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000009756) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::NewMemoryBlock(AppleUSBOHCIitdMemoryBlock *this, unsigned __int64 a2)
{
  __int64 v2; // r12@1
  __int64 v3; // rax@2
  unsigned __int64 v4; // r8@2
  __int64 v5; // r14@2
  __int64 v6; // rax@3
  __int64 v7; // r15@5
  signed __int64 v8; // rsi@5
  signed __int64 v9; // rsi@9
  void *v10; // rax@11
  int v12; // ebx@15
  __int64 v13; // rax@18
  int v14; // [sp+1Ch] [bp-34h]@1
  unsigned int v15; // [sp+20h] [bp-30h]@15
  int v16; // [sp+24h] [bp-2Ch]@17
  __int64 v17; // [sp+28h] [bp-28h]@1

  v2 = OSObject::operator new((OSObject *)((char *)&loc_23E6 + 2), a2);
  OSObject::OSObject(v2);
  *(_QWORD *)v2 = off_C390;
  OSMetaClass::instanceConstructed((OSMetaClass *)&AppleUSBOHCIitdMemoryBlock::gMetaClass);
  v17 = 0LL;
  v14 = 1;
  if ( v2 )
  {
    LODWORD(v3) = IODMACommand::withSpecification(off_B008[0], 32LL, 4096LL, 64LL, 0LL, 1LL);
    v5 = v3;
    if ( !v3 )
    {
      v7 = 0LL;
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "AppleUSBOHCIitdMemoryBlock::NewMemoryBlock - could not create IODMACommand");
      return v7;
    }
    v6 = IOBufferMemoryDescriptor::inTaskWithPhysicalMask(
           *(IOBufferMemoryDescriptor **)off_B068,
           (task *)((char *)&dword_0 + 3),
           0x1000u,
           0xFFFFF000uLL,
           v4);
    *(_QWORD *)(v2 + 9184) = v6;
    if ( v6 )
    {
      if ( (*(int (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v6 + 496LL))(v6, 0LL) )
      {
        v7 = 0LL;
        v8 = 1431519814LL;
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBOHCIitdMemoryBlock::NewMemoryBlock - could not prepare buffer");
LABEL_13:
        (*(void (__fastcall **)(_QWORD, signed __int64))(**(_QWORD **)(v2 + 9184) + 40LL))(*(_QWORD *)(v2 + 9184), v8);
        *(_QWORD *)(v2 + 9184) = 0LL;
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v2 + 40LL))(v2);
        (*(void (__fastcall **)(__int64))(*(_QWORD *)v5 + 40LL))(v5);
        return v7;
      }
      LODWORD(v10) = (*(int (__cdecl **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 9184) + 736LL))(
                       *(_QWORD *)(v2 + 9184),
                       0LL);
      *(_QWORD *)(v2 + 24) = v10;
      bzero(v10, 0x1000uLL);
      if ( (*(int (__fastcall **)(__int64, _QWORD, signed __int64))(*(_QWORD *)v5 + 296LL))(
             v5,
             *(_QWORD *)(v2 + 9184),
             1LL) )
      {
        v7 = 0LL;
        KernelDebugLogInternal(
          1LL,
          1431519814LL,
          "AppleUSBOHCIitdMemoryBlock::NewMemoryBlock - could not set memory descriptor");
        v8 = 0LL;
        (*(void (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 9184) + 504LL))(*(_QWORD *)(v2 + 9184), 0LL);
        goto LABEL_13;
      }
      v12 = (*(int (__fastcall **)(__int64, __int64 *, int *, int *))(*(_QWORD *)v5 + 344LL))(v5, &v17, &v15, &v14);
      (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v5 + 304LL))(v5, 1LL);
      (*(void (__fastcall **)(__int64))(*(_QWORD *)v5 + 40LL))(v5);
      if ( !v12 && v14 == 1 && v16 == 4096 )
      {
        *(_QWORD *)(v2 + 16) = v15;
        v13 = *(_QWORD *)(v2 + 24);
        *(_QWORD *)v13 = v2;
        *(_QWORD *)(v13 + 8) = 543781988LL;
        return v2;
      }
      v7 = 0LL;
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "AppleUSBOHCIitdMemoryBlock::NewMemoryBlock - could not get physical segment");
      v9 = 0LL;
      (*(void (__fastcall **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 9184) + 504LL))(*(_QWORD *)(v2 + 9184), 0LL);
      (*(void (__cdecl **)(_QWORD, _QWORD))(**(_QWORD **)(v2 + 9184) + 40LL))(*(_QWORD *)(v2 + 9184), 0LL);
      *(_QWORD *)(v2 + 9184) = 0LL;
    }
    else
    {
      v7 = 0LL;
      v9 = 1431519814LL;
      KernelDebugLogInternal(
        1LL,
        1431519814LL,
        "AppleUSBOHCIitdMemoryBlock::NewMemoryBlock, could not allocate buffer!");
    }
    (*(void (__fastcall **)(__int64, signed __int64))(*(_QWORD *)v2 + 40LL))(v2, v9);
    return v7;
  }
  KernelDebugLogInternal(1LL, 1431519814LL, "AppleUSBOHCIitdMemoryBlock::NewMemoryBlock, constructor failed!");
  return v2;
}
// 0: using guessed type int dword_0;
// B008: using guessed type __int64 off_B008[13];
// B068: using guessed type __int64 off_B068;
// C390: using guessed type __int64 (__fastcall *off_C390[2])(AppleUSBOHCIitdMemoryBlock *__hidden this);
// C6D8: using guessed type _QWORD AppleUSBOHCIitdMemoryBlock::gMetaClass;
// 1B1F0: using guessed type int __fastcall KernelDebugLogInternal(_QWORD, _QWORD, _QWORD);
// 1B270: using guessed type int __fastcall IODMACommand::withSpecification(_QWORD, _QWORD, _QWORD, _QWORD, _QWORD, _QWORD);
// 1B940: using guessed type int __cdecl OSObject::OSObject(_QWORD);

//----- (0000000000009A18) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::NumITDs(AppleUSBOHCIitdMemoryBlock *this)
{
  return 127LL;
}

//----- (0000000000009A24) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::GetSharedPhysicalPtr(AppleUSBOHCIitdMemoryBlock *this, unsigned int a2)
{
  __int64 result; // rax@1

  result = 0LL;
  if ( a2 <= 0x7E )
    result = *((_QWORD *)this + 2) + 32LL * (a2 + 1);
  return result;
}

//----- (0000000000009A3E) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::GetSharedLogicalPtr(AppleUSBOHCIitdMemoryBlock *this, unsigned int a2)
{
  __int64 result; // rax@1

  result = 0LL;
  if ( a2 <= 0x7E )
    result = *((_QWORD *)this + 3) + 32LL * (a2 + 1);
  return result;
}

//----- (0000000000009A58) ----------------------------------------------------
AppleUSBOHCIitdMemoryBlock *__fastcall AppleUSBOHCIitdMemoryBlock::GetITD(AppleUSBOHCIitdMemoryBlock *this, unsigned int a2)
{
  AppleUSBOHCIitdMemoryBlock *result; // rax@1

  result = 0LL;
  if ( a2 <= 0x7E )
    result = (AppleUSBOHCIitdMemoryBlock *)((char *)this + 72 * a2 + 40);
  return result;
}

//----- (0000000000009A70) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::GetNextBlock(AppleUSBOHCIitdMemoryBlock *this)
{
  return *((_QWORD *)this + 4);
}

//----- (0000000000009A7A) ----------------------------------------------------
void __fastcall AppleUSBOHCIitdMemoryBlock::SetNextBlock(AppleUSBOHCIitdMemoryBlock *this, AppleUSBOHCIitdMemoryBlock *a2)
{
  *((_QWORD *)this + 4) = a2;
}

//----- (0000000000009A84) ----------------------------------------------------
int __fastcall AppleUSBOHCIitdMemoryBlock::free(AppleUSBOHCIitdMemoryBlock *this)
{
  AppleUSBOHCIitdMemoryBlock *v1; // rbx@1
  __int64 v2; // rdi@1

  v1 = this;
  v2 = *((_QWORD *)this + 1148);
  if ( v2 )
  {
    (*(void (__fastcall **)(__int64, _QWORD))(*(_QWORD *)v2 + 504LL))(v2, 0LL);
    (*(void (__cdecl **)(_QWORD))(**((_QWORD **)v1 + 1148) + 40LL))(*((_QWORD *)v1 + 1148));
  }
  return (*(int (__fastcall **)(AppleUSBOHCIitdMemoryBlock *))(off_B048[0] + 160))(v1);
}
// B048: using guessed type __int64 off_B048[5];

//----- (0000000000009AC8) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIedMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIedMemoryBlock::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (0000000000009AD2) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIgtdMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIgtdMemoryBlock::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (0000000000009ADC) ----------------------------------------------------
__int64 __fastcall AppleUSBOHCIitdMemoryBlock::MetaClass::~MetaClass(AppleUSBOHCIitdMemoryBlock::MetaClass *this)
{
  return OSMetaClass::~OSMetaClass(this);
}

//----- (0000000000009AF0) ----------------------------------------------------
__int64 `global constructor keyed to'_a_0()
{
  __int64 v0; // rbx@1
  __int64 result; // rax@1

  v0 = off_B038[0];
  OSMetaClass::OSMetaClass(&AppleUSBOHCIedMemoryBlock::gMetaClass, "AppleUSBOHCIedMemoryBlock", off_B038[0], 12336LL);
  AppleUSBOHCIedMemoryBlock::gMetaClass = off_C060;
  OSMetaClass::OSMetaClass(&AppleUSBOHCIgtdMemoryBlock::gMetaClass, "AppleUSBOHCIgtdMemoryBlock", v0, 16368LL);
  AppleUSBOHCIgtdMemoryBlock::gMetaClass = off_C290;
  OSMetaClass::OSMetaClass(&AppleUSBOHCIitdMemoryBlock::gMetaClass, "AppleUSBOHCIitdMemoryBlock", v0, 9192LL);
  result = (__int64)off_C4C0;
  AppleUSBOHCIitdMemoryBlock::gMetaClass = off_C4C0;
  return result;
}
// B038: using guessed type _QWORD off_B038[7];
// C060: using guessed type __int64 (__fastcall *off_C060[2])(AppleUSBOHCIedMemoryBlock::MetaClass *__hidden this);
// C290: using guessed type __int64 (__fastcall *off_C290[2])(AppleUSBOHCIgtdMemoryBlock::MetaClass *__hidden this);
// C4C0: using guessed type __int64 (__fastcall *off_C4C0[2])(AppleUSBOHCIitdMemoryBlock::MetaClass *__hidden this);
// C688: using guessed type _QWORD AppleUSBOHCIedMemoryBlock::gMetaClass;
// C6B0: using guessed type _QWORD AppleUSBOHCIgtdMemoryBlock::gMetaClass;
// C6D8: using guessed type _QWORD AppleUSBOHCIitdMemoryBlock::gMetaClass;
// 1B250: using guessed type int __fastcall OSMetaClass::OSMetaClass(_QWORD, _QWORD, _QWORD, _QWORD);

//----- (0000000000009B80) ----------------------------------------------------
__int64 `global destructor keyed to'_a_0()
{
  OSMetaClass::~OSMetaClass((OSMetaClass *)&AppleUSBOHCIitdMemoryBlock::gMetaClass);
  OSMetaClass::~OSMetaClass((OSMetaClass *)&AppleUSBOHCIgtdMemoryBlock::gMetaClass);
  return OSMetaClass::~OSMetaClass((OSMetaClass *)&AppleUSBOHCIedMemoryBlock::gMetaClass);
}
// C688: using guessed type _QWORD AppleUSBOHCIedMemoryBlock::gMetaClass;
// C6B0: using guessed type _QWORD AppleUSBOHCIgtdMemoryBlock::gMetaClass;
// C6D8: using guessed type _QWORD AppleUSBOHCIitdMemoryBlock::gMetaClass;

//----- (0000000000009BA9) ----------------------------------------------------
int _start()
{
  int result; // eax@2

  if ( _realmain )
    result = _realmain();
  else
    result = 0;
  return result;
}
// C700: using guessed type int (*_realmain)(void);

//----- (0000000000009BC3) ----------------------------------------------------
__int64 *OSKextGetCurrentIdentifier()
{
  return &kmod_info + 2;
}
// C598: using guessed type __int64 kmod_info;

//----- (0000000000009BD4) ----------------------------------------------------
__int64 *OSKextGetCurrentVersionString()
{
  return &kmod_info + 10;
}
// C598: using guessed type __int64 kmod_info;

//----- (0000000000009BE5) ----------------------------------------------------
__int64 OSKextGetCurrentLoadTag()
{
  return *((_DWORD *)&kmod_info + 3);
}
// C598: using guessed type __int64 kmod_info;

//----- (0000000000009BF5) ----------------------------------------------------
int _stop()
{
  int result; // eax@2

  if ( _antimain )
    result = _antimain();
  else
    result = 0;
  return result;
}
// C708: using guessed type int (*_antimain)(void);

// ALL OK, 222 function(s) have been successfully decompiled
